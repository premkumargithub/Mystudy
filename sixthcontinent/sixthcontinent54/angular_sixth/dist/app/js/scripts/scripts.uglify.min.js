function checkEmailField(){""!=document.getElementById("to_emails").value&&$("#needEmail").hide()}function inviteCAffiliationUser(){var emails=document.getElementById("to_emails").value,url=document.getElementById("inviteUrl").value;return""==emails?($("#needEmail").show(),!1):($("#requestSending").hide(),$("#sendingloader").show(),angular.element(document.getElementById("InviteAffiliationController")).scope().InviteAffiliationUser(emails,url),void 0)}function callLogServiceOnError($http,actionUrl,resCode,reqObj,reqContentType,resObj,config){var opt={};opt.response_code="",opt.page_name=window.location.href,opt.action_name=actionUrl,opt.request_object=JSON.stringify(reqObj),opt.response_object=JSON.stringify(resObj),opt.request_content_type=JSON.stringify(reqContentType),opt.response_content_type=JSON.stringify(config.headers),opt.header_str=resCode;var url=APP.service.saveLogToServer;$http({method:"POST",url:url,data:{reqObj:opt},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(data){}).error(function(data,status,headers,config){})}function doPost($http,url,opt,callback){$http({method:"POST",url:url,data:{reqObj:opt},headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(data,status,headers,config){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function updateProfileWithFiles($http,url,opt,idcard,ssnfile,callback){var fd=new FormData;fd.append("idcard",idcard),fd.append("ssn",ssnfile),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostWithFile($http,url,opt,file,callback){var fd=new FormData;fd.append("group_media",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostUploadWithMedia($http,url,opt,files,callback){var fd=new FormData;angular.forEach(files,function(file){fd.append("user_media[]",file)}),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostUploadProfileMedia($http,url,opt,file,callback){var fd=new FormData;fd.append("user_media",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostUploadWithStoreMedia($http,url,opt,file,callback){var fd=new FormData;fd.append("store_media[]",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostReplyWithMedia($http,url,opt,file,callback){var fd=new FormData;fd.append("commentfile[]",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostPostOnGroupWithFile($http,url,opt,files,callback){var fd=new FormData;angular.forEach(files,function(file){fd.append("post_media[]",file)}),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostCommentOnGroupWithFile($http,url,opt,file,callback){var fd=new FormData;fd.append("commentfile[]",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doUploadStoreProfilePost($http,url,opt,file,callback){var fd=new FormData;fd.append("store_media",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostCommentOnStoreWithFile($http,url,opt,file,callback){var fd=new FormData;fd.append("commentfile[]",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostWithClubAlbumMedia($http,url,opt,files,callback){var fd=new FormData;fd.append("group_media[]",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doPostCommentOnDashboardWithFile($http,url,opt,file,callback){var fd=new FormData;fd.append("commentfile[]",file),fd.append("reqObj",angular.toJson(opt)),$http({method:"POST",url:url,data:fd,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(data){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,{reqObj:opt},"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?1045==data.code&&"TRIAL_EXPIRED"==data.message?TrailExpiredModal&&angular.element(document.getElementById("AppController")).scope().checkTrialExpired():notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function accessTokenExpiredLogout(){angular.element(document.getElementById("AppController")).scope().logoutWithoutService()}function checkTokenNotExpired(data){return data.hasOwnProperty("error")?void angular.element(document.getElementById("AppController")).scope().wentWrong():!1}function notAuthorizedThisRequest(){angular.element(document.getElementById("AppController")).scope().logoutWithoutService()}function doApplanePost($http,url,opt,callback){$http({method:"POST",url:url,data:JSON.stringify(opt),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(data,status,headers,config){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,opt,"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}function doApplaneUpdatePost($http,url,opt,callback){$http({method:"POST",url:url,data:JSON.stringify(opt),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(data,status,headers,config){callback(data)}).error(function(data,status,headers,config){callLogServiceOnError($http,url,status,opt,"application/x-www-form-urlencoded; charset=UTF-8",data,config),403===status?notAuthorizedThisRequest():401===status?accessTokenExpiredLogout():checkTokenNotExpired(data)||callback(data)})}app.controller("CitizenAffiliatedkController",["$scope","$http","AffiliatedkService",function($scope,$http,AffiliatedkService){$scope.followersLoader=!0,$scope.resultNotFound=!1,$scope.citizenAffiliate=[],$scope.affilateAllList=[],$scope.allRes=1,$scope.totalSize=0,$scope.firsttime=1,$scope.getCitizenAffiliate=function(){var limit_start=$scope.citizenAffiliate.length,opts={};opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.affiliation.end,($scope.totalSize>limit_start||0===$scope.totalSize&&1===$scope.firsttime)&&1===$scope.allRes&&($scope.allRes=0,$scope.followersLoader=!0,AffiliatedkService.getCitizenAffiliates(opts,function(data){$scope.allRes=1,101==data.code?($scope.citizenAffiliate=$.merge($scope.citizenAffiliate,data.data.affiliates),$scope.totalSize=data.data.count,$scope.followersLoader=!1,$scope.resultNotFound=!0,$scope.firsttime=0):($scope.followersLoader=!1,$scope.resultNotFound=!0)}))},$scope.getCitizenAffiliate(),$scope.loadMore=function(){$scope.getCitizenAffiliate()}}]),app.controller("ShopAffiliatedkController",["$scope","$http","AffiliatedkService",function($scope,$http,AffiliatedkService){$scope.followersLoader=!0,$scope.resultNotFound=!1,$scope.shopAffiliate=[],$scope.allRes=1,$scope.totalSize=0,$scope.incomeTax=APP.incomeTax,$scope.firsttime=1,$scope.getShopAffiliate=function(){var limit_start=$scope.shopAffiliate.length,opts={};opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.affiliation.end,($scope.totalSize>limit_start||1===(0===$scope.totalSize&&$scope.firsttime))&&1===$scope.allRes&&($scope.allRes=0,$scope.followersLoader=!0,AffiliatedkService.getShopAffiliates(opts,function(data){$scope.allRes=1,101==data.code?($scope.shopAffiliate=$.merge($scope.shopAffiliate,data.data.affiliates),$scope.totalSize=data.data.count,$scope.followersLoader=!1,$scope.resultNotFound=!0,$scope.firsttime=0):($scope.followersLoader=!1,$scope.resultNotFound=!0)}))},$scope.getShopAffiliate(),$scope.loadMore=function(){$scope.getShopAffiliate()}}]),app.controller("ShopAffiliatedkForBroker",["$scope","$http","AffiliatedkService",function($scope,$http,AffiliatedkService){$scope.followersLoader=!0,$scope.resultNotFound=!1,$scope.shopAffiliate=[],$scope.allRes=1,$scope.totalSize=0,$scope.incomeTax=APP.incomeTax,$scope.getShopAffiliate=function(){var opts={};opts.user_id=APP.currentUser.id,opts.limit_start=APP.affiliation.start,opts.limit_size=50,1==$scope.allRes&&($scope.allRes=0,$scope.followersLoader=!0,AffiliatedkService.getShopAffiliates(opts,function(data){$scope.allRes=1,101==data.code?($scope.filterItems(data.data.affiliates,function(data){$scope.shopAffiliate=data}),$scope.totalSize=data.data.count,$scope.followersLoader=!1,$scope.resultNotFound=!0):($scope.followersLoader=!1,$scope.resultNotFound=!0)}))},$scope.filterItems=function(orders,callback){for(var filtered_list=[],date=new Date,firstDay=new Date(date.getFullYear(),date.getMonth(),1),lastDay=new Date(date.getFullYear(),date.getMonth()+1,0),i=0;i<orders.length;i++)orders.created_at>=firstDay&&orders.created_at<=lastDay&&filtered_list.push(orders[i]);callback(filtered_list)},$scope.getShopAffiliate()}]),app.controller("BrokerAffiliatedkController",["$scope","$http","AffiliatedkService",function($scope,$http,AffiliatedkService){$scope.followersLoader=!0,$scope.resultNotFound=!1,$scope.brokerAffiliate=[],$scope.allRes=1,$scope.totalSize=0,$scope.getBrokerAffiliate=function(){var limit_start=$scope.brokerAffiliate.length,opts={};opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.affiliation.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.allRes=0,$scope.followersLoader=!0,AffiliatedkService.getBrokerAffiliates(opts,function(data){$scope.allRes=1,101==data.code?($scope.brokerAffiliate=$.merge($scope.brokerAffiliate,data.data.affiliates),$scope.totalSize=data.data.count,$scope.followersLoader=!1,$scope.resultNotFound=!0):($scope.followersLoader=!1,$scope.resultNotFound=!0)}))},$scope.getBrokerAffiliate(),$scope.loadMore=function(){$scope.getBrokerAffiliate()}}]),app.controller("AlbumController",["$scope","$rootScope","$modal","$log","AlbumService","$location","$routeParams","$timeout","ProfileImageService","fileReader","FileUploader","ProfileService","TranslationService","focus",function($scope,$rootScope,$modal,$log,AlbumService,$location,$routeParams,$timeout,ProfileImageService,fileReader,FileUploader,ProfileService,TranslationService,focus){$scope.myValue=!1,$scope.albloader=!1,$scope.noAlbums=!1,$scope.noPhotos=!1,$scope.uploadloader=!1,$scope.albumResponse="",$scope.listload=!1,$scope.listAlbum=[],$scope.totalSize=0,$scope.allRes=1,$scope.viewalbum=[],$scope.imagecount=0,$scope.totalSizeImg=0,$scope.allResImg=1,$scope.albumId=$routeParams.album_id,$scope.albumErrResponse=!1,$scope.storedFriend=[],$scope.tagged_Friends=[],$scope.tag=!1,$scope.tagged_photo=[],$scope.Name=APP.currentUser.firstname+" "+APP.currentUser.lastname,$scope.albmPrivacySet=3,$scope.userAlbumSubmitted=!1,$scope.createAlbumLoader=!1,$scope.createAlbum=function(){if($scope.userAlbumSubmitted=!0,void 0===$scope.user.albumname||""===$scope.user.albumname)return $scope.userAlbumForm.albumname.$dirty=!0,$scope.userAlbumForm.albumname.$invalid=!0,$scope.userAlbumForm.albumname.$error.required=!0,focus("albumname"),!1;if(void 0===$scope.user.albumdesc||""===$scope.user.albumdesc)return $scope.userAlbumForm.albumdesc.$dirty=!0,$scope.userAlbumForm.albumdesc.$invalid=!0,$scope.userAlbumForm.albumdesc.$error.required=!0,focus("albumdesc"),!1;if(void 0===$scope.albmPrivacySet||""===$scope.albmPrivacySet)return $scope.userAlbumForm.albumprivacy.$dirty=!0,$scope.userAlbumForm.albumprivacy.$invalid=!0,$scope.userAlbumForm.albumprivacy.$error.required=!0,focus("albumprivacy"),!1;$scope.createAlbumLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.album_name=$scope.user.albumname,opts.album_desc=$scope.user.albumdesc,opts.privacy_setting=$scope.albmPrivacySet,AlbumService.createAlbum(opts,function(data){$scope.createAlbumLoader=!1,$scope.userAlbumSubmitted=!1,101==data.code?($scope.listAlbum.length=0,$scope.albloader=!0,$scope.albumListing("listing"),$scope.user=null,$scope.myValue=!$scope.myValue,$scope.albumResponse=$scope.i18n.albums.album_created,$timeout(function(){$scope.albumResponse=""},5e3)):($scope.albumErrorResponse=$scope.i18n.albums.gone_wrong,$timeout(function(){$scope.albumErrorResponse=""},5e3))})},$scope.editAlbumForm=!1,$scope.updateUserAlbum=!1,$scope.editAlbum=function(temp){$scope.editAlbumData={},$scope.editAlbumData.id=temp.id,$scope.editAlbumData.album_name=temp.album_name,$scope.editAlbumData.album_description=temp.album_description,$scope.editAlbumData.album_privacy=temp.album_privacy,$scope.editAlbumForm=!$scope.editAlbumForm},$scope.closeEditForm=function(){$scope.editAlbumForm=!$scope.editAlbumForm,$scope.editAlbumData={}},$scope.updateAlbum=function(){if($scope.userAlbumSubmitted=!0,void 0===$scope.editAlbumData.album_name||""===$scope.editAlbumData.album_name)$scope.albumEditForm.editalbumname.$dirty=!0,$scope.albumEditForm.editalbumname.$invalid=!0,$scope.albumEditForm.editalbumname.$error.required=!0,focus("editalbumname");else if(void 0===$scope.editAlbumData.album_description||""===$scope.editAlbumData.album_description)$scope.albumEditForm.editalbumdesc.$dirty=!0,$scope.albumEditForm.editalbumdesc.$invalid=!0,$scope.albumEditForm.editalbumdesc.$error.required=!0,focus("editalbumdesc");else{$scope.updateUserAlbum=!0;var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.editAlbumData.id,opts.album_name=$scope.editAlbumData.album_name,opts.album_desc=$scope.editAlbumData.album_description,opts.privacy_setting=$scope.editAlbumData.album_privacy,opts.type="user",AlbumService.updateAlbum(opts,function(data){$scope.updateUserAlbum=!1,$scope.userAlbumSubmitted=!1,101==data.code?($scope.editAlbumForm=!$scope.editAlbumForm,$scope.listAlbum.length=0,$scope.albumListing("listing"),$scope.user=null,$scope.albumResponse=$scope.i18n.albums.album_updated,$timeout(function(){$scope.albumResponse=""},15e3)):($scope.editAlbumForm=!$scope.editAlbumForm,$scope.albumErrorResponse=$scope.i18n.albums.gone_wrong,$timeout(function(){$scope.albumErrorResponse=""},15e3))})}},$scope.uploadmediaAlbum=function(){if(void 0==$scope.imageToUpload||0==$scope.imageToUpload.length)return $scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.albums.select_image_first,$timeout(function(){$scope.fileNotValidMsg="",$scope.fileNotValid=!1},15e3),!1;$scope.uploadloader=!0,$("#addbutton").hide();var opts=($routeParams.album_id,{});opts.user_id=APP.currentUser.id,opts.album_id=$scope.albumId,opts.post_type=1;$scope.imageToUpload.length;opts.media_id=[],angular.forEach($scope.imageToUpload,function(file){opts.media_id.push(file.media_id)}),angular.forEach($scope.imageToUpload,function(index,file){}),$scope.fileNotValidMsg="",$scope.fileNotValid=!1,AlbumService.finalMediaAlbum(opts,function(data){101==data.code?($scope.uploadloader=!1,$("#addbutton").show(),$scope.viewalbum.length=0,$scope.totalSizeImg=0,$scope.allResImg=1,$scope.viewAlbum("upload"),$timeout(function(){$scope.albumResponse=""},15e3),$("input[type='file']").val(""),$scope.postFiles=[],$scope.imageToUpload=[],$scope.imgUpload=!1,uploader.queue=[]):($scope.uploadloader=!1,$("#addbutton").show(),$scope.albumResponse=data.message,$timeout(function(){$scope.albumResponse=""},15e3))})},$scope.fileNotValid=!1,$scope.fileNotValidMsg="",$scope.tempAlbumId="",$scope.albumImgLoader=[],$scope.imagePrvSrc=$scope.viewalbum,$scope.imageToUpload=[];var uploader=$scope.uploader=new FileUploader({url:APP.service.uploadmediaAlbum+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id,album_id:$scope.albumId,post_type:"0"},dataObjName:"reqObj",formDataName:"user_media[]"});uploader.filters.push({name:"user_media[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0;var queueLen=uploader.queue.length;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.albumImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imageToUpload.push(response.data),$scope.albumImgLoader[index]=!1)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.albums.upload_media_invalid,$timeout(function(){$scope.fileNotValidMsg=""},4e3)},$scope.removeImage=function(index,type){var tempImg=2==type?$scope.imagePrvSrc[index]:$scope.imageToUpload[index];if(2==type?$scope.imagePrvSrc.splice(index,1):$scope.imageToUpload.splice(index,1),$scope.uploader.queue[index]){var item=$scope.uploader.queue[index];item.remove()}if(tempImg){var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.albumId,opts.media_id=tempImg.media_id?tempImg.media_id:tempImg.id,AlbumService.deleteMediaAlbum(opts,function(data){101==data.code?tempImg.media_id||$scope.viewalbum.splice(index,1):(2==type?$scope.imagePrvSrc[index]=tempImg:$scope.imageToUpload[index]=tempImg,$timeout(function(){$scope.albumErrMsg=data.message},4e3))})}},$scope.albumListing=function(type){var limit_start=$scope.listAlbum.length;"delete"==type?$scope.albloader=!1:"listing"===type?$scope.albloader=!1:$scope.albloader=!0;var limit_start=$scope.listAlbum.length,opts={};opts.user_id=APP.currentUser.id,opts.friend_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=12,opts.friend_id=APP.currentUser.id,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.listload=!0,$scope.allRes=0,AlbumService.albumListing(opts,function(data){if(101==data.code){if("create"==type?$scope.albumResponse=$scope.i18n.albums.album_created:"delete"==type&&($scope.albumResponse=$scope.i18n.albums.album_deleted),$timeout(function(){$scope.albumResponse=""},15e3),$(".album-option").removeClass("album-blank"),$scope.noAlbums=!0,$scope.albloader=!1,$scope.totalSize=data.data.size,$scope.allRes=1,$scope.listAlbum=$scope.listAlbum.concat(data.data.albums),$scope.tagged_photo_available=data.data.tagged_photo,$scope.tagged_photo_available&&"Photo Of You"===$scope.tagged_photo_available.album_name){var opts={};opts.user_id=APP.currentUser.id,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=12,AlbumService.getTaggedPhoto(opts,function(data){$scope.tagged_photo=data.data})}$scope.listload=!1,0==$scope.totalSize||document.getElementById("albumname")&&($scope.user={})}else $scope.albloader=!1,$scope.listload=!1}))},$scope.loadMore=function(){$scope.albumListing("listing")},$scope.loadMoreImage=function(){$scope.viewalbum.length<$scope.imagecount?$scope.viewAlbum("listing"):$scope.listload=!1},$scope.delAlbmLoader=[],$scope.deleteAlbum=function(indx){$scope.delAlbmLoader[indx]=!0;var tempItem=$scope.listAlbum[indx],opts={};opts.user_id=$scope.currentUser.id,opts.album_id=tempItem.id,AlbumService.deleteAlbum(opts,function(data){101==data.code&&($scope.delAlbmLoader[indx]=!0,$scope.listAlbum.splice(indx,1),$timeout(function(){$scope.delAlbmLoader[indx]=""},15e3))})},$scope.albumDescription="",$scope.viewAlbum=function(type){var limit_start=$scope.viewalbum.length;"delete"==type?$scope.albloader=!1:"listing"===type?$scope.albloader=!1:"upload"===type?$scope.albloader=!1:$scope.albloader=!0;var albumId=$routeParams.album_id;$scope.albumname=$routeParams.album_name;var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=APP.currentUser.id,opts.album_id=albumId,opts.limit_start=limit_start,opts.limit_size=12,($scope.totalSizeImg>limit_start||0==$scope.totalSizeImg)&&1==$scope.allResImg&&($scope.listload=!0,$scope.allResImg=0,AlbumService.viewAlbum(opts,function(data){if(101==data.code){$scope.imagecount=data.data.size,$(".album-option").removeClass("album-blank"),$scope.albloader=!1,$scope.noPhotos=!0,"upload"==type?$scope.albumResponse=$scope.i18n.albums.successful_upload:"delete"==type?$scope.albumResponse=$scope.i18n.albums.sucessful_delete:$scope.albumResponse="",$scope.totalSizeImg=data.data.size,$scope.allResImg=1,$scope.viewalbum=$scope.viewalbum.concat(data.data.media),$scope.albumDescription=data.data.album.description,$scope.albumDetails=data.data.album,$scope.listload=!1;var str_imagePrvSrc=JSON.stringify($scope.imagePrvSrc);angular.forEach(data.data.media,function(data_img){-1===str_imagePrvSrc.indexOf(data_img.id)&&$scope.imagePrvSrc.push(data_img)})}else $scope.albloader=!1,$scope.noPhotos=!0,$scope.listload=!1}))},$scope.countPhoto=function(){var opts=($routeParams.album_id,{});opts.user_id=APP.currentUser.id,opts.album_id=Album_id,AlbumService.countPhoto(opts,function(data){101==data.code})},$scope.deleteMediaAlbum=function(m_id,index){var albumId=$routeParams.album_id,opts={};opts.user_id=APP.currentUser.id,opts.album_id=albumId,opts.media_id=m_id,AlbumService.deleteMediaAlbum(opts,function(data){101==data.code&&($scope.viewalbum.splice(index,1),$timeout(function(){$scope.albumResponse=""},15e3))})},$scope.setuserprofileimages=function(m_id,id){$("#featuredloaderlink-"+id).hide(),$("#featuredloader-"+id).show(),$scope.featuredloader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.media_id=m_id,AlbumService.setuserprofileimages(opts,function(data){101==data.code?($("#featuredloaderlink-"+id).show(),$("#featuredloader-"+id).hide(),$timeout(function(){$scope.albumResponse=""},4e3),$scope.viewmultiprofiles()):($scope.albumResponse=data.message,$("#featuredloaderlink-"+id).show(),$("#featuredloader-"+id).hide(),$timeout(function(){$scope.albumResponse=""},4e3))})},$scope.viewmultiprofiles=function(){$scope.albloader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.profile_type=4,ProfileImageService.viewmultiprofiles(opts,function(data){101==data.code?($scope.albloader=!1,$scope.picloader=!1,$scope.propic=!0,$rootScope.currentUser.basicProfile=data.data,$scope.albumResponse=$scope.i18n.albums.profile_pic_update):($scope.propic=!0,$scope.picloader=!1)})},$scope.showAlbumForm=function(){$scope.myValue=!0},$scope.closeForm=function(){$scope.myValue=!1},$scope.albumListing("all"),$scope.viewAlbum(),$scope.redirectUrl=function(album_id,album_name){$location.path("/album/images/"+album_id+"/"+album_name)},$scope.editPrivacyMsg=[],$scope.editPrivacyCls=[],$scope.updateAlbumPrivacy=[],$scope.changePrivacy=function(item,indx){var opts={};opts.user_id=$scope.currentUser.id,opts.album_id=item.id,opts.album_name=item.album_name,opts.album_desc=item.album_description,opts.privacy_setting=item.album_privacy,opts.type="user",AlbumService.updateAlbum(opts,function(data){$scope.updateAlbumPrivacy[indx]=!1,101==data.code?($scope.listAlbum[indx]=data.data,$scope.user=null,$scope.editPrivacyMsg[indx]=""):($scope.editPrivacyMsg[indx]=$scope.i18n.albums.gone_wrong,$timeout(function(){$scope.editPrivacyMsg[indx]=""},15e3))})},$scope.setPrivacy=function(item,value){var indx=$scope.listAlbum.indexOf(item),opts={};opts.user_id=$scope.currentUser.id,opts.album_id=item.id,opts.album_name=item.album_name,opts.album_desc=item.album_description,opts.privacy_setting=value,opts.type="user",AlbumService.updateAlbum(opts,function(data){$scope.updateAlbumPrivacy[indx]=!1,101==data.code?(data.data.media_in_album=item.media_in_album,data.data.featured_media_path=item.featured_media_path,$scope.listAlbum[indx].album_privacy=data.data.album_privacy,$scope.user=null,$scope.editPrivacyMsg[indx]=""):($scope.editPrivacyMsg[indx]=$scope.i18n.albums.gone_wrong,$timeout(function(){$scope.editPrivacyMsg[indx]=""},15e3))})}}]),app.controller("AllNotiController",["$cookieStore","$scope","$rootScope","$http","$location","$timeout","UserService","ProfileService","GroupService","SingleMediaDetailService","$modal","$log","AlbumService","ShopTransactionService","LandURL",function($cookieStore,$scope,$rootScope,$http,$location,$timeout,UserService,ProfileService,GroupService,SingleMediaDetailService,$modal,$log,AlbumService,ShopTransactionService,LandURL){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,$rootScope.showNotificationList=!1,$rootScope.loadNotification=!1,$scope.loadNotiResponse=1,$scope.scopeVar=!1,$scope.friendTagIndex=0,$scope.tagged_Friends=[],$scope.UpdateTag=!1,$scope.TagLoader=!1,$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.dublicate=!1,$scope.toBelong=!1,$scope.tagged_collection=[],$scope.untagg_friend={},$scope.choose=!1,$scope.max=5,$scope.isReadonly=!1;var modalInstance;$scope.showAllNotification=function($event){void 0!=$event&&$event.stopPropagation();var temp=$rootScope.toggleSearch;$rootScope.toggleSearch=null,setTimeout(function(){$rootScope.toggleSearch=temp},100),$rootScope.groupNotificationList=!1,$rootScope.showNewMessageList=!1,$rootScope.showFriendNotificationList=!1,$rootScope.loadGroupNotification=!1,$rootScope.showNotificationList=!$rootScope.showNotificationList,$scope.scopeVar=!$scope.scopeVar,$scope.scopeVar1=!1,$scope.scopeVar2=!1,$scope.scopeVar3=!1,$scope.scopeVar?$scope.getAllNotification():$rootScope.getCountOfAllTypeNotificaton()},$scope.notificationOut=function(){$rootScope.showNotificationList=!1,$scope.scopeVar=!1},$scope.blockDivClick=function(even){if("IMG"!==even.target.nodeName){var temp=$rootScope.toggleSearch;$rootScope.toggleSearch=null,setTimeout(function(){$rootScope.toggleSearch=temp},100)}},$scope.getAllNotification=function(){$rootScope.loadNotification=!0,$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,opts={},opts.user_id=APP.currentUser.id.toString(),
opts.is_view=1,opts.limit_start=0,opts.limit_size=200,1==$scope.loadNotiResponse&&($scope.loadNotiResponse=0,ProfileService.getAllTypeNotification(opts,function(data){$scope.loadNotiResponse=1,101==data.code?($scope.allNotification=data.data.requests,$scope.allTotal=data.data.size,$scope.NotificationFound=!0,$rootScope.loadNotification=!1,$rootScope.getCountOfAllTypeNotificaton()):($scope.NotificationFound=!1,$scope.allNotification=[],$scope.allTotal=0,$rootScope.loadNotification=!1)}))},$scope.deleteMarkNotification=function(tag,id,notificationId){$("#"+tag+"-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notificationId,ProfileService.markAsDelete(opts,function(data){101==data.code?($("#"+tag+"-"+id).hide(),$rootScope.getCountOfAllTypeNotificaton()):$("#"+tag+"-"+id).show()})},$scope.markAsRead=function(tag,id,notificationId){$("#"+tag+"-"+id).removeClass("unread-noti").addClass("read-noti"),$scope.allNotification[id].is_read=1,opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notificationId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton()})},$scope.markAsUnread=function(tag,id,notificationId){$("#"+tag+"-"+id).removeClass("read-noti").addClass("unread-noti"),$scope.allNotification[id].is_read=0,opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notificationId},$scope.viewClubDetail=function(clubId,notiId,clubType){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/club/view/"+clubId+"/"+clubType)})},$scope.viewUserAlbum=function(albumId,notiId,albumTitle){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/album/images/"+albumId+"/"+albumTitle)):LandURL.sendTo("/album/images/"+albumId+"/"+albumTitle)})},$scope.getmediainfo=function(media_id,album_type,parent_id,ownerid,parent_type,ClubMember){$scope.modal_loader=!0,$scope.pre_visible=!1,$scope.next_visible=!1,$scope.showInLimit=!0,$scope.album_type=album_type,$scope.parent_type=parent_type,$scope.parent_id=parent_id,$scope.media_id=media_id,$scope.supportId=ownerid,void 0!=ClubMember&&($scope.is_member=ClubMember),modalInstance=$modal.open({templateUrl:"app/views/img_modal_new.html",controller:"ModalController",size:"lg",scope:$scope}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date),$scope.tagged_Friends=[],$scope.UpdateTag=!1}),$scope.showAllTaggedFriend=function(){$scope.showInLimit=!1},$scope.data=[];var opt=new Object;opt.media_id=media_id,opt.album_type=album_type,opt.album_id=parent_id,opt.user_id=APP.currentUser.id,opt.owner_id=ownerid,SingleMediaDetailService.getMediaInfo(opt,function(data){101==data.code&&($scope.data=data.data,$scope.modal_loader=!1)})},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.viewUserProfile=function(friendId){friendId==APP.currentUser.id?(modalInstance.dismiss("cancel"),$location.path("profiles")):(modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId))},$scope.Tagtoggle=function(){$scope.UpdateTag=!$scope.UpdateTag},$scope.tagFriendSuggestion=function(event,friendname){if(40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex+1!==$scope.friends.length&&$scope.friendTagIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex-1!==-1&&$scope.friendTagIndex--):13===event.keyCode&&$scope.friends.length>0&&-1!==$scope.friendTagIndex&&$scope.selectFriend($scope.friends[$scope.friendTagIndex]),""===$("#searchTagFriend").val().trim()&&($scope.showFriendList=!1),event.keyCode>=65&&event.keyCode<=95){$scope.cancelFriendSearch=!1;var opts={};opts.user_id=APP.currentUser.id,friendname?opts.friend_name=friendname:opts.friend_name="",opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&(data.data.users.length>0?$scope.showFriendList=!0:$scope.showFriendList=!1,$scope.friends=data.data.users)})}},$scope.selectFriend=function(friendInfo){$scope.dublicate=!1,$scope.choose=!1,angular.forEach($scope.data.tagged_friends_info,function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.data.tagged_friends_info.push(friendInfo.user_info),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1)},$scope.taggService=function(){var pre_visible_status=$scope.pre_visible,next_visible_status=$scope.next_visible;$scope.pre_visible=!1,$scope.next_visible=!1;var frnd_array=[];angular.forEach($scope.data.tagged_friends_info,function(index){frnd_array.push(index.id)});var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.parent_id,opts.post_type=1,opts.media_id=[$scope.media_id],opts.tagged_friends=frnd_array.join(","),$scope.UpdateTag=!1,$scope.TagLoader=!0,AlbumService.photoTaging(opts,function(data){101===data.code&&($scope.choose=!0,$scope.TagLoader=!1),$scope.pre_visible=pre_visible_status,$scope.next_visible=next_visible_status})},$scope.removeTagFriend=function(friendIndex){$scope.data.tagged_friends_info.splice(friendIndex,1)},$scope.lostFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.findPeopleRate=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance1=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance1.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance1.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.waitRateResponse=!1,$scope.ratePicture=function(rating,picture_id,mediaIndex){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type_id=picture_id,opts.rate=rating,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,update=$scope.data.is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.data.avg_rate=data.data.avg_rate,$scope.data.no_of_votes=data.data.no_of_votes,$scope.data.is_rated=!0,$scope.data.current_user_rate=data.data.current_user_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.data.current_user_rate=0,$scope.data.is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeRating=function(pictureIndex,mediaIndex){var opts={};opts.user_id=APP.currentUser.id,opts.type_id=pictureIndex,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,$scope.waitRateResponse===!1&&($scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.data.current_user_rate=0,$scope.data.avg_rate=data.data.avg_rate,$scope.data.no_of_votes=data.data.no_of_votes,$scope.data.is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.data.current_user_rate=0,$scope.data.is_rated=!1),$scope.waitRateResponse=!1}))},$scope.viewClubAlbum=function(clubId,albumName,albumId,clubType,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/album/club/view/"+clubId+"/"+albumId+"/"+clubType+"/"+albumName)):LandURL.sendTo("/album/club/view/"+clubId+"/"+albumId+"/"+clubType+"/"+albumName)})},$scope.viewShopAlbum=function(shopId,albumTitle,albumId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/album/shop/image/"+albumId+"/"+albumTitle+"/"+shopId)):LandURL.sendTo("/album/shop/image/"+albumId+"/"+albumTitle+"/"+shopId)})},$scope.viewPost=function(postId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/post/"+postId)):LandURL.sendTo("/post/"+postId)})},$scope.viewClubPost=function(postId,clubId,notiId,clubType){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/club/"+clubId+"/post/"+postId+"/"+clubType)})},$scope.viewShopPost=function(postId,shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/shop/"+shopId+"/post/"+postId)})},$scope.viewTaggedMedia=function(photoId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code&&$rootScope.getCountOfAllTypeNotificaton()})},$scope.viewTxnPage=function(txnId,shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){if(101==data.code){var shopTransationObj={};shopTransationObj.tab=2,shopTransationObj.txnId=txnId,ShopTransactionService.setTransactionTab(shopTransationObj),$rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/shop/transaction/"+shopId)}})},$scope.viewShopProfile=function(shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code&&($rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/shop/view/"+shopId))})},$scope.viewCitizenProfile=function(userId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/wallets")):LandURL.sendTo("/wallets")})},$scope.viewShopPromotions=function(shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),LandURL.sendTo("/shop/promotions/"+shopId)):LandURL.sendTo("/shop/promotions/"+shopId)})}}]),app.controller("AllGroupNotiController",function($cookieStore,$scope,$rootScope,$http,$location,$timeout,UserService,ProfileService,GroupService){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,$rootScope.groupNotificationList=!1,$rootScope.loadGroupNotification=!1,$scope.groupNotiResponse=1,$scope.scopeVar3=!1,$scope.groupNotificationOut=function(){$rootScope.groupNotificationList=!1,$scope.scopeVar3=!1},$scope.blockDivClick=function(even){if("IMG"!==even.target.nodeName){var temp=$rootScope.toggleSearch;$rootScope.toggleSearch=null,setTimeout(function(){$rootScope.toggleSearch=temp},100)}},$scope.getAllGroupNotification=function($event){void 0!=$event&&$event.stopPropagation(),$scope.scopeVar=!1,$scope.scopeVar1=!1,$scope.scopeVar2=!1,$scope.scopeVar3=!$scope.scopeVar3,$rootScope.showNewMessageList=!1,$rootScope.showNotificationList=!1,$rootScope.showFriendNotificationList=!1,$rootScope.groupNotificationList=!$rootScope.groupNotificationList,$rootScope.loadGroupNotification=!$rootScope.loadGroupNotification,$scope.NotificationFound=!1,$scope.NotificationNotFound=!1;var opts={};opts.user_id=APP.currentUser.id.toString(),opts.is_view="1",opts.limit_start=0,opts.limit_size=100,1==$scope.groupNotiResponse&&$scope.scopeVar3&&($scope.groupNotiResponse=0,ProfileService.getAllGroupNotification(opts,function(data){$scope.groupNotiResponse=1,101==data.code?($scope.allNotification=data.data.requests,$scope.allTotal=data.data.size,$scope.NotificationFound=!0,$rootScope.loadGroupNotification=!1,$rootScope.getCountOfAllTypeNotificaton()):($scope.NotificationFound=!1,$scope.allNotification=[],$scope.allTotal=0,$rootScope.loadGroupNotification=!1,$rootScope.getCountOfAllTypeNotificaton())})),$scope.scopeVar3||$rootScope.getCountOfAllTypeNotificaton()},$scope.AcceptClubRequest=function(senderId,requestId,groupId,groupType,id,$event){$("#Groupnotification-request-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=1,GroupService.responseClubNotification(opts,function(data){101==data.code?($("#Groupnotification-request-"+id).hide(),$rootScope.getCountOfAllTypeNotificaton(),$scope.getAllGroupNotification($event)):$("#Groupnotification-request-"+id).show()})},$scope.RejectClubRequest=function(senderId,requestId,groupId,groupType,id,$event){$("#Groupnotification-request-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=2,GroupService.responseClubNotification(opts,function(data){101==data.code?($("#Groupnotification-request-"+id).hide(),$rootScope.getCountOfAllTypeNotificaton()):$("#Groupnotification-request-"+id).hide()})}}),app.controller("AllNotificationView",["$cookieStore","$scope","$rootScope","$http","$timeout","$location","ProfileService","ShopTransactionService",function($cookieStore,$scope,$rootScope,$http,$timeout,$location,ProfileService,ShopTransactionService){$scope.loadNotificationList=!1,$scope.loadNotificationListFound=!1,$scope.listResponse=1,$scope.allNotificationList=[],$scope.endLimit=12,$scope.allTotal=0,$scope.getAllNotificationList=function(){var limit_start=$scope.allNotificationList.length;opts={},opts.user_id=APP.currentUser.id.toString(),opts.is_view=1,opts.limit_start=limit_start,opts.limit_size=$scope.endLimit,($scope.allTotal>limit_start||0==$scope.allTotal)&&1==$scope.listResponse&&($scope.loadNotificationList=!0,$scope.listResponse=0,ProfileService.getAllTypeNotification(opts,function(data){$scope.listResponse=1,101==data.code?($scope.allNotificationList=$scope.allNotificationList.concat(data.data.requests),$scope.allTotal=data.data.size,$scope.loadNotificationList=!1,$scope.loadNotificationListFound=!0):($scope.allNotificationList=[],$scope.allTotal=0,$scope.loadNotificationList=!1,$scope.loadNotificationListFound=!0)}))},$scope.getAllNotificationList(),$scope.loadMore=function(){$scope.getAllNotificationList()},$scope.deleteMarkNotification=function(tag,id,notificationId){$("#"+tag+"-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notificationId,ProfileService.markAsDelete(opts,function(data){101==data.code?($("#"+tag+"-"+id).hide(),$rootScope.getCountOfAllTypeNotificaton()):$("#"+tag+"-"+id).show()})},$scope.markAsRead=function(tag,id,notificationId){$("#"+tag+"-"+id).removeClass("unread-noti").addClass("read-noti"),$scope.allNotification[id].is_read=1,opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notificationId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton()})},$scope.markAsUnread=function(tag,id,notificationId){$("#"+tag+"-"+id).removeClass("read-noti").addClass("unread-noti"),$scope.allNotification[id].is_read=0,opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notificationId},$scope.viewClubDetail=function(clubId,notiId,clubType){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton(),$location.path("/club/view/"+clubId+"/"+clubType)})},$scope.viewUserAlbum=function(albumId,notiId,albumTitle){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),$location.path("/album/images/"+albumId+"/"+albumTitle)):$location.path("/album/images/"+albumId+"/"+albumTitle)})},$scope.viewClubAlbum=function(clubId,albumName,albumId,clubType,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),$location.path("/album/club/view/"+clubId+"/"+albumId+"/"+clubType+"/"+albumName)):$location.path("/album/club/view/"+clubId+"/"+albumId+"/"+clubType+"/"+albumName)})},$scope.viewShopAlbum=function(shopId,albumTitle,albumId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),$location.path("/album/shop/image/"+albumId+"/"+albumTitle+"/"+shopId)):$location.path("/album/shop/image/"+albumId+"/"+albumTitle+"/"+shopId)})},$scope.viewPost=function(postId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code?($rootScope.getCountOfAllTypeNotificaton(),$location.path("/post/"+postId)):$location.path("/post/"+postId)})},$scope.viewClubPost=function(postId,clubId,notiId,clubType){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton(),$location.path("/club/"+clubId+"/post/"+postId+"/"+clubType)})},$scope.viewShopPost=function(postId,shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){$rootScope.getCountOfAllTypeNotificaton(),$location.path("/shop/"+shopId+"/post/"+postId)})},$scope.viewTaggedMedia=function(photoId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code&&$rootScope.getCountOfAllTypeNotificaton()})},$scope.viewTxnPage=function(txnId,shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){if(101==data.code){var shopTransationObj={};shopTransationObj.tab=2,shopTransationObj.txnId=txnId,ShopTransactionService.setTransactionTab(shopTransationObj),$rootScope.getCountOfAllTypeNotificaton(),$location.path("/shop/transaction/"+shopId)}})},$scope.viewShopProfile=function(shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code&&($rootScope.getCountOfAllTypeNotificaton(),$location.path("/shop/view/"+shopId))})},$scope.viewCitizenProfile=function(userId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code&&($rootScope.getCountOfAllTypeNotificaton(),$location.path("/wallets"))})},$scope.viewShopPromotions=function(shopId,notiId){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=notiId,ProfileService.markReadNotification(opts,function(data){101==data.code&&($rootScope.getCountOfAllTypeNotificaton(),$location.path("/shop/promotions/"+shopId))})}}]),app.controller("AllClubReNotificationView",["$cookieStore","$scope","$rootScope","$http","$location","$timeout","ProfileService","GroupService",function($cookieStore,$scope,$rootScope,$http,$location,$timeout,ProfileService,GroupService){$scope.loadGroupNotificationList=!1,$scope.groupNotificationFound=!1,$scope.groupNotiResponse=1,$scope.allGroupNotification=[],$scope.allTotal=0,$scope.endLimit=12,$scope.getAllGroupNotification=function(){var limit_start=$scope.allGroupNotification.length;opts={},opts.user_id=APP.currentUser.id.toString(),opts.is_view="1",opts.limit_start=limit_start,opts.limit_size=$scope.endLimit,($scope.allTotal>limit_start||0==$scope.allTotal)&&1==$scope.groupNotiResponse&&($scope.loadGroupNotificationList=!0,$scope.groupNotiResponse=0,ProfileService.getAllGroupNotification(opts,function(data){$scope.groupNotiResponse=1,$scope.groupNotificationFound=!0,101==data.code?($scope.allGroupNotification=$scope.allGroupNotification.concat(data.data.requests),$scope.allTotal=data.data.size,$scope.loadGroupNotificationList=!1):($scope.allGroupNotification=[],$scope.allTotal=0,$scope.loadGroupNotificationList=!1)}))},$scope.getAllGroupNotification(),$scope.loadMore=function(){$scope.getAllGroupNotification()},$scope.AcceptClubRequest=function(senderId,requestId,groupId,groupType,id){$("#notification-request-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=1,GroupService.responseClubNotification(opts,function(data){101==data.code?($("#notification-request-"+id).hide(),$rootScope.getCountOfAllTypeNotificaton()):$("#notification-request-"+id).show()})},$scope.RejectClubRequest=function(senderId,requestId,groupId,groupType,id){$("#notification-request-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=2,GroupService.responseClubNotification(opts,function(data){101==data.code?($("#notification-request-"+id).hide(),$rootScope.getCountOfAllTypeNotificaton()):$("#notification-request-"+id).hide()})}}]),app.controller("ClubRequestAction",["$cookieStore","$scope","$rootScope","$http","$routeParams","$location","GroupService",function($cookieStore,$scope,$rootScope,$http,$routeParams,$location,GroupService){$scope.requestLoader=!0,$scope.notAccesssible=!1,opts={},opts.user_id=APP.currentUser.id,opts.request_id=$routeParams.notiId,opts.sender_id=$routeParams.senderId,opts.group_id=$routeParams.clubId,1==$routeParams.clubType?opts.request_type="admin":opts.request_type="user",opts.response=$routeParams.action,GroupService.responseClubNotification(opts,function(data){182==data.code?$scope.requestLoader=!1:2==$routeParams.clubType&&2==$routeParams.action?($scope.requestLoader=!1,$scope.notAccesssible=!0):$location.path("/club/view/"+$routeParams.clubId+"/"+$routeParams.clubType)})}]),app.controller("AllNotiFriendController",["$cookieStore","$scope","$rootScope","$http","$location","$timeout","$modal","$log","UserService","ProfileService","GroupService",function($cookieStore,$scope,$rootScope,$http,$location,$timeout,$modal,$log,UserService,ProfileService,GroupService){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,$rootScope.showFriendNotificationList=!1,$rootScope.loadNotification1=!1,$scope.loadNotiResponse=1,$scope.scopeVar2=!1,$scope.showFriendNotification=function($event){void 0!=$event&&$event.stopPropagation();var temp=$rootScope.toggleSearch;$rootScope.toggleSearch=null,setTimeout(function(){$rootScope.toggleSearch=temp},100),$rootScope.groupNotificationList=!1,$rootScope.loadGroupNotification=!1,$rootScope.showNewMessageList=!1,$rootScope.showNotificationList=!1,$rootScope.showFriendNotificationList=!$rootScope.showFriendNotificationList,$scope.scopeVar2=!$scope.scopeVar2,$scope.scopeVar1=!1,$scope.scopeVar=!1,$scope.scopeVar2?$rootScope.getAllFriendNotification():$rootScope.getCountOfAllTypeNotificaton()},$scope.NotificationFriendOut=function(){$rootScope.showFriendNotificationList=!1,$scope.scopeVar2=!1},$scope.blockDivClick=function(even){if("IMG"!==even.target.nodeName){var temp=$rootScope.toggleSearch;$rootScope.toggleSearch=null,setTimeout(function(){$rootScope.toggleSearch=temp},100)}},$scope.FriendRequests=[],$rootScope.getAllFriendNotification=function(){$scope.FriendRequests=[],$rootScope.loadNotification1=!0,$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,opts={},opts.user_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=100,ProfileService.getPendingFreindReq(opts,function(data){101==data.code?($scope.FriendRequests=data.data.requests,$rootScope.allFriendTotal=data.data.size,$scope.NotificationFound=!0,$rootScope.loadNotification1=!1,$scope.NotificationNotFound=!0):($scope.NotificationNotFound=!0,$rootScope.loadNotification1=!1)})},$scope.AcceptRequest=function(friendInfo,id){$("#notification-request-friend-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.friend_id=friendInfo.friend_id,opts.action=1,1==friendInfo.personal?opts.request_type=1:1==friendInfo.professional&&(opts.request_type=2),ProfileService.acceptFriendRequest(opts,function(data){101==data.code?($("#notification-request-friend-"+id).hide(),$location.path("/viewfriend/"+friendInfo.friend_id)):$("#notification-request-friend-"+id).show()})},$scope.RejectRequest=function(friend,id){$("#notification-request-friend-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.friend_id=friend.friend_id,opts.action="0",1==friend.personal?opts.request_type=1:1==friend.professional&&(opts.request_type=2),ProfileService.rejectFriendRequest(opts,function(data){101==data.code?($("#notification-request-friend-"+id).hide(),$rootScope.getAllFriendNotification()):$("#notification-request-friend-"+id).hide()})},UserService.isAuthenticated()&&$rootScope.getAllFriendNotification()}]),app.controller("AllSearchProfile",["$cookieStore","$rootScope","$scope","$http","$location","$timeout","$routeParams","ProfileService",function($cookieStore,$rootScope,$scope,$http,$location,$timeout,$routeParams,ProfileService){$scope.searchType=1,$scope.searchtext=$routeParams.text,$scope.allItems=[],$scope.itemSearching=!1,$scope.activeTab="user",$scope.totalItems=0,$scope.searchType=1,$scope.res=1,$scope.itemPerPage=12,$scope.AllSearchloader=!0,$scope.searchAllProfiles=function(type){var limit_start=$scope.allItems.length.toString(),opts={};opts.user_id=APP.currentUser.id,opts.search_text=$scope.searchtext,opts.search_type=type,opts.limit_start=limit_start,opts.limit_size=$scope.itemPerPage,($scope.totalItems>limit_start||0==$scope.totalItems)&&1==$scope.res&&($scope.res=0,$scope.AllSearchloader=!0,ProfileService.getAllsearchProfiles(opts,function(data){$scope.res=1,101==data.code?($scope.AllSearchloader=!1,$scope.allItems=$scope.allItems.concat(data.data.results),$scope.totalItems=data.data.total_count):$scope.AllSearchloader=!1}))},$scope.searchAllProfiles($scope.searchType),$scope.changeItems=function(type){switch($scope.allItems=[],$scope.totalItems=0,$scope.res=1,$scope.searchType=type,$scope.searchType){case 1:$scope.activeTab="user";break;case 2:$scope.activeTab="shop";break;case 3:$scope.activeTab="club"}$scope.searchAllProfiles($scope.searchType)},$scope.loadMore=function(){$scope.searchAllProfiles($scope.searchType)}}]),app.controller("BLShopsController",["$scope","$http","BLShopService","$timeout",function($scope,$http,BLShopService,$timeout){$scope.storeAllList=[],$scope.storeListObject=[],$scope.storeMyList=[],$scope.storeAllList=[],$scope.myRes=1,$scope.totalSize=0,$scope.storeLoading=!0,$scope.notFound=!1,$scope.allRes=1,$scope.showPublicShop=function(){var opts={},limit_start=$scope.storeAllList.length;opts.limit_start=limit_start,opts.limit_size=APP.store_list_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.storeLoading=!0,$scope.allRes=0,BLShopService.getPublicShops(opts,function(data){101==data.code?($scope.allRes=1,$scope.totalSize=data.data.size,$scope.storeListObject=$scope.storeAllList=$scope.storeAllList.concat(data.data.stores),$scope.storeLoading=!1,$scope.notFound=!1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1)}))},$scope.showPublicShop(),$scope.loadMore=function(){$scope.showPublicShop()},$scope.listActive="active",$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.searchTitle="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#shopserchbox").keypress(function(){$scope.searchTitle;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.searchStore()},DELAY_TIME_BEFORE_POSTING)}),$scope.searchRes=0,$scope.searchStore=function(){$scope.searchRes=0,$scope.storeLoading=!0,$scope.myStoreActive="";var opts={};$scope.searchTitle.length>=3&&(void 0!==$scope.searchTitle&&""!==$scope.searchTitle||1!=$scope.searchRes||($scope.allRes=1,$scope.storeMyList=[],$scope.storeAllList=[]),opts.business_name=void 0===$scope.searchTitle?"":$scope.searchTitle,opts.limit_start=APP.store_list_pagination.start,opts.limit_size=APP.store_list_pagination.end,BLShopService.getSearchStoreDetail(opts,function(data){$scope.searchRes=1,101==data.code?($scope.storeListObject=data.data,$scope.storeLoading=!1,$scope.notFound=!1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1)}))}}]),app.controller("BLDetailShopsController",["$route","$scope","$location","$http","BLShopService","$timeout","$routeParams",function($route,$scope,$location,$http,BLShopService,$timeout,$routeParams){$scope.$route=$route,$scope.storeMainId=$routeParams.id;var latitudeMap=0,longitudeMap=0;$scope.loadDetails=function(){$scope.storeLoading=!0,$scope.updateStart=!1,$scope.createStoreError=!1,$scope.showEditForm=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.id,BLShopService.getShopsDetail(opts,function(data){101==data.code?($scope.storeDetail=data.data,$scope.store=$scope.storeDetail,$scope.storeLoading=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,-1!=$location.path().indexOf("/shop/edit")||-1!=$location.path().indexOf("/shop/view")?$timeout(function(){},1e3):$timeout(function(){$scope.initializeMaps()},1e3)):($scope.storeLoading=!1,$scope.createStoreError=!0)})},$scope.initializeMaps=function(){{var mapOptions=(new google.maps.LatLng(latitudeMap,longitudeMap),{center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:6}),map=new google.maps.Map(document.getElementById("map-canvas-second"),mapOptions);new google.maps.Marker({position:new google.maps.LatLng(latitudeMap,longitudeMap),map:map,title:$scope.store.map_place})}},$scope.loadDetails()}]),app.controller("BLDetailCoverController",["$route","$scope","$location","$http","BLShopService","$timeout","$routeParams",function($route,$scope,$location,$http,BLShopService,$timeout,$routeParams){$scope.$route=$route,$scope.storeMainId=$routeParams.id;var latitudeMap=0,longitudeMap=0;$scope.loadDetails=function(){$scope.storeLoading=!0,$scope.updateStart=!1,$scope.createStoreError=!1,$scope.showEditForm=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.id,BLShopService.getShopsDetail(opts,function(data){
101==data.code?($scope.storeDetail=data.data,$scope.storeLoading=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude):($scope.storeLoading=!1,$scope.createStoreError=!0)})},$scope.loadDetails()}]),app.controller("BLDetailAlbumShopsController",["$routeParams","$route","$scope","$location","$http","BLShopService","$timeout",function($routeParams,$route,$scope,$location,$http,BLShopService,$timeout){$scope.totalSize=0,$scope.allRes=1,$scope.listAlbum=[],$scope.viewalbum=[],$scope.albloader=!1,$scope.noAlbums=!1,$scope.noPhotos=!1,$scope.storeMainId=$routeParams.id,$scope.totalSizeImg=0,$scope.allResImg=1,$scope.$route=$route,$scope.listload=!1,$scope.redirectUrl=function(album_id,album_name){""==album_name?(album_name="Untitled",$location.path("/shop/home/image/"+album_id+"/"+album_name+"/"+$scope.storeMainId)):$location.path("/shop/home/image/"+album_id+"/"+album_name+"/"+$scope.storeMainId)},$scope.storepagealbumlists=function(){$scope.albloader=!1;var opts={};opts.store_id=$scope.storeMainId;var limit_start=$scope.listAlbum.length;opts.limit_start=limit_start,opts.limit_size=20,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.allRes=0,$scope.listload=!0,BLShopService.getShopAlbumDetail(opts,function(data){101==data.code?($scope.totalSize=data.data.size,$scope.allRes=1,$scope.listAlbum=$scope.listAlbum.concat(data.data.album),$scope.noAlbums=!0,$scope.albloader=!1,$scope.listload=!1):($scope.albloader=!1,$scope.listload=!1)}))},$scope.storepagealbumlists(),$scope.loadMore=function(){$scope.storepagealbumlists()},$scope.viewdetailalbums=function(){var limit_start=$scope.viewalbum.length,albumId=$routeParams.album_id;$scope.albumname=$routeParams.album_name;var opts={};opts.store_id=$routeParams.id,opts.album_id=albumId,opts.limit_start=limit_start,opts.limit_size=20,($scope.totalSizeImg>limit_start||0==$scope.totalSizeImg)&&1==$scope.allResImg&&($scope.listload=!0,$scope.allResImg=0,BLShopService.getShopPicturesDetail(opts,function(data){101==data.code?($scope.albloader=!1,$scope.totalSizeImg=data.data.size,$scope.allResImg=1,$scope.viewalbum=$scope.viewalbum.concat(data.data.media),$scope.listload=!1,$scope.noPhotos=!0):($scope.albloader=!1,$scope.listload=!1)}))},$scope.viewdetailalbums(),$scope.loadMoreImage=function(){$scope.viewdetailalbums()}}]),app.controller("BLDetailPostShopsController",["$routeParams","$route","$scope","$http","BLShopService","$timeout",function($routeParams,$route,$scope,$http,BLShopService,$timeout){$scope.$route=$route,$scope.posts=[],$scope.myRes=1,$scope.isLoading=!0,$scope.Size=0,$scope.storeMainId=$routeParams.id,$scope.getPosts=function(){var limit_start=$scope.posts.length,opts={};opts.store_id=$scope.storeMainId,opts.limit_start=limit_start,opts.limit_size=20,($scope.Size>limit_start||0==$scope.Size)&&1==$scope.myRes&&($scope.myRes=0,BLShopService.getShopPostDetail(opts,function(data){101==data.code?($scope.posts=$scope.posts.concat(data.data),$scope.isLoading=!1,$scope.myRes=1,$scope.Size=data.count,0==$scope.posts.length&&($scope.noContent=!0)):($scope.noContent=!1,$scope.isLoading=!1)}))},$scope.getPosts(),$scope.loadMore=function(){$scope.getPosts()},$scope.allCommentLoad=[],$scope.showComments=[],$scope.showAllComments=function(postIndx){$scope.allCommentLoad[postIndx]=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx),$scope.showComments[postIndx]=!0},$scope.comments=[],$scope.getComments=function(opts,postIndx){$scope.comments[postIndx]=[],BLShopService.getCommentsStoreDetail(opts,function(data){100==data.code?($scope.posts[postIndx].comments=data.data.comment,$scope.allCommentLoad[postIndx]=!1,0!=$scope.comments[postIndx].length&&($scope.noComment=!0)):$scope.allCommentLoad[postIndx]=!0})}}]),app.controller("PublicMapStoreController",["$scope","$http","BLShopService","$timeout",function($scope,$http,BLShopService,$timeout){var locations=[];$scope.maploader=!1;var n=[];$scope.getmapstores=function(){$scope.maploader=!0;var opts={user_id:APP.currentUser.id};BLShopService.getMapPublicDetail(opts,function(data){if(101==data.code){$scope.detail=data.data;for(var mapArray=data.data,i=0;i<mapArray.length;i++){n.push(mapArray[i].name);var mi=new Array(mapArray[i].mapplace,mapArray[i].latitude,mapArray[i].longitude,mapArray[i].thumb_path,mapArray[i].name,mapArray[i].credit_status,mapArray[i].shot_status,mapArray[i].dp_status,mapArray[i].id);locations.push(mi)}$(".shop-map").show(),$scope.initialize(),$scope.maploader=!1}else $scope.maploader=!1})},$scope.getmapstores();var containsText=function(search){var gotText=!1;for(var i in n){var re=new RegExp(search,"ig"),s=re.test(n[i]);s&&($scope.itemsArr.push(n[i]),gotText=!0)}return gotText};$scope.searchText="",$scope.itemsSelectedArr=[],$scope.itemsArr=[],$scope.itemsDisplaPanel=!1,$scope.searchMe=function(search){if($scope.itemsArr=[],$scope.itemsDisplaPanel=!1,search.length>2){var foundText=containsText(search);$scope.itemsDisplaPanel=foundText?!0:!1}},$scope.itemSelectedData=function(str){$scope.itemsDisplaPanel=!1,$scope.searchText=str,$("#results").html("");var a=n.indexOf(str);$scope.markerpopup(a)},$scope.itemSelectedDelet=function(sel){var idx=$scope.itemsSelectedArr.indexOf(sel);-1!==idx&&$scope.itemsSelectedArr.splice(idx,1),$scope.itemsDisplaPanel=!1};var map,arrMarker=[],geocoder=new google.maps.Geocoder,circle=null,gmarkers=[],arrMapresult=[],arrShotMarker=[],arrDpMarker=[],arrDpnShotMarker=[],arrSearchStore=[];$scope.initialize=function(){document.getElementById("pac-input").value="";var centerLatLng=new google.maps.LatLng(51.532315,-.1544);map=new google.maps.Map(document.getElementById("map-canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:3,center:centerLatLng});var input=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);var searchBox=new google.maps.places.SearchBox(input);google.maps.event.addListener(searchBox,"places_changed",function(){document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1;var address=document.getElementById("pac-input").value,radius=1e3*parseInt(50,10);geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng(),marker=(new google.maps.LatLng(latitude,longitude),new google.maps.Marker({map:map,position:results[0].geometry.location}));marker.setMap(null),circle&&circle.setMap(null),circle=new google.maps.Circle({center:marker.getPosition(),radius:radius,fillOpacity:.35,fillColor:"#FF0000",map:map});var bounds=new google.maps.LatLngBounds;$("#results").html(""),arrMapresult.length=0;for(var i=0;i<gmarkers.length;i++)if(google.maps.geometry.spherical.computeDistanceBetween(gmarkers[i].getPosition(),marker.getPosition())<radius){bounds.extend(gmarkers[i].getPosition()),gmarkers[i].setMap(map),arrMapresult.push(gmarkers[i].getPosition());var marker,i,infowindow=new google.maps.InfoWindow;gmarkers[i].getPosition(),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>"),infowindow.open(map,marker)}}(marker,i))}else gmarkers[i].setMap(null);0==arrMapresult.length?(bounds.extend(results[0].geometry.location),$("#results").html("<span>No Result Found</span>")):$("#results").html("<span>"+arrMapresult.length+" result found</span>"),map.fitBounds(bounds),map.setZoom(9)}else alert("Geocode was not successful for the following reason: "+status)})}),google.maps.event.addListener(map,"bounds_changed",function(){var bounds=map.getBounds();searchBox.setBounds(bounds)});var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)marker=new google.maps.Marker(0==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrMarker.push(marker),gmarkers.push(marker)},$scope.markerpopup=function(index){document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,$scope.setAllShotMap(null),$scope.setAllMap(map),$scope.setDpMarker(null),$scope.setDpShotMarker(null),null!=circle&&circle.setMap(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)marker=new google.maps.Marker(""==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrSearchStore.push(marker);google.maps.event.trigger(arrMarker[index],"click")},$scope.setAllMap=function(map){for(var i=0;i<arrMarker.length;i++)arrMarker[i].setMap(map),gmarkers[i].setMap(map)},$scope.setRemoveAllMap=function(map){for(var i=0;i<arrSearchStore.length;i++)arrSearchStore[i].setMap(map)},$scope.setAllShotMap=function(map){for(var i=0;i<arrShotMarker.length;i++)arrShotMarker[i].setMap(map)},$scope.setDpMarker=function(map){for(var i=0;i<arrDpMarker.length;i++)arrDpMarker[i].setMap(map)},$scope.setDpShotMarker=function(map){for(var i=0;i<arrDpnShotMarker.length;i++)arrDpnShotMarker[i].setMap(map)},$scope.mapfilter=function(){var chk=document.getElementById("shotfilter").checked,dpchk=document.getElementById("dpfilter").checked;if(1==chk&&0==dpchk){$scope.setRemoveAllMap(null),$scope.setDpMarker(null),$scope.setAllMap(null),$scope.setDpShotMarker(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)1==locations[i][6]&&(marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrShotMarker.push(marker))}else if(1==dpchk&&0==chk){$scope.setRemoveAllMap(null),$scope.setDpShotMarker(null),$scope.setAllMap(null),$scope.setAllShotMap(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)1==locations[i][7]&&(marker=new google.maps.Marker(1==locations[i][6]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpMarker.push(marker))}else if(1==chk&&1==dpchk){$scope.setDpShotMarker(null),$scope.setAllMap(null),$scope.setAllShotMap(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)(1==locations[i][7]||1==locations[i][6])&&(marker=new google.maps.Marker({position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpnShotMarker.push(marker))}else $scope.setAllShotMap(null),$scope.setAllMap(map),$scope.setDpMarker(null),$scope.setDpShotMarker(null),$scope.setRemoveAllMap(null)}}]),app.controller("StoreController",function($scope,$http,StoreService,$timeout){$scope.storeListObject=[],$scope.storeMyList=[],$scope.storeAllList=[],$scope.totalSize=0,$scope.myTotalSize=0,$scope.storeLoading=!0,$scope.viewAllActive="current",$scope.myStoreActive="",$scope.tab="viewAll",$scope.notFound=!1,$scope.allRes=1,$scope.myRes=1,$scope.firstPage=APP.store_list_pagination.end,$scope.itemsPerPage=APP.store_list_pagination.end,$scope.currentPage=1,$scope.range=[],$scope.pagevalue="",$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.loadMore()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMore()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.loadMore()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.loadMore()},$scope.showStoreList=function(tab,itemsPerPage){$scope.pagevalue="storeAll",$scope.searchText="",$scope.storeMyList=[],$scope.tab=tab,$scope.viewAllActive="current",$scope.myStoreActive="";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,opts.store_type=1,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.storeLoading=!0,$scope.allRes=0,StoreService.getStore(opts,function(data){if(101==data.code){$scope.allRes=1,$scope.totalSize=data.data.size,$scope.storeListObject=data.data.stores,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1,$scope.notFound=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1)}))},$scope.myStoreList=function(tab,itemsPerPage){$scope.pagevalue="storeMy",$scope.searchText="",$scope.storeAllList=[],$scope.tab=tab,$scope.viewAllActive="",$scope.myStoreActive="current";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,($scope.myTotalSize>limit_start||0==$scope.myTotalSize)&&1==$scope.myRes&&($scope.storeLoading=!0,$scope.myRes=0,StoreService.getStore(opts,function(data){if($scope.range=[],101==data.code){$scope.myTotalSize=data.data.size,$scope.myRes=1,$scope.storeListObject=$scope.storeMyList=data.data.stores,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage);for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1)}))},$scope.addressFilter="",$scope.showStoreList($scope.tab,$scope.itemsPerPage),$scope.loadMore=function(){$scope.searchText,$scope.addressFilter;""==$scope.pagevalue?$scope.showStoreList($scope.tab,$scope.itemsPerPage):"storeAll"==$scope.pagevalue?$scope.showStoreList($scope.tab,$scope.itemsPerPage):"storeMy"==$scope.pagevalue?$scope.myStoreList($scope.tab,$scope.itemsPerPage):"storeNameSearch"==$scope.pagevalue?$scope.searchStore("viewAll",$scope.itemsPerPage):"storeAddSearch"==$scope.pagevalue&&$scope.searchAddressShop($scope.storeIdArray)},$scope.listActive="active",$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.searchText="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#shopserchbox").keypress(function(){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){0==$scope.searchText.length&&$scope.searchStore()},DELAY_TIME_BEFORE_POSTING)}),$scope.searchRes=0,$scope.searchTotalSize=0,$scope.searchStore=function(tab,itemsPerPage){$scope.pagevalue="storeNameSearch",$scope.searchRes=0,$scope.storeLoading=!0,$scope.viewAllActive="current",$scope.myStoreActive="";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,$scope.tab="viewAll",$scope.searchText.length>=3&&(void 0!==$scope.searchText&&""!==$scope.searchText||1!=$scope.searchRes||($scope.allRes=1,$scope.storeMyList=[],$scope.storeAllList=[],$scope.showStoreList($scope.tab)),opts.business_name=void 0===$scope.searchText?"":$scope.searchText,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,($scope.searchTotalSize>limit_start||0==$scope.searchTotalSize)&&StoreService.searchStore(opts,function(data){if($scope.searchRes=1,101==data.code){$scope.storeListObject=data.data,$scope.searchTotalSize=data.size,$scope.totalItems=Math.ceil(data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1,$scope.notFound=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1)}))},$scope.deleteStore=function(id,parentId){$("#store"+id).hide(),$("#storedelete"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,opts.store_type=1,StoreService.deleteStore(opts,function(data){101==data.code?$(".storecoverid"+id).hide():($("#store"+id).show(),$("#storedelete"+id).hide())})},$scope.deleteStoreGrid=function(id,parentId){$("#store"+id).hide(),$("#storedelete"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,opts.store_type=1,StoreService.deleteStore(opts,function(data){101==data.code?$(".storecoverid"+id).hide():($("#store"+id).show(),$("#storedelete"+id).hide())})},$scope.format1=function(n,currency){return n=Number(n),currency+""+n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")};var locations=[];$scope.maploader=!1;var n=[];$scope.getmapstores=function(){$scope.maploader=!0;var opts={user_id:APP.currentUser.id};StoreService.getmapstores(opts,function(data){if(101==data.code){$scope.detail=data.data;for(var mapArray=data.data,i=0;i<mapArray.length;i++){n.push(mapArray[i].name);var mi=new Array(mapArray[i].mapplace,mapArray[i].latitude,mapArray[i].longitude,mapArray[i].thumb_path,mapArray[i].name,mapArray[i].credit_status,mapArray[i].shot_status,mapArray[i].dp_status,mapArray[i].id,mapArray[i].credit_available);locations.push(mi)}$(".shop-map").show(),$scope.initialize(),$scope.maploader=!1}else $scope.maploader=!1})},$scope.getmapstores();var res=1;$scope.searchTot=0,$scope.searchshoponmaps=function(arrCollection,req,itemSize){var opts=req;1==res&&StoreService.searchshoponmaps(opts,function(data){if(res=0,101==data.code){$scope.storeLoading=!1,$scope.storeListObject=data.data.stores,$scope.storeListObject.length<1?$scope.notFound=!0:$scope.notFound=!1,res=1,$scope.searchTot=itemSize,$scope.totalItems=Math.ceil(itemSize/$scope.itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}else $scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1})};var limit_starts=0,limit_end=12,idCollection=[];$scope.searchAddressShop=function(arrCollection){if($scope.pagevalue="storeAddSearch",limit_starts=($scope.currentPage-1)*$scope.itemsPerPage,limit_end=limit_starts+$scope.itemsPerPage,$scope.searchTot>limit_starts||0==$scope.searchTot){$scope.storeLoading=!0,idCollection=arrCollection;var tempArray=idCollection.slice(limit_starts,limit_end),req={user_id:APP.currentUser.id,shops:tempArray};$scope.searchshoponmaps(arrCollection,req,arrCollection.length)}};var containsText=function(search){var gotText=!1;for(var i in n){var re=new RegExp(search,"ig"),s=re.test(n[i]);s&&(-1==$scope.itemsArr.indexOf(n[i])&&$scope.itemsArr.push(n[i]),gotText=!0)}return gotText};$scope.searchText="",$scope.itemsSelectedArr=[],$scope.itemsArr=[],$scope.itemsDisplaPanel=!1,$scope.searchMe=function(search){if($scope.itemsArr=[],$scope.itemsDisplaPanel=!1,search.length>2){var foundText=containsText(search);$scope.itemsDisplaPanel=foundText?!0:!1}},$("#pac-input").focus(function(){$scope.itemsDisplaPanel=!1}),$("body").click(function(){$scope.itemsDisplaPanel=!1}),$scope.itemSelectedData=function(str){$scope.itemsDisplaPanel=!1,$scope.searchText=str,$("#results").html("");var a=n.indexOf(str);$scope.markerpopup(a),$scope.searchText;$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.searchStore("viewAll",$scope.itemsPerPage)},DELAY_TIME_BEFORE_POSTING)},$scope.itemSelectedDelet=function(sel){var idx=$scope.itemsSelectedArr.indexOf(sel);-1!==idx&&$scope.itemsSelectedArr.splice(idx,1),$scope.itemsDisplaPanel=!1};var map,arrMarker=[],geocoder=new google.maps.Geocoder,circle=null,gmarkers=[],arrMapresult=[],arrShotMarker=[],arrDpMarker=[],arrDpnShotMarker=[],arrSearchStore=[],markerClusterer=null;$scope.storeIdArray="",$scope.initialize=function(){document.getElementById("pac-input").value="";var centerLatLng=new google.maps.LatLng(41.9,12.4833);map=new google.maps.Map(document.getElementById("map-canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:6,center:centerLatLng});var input=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);var searchBox=new google.maps.places.SearchBox(input);google.maps.event.addListener(searchBox,"places_changed",function(){$scope.storeListObject=[],$scope.viewAllActive="current",$scope.myStoreActive="",$scope.searchText="",markerClusterer.setMap(null),document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1;var address=document.getElementById("pac-input").value,radius=1e3*parseInt(50,10);geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng(),marker=(new google.maps.LatLng(latitude,longitude),new google.maps.Marker({map:map,position:results[0].geometry.location}));marker.setMap(null),circle&&circle.setMap(null),circle=new google.maps.Circle({center:marker.getPosition(),strokeWeight:0,map:map});var bounds=new google.maps.LatLngBounds;$("#results").html(""),arrMapresult.length=0;for(var arrId=[],i=0;i<gmarkers.length;i++)if(google.maps.geometry.spherical.computeDistanceBetween(gmarkers[i].getPosition(),marker.getPosition())<radius){arrId.push(locations[i][8]),bounds.extend(gmarkers[i].getPosition()),gmarkers[i].setMap(map),arrMapresult.push(gmarkers[i].getPosition());var marker,i,infowindow=new google.maps.InfoWindow;gmarkers[i].getPosition(),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i))}else gmarkers[i].setMap(null);limit_starts=0,limit_end=12,$scope.storeIdArray=arrId,$scope.searchAddressShop(arrId),0==arrMapresult.length?(bounds.extend(results[0].geometry.location),$("#results").html("<span>"+$scope.i18n.store.result_not_found+"</span>")):$("#results").html("<span>"+arrMapresult.length+" "+$scope.i18n.store.result_found+"</span>"),map.fitBounds(bounds),map.setZoom(9)}else alert("Geocode was not successful for the following reason: "+status)})}),google.maps.event.addListener(map,"bounds_changed",function(){var bounds=map.getBounds();searchBox.setBounds(bounds)}),markerClusterer&&markerClusterer.clearMarkers();var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)marker=new google.maps.Marker(0==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrMarker.push(marker),gmarkers.push(marker);markerClusterer=new MarkerClusterer(map,arrMarker,{}),google.maps.event.addListener(map,"zoom_changed",function(){var zoomLevel=map.getZoom();5>zoomLevel&&(document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,$scope.addressFilter="",$scope.searchText="",null!=circle&&circle.setMap(null),$("#results").html(""),markerClusterer.setMap(null),$scope.setDpShotMarker(null),$scope.setDpMarker(null),$scope.setAllMap(null),$scope.setAllShotMap(null),$scope.setAllMap(map),markerClusterer.setMap(map))})},$scope.markerpopup=function(index){document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,markerClusterer.setMap(null),$scope.setAllShotMap(null),$scope.setAllMap(null),$scope.setAllMap(map),$scope.setDpMarker(null),$scope.setDpShotMarker(null),null!=circle&&circle.setMap(null),$scope.addressFilter="",google.maps.event.trigger(arrMarker[index],"click"),map.setZoom(10)},$scope.setAllMap=function(map){for(var i=0;i<arrMarker.length;i++)arrMarker[i].setMap(map),gmarkers[i].setMap(map)},$scope.setRemoveAllMap=function(map){for(var i=0;i<arrSearchStore.length;i++)arrSearchStore[i].setMap(map)},$scope.setAllShotMap=function(map){for(var i=0;i<arrShotMarker.length;i++)arrShotMarker[i].setMap(map)},$scope.setDpMarker=function(map){
for(var i=0;i<arrDpMarker.length;i++)arrDpMarker[i].setMap(map)},$scope.setDpShotMarker=function(map){for(var i=0;i<arrDpnShotMarker.length;i++)arrDpnShotMarker[i].setMap(map)},$scope.mapfilter=function(){$scope.storeListObject=[];var filterArray=[],chk=document.getElementById("shotfilter").checked,dpchk=document.getElementById("dpfilter").checked;if(1==chk&&0==dpchk){$scope.searchText="",markerClusterer.setMap(null),$scope.setRemoveAllMap(null),$scope.setDpMarker(null),$scope.setAllMap(null),$scope.setDpShotMarker(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)1==locations[i][6]&&(marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrShotMarker.push(marker));limit_starts=0,limit_end=12,$scope.storeIdArray=filterArray,$scope.searchAddressShop(filterArray)}else if(1==dpchk&&0==chk){markerClusterer.setMap(null),$scope.setRemoveAllMap(null),$scope.setDpShotMarker(null),$scope.setAllMap(null),$scope.setAllShotMap(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)1==locations[i][7]&&(marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpMarker.push(marker));limit_starts=0,limit_end=12,$scope.storeIdArray=filterArray,$scope.searchAddressShop(filterArray)}else if(1==chk&&1==dpchk){$scope.searchText="",markerClusterer.setMap(null),$scope.setDpShotMarker(null),$scope.setAllMap(null),$scope.setAllShotMap(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/silver-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)(1==locations[i][7]||1==locations[i][6])&&(marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),filterArray.push(locations[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div><div class='category-dec'><strong>Category</strong> : Not Available</div><div class='lower-cont'><div class='vote-count'><ul><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li><li><img src='app/assets/images/star-blank.png'></li></ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpnShotMarker.push(marker));limit_starts=0,limit_end=12,$scope.storeIdArray=filterArray,$scope.searchAddressShop(filterArray)}else null!=circle&&circle.setMap(null),$("#results").html(""),$scope.addressFilter="",$scope.searchText="",markerClusterer.setMap(null),$scope.setDpMarker(null),$scope.setDpShotMarker(null),$scope.setRemoveAllMap(null),$scope.setAllShotMap(null),$scope.setAllMap(map),""===$scope.searchText&&""===$scope.addressFilter&&markerClusterer.setMap(map),$scope.showStoreList($scope.tab,$scope.itemsPerPage),$scope.notFound=!1,$scope.viewAllActive="current",$scope.myStoreActive=""}}),app.controller("CreateStoreController",function($scope,$http,$location,$timeout,StoreService,$rootScope,$cookieStore){$scope.createStoreLoader=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.store={};var opts1={};StoreService.getCountryList(opts1,function(data){101==data.code&&($scope.countryList=data.data)}),$scope.createStore=function(){$scope.createStoreLoader=!0;var opts={};return opts.user_id=APP.currentUser.id,void 0==$scope.store.name||""==$scope.store.name?($scope.createStoreErrorMgs=$scope.i18n.store.enter_name,alert($scope.createStoreErrorMgs),$timeout(function(){$scope.createStoreErrorMgs=""},15e3),$scope.createStoreError=!0,$scope.createStoreLoader=!1,!1):void 0==$scope.store.business_name||""==$scope.store.business_name?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storename,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.legal_status||""==$scope.store.legal_status?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storestatus,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_type||""==$scope.store.business_type?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storetype,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone)?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storenumber,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.email||""==$scope.store.email?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeemail,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_country||""==$scope.store.business_country?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storecountry,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_region||""==$scope.store.business_region?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeregion,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_city||""==$scope.store.business_city?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storecity,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_address||""==$scope.store.business_address?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeaddress,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):""==$scope.store.zip||void 0==$scope.store.zip?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storezip,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):""==$scope.store.province||void 0==$scope.store.province?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeprovince,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):$scope.store.province.length<2||$scope.store.province.length>2?($scope.createStoreErrorMgs=$scope.i18n.validation.province_length,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.vat_number||""==$scope.store.vat_number?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storevat,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.iban||""==$scope.store.iban?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeiban,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.description||""==$scope.store.description?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storedesc,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storelat,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storelog,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storemap,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):""!=$scope.store.referral_id&&void 0!=$scope.store.referral_id&&isNaN($scope.store.referral_id)?($scope.createStoreErrorMgs=$scope.i18n.store.valid_ref_id,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):(opts.name=$scope.store.name,opts.business_name=$scope.store.business_name,opts.legal_status=$scope.store.legal_status,opts.business_type=$scope.store.business_type,opts.phone=$scope.store.phone,opts.email=$scope.store.email,opts.business_country=$scope.store.business_country,opts.business_region=$scope.store.business_region,opts.business_city=$scope.store.business_city,opts.business_address=$scope.store.business_address,opts.zip=$scope.store.zip,opts.province=$scope.store.province,opts.vat_number=$scope.store.vat_number,opts.iban=$scope.store.iban,opts.description=$scope.store.description,opts.terms=$scope.store.terms,opts.referral_id=$scope.store.referral_id,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.broker_id=$scope.store.broker_id,$scope.createStoreErrorMgs="",void StoreService.createStore(opts,function(data){101==data.code?($scope.createStoreLoader=!0,$rootScope.tempStoreId=data.data.store_id,$cookieStore.put("tempStoreId",data.data.store_id),$location.path("/shop/payment/2")):154==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.citizen_not_exists,$scope.createStoreError=!0):100==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.missed_param,$scope.createStoreError=!0):116==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.enter_businessname,$scope.createStoreError=!0):138==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.vat_exists,$scope.createStoreError=!0):85==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.account_inactive,$scope.createStoreError=!0):165==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.vat_valid,$scope.createStoreError=!0):166==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.iban_valid,$scope.createStoreError=!0):($scope.createStoreLoader=!1,$scope.createStoreError=!0),$timeout(function(){$scope.createStoreErrorMgs=""},15e3)}))},$scope.resetStoreObject=function(){document.getElementById("mapplace").value="",document.getElementById("latitude").value="",document.getElementById("longitude").value="",$scope.store={}},$scope.loadMap=function(){$scope.map={center:{latitude:40.1451,longitude:-99.668},zoom:4},$scope.options={scrollwheel:!1},$scope.marker={id:0,coords:{latitude:40.1451,longitude:-99.668},options:{draggable:!0},events:{dragend:function(marker,eventName,args){document.getElementById("latitude").value=marker.getPosition().lat(),document.getElementById("longitude").value=marker.getPosition().lng(),$scope.mapLocation(marker.getPosition().lat(),marker.getPosition().lng())}}}},$scope.mapLocation=function(mapLatitude,mapLogitude){var geocoder;geocoder=new google.maps.Geocoder;var latlng=new google.maps.LatLng(parseFloat(mapLatitude),parseFloat(mapLogitude));geocoder.geocode({latLng:latlng},function(results,status){status==google.maps.GeocoderStatus.OK?results[1]?$("#mapplace").val(results[1].formatted_address):alert($scope.i18n.storealbum.album_alert_msg):alert($scope.i18n.storealbum.album_alert_failed+status)})},$scope.loadMap(),$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:13},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.k,document.getElementById("longitude").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$timeout(function(){$scope.initialize()},1e3)}),app.controller("DeatilStoreController",function($route,$scope,$http,$sce,$routeParams,$location,$timeout,StoreService,fileReader){$scope.$route=$route,$scope.storeMainId=$routeParams.id;var latitudeMap=0,longitudeMap=0;$scope.mobileAppUrl="<li> Fits true to size. Take your normal size\r</li>",$scope.loadDetails=function(){$scope.storeLoading=!0,$scope.updateStart=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.showEditForm=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.id,StoreService.getStoreDetail(opts,function(data){if(101==data.code)if(data.data.owner_id==APP.currentUser.id&&0==data.data.shop_status&&0==data.data.is_active)$location.path("/shop/pending/payment"+data.data.id);else{$scope.storeDetail=data.data,$scope.store=$scope.storeDetail,$scope.aboutStore(),$scope.storeLoading=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,angular.element("#pac-input").val(data.data.map_place),-1!=$location.path().indexOf("/shop/edit")||-1!=$location.path().indexOf("/shop/view")?$timeout(function(){$scope.initialize()},1e3):$timeout(function(){},1e3);var storeData={};storeData.storeId=$scope.storeDetail.owner_id;var mopts={};mopts.store_id=$scope.storeDetail.id,StoreService.getMobileAppUrl(mopts,function(data){101==data.code?$scope.store.mobileAppUrl=data.data.url:$scope.store.mobileAppUrl=""}),StoreService.setStoreOwnerId(storeData,function(data){})}else $scope.storeLoading=!1,$scope.createStoreError=!0})},$scope.loadDetails(),$scope.editStore=function(){$scope.createStoreLoader=!1,$scope.store=$scope.storeDetail,$scope.showEditForm=!0,$scope.timelineActive=!1,$scope.timelineActive1=!1;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.aboutStore=function(){$scope.store=$scope.storeDetail;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.updateEditStore=function(){$scope.updateStart=!0;var opts={};return opts.user_id=APP.currentUser.id,opts.store_id=$scope.store.id,void 0==$scope.store.name||""==$scope.store.name?($scope.createStoreErrorMgs=$scope.i18n.register.enter_storename,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_name||""==$scope.store.business_name?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessname,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_type||""==$scope.store.business_type?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesstype,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.legal_status||""==$scope.store.legal_status?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesstatus,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone)?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessnumber,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.email||""==$scope.store.email?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessemail,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_country||""==$scope.store.business_country?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesscountry,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_region||""==$scope.store.business_region?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessregion,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_city||""==$scope.store.business_city?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesscity,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_address||""==$scope.store.business_address?($scope.createStoreErrorMgs=$scope.i18n.validation.enter_businessaddress,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.zip||""==$scope.store.zip||$scope.store.zip.length<5||$scope.store.zip.length>5?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesszip,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.province||""==$scope.store.province?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessprovince,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):$scope.store.province.length<2||$scope.store.province.length>2?($scope.createStoreErrorMgs=$scope.i18n.validation.province_length,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.vat_number||""==$scope.store.vat_number?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessvat,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.iban||""==$scope.store.iban?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessiban,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.description||""==$scope.store.description?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessdesc,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesslat,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesslog,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessmap,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):(opts.name=$scope.store.name,opts.business_name=$scope.store.business_name,opts.parent_store_id=$scope.store.parent_store_id,opts.legal_status=$scope.store.legal_status,opts.business_type=$scope.store.business_type,opts.phone=$scope.store.phone,opts.email=$scope.store.email,opts.business_country=$scope.store.business_country,opts.business_region=$scope.store.business_region,opts.business_city=$scope.store.business_city,opts.business_address=$scope.store.business_address,opts.zip=$scope.store.zip,opts.province=$scope.store.province,opts.vat_number=$scope.store.vat_number,opts.iban=$scope.store.iban,opts.description=$scope.store.description,opts.referral_id=$scope.store.referral_info.id,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.allow_access=$scope.store.is_allowed,$scope.createStoreErrorMgs="",void StoreService.updateStore(opts,function(data){101==data.code?($scope.updateStart=!1,$scope.showEditForm=!1,$scope.createStoreLoader=!1,$scope.createGroupSuccess=!0,$scope.createStoreSuccessMgs=$scope.i18n.albums.update_sucess,$timeout(function(){$scope.createStoreSuccessMgs=""},15e3),$location.path("/shop/edit/"+$scope.store.id)):137==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.broker_not_exists,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):100==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.missed_param,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):90==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.account_inactive,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):91==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_exists,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):126==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.invalid_store_forum_type,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):500==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.permission_denied,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):89==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.error_occured,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):165==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_valid,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):166==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.iban_valid,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):($scope.createStoreErrorMgs=data.message,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3))}))},$scope.initializeMaps=function(){{var mapOptions=(new google.maps.LatLng(latitudeMap,longitudeMap),{center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:6}),map=new google.maps.Map(document.getElementById("map-canvas-second"),mapOptions);new google.maps.Marker({position:new google.maps.LatLng(latitudeMap,longitudeMap),map:map,title:$scope.store.map_place})}},$(".member-store").click(function(){$(this).addClass("active"),$(".store-invitations li").removeClass("active")}),$scope.cancelEditStore=function(){$scope.showEditForm=!1,$location.path("/shop/about/"+$scope.store.id)},$scope.loadEditMap=function(){$scope.map={center:{latitude:40.1451,longitude:-99.668},zoom:4},$scope.options={scrollwheel:!1},$scope.marker={id:0,coords:{latitude:40.1451,longitude:-99.668},options:{draggable:!0},events:{dragend:function(marker,eventName,args){document.getElementById("latitude").value=marker.getPosition().lat(),document.getElementById("longitude").value=marker.getPosition().lng(),$scope.mapLocation(marker.getPosition().lat(),marker.getPosition().lng())}}}},$scope.loadEditMap(),$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:8},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.k,document.getElementById("longitude").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),
scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$scope.initializeWait=function(){$timeout(function(){},1e3)},$scope.showInvite=!1,$scope.timelineActive=!1,$scope.toggleInvite=function(){$scope.timelineActive=!$scope.timelineActive,$scope.uploadProfileImage=!1,$scope.showInvite=!$scope.showInvite,$scope.timelineActive1=!1,$scope.showEditForm=!1},$scope.uploadProfileImage=!1,$scope.toggleUploadImage=function(){$scope.showInvite=!1,$scope.uploadProfileImage=!$scope.uploadProfileImage},$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.uploadStoreProfileImage=function(){$scope.uploadStoreProfile=!0;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);if("gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType)$scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0;else{var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeDetail.id,StoreService.uploadStoreProfileimage(opts,$scope.myFile,function(data){101==data.code?($scope.uploadProfileImage=!1,$scope.uploadStoreProfile=!1,$scope.storeDetail.cover_image_path=data.data.cover_image_path,$scope.storeDetail.profile_image_original=data.data.original_image_path):$scope.uploadStoreProfile=!1})}},$scope.myFile="",$scope.imageSrc="",$scope.invalidCoverImage=!1,$scope.invalidCoverImageMgs=$scope.i18n.storealbum.album_invalidCoverImageMgs,$scope.getFile=function(){$scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.imageSrc=result;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0):($scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.readImage($scope.myFile,function(data){0!=data.length&&data.width>=400&&data.height>=200?$scope.uploadStoreProfileImage():($("#invalidCoverImage").show(),$timeout(function(){$("#invalidCoverImage").hide()},4e3))}))})},$scope.readImage=function(file,callback){var reader=new FileReader,image=new Image;reader.readAsDataURL(file),reader.onload=function(_file){var filedata={};image.src=_file.target.result,image.onload=function(){{var w=this.width,h=this.height;file.type,file.name,~~(file.size/1024)+"KB"}filedata.width=w,filedata.height=h,callback(filedata)},image.onerror=function(){callback(filedata)}}},$scope.timelineActive1=!1,$scope.showAllStoreMember=!1,$scope.showAllMembers=function(){$scope.showAllStoreMember=!$scope.showAllStoreMember,$scope.timelineActive1=!$scope.timelineActive1,$scope.timelineActive=!1,$scope.showEditForm=!1}}).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("CreateChildStore",function($scope,$http,$routeParams,$location,$timeout,StoreService){$scope.createStoreLoader=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.store={};var opts1={};StoreService.getCountryList(opts1,function(data){101==data.code&&($scope.countryList=data.data)}),$scope.createChildStore=function(){var storeParentId=$routeParams.id;if(void 0==$scope.store.phone||""==$scope.store.phone)return $scope.createStoreError=!0,$scope.createStoreErrorMgs=$scope.i18n.storealbum.album_ErrorMgsphone,!1;if(void 0==$scope.store.zip||""==$scope.store.zip)return $scope.createStoreError=!0,$scope.createStoreErrorMgs=$scope.i18n.storealbum.album_ErrorMgszip,!1;$scope.createStoreLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.business_name=$scope.store.business_name,opts.parent_store_id=storeParentId,opts.legal_status=$scope.store.legal_status,opts.business_type=$scope.store.business_type,opts.phone=$scope.store.phone,opts.email=$scope.store.email,opts.business_country=$scope.store.business_country,opts.business_region=$scope.store.business_region,opts.business_city=$scope.store.business_city,opts.business_address=$scope.store.business_address,opts.zip=$scope.store.zip,opts.province=$scope.store.province,opts.vat_number=$scope.store.vat_number,opts.iban=$scope.store.iban,opts.description=$scope.store.description,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,StoreService.createChildStore(opts,function(data){101==data.code?($scope.createStoreLoader=!0,$location.path("/shop/view/"+storeParentId)):($scope.createStoreLoader=!1,$scope.createStoreError=!0,$scope.createStoreErrorMgs=$scope.i18n.storealbum.album_ErrorMgs)})},$scope.resetStoreObject=function(){document.getElementById("mapplace").value="",document.getElementById("latitude").value="",document.getElementById("longitude").value="",$scope.store={}},$scope.updateChildStore=function(){},$scope.cancelChildStore=function(){$scope.showEditForm=!1,$scope.editStoreObject={}},$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:8},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.k,document.getElementById("longitude").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},"{}"!=JSON.stringify(APP.currentUser)&&$timeout(function(){$scope.initialize()},1e3)}),app.controller("StoreLeftController",function($scope,$http,StoreService){$scope.showLeftPanel=!1,$scope.storeNotFound=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start="",opts.limit_size="",StoreService.getAllStoreWithChild(opts,function(data){101==data.code?0!=data.data.stores.length?($scope.storeLeftList=data.data.stores,$scope.storeNotFound=!1):($scope.storeNotFound=!0,$scope.storeLeftList=data.data.stores):100==data.code?$scope.storeNotFound=!0:$scope.storeNotFound=!0,$scope.showLeftPanel=!0})}),app.controller("StoreNotificationController",function($scope,$http,StoreService){$scope.getStoreNotification=function(){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,opts={},opts.user_id=APP.currentUser.id,StoreService.getStoreNotifications(opts,function(data){101==data.code&&0!=data.data.length?($scope.storeNotification=data.data,$scope.NotificationFound=!0):$scope.NotificationNotFound=!0})},$scope.getStoreNotification(),$scope.AcceptRequest=function(storeId,requestId,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.store_id=storeId,opts.response=1,StoreService.acceptDenyToStoreNotification(opts,function(data){101==data.code&&$scope.getStoreNotification()})},$scope.rejectRequest=function(storeId,requestId,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.store_id=storeId,opts.response=2,StoreService.acceptDenyToStoreNotification(opts,function(data){101==data.code&&$scope.getStoreNotification()})}}),app.controller("AutocompleteController",function($scope,$http,$timeout,StoreService){$scope.searchLoading=!1,$scope.msgAfterInvite="",$scope.searchedUsers=[],$scope.searchUsers=function(){if($scope.msgAfterInvite="",$scope.searchLoading=!0,""!==$scope.selectedCountries){var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=void 0===$scope.selectedCountries?"":$scope.selectedCountries,opts.limit_start=APP.user_list_pagination.start,opts.limit_size=APP.user_list_pagination.end,StoreService.searchUser(opts,function(data){if($scope.searchLoading=!1,$scope.searchedUsers=[],101==data.code)for(var response=data.data.users,i=0;i<data.data.users.length;i++){var user={};user.capital=response[i].user_id,user.country=response[i].user_name,$scope.searchedUsers.push(user)}else $scope.searchedUsers=[]})}},$scope.InviteSendButton=!1,$scope.onSelectPart=function(){$scope.InviteSendButton=!0},$scope.onSelectPartCancel=function(){$scope.InviteSendButton=!1,$scope.selectedCountries=""},$scope.SentInviteFromStore=function(){$scope.searchLoading=!0;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeDetail.id,opts.friend_id=$scope.selectedCountries.capital,StoreService.inviteUserOnStore(opts,function(data){$scope.searchLoading=!1,$scope.InviteSendButton=!1,$scope.selectedCountries="",(data.code=101)?($scope.msgAfterInvite=$scope.i18n.storealbum.album_msgAfterInvite,$timeout(function(){$scope.msgAfterInvite=""},2e3)):118==data.code?($scope.msgAfterInvite=data.message,$timeout(function(){$scope.msgAfterInvite=""},2e3)):($scope.msgAfterInvite=data.message,$timeout(function(){$scope.msgAfterInvite=""},2e3))})}}),app.controller("MyShopController",function($scope,$http,$timeout,StoreService,$location){$scope.storeListObject=[],$scope.storeMyList=[],$scope.storeAllList=[],$scope.totalSize=0,$scope.myTotalSize=0,$scope.storeLoading=!0,$scope.viewAllActive="current",$scope.myStoreActive="",$scope.tab="viewAll",$scope.notFound=!1,$scope.allRes=1,$scope.myRes=1,$scope.listActive="active",$scope.gridActive="",$scope.firstPage=APP.store_list_pagination.end,$scope.itemsPerPage=APP.store_list_pagination.end,$scope.currentPage=1,$scope.range=[],$scope.affilateShop=!1,$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,""===$scope.searchText?$scope.showStoreList($scope.tab,$scope.itemsPerPage):$scope.searchStore("viewAll",$scope.itemsPerPage)},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMore()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$("ul.pagination li.active:gt(3)").hide(),$scope.loadMore()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,""===$scope.searchText?$scope.showStoreList($scope.tab,$scope.itemsPerPage):$scope.searchStore("viewAll",$scope.itemsPerPage)},$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.showStoreList=function(tab,itemsPerPage){$scope.searchText="",$scope.storeMyList=[],$scope.tab=tab,$scope.viewAllActive="current",$scope.myStoreActive="";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,opts.store_type=1,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.storeLoading=!0,$scope.allRes=0,StoreService.getStore(opts,function(data){if($scope.affilateShop=!0,101==data.code){$scope.allRes=1,$scope.totalSize=data.data.size,$scope.storeListObject=$scope.storeAllList=data.data.stores,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1,$scope.notFound=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1)}))},$scope.myStoreList=function(tab,itemsPerPage){$scope.searchText="",$scope.storeAllList=[],$scope.tab=tab,$scope.viewAllActive="",$scope.myStoreActive="current";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,($scope.myTotalSize>limit_start||0==$scope.myTotalSize)&&1==$scope.myRes&&($scope.storeLoading=!0,$scope.myRes=0,StoreService.getStore(opts,function(data){if($scope.affilateShop=!0,$scope.range=[],101==data.code){$scope.myTotalSize=data.data.size,$scope.myRes=1,$scope.storeListObject=$scope.storeMyList=data.data.stores,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage);for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1)}))},$scope.showStoreList($scope.tab,$scope.itemsPerPage),$scope.loadMore=function(){""===$scope.searchText?"myStore"==$scope.tab?($scope.storeAllList=[],$scope.myStoreList($scope.tab,$scope.itemsPerPage)):($scope.storeMyList=[],$scope.showStoreList($scope.tab,$scope.itemsPerPage)):$scope.searchStore("viewAll",$scope.itemsPerPage)},$scope.deleteStore=function(id,parentId,index){$("#store"+id).hide(),$("#storedelete"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,opts.store_type=1,StoreService.deleteStore(opts,function(data){101==data.code?($(".storecoverid"+id).hide(),$scope.storeListObject.splice(index,1)):($("#store"+id).show(),$("#storedelete"+id).hide())})},$scope.deleteStoreGrid=function(id,parentId){$("#store"+id).hide(),$("#storedelete"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,opts.store_type=1,StoreService.deleteStore(opts,function(data){101==data.code?$(".storecoverid"+id).hide():($("#store"+id).show(),$("#storedelete"+id).hide())})},$scope.searchText="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#shopserchbox").keypress(function(){var model=$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){model.length>=2&&$scope.searchStore("viewAll",$scope.itemsPerPage)},DELAY_TIME_BEFORE_POSTING)}),$scope.searchRes=0,$scope.searchTotalSize=0,$scope.searchStore=function(tab,itemsPerPage){$scope.searchRes=0,$scope.storeLoading=!0,$scope.viewAllActive="current",$scope.myStoreActive="";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,$scope.tab="viewAll",$scope.searchText.length>=3?(void 0!==$scope.searchText&&""!==$scope.searchText||1!=$scope.searchRes||($scope.allRes=1,$scope.storeMyList=[],$scope.storeAllList=[],$scope.storeLoading=!1,$scope.showStoreList($scope.tab,itemsPerPage)),opts.business_name=void 0===$scope.searchText?"":$scope.searchText,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,($scope.searchTotalSize>limit_start||0==$scope.searchTotalSize)&&StoreService.searchStore(opts,function(data){if($scope.searchRes=1,$scope.storeLoading=!1,101==data.code){$scope.storeListObject=data.data,$scope.searchTotalSize=data.size,$scope.totalItems=Math.ceil(data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1,$scope.notFound=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1)})):$scope.storeLoading=!1}}),app.controller("DetailStoreCoverController",function($route,$scope,$http,$sce,$routeParams,$location,$timeout,StoreService,fileReader,ProfileService){$scope.$route=$route,$scope.storeMainId=$routeParams.id;var latitudeMap=0,longitudeMap=0;$scope.mobileAppUrl="<li> Fits true to size. Take your normal size\r</li>",$scope.$on("updateProfileCover",function(event,imgData){$scope.storeDetail.cover_image_path=imgData.cover_image_path,$scope.storeDetail.profile_image_original=imgData.original_image_path}),$scope.loadDetails=function(){$scope.storeLoading=!0,$scope.updateStart=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.showEditForm=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.id,StoreService.getStoreDetail(opts,function(data){if(101==data.code){$scope.storeDetail=data.data,$scope.store=$scope.storeDetail,$scope.aboutStore(),$scope.storeLoading=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,-1!=$location.path().indexOf("/shop/edit")||-1!=$location.path().indexOf("/shop/view")?$timeout(function(){},1e3):$timeout(function(){$scope.initializeMaps()},1e3),$scope.getShopCategory(),$scope.getShopSubCategory();var storeData={};storeData.storeId=$scope.storeDetail.owner_id;var mopts={};mopts.store_id=$scope.storeDetail.id,StoreService.getMobileAppUrl(mopts,function(data){101==data.code?$scope.store.mobileAppUrl=data.data.url:$scope.store.mobileAppUrl=""}),StoreService.setStoreOwnerId(storeData,function(data){})}else $scope.storeLoading=!1,$scope.createStoreError=!0})},$scope.loadDetails(),$scope.getShopCategory=function(){if($scope.store.sale_catid=$scope.store.sale_catid,""!=$scope.store.sale_catid&&void 0!=$scope.store.sale_catid){var catopts={};catopts.lang_code=$scope.currentLanguage,catopts.cat_id=$scope.store.sale_catid,catopts.type="show",catopts.session_id=APP.currentUser.id,ProfileService.getCategories(catopts,function(data){101==data.code?$scope.store.categoryName=data.data.category_name:$scope.store.categoryName=""})}else $scope.store.categoryName=""},$scope.getShopSubCategory=function(){if($scope.store.sale_subcatid=$scope.store.sale_subcatid,""!=$scope.store.sale_subcatid&&void 0!=$scope.store.sale_subcatid){var subopts={};subopts.lang_code=$scope.currentLanguage,subopts.cat_id=$scope.store.sale_subcatid,subopts.type="show",subopts.session_id=APP.currentUser.id,ProfileService.getCategories(subopts,function(data){101==data.code?$scope.store.categorySubName=data.data.category_name:$scope.store.categorySubName=""})}else $scope.store.categorySubName=""},$scope.editStore=function(){$scope.createStoreLoader=!1,$scope.store=$scope.storeDetail,$scope.showEditForm=!0,$scope.timelineActive=!1,$scope.timelineActive1=!1;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.aboutStore=function(){$scope.store=$scope.storeDetail;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.updateStore=function(){$scope.updateStart=!0;var opts={};return opts.user_id=APP.currentUser.id,opts.store_id=$scope.store.id,void 0==$scope.store.name||""==$scope.store.name?($scope.createStoreErrorMgs=$scope.i18n.register.enter_storename,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_name||""==$scope.store.business_name?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessname,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_type||""==$scope.store.business_type?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesstype,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.legal_status||""==$scope.store.legal_status?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesstatus,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone)?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessnumber,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.email||""==$scope.store.email?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessemail,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_country||void 0==$scope.store.business_country.id||""==$scope.store.business_country.id?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesscountry,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_region||""==$scope.store.business_region?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessregion,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_city||""==$scope.store.business_city?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesscity,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_address||""==$scope.store.business_address?($scope.createStoreErrorMgs=$scope.i18n.validation.enter_businessaddress,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.zip||""==$scope.store.zip||$scope.store.zip.length<2||$scope.store.zip.length>2?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesszip,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.province||""==$scope.store.province?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessprovince,$scope.createGroupError=!0,$scope.updateStart=!1,!1):$scope.store.province.length<2||$scope.store.province.length>2?($scope.createStoreErrorMgs=$scope.i18n.validation.province_length,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.vat_number||""==$scope.store.vat_number?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessvat,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.iban||""==$scope.store.iban?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessiban,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.description||""==$scope.store.description?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessdesc,$scope.createGroupError=!0,$scope.updateStart=!1,!1):""==$scope.store.referral_info||void 0==$scope.store.referral_info||void 0==$scope.store.referral_info.id||""==$scope.store.referral_info.id?($scope.createStoreErrorMgs=$scope.i18n.store.enter_broker_id,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesslat,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesslog,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessmap,$scope.createGroupError=!0,$scope.updateStart=!1,!1):(opts.name=$scope.store.name,opts.business_name=$scope.store.business_name,opts.parent_store_id=$scope.store.parent_store_id,opts.legal_status=$scope.store.legal_status,opts.business_type=$scope.store.business_type,opts.phone=$scope.store.phone,opts.email=$scope.store.email,opts.business_country=$scope.store.business_country,opts.business_region=$scope.store.business_region,opts.business_city=$scope.store.business_city,opts.business_address=$scope.store.business_address,opts.zip=$scope.store.zip,opts.province=$scope.store.province,opts.vat_number=$scope.store.vat_number,opts.iban=$scope.store.iban,opts.description=$scope.store.description,opts.referral_id=$scope.store.referral_info.id,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.allow_access=$scope.store.is_allowed,void StoreService.updateStore(opts,function(data){101==data.code?($scope.updateStart=!1,$scope.showEditForm=!1,$scope.createStoreLoader=!1,$location.path("/shop/edit/"+$scope.store.id)):137==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.broker_not_exists,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1):100==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.missed_param,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):90==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.account_inactive,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):91==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_exists,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):126==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.invalid_store_forum_type,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):500==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.permission_denied,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):89==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.error_occured,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):($scope.createStoreErrorMgs=data.message,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1)}))},$scope.initializeMaps=function(){{var mapOptions=(new google.maps.LatLng(latitudeMap,longitudeMap),{center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:6}),map=new google.maps.Map(document.getElementById("map-canvas-second"),mapOptions);new google.maps.Marker({position:new google.maps.LatLng(latitudeMap,longitudeMap),map:map,title:$scope.store.map_place})}},$(".member-store").click(function(){$(this).addClass("active"),$(".store-invitations li").removeClass("active")}),$scope.cancelEdit=function(){$scope.showEditForm=!1,$scope.store={}},$scope.loadEditMap=function(){$scope.map={center:{latitude:40.1451,longitude:-99.668},zoom:4},$scope.options={scrollwheel:!1},$scope.marker={id:0,coords:{latitude:40.1451,longitude:-99.668},options:{draggable:!0},events:{dragend:function(marker,eventName,args){document.getElementById("latitude").value=marker.getPosition().lat(),document.getElementById("longitude").value=marker.getPosition().lng(),$scope.mapLocation(marker.getPosition().lat(),marker.getPosition().lng())}}}},$scope.loadEditMap(),$scope.showInvite=!1,$scope.timelineActive=!1,$scope.toggleInvite=function(){$scope.timelineActive=!$scope.timelineActive,$scope.uploadProfileImage=!1,$scope.showInvite=!$scope.showInvite,$scope.timelineActive1=!1,$scope.showEditForm=!1},$scope.uploadProfileImage=!1,$scope.toggleUploadImage=function(){$scope.showInvite=!1,$scope.uploadProfileImage=!$scope.uploadProfileImage},$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.uploadStoreProfileImage=function(){$scope.uploadStoreProfile=!0;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);if("gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType)$scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0;else{var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeDetail.id,StoreService.uploadStoreProfileimage(opts,$scope.myFile,function(data){101==data.code?($scope.uploadProfileImage=!1,$scope.uploadStoreProfile=!1,$scope.storeDetail.cover_image_path=data.data.cover_image_path,$scope.storeDetail.profile_image_original=data.data.original_image_path):$scope.uploadStoreProfile=!1})}},$scope.myFile="",$scope.imageSrc="",$scope.invalidCoverImage=!1,$scope.invalidCoverImageMgs=$scope.i18n.storealbum.album_invalidCoverImageMgs,$scope.getFile=function(){$scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.imageSrc=result;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0):($scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.readImage($scope.myFile,function(data){0!=data.length&&data.width>=400&&data.height>=200?$scope.uploadStoreProfileImage():($("#invalidCoverImage").show(),$timeout(function(){$("#invalidCoverImage").hide()},4e3))}))})},$scope.readImage=function(file,callback){var reader=new FileReader,image=new Image;reader.readAsDataURL(file),reader.onload=function(_file){var filedata={};image.src=_file.target.result,image.onload=function(){{var w=this.width,h=this.height;file.type,file.name,~~(file.size/1024)+"KB"}filedata.width=w,filedata.height=h,callback(filedata)},image.onerror=function(){callback(filedata)}}},$scope.timelineActive1=!1,$scope.showAllStoreMember=!1,$scope.showAllMembers=function(){$scope.showAllStoreMember=!$scope.showAllStoreMember,$scope.timelineActive1=!$scope.timelineActive1,$scope.timelineActive=!1,$scope.showEditForm=!1}}).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("HistoryStoreController",function($scope,$http,$routeParams,$location,$timeout,StoreService){$scope.storeAllList=[],$scope.storeHistoryDetail=[],$scope.totalSize=0,$scope.notFound=!1,$scope.allRes=1,$scope.noHistory=!1,$scope.storeMainId=$routeParams.id,$scope.storeLoading=!0,$scope.showHistory=function(){var opts={},limit_start=$scope.storeAllList.length;opts.limit_start=limit_start,opts.limit_size=APP.store_list_pagination.end,opts.user_id=APP.currentUser.id,opts.shop_id=$scope.storeMainId,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.storeLoading=!0,$scope.allRes=0,StoreService.getStoreHistory(opts,function(data){101==data.code?($scope.allRes=1,$scope.totalSize=data.data.total,$scope.storeLoading=!1,$scope.storeHistoryDetail=$scope.storeAllList=$scope.storeAllList.concat(data.data.transactions),$scope.notFound=!1,$scope.noHistory=!0):($scope.storeHistoryDetail=[],$scope.storeLoading=!1,$scope.notFound=!0)}))},$scope.showHistory(),$scope.loadMore=function(){$scope.showHistory()}}),app.controller("BrokerProfileController",["$scope","BrokerProfileService","$location",function($scope,BrokerProfileService,$location){$scope.countries=APP.countries,$scope.brokerMultiprofile=function(){var opts={};opts.user_id=APP.currentUser.id,opts.phone=$scope.user.albumname,opts.vat_number=$scope.user.albumdesc,opts.fiscal_code=APP.currentUser.id,opts.iban=$scope.user.albumname,opts.type=APP.profileType.brokerProfile,BrokerProfileService.brokerMultiprofile(opts,function(data){101==data.code})}}]),app.controller("businessAppController",["$scope","StoreService","$cookieStore",function($scope,StoreService,$cookieStore){$scope.currentLanguage=$cookieStore.get("activeLanguage"),
$scope.businessApp=[],$scope.myStoreList=function(){var opts={};opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start=0,opts.limit_size=50,opts.lang_code=$scope.currentLanguage,opts.filter_type=1,StoreService.getStore(opts,function(data){101===data.code&&($scope.businessApp=data.data.stores)})},$scope.myStoreList()}]),app.controller("ClubAlbumController",["$scope","$http","$timeout","GroupService","AlbumService","$routeParams","$location","ProfileService","$modal","$log","focus",function($scope,$http,$timeout,GroupService,AlbumService,$routeParams,$location,ProfileService,$modal,$log,focus){$scope.createAlbumForm=!1,$scope.clubAlbumLoading=!0,$scope.clubAlbumFound=!1,$scope.CreateAlbumStart=!1,$scope.createSuccess=!1,$scope.createError=!1,$scope.clubphoto=!0,$scope.aboutsection=!1,$scope.listload=!1,$scope.clubAlbumData=[],$scope.totalSize=0,$scope.allRes=1,$scope.clubAlbumSubmitted=!1,$scope.groupId=$routeParams.clubId,$scope.groupType=$routeParams.clubType,$scope.listOfAlbums=function(type){var limit_start=$scope.clubAlbumData.length,opts={};opts.group_id=$scope.groupId,opts.user_id=APP.currentUser.id,opts.session_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=12,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.listload=!0,$scope.allRes=0,GroupService.getClubAlbum(opts,function(data){101==data.code?($scope.clubAlbumLoading=!1,$scope.clubAlbumFound=!0,$scope.totalSize=data.data[0].size,$scope.allRes=1,$scope.clubAlbumData=$scope.clubAlbumData.concat(data.data[0].media),$scope.listload=!1,$(".album-option").removeClass("album-blank")):($scope.clubAlbumLoading=!1,$scope.clubAlbumFound=!1,$scope.listload=!1,$(".album-option").removeClass("album-blank"))}))},$scope.loadMore=function(){$scope.listOfAlbums("listing")},$scope.listOfAlbums("listing"),$scope.showAlbumForm=function(){$scope.errorMessage="",$scope.createError=!1,$scope.createAlbumForm=!$scope.createAlbumForm,$scope.CreateAlbum={}},$scope.createClubAlbum=function(){$scope.clubAlbumSubmitted=!0;var opts={};return opts.group_id=$routeParams.clubId,opts.session_id=APP.currentUser.id,void 0===$scope.CreateAlbum.albumName||""===$scope.CreateAlbum.albumName?(focus("clubalbumname"),!1):void 0===$scope.CreateAlbum.description||""===$scope.CreateAlbum.description?(focus("clubalbumdesc"),!1):($scope.CreateAlbumStart=!0,opts.album_name=$scope.CreateAlbum.albumName,opts.album_desc=$scope.CreateAlbum.description,GroupService.createClubAlbum(opts,function(data){101==data.code?($scope.createSuccess=!0,$scope.CreateAlbumStart=!1,$scope.successMessage=$scope.i18n.albums.album_sucessful_created,$timeout(function(){$scope.createSuccess=!1,$scope.successMessage="",$scope.showAlbumForm(),$scope.clubAlbumData.length=0,$scope.listOfAlbums("listing")},2e3)):($scope.createError=!0,$scope.errorMessage=$scope.i18n.albums.creation_gone_wrong,$scope.CreateAlbumStart=!1,$timeout(function(){$scope.createError=!1,$scope.errorMessage=""},2e3))}),void 0)},$scope.editAlbumForm=!1,$scope.updateUserAlbum=!1,$scope.editAlbum=function(albumdata){$scope.editAlbumData={},$scope.editAlbumData.id=albumdata.id,$scope.editAlbumData.albumName=albumdata.album_name,$scope.editAlbumData.albumDescription=albumdata.album_description,$scope.editAlbumForm=!$scope.editAlbumForm},$scope.closeEditForm=function(){$scope.editAlbumForm=!$scope.editAlbumForm,$scope.editAlbumData={}},$scope.updateAlbum=function(){if($scope.clubAlbumSubmitted=!0,void 0===$scope.editAlbumData.albumName||""===$scope.editAlbumData.albumName)return focus("editalbumname"),!1;if(void 0===$scope.editAlbumData.albumDescription||""===$scope.editAlbumData.albumDescription)return focus("editalbumdesc"),!1;$scope.updateUserAlbum=!0;var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.editAlbumData.id,opts.album_name=$scope.editAlbumData.albumName,opts.album_desc=$scope.editAlbumData.albumDescription,opts.type="club",AlbumService.updateAlbum(opts,function(data){$scope.updateUserAlbum=!1,$scope.clubAlbumSubmitted=!1,101==data.code?($scope.editAlbumForm=!$scope.editAlbumForm,$scope.clubAlbumData=[],$scope.listOfAlbums("listing"),$scope.user=null,$scope.albumResponse=$scope.i18n.albums.album_updated,$timeout(function(){$scope.albumResponse=""},5e3)):($scope.editAlbumForm=!$scope.editAlbumForm,$scope.albumErrorResponse=$scope.i18n.albums.gone_wrong,$timeout(function(){$scope.albumErrorResponse=""},5e3))})},$scope.deleteClubAlbum=function(albumId,id){var opts={};opts.group_id=$scope.groupId,opts.album_id=albumId,opts.session_id=APP.currentUser.id,GroupService.deleteClubAlbum(opts,function(data){101==data.code&&($scope.clubAlbumData.length=0,$scope.listOfAlbums("listing"))})},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.ratePost=function(rating,id,index){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="club_album",opts.type_id=id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.clubAlbumData[index].is_rated?"update":"add",waitRequest=ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.clubAlbumData[index].avg_rate=data.data.avg_rate,$scope.clubAlbumData[index].no_of_votes=data.data.no_of_votes,$scope.clubAlbumData[index].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.clubAlbumData[index].is_rated=!1,$scope.clubAlbumData[index].current_user_rate=0),$scope.waitRateResponse=!1})},$scope.WaitDeleteResponse=!1,$scope.removeRating=function(id,index){var opts={};opts.user_id=APP.currentUser.id,opts.type="club_album",opts.type_id=id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.clubAlbumData[index].current_user_rate=0,$scope.clubAlbumData[index].is_rated=!1,$scope.clubAlbumData[index].no_of_votes=data.data.no_of_votes,$scope.clubAlbumData[index].avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.clubAlbumData[index].current_user_rate=0,$scope.clubAlbumData[index].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.stars=[],$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}],$scope.showPeopleLoader=!1,$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({template:'<style>.modal-body.tag-frnd-modal ul li{padding:8px 130px 8px 0}.modal-content .modal-body ul.rmv-tag{position:absolute;right:0;top:10px}.modal-content .modal-body ul.rmv-tag li{padding:0;display:inline-block;vertical-align:middle;border:0}.modal-content .modal-body ul.rmv-tag li span.votes-avg{width:23px;height:21px;margin-left:2px;background:url(app/assets/images/rating-star.png) no-repeat;display:block}.modal-content .modal-body ul.rmv-tag li span.votes-blank{width:23px;height:21px;margin-left:2px;background:url(app/assets/images/rating-star.png) 0 -21px no-repeat;display:block}.modal.in .modal-dialog{margin:auto;top:0;bottom:0;left:0;right:0;position:absolute}.modal-body.tag-frnd-modal{height:360px;overflow-y:auto;overflow-x:hidden;padding:0 10px}.modal .modal-content{margin:auto;height:400px;top:0;bottom:0;left:0;right:0;position:absolute;overflow:visible}@media screen and (max-width:479px){.modal.in .modal-dialog{margin:auto 20px}.modal-body.tag-frnd-modal ul li{padding:8px 70px 8px 0}.modal-content .modal-body ul.rmv-tag li span.votes-avg{width:12px;height:10px;margin-left:1px;background:url(app/assets/images/rating-star.png) 0 0/12px no-repeat}.modal-content .modal-body ul.rmv-tag li span.votes-blank{width:12px;height:10px;margin-left:1px;background:url(app/assets/images/rating-star.png) 0 -11px/12px no-repeat}}</style><div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div></div><div class="modal-body tag-frnd-modal"><ul ng-hide="showPeopleLoader"><li data-ng-repeat="friend in ratedUsers"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a ng-href="#/viewfriend/{{friend.id}}">{{friend.first_name}} {{friend.last_name}}</a><span class="frnd-details"><a href>{{friend.about_me}}</a></span></span><ul class="rmv-tag"><li data-ng-repeat="avgRate in averageRating(friend.rate) track by $index"><span ng-class="friend.rate % 1 == 0 ?\'votes-avg\': ($last ? \'half-avg\':\'votes-avg\')" /></li><li ng-repeat="blank in blankStar(friend.rate) track by $index"><span class="votes-blank"/> </li></ul></li></ul> <div ng-show="showPeopleLoader"><img titile="" alt="" src="app/assets/images/proceed.gif"></div></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.redirectUrl=function(albumId,name){$location.path("/album/club/view/"+$scope.groupId+"/"+albumId+"/"+$scope.groupType+"/"+name)}}]),app.controller("ClubAlbumPhotoController",["$scope","$http","$timeout","GroupService","$routeParams","FileUploader","ProfileService","$modal","$log",function($scope,$http,$timeout,GroupService,$routeParams,FileUploader,ProfileService,$modal,$log){$scope.createAlbumForm=!1,$scope.clubAlbumLoading=!0,$scope.imageUploadStart=!1,$scope.uploadSuccess=!1,$scope.uploadError=!1,$scope.listload=!1,$scope.deleteMediaStart=!1,$scope.viewalbum=[],$scope.totalSizeImg=0,$scope.allResImg=1,$scope.groupId=$routeParams.clubId,$scope.albumId=$routeParams.albumId,$scope.clubType=$routeParams.clubType,$scope.albumName=$routeParams.name,$scope.viewClubAlbumPhotos=function(type){"listing"==type?$scope.clubAlbumLoading=!1:$scope.clubAlbumLoading=!0;var limit_start=$scope.viewalbum.length,opts={};opts.group_id=$scope.groupId,opts.user_id=APP.currentUser.id,opts.album_id=$scope.albumId,opts.session_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=12,($scope.totalSizeImg>limit_start||0==$scope.totalSizeImg)&&1==$scope.allResImg&&($scope.listload=!0,$scope.allResImg=0,GroupService.viewClubAlbum(opts,function(data){101==data.code?($scope.clubAlbumLoading=!1,$scope.totalSizeImg=data.data[0].size,$scope.allResImg=1,$scope.viewalbum=$scope.viewalbum.concat(data.data[0].media),$scope.albumDescription=data.data[0].album.description,$scope.albumDetails=data.data[0].album,$scope.listload=!1,$(".album-option").removeClass("album-blank")):($scope.listload=!1,$(".album-option").removeClass("album-blank"))}))},$scope.loadMoreImage=function(){$scope.viewClubAlbumPhotos("listing")},$scope.viewClubAlbumPhotos("listing"),$scope.UploadMediaInAlbum=function(){if(void 0==$scope.imagePrvSrc||0==$scope.imagePrvSrc.length)return $scope.uploadError=!0,$scope.uploadErrorMsg=$scope.i18n.albums.select_first,$timeout(function(){$scope.uploadErrorMsg="",$scope.uploadError=!1},4e3),!1;$scope.imageUploadStart=!0;var opts={};opts.group_id=$scope.groupId,opts.album_id=$scope.albumId,opts.session_id=APP.currentUser.id,opts.group_media=$scope.postFiles,opts.post_type=1;$scope.imagePrvSrc.length;opts.media_id=[],angular.forEach($scope.imagePrvSrc,function(file){opts.media_id.push(file.media_id)}),GroupService.uploadMediaInClubAlbumFinal(opts,function(data){$scope.postFiles=[],$scope.imagePrvSrc=[],101==data.code?($scope.viewalbum.length=0,$scope.imageUploadStart=!1,$scope.uploadSuccess=!0,$scope.imgUpload=!1,$scope.uploadSuccessMsg=$scope.i18n.albums.upload_sucess,$("input[type='file']").val(""),$timeout(function(){$scope.uploadSuccessMsg="",$scope.viewClubAlbumPhotos("listing")},5e3),$scope.postFiles=[],$scope.imagePrvSrc=[],uploader.queue=[]):($("input[type='file']").val(""),$scope.imageUploadStart=!1,$scope.imgUpload=!1,$scope.uploadError=!0,$scope.uploadErrorMsg=$scope.i18n.albums.upload_error,$timeout(function(){$scope.$scope.uploadErrorMsg="",$scope.viewClubAlbumPhotos()},15e3),$("input[type='file']").val(""))})},$scope.fileNotValid=!1,$scope.fileNotValidMsg="",$scope.tempAlbumId="",$scope.albumImgLoader=[],$scope.imagePrvSrc=[];var uploader=$scope.uploader=new FileUploader({url:APP.service.uploadMediaInClubAlbum+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id,album_id:$scope.albumId,group_id:$scope.groupId,post_type:"0",session_id:APP.currentUser.id},dataObjName:"reqObj",formDataName:"group_media[]"});uploader.filters.push({name:"group_media[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0;var queueLen=uploader.queue.length;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.albumImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imagePrvSrc[index]=response.data,$scope.albumImgLoader[index]=!1)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.albums.upload_media_invalid,$timeout(function(){$scope.fileNotValidMsg=""},4e3)},$scope.removeImage=function(index){var tempImg=$scope.imagePrvSrc[index];$scope.imagePrvSrc.splice(index,1);var item=$scope.uploader.queue[index];item.remove();var opts={};opts.group_id=$scope.groupId,opts.album_id=$scope.albumId,opts.media_id=tempImg.media_id,opts.session_id=APP.currentUser.id,GroupService.deleteClubAlbumMedia(opts,function(data){101==data.code||($scope.imagePrvSrc[index]=tempImg,$timeout(function(){$scope.albumErrMsg=data.message},4e3))})},$scope.deleteClubAlbumMedia=function(mediaId,id){var opts={};opts.group_id=$scope.groupId,opts.album_id=$scope.albumId,opts.media_id=mediaId,opts.session_id=APP.currentUser.id,GroupService.deleteClubAlbumMedia(opts,function(data){101==data.code?$scope.viewalbum.splice(id,1):$scope.deleteMediaStart=!1})},$scope.setClubProfileImage=function(m_id,id){$("#featuredloaderlink-"+id).hide(),$("#featuredloader-"+id).show(),$scope.featuredloader=!0;var opts={};opts.group_id=$scope.groupId,opts.session_id=APP.currentUser.id,opts.media_id=m_id,GroupService.setClubProfileImage(opts,function(data){if(101==data.code){$scope.uploadSuccess=!0,$scope.uploadSuccessMsg=$scope.i18n.albums.update_sucess,$("#featuredloaderlink-"+id).show(),$("#featuredloader-"+id).hide(),$timeout(function(){$scope.uploadSuccessMsg=""},2e3);var imageData=data.data;$scope.$broadcast("updateClubProfileCover",imageData)}else $scope.uploadError=!0,$scope.uploadSuccessMsg=$scope.i18n.albums.not_success_update,$("#featuredloaderlink-"+id).show(),$("#featuredloader-"+id).hide(),$timeout(function(){$scope.uploadSuccessMsg=""},2e3)})},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.ratePost=function(rating,id,index){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="club_album_photo",opts.type_id=id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.viewalbum[index].is_rated?"update":"add",waitRequest=ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.viewalbum[index].avg_rate=data.data.avg_rate,$scope.viewalbum[index].no_of_votes=data.data.no_of_votes,$scope.viewalbum[index].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.viewalbum[index].is_rated=!1,$scope.viewalbum[index].current_user_rate=0),$scope.waitRateResponse=!1})},$scope.WaitDeleteResponse=!1,$scope.removeRating=function(id,index){var opts={};opts.user_id=APP.currentUser.id,opts.type="club_album_photo",opts.type_id=id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.viewalbum[index].current_user_rate=0,$scope.viewalbum[index].is_rated=!1,$scope.viewalbum[index].no_of_votes=data.data.no_of_votes,$scope.viewalbum[index].avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.viewalbum[index].current_user_rate=0,$scope.viewalbum[index].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.stars=[],$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}],$scope.showPeopleLoader=!1,$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({template:'<style>.modal-body.tag-frnd-modal ul li{padding:8px 130px 8px 0}.modal-content .modal-body ul.rmv-tag{position:absolute;right:0;top:10px}.modal-content .modal-body ul.rmv-tag li{padding:0;display:inline-block;vertical-align:middle;border:0}.modal-content .modal-body ul.rmv-tag li span.votes-avg{width:23px;height:21px;margin-left:2px;background:url(app/assets/images/rating-star.png) no-repeat;display:block}.modal-content .modal-body ul.rmv-tag li span.votes-blank{width:23px;height:21px;margin-left:2px;background:url(app/assets/images/rating-star.png) 0 -21px no-repeat;display:block}.modal.in .modal-dialog{margin:auto;top:0;bottom:0;left:0;right:0;position:absolute}.modal-body.tag-frnd-modal{height:360px;overflow-y:auto;overflow-x:hidden;padding:0 10px}.modal .modal-content{margin:auto;height:400px;top:0;bottom:0;left:0;right:0;position:absolute;overflow:visible}@media screen and (max-width:479px){.modal.in .modal-dialog{margin:auto 20px}.modal-body.tag-frnd-modal ul li{padding:8px 70px 8px 0}.modal-content .modal-body ul.rmv-tag li span.votes-avg{width:12px;height:10px;margin-left:1px;background:url(app/assets/images/rating-star.png) 0 0/12px no-repeat}.modal-content .modal-body ul.rmv-tag li span.votes-blank{width:12px;height:10px;margin-left:1px;background:url(app/assets/images/rating-star.png) 0 -11px/12px no-repeat}}</style><div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div></div><div class="modal-body tag-frnd-modal"><ul ng-hide="showPeopleLoader"><li data-ng-repeat="friend in ratedUsers"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a ng-href="#/viewfriend/{{friend.id}}">{{friend.first_name}} {{friend.last_name}}</a><span class="frnd-details"><a href>{{friend.about_me}}</a></span></span><ul class="rmv-tag"><li data-ng-repeat="avgRate in averageRating(friend.rate) track by $index"><span ng-class="friend.rate % 1 == 0 ?\'votes-avg\': ($last ? \'half-avg\':\'votes-avg\')" /></li><li ng-repeat="blank in blankStar(friend.rate) track by $index"><span class="votes-blank"/> </li></ul></li></ul> <div ng-show="showPeopleLoader"><img titile="" alt="" src="app/assets/images/proceed.gif"></div></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)})}}]),app.controller("PromotionController",["$scope","$http","$rootScope","$routeParams","$location","$timeout","CommerialService","StoreService",function($scope,$http,$rootScope,$routeParams,$location,$timeout,CommerialService,StoreService){if($rootScope.tabActive="coupon",$scope.awards=!1,$scope.shopping1=!1,$scope.shopping2=!1,$scope.commerce=!1,$scope.report=!1,$scope.coupon=!0,$scope.tabShopping=!1,$scope.routeId=$routeParams.id,$scope.ShowDetail=function(parameter){switch(parameter){case"coupon":$scope.coupon=!0,$scope.awards=!1,$scope.shopping1=!1,$scope.shopping2=!1,$scope.commerce=!1,$scope.report=!1,$scope.tabShopping=!1,$rootScope.tabActive="coupon";break;case"awards":$scope.awards=!0,$scope.coupon=!1,$scope.shopping1=!1,$scope.shopping2=!1,$scope.commerce=!1,$scope.report=!1,$scope.tabShopping=!1,$rootScope.tabActive="awards";break;case"card":$scope.shopping1=!0,$scope.tabShopping=!0,$scope.awards=!1,$scope.coupon=!1,$scope.shopping2=!1,$scope.commerce=!1,$scope.report=!1,$rootScope.tabActive="card",$rootScope.tabinActive="shopping1";break;case"commerce":$scope.commerce=!0,$scope.shopping1=!1,$scope.awards=!1,$scope.coupon=!1,$scope.shopping2=!1,$scope.report=!1,$scope.tabShopping=!1,$rootScope.tabActive="commerce";break;case"report":$scope.report=!0,$scope.commerce=!1,$scope.shopping1=!1,$scope.awards=!1,$scope.coupon=!1,$scope.shopping2=!1,$scope.tabShopping=!1,$rootScope.tabActive="report";break;case"shopping1":$scope.shopping1=!0,$scope.tabShopping=!0,$scope.report=!1,$scope.commerce=!1,$scope.awards=!1,$scope.coupon=!1,$scope.shopping2=!1,$rootScope.tabActive="card",$rootScope.tabinActive="shopping1";break;case"shopping2":$scope.shopping2=!0,$scope.tabShopping=!0,$scope.report=!1,$scope.commerce=!1,$scope.awards=!1,$scope.coupon=!1,$scope.shopping1=!1,$rootScope.tabActive="card",$rootScope.tabinActive="shopping2";break;default:$rootScope.tabActive="coupon",$scope.coupon=!0}},$scope.$on("update_parent",function(event,storeDetail){$scope.storeDetail=storeDetail,$scope.storeId=$scope.storeDetail.id,$scope.storeName=$scope.storeDetail.name,$scope.is_paypal_added=$scope.storeDetail.is_paypal_added,$scope.is_subscribed=$scope.storeDetail.is_subscribed}),$scope.success=!1,$scope.subscribeError=!1,$scope.is_paypal_added=StoreService.getStoreData().is_paypal_added,$scope.is_subscribed=StoreService.getStoreData().is_subscribed,$location.search().codTrans)if($scope.codTrans=$location.search().codTrans,$scope.amount=$location.search().importo,$scope.uniform=$location.search().divisa,$scope.outcome=$location.search().esito,$scope.descrizione=$location.search().descrizione,$scope.pan=$location.search().pan,$scope.profileId=$rootScope.tempStoreId,"OK"==$scope.outcome){$scope.coupon=!1,$scope.shopping1=!0,$scope.tabShopping=!0,$scope.is_subscribed=1,$scope.tranId=$location.search().txn_id;var formData={};formData.user_id=APP.currentUser.id,formData.txn_id=$scope.tranId,formData.status="PENDING",CommerialService.returnPaymentCancel(formData,function(data){}),$rootScope.tabActive="card",$rootScope.tabinActive="shopping1",$scope.success=!0,$timeout(function(){$scope.success=!1,$location.search({})},1e4)}else $scope.coupon=!1,$scope.is_subscribed=2,$scope.shopping1=!0,$scope.tabShopping=!0,$rootScope.tabActive="card",$rootScope.tabinActive="shopping1",$scope.subscribeError=!0}]),app.controller("DateController",["$scope",function($scope){$scope.today=function(){$scope.dt=new Date},$scope.clear=function(){$scope.dt=null},$scope.disabled=function(date,mode){return"day"===mode&&(0===date.getDay()||6===date.getDay())},$scope.toggleMin=function(){$scope.minDate=$scope.minDate?null:new Date},$scope.toggleMin(),$scope.open=function($event,parameter){$event.preventDefault(),$event.stopPropagation(),1==parameter&&($scope.opened1=!0,$scope.opened2=!1),2==parameter&&($scope.opened2=!0,$scope.opened1=!1)},$scope.dateOptions={formatYear:"yy",startingDay:1},$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate","dd-MM-yyyy"],$scope.format=$scope.formats[4]}]),app.controller("CouponController",["$scope","$http","$rootScope","$routeParams","$location","$timeout","focus","CommerialService","ProfileService","OfferService","DateToMongoDate",function($scope,$http,$rootScope,$routeParams,$location,$timeout,focus,CommerialService,ProfileService,OfferService,DateToMongoDate){$scope.formSubmitted=!1;var DELAY_TIME_BEFORE_POSTING=300;$scope.startDate=$scope.i18n.coupon.start_date,$scope.endDate=$scope.i18n.coupon.end_date,$scope.sex=[{dbvalue:"Male",value:$scope.i18n.coupon.man},{dbvalue:"Female",value:$scope.i18n.coupon.women}],$scope.checkedSex=[],$scope.toggleCheck=function(dbvalue){-1===$scope.checkedSex.indexOf(dbvalue)?$scope.checkedSex.push(dbvalue):$scope.checkedSex.splice($scope.checkedSex.indexOf(dbvalue),1)};var currentTimeout=null;angular.element("#searchTagFriend").keypress(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.tagFriendSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.showFrom=!1,$scope.tagFriendSuggestion=function(){$scope.cancelFriendSearch=!1,$scope.showFriendList=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.friendName,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&($scope.friends=data.data.users,0==$scope.friends.length)})},$scope.storedFriend=[],$scope.dublicate=!1,$scope.selectFriend=function(friendInfo){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.storedFriend,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.storedFriend.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1))},$scope.removeTagFriend=function(friendIndex){$scope.storedFriend.splice(friendIndex,1)},$scope.lostFormFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.friendTaggIndex=-1,$scope.keyUpDownControl=function(event){40===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex+1!==$scope.friends.length&&$scope.friendTaggIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex-1!==-1&&$scope.friendTaggIndex--):13===event.keyCode&&$scope.selectFriend($scope.friends[$scope.friendTaggIndex])},$("#categoryKeyword").keypress(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchKeyword()},DELAY_TIME_BEFORE_POSTING)}),$scope.keywords=[],$scope.searchKeyword=function(){var opts={};opts.keyword=$scope.tagkeywords,opts.session_id=APP.currentUser.id,$scope.cancelKeywordRequest=!1,$scope.showCatKeyLoading=!0,ProfileService.searchCatagoryKeyword(opts,function(data){$scope.showCatKeyLoading=!1,101===data.code&&"SUCCESS"===data.message&&$scope.cancelKeywordRequest===!1&&($scope.keywords=data.data.keyword)})},$scope.keywordIndex=-1,$scope.keywordKeyDown=function(event){if(40===event.keyCode)event.preventDefault(),$scope.keywordIndex+1!==$scope.keywords.length&&$scope.keywordIndex++;else if(38===event.keyCode)event.preventDefault(),$scope.keywordIndex-1!==-1&&$scope.keywordIndex--;else if(13===event.keyCode)if(void 0===$scope.keywords[$scope.keywordIndex]){if(""!==$scope.tagkeywords.trim()){var opts={};opts.user_id=APP.currentUser.id,opts.keyword=$scope.tagkeywords,ProfileService.addKeywords(opts,function(data){101===data.code&&"SUCCESS"===data.message&&($scope.keywords=data.data.keyword,$scope.storeKeyword($scope.keywords))})}}else $scope.storeKeyword($scope.keywords[$scope.keywordIndex])},$scope.cancelKeywordRequest=!1,$scope.clearKeyList=function(){$scope.cancelKeywordRequest=!0,$timeout(function(){$scope.keywords=[]},500)},$scope.tagkeywords="",$scope.keywordList=[],$scope.storeKeyword=function(index){if($scope.keywords=[],$scope.keywordIndex=-1,$scope.seen=!0,$scope.tagkeywords="","object"==typeof index){for(var i=0;i<$scope.keywordList.length;i++)$scope.keywordList[i].name==index.name&&($scope.seen=!1);1==$scope.seen&&$scope.keywordList.push(index)}else{if(""===index||void 0===index)return!1;-1===$scope.keywordList.indexOf(index)&&$scope.keywordList.push(index)}},$scope.removeKeyword=function(index){$scope.keywordList.indexOf(index);$scope.keywordList.splice(index,1)},$scope.coupon={},$scope.errorMesg=!1,$scope.showMesge=!1,$scope.showLoader=!1,$scope.dateDiff=!1,$scope.todayDiff=!1;var today=new Date,stoday=today.toISOString();$scope.todayDate=stoday,$scope.compareDate=function(){$scope.dt.toISOString()>$scope.dtt.toISOString()?$scope.dateDiff=!0:$scope.dateDiff=!1,$scope.dtt.toISOString()<$scope.todayDate?$scope.todayDiff=!0:$scope.todayDiff=!1},$scope.compareDateStart=function(){$scope.dtt&&($scope.dt.toISOString()>$scope.dtt.toISOString()?$scope.dateDiff=!0:$scope.dateDiff=!1)},$scope.createCoupon=function(){var newSDate=$scope.dt,dd=newSDate.getDate(),mm=newSDate.getMonth()+1,yyyy=newSDate.getFullYear();10>dd&&(dd="0"+dd),10>mm&&(mm="0"+mm);var newSDate=yyyy+"-"+mm+"-"+dd,newEDate=$scope.dtt,dd=newEDate.getDate(),mm=newEDate.getMonth()+1,yyyy=newEDate.getFullYear();10>dd&&(dd="0"+dd),10>mm&&(mm="0"+mm);var newEDate=yyyy+"-"+mm+"-"+dd;$scope.formSubmitted=!0,$scope.showErrorDp=!1;$scope.dt,$scope.dtt;if(void 0==$scope.coupon.couponValue||""==$scope.coupon.couponValue)return focus("radio1"),!1;if(void 0==$scope.coupon.couponQuantity||""==$scope.coupon.couponQuantity)return focus("radio7"),!1;if(void 0==$scope.dt||""==$scope.dt)return focus("dt"),!1;if(void 0===$scope.dtt||""===$scope.dtt)return focus("dtt"),!1;if($scope.dt.toISOString()>$scope.dtt.toISOString())return $scope.dateDiff=!0,focus("dtt"),$timeout(function(){$scope.dateDiff=!1},15e3),!1;if($scope.dtt.toISOString()<$scope.todayDate)return $scope.todayDiff=!0,focus("dtt"),$timeout(function(){$scope.todayDiff=!1},5e3),!1;if(void 0==$scope.coupon.discountValue||""==$scope.coupon.discountValue)return focus("chk1"),!1;$scope.showLoader=!0,$scope.hideButton=!0;var parameters=(APP.service.addUpdateApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id,new Object),main=[];$scope.offer_type="551ce49e2aa8f00f20d9328f";var option=new Object;option.code="",option.description="",option.discount=parseInt($scope.coupon.discountValue),
option.end_date=newEDate;var keywordtagged=[];if($scope.keywordList.length>0)for(var i=0;i<$scope.keywordList.length;i++)keywordtagged.push(" "+$scope.keywordList[i].name+" ");var keyword=keywordtagged.join();option.keywords=keyword,option.name="";var type=new Object;type._id=$scope.offer_type,option.offer_type=type;var shopdetail=new Object;shopdetail._id=$scope.storeId,shopdetail.name=$scope.storeName,option.shop_id=shopdetail,option.start_date=newSDate;var tagged=[],taggfriend={};if($scope.storedFriend.length>0)for(var i=0;i<$scope.storedFriend.length;i++)taggfriend._id=$scope.storedFriend[i].user_info.id.toString(),taggfriend.name=$scope.storedFriend[i].user_info.first_name+$scope.storedFriend[i].user_info.last_name,tagged.push(taggfriend);var friends=new Object;friends.$insert=tagged,option.tag_friends=friends,option.title="",option.to_avail=parseInt($scope.coupon.couponQuantity),option.value=parseInt($scope.coupon.couponValue),option.sex=$scope.checkedSex;var array=[];array.push(option),parameters.$insert=array,parameters.$collection="sixc_offers",main.push(parameters),OfferService.addUpdateApplaneData(main,function(data){"ok"===data.status&&200===data.code?($scope.showLoader=!1,$scope.hideButton=!1,$scope.showMesge=!0,$scope.dt="",$scope.dtt="",$scope.coupon={},$scope.storedFriend.length=0,$scope.keywordList.length=0,$scope.couponValue=" ",$scope.checkedSex.length=0,$timeout(function(){$scope.showMesge=!1},15e3),$scope.formSubmitted=!1,$scope.getlistingData()):"error"===data.status&&1==data.message?($scope.showErrorDp=!0,$scope.showLoader=!1,$scope.ShowErrorResponse=data.response,$scope.dt="",$scope.dtt="",$scope.coupon={},$scope.storedFriend.length=0,$scope.keywordList.length=0,$scope.couponValue=" ",$scope.checkedSex.length=0,$scope.hideButton=!1,$scope.formSubmitted=!1,$timeout(function(){$scope.showErrorDp=!1},11e4)):($scope.showLoader=!1,$scope.hideButton=!1,$scope.errorMesg=!0,$scope.formSubmitted=!1,$timeout(function(){$scope.errorMesg=!1},15e3))})},$scope.getlistingData=function(){var today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();10>dd&&(dd="0"+dd),10>mm&&(mm="0"+mm);var today=yyyy+"-"+mm+"-"+dd;$scope.todaySDate=today,$scope.offerlistingObject=[],$scope.noResult=!1,$scope.showCouponListMsg=!1,$scope.couponListingLoader=!0,$scope.showList=!1,$scope.offer_id="551ce49e2aa8f00f20d9328f";var option=new Object;option.$collection="sixc_offers";var getlisting=new Object;getlisting.value=1,getlisting.start_date=1,getlisting.end_date=1,getlisting.discount=1,getlisting.to_avail=1,option.$fields=getlisting;var filters=new Object,start=new Object;start.$lte=today;var end=new Object;end.$gte="$$CurrentDate",filters.start_date=start,filters.end_date=end,filters.offer_type=$scope.offer_id,filters.shop_id=$scope.routeId,option.$filter=filters;var history=new Object;history["__history.__createdOn"]=-1,option.$sort=history,option.$limit=15,option.$skip=0,$scope.noResult=!1,OfferService.getApplaneData(option,function(data){"ok"===data.status&&200===data.code?($scope.couponListingLoader=!1,$scope.showList=!0,$scope.offerlistingObject=data.response.result,0==$scope.offerlistingObject.length&&($scope.showCouponListMsg=!0)):$scope.couponListingLoader=!1})},$scope.getlistingData()}]),app.controller("AwardsController",["$scope","$http","$rootScope","$routeParams","$location","$timeout","focus","CommerialService","ProfileService","OfferService",function($scope,$http,$rootScope,$routeParams,$location,$timeout,focus,CommerialService,ProfileService,OfferService){$scope.errorMesg=!1,$scope.showValue=!1;var today=new Date,stoday=today.toISOString();$scope.todayDate=stoday,$scope.deleteLoader=!1,$scope.deleteDP=function(index,value){$scope.deleteLoader=!0;var option=new Object,insert=new Object;insert._id=value;var inner=new Object;inner.status="Closed",inner.balance=0,inner.end_date=$scope.todayDate,insert.$set=inner;var array=[];array.push(insert),option.$update=array,option.$collection="sixc_shopdp";var param=new Object;param.status=1,option.$fields=param;var main=[];main.push(option),OfferService.addUpdateApplaneData(main,function(data){"ok"===data.status&&200===data.code?($scope.deleteLoader=!1,$scope.offerlistingObject.splice(index,1),$scope.getlistingData()):$scope.deleteLoader=!1})},$scope.showOther=function(){$scope.showValue=!0,$scope.confirm=!1},$scope.showHideOther=function(){$scope.showValue=!1,($scope.confirm=!0)&&($scope.confirm=!1)},$scope.sex=[{dbvalue:"Male",value:$scope.i18n.coupon.man},{dbvalue:"Female",value:$scope.i18n.coupon.women}],$scope.checkedSex=[],$scope.toggleCheck=function(dbvalue){-1===$scope.checkedSex.indexOf(dbvalue)?$scope.checkedSex.push(dbvalue):$scope.checkedSex.splice($scope.checkedSex.indexOf(dbvalue),1)},$scope.discountSubmitted=!1,$scope.showLoader=!1;var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;angular.element("#searchTagFriend").keypress(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.tagFriendSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.showFrom=!1,$scope.tagFriendSuggestion=function(){$scope.cancelFriendSearch=!1,$scope.showFriendList=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.friendName,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&($scope.friends=data.data.users,0==$scope.friends.length)})},$scope.storedFriend=[],$scope.dublicate=!1,$scope.selectFriend=function(friendInfo){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.storedFriend,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.storedFriend.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1))},$scope.removeTagFriend=function(friendIndex){$scope.storedFriend.splice(friendIndex,1)},$scope.lostFormFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.friendTaggIndex=-1,$scope.keyUpDownControl=function(event){40===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex+1!==$scope.friends.length&&$scope.friendTaggIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex-1!==-1&&$scope.friendTaggIndex--):13===event.keyCode&&$scope.selectFriend($scope.friends[$scope.friendTaggIndex])},$("#categoryKeyword").keypress(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchKeyword()},DELAY_TIME_BEFORE_POSTING)}),$scope.keywords=[],$scope.searchKeyword=function(){var opts={};opts.keyword=$scope.tagkeywords,opts.session_id=APP.currentUser.id,$scope.cancelKeywordRequest=!1,$scope.showCatKeyLoading=!0,ProfileService.searchCatagoryKeyword(opts,function(data){$scope.showCatKeyLoading=!1,101===data.code&&"SUCCESS"===data.message&&$scope.cancelKeywordRequest===!1&&($scope.keywords=data.data.keyword)})},$scope.keywordIndex=-1,$scope.keywordKeyDown=function(event){if(40===event.keyCode)event.preventDefault(),$scope.keywordIndex+1!==$scope.keywords.length&&$scope.keywordIndex++;else if(38===event.keyCode)event.preventDefault(),$scope.keywordIndex-1!==-1&&$scope.keywordIndex--;else if(13===event.keyCode)if(void 0===$scope.keywords[$scope.keywordIndex]){if(""!==$scope.tagkeywords.trim()){var opts={};opts.user_id=APP.currentUser.id,opts.keyword=$scope.tagkeywords,ProfileService.addKeywords(opts,function(data){101===data.code&&"SUCCESS"===data.message&&($scope.keywords=data.data.keyword,$scope.storeKeyword($scope.keywords))})}}else $scope.storeKeyword($scope.keywords[$scope.keywordIndex])},$scope.cancelKeywordRequest=!1,$scope.clearKeyList=function(){$scope.cancelKeywordRequest=!0,$timeout(function(){$scope.keywords=[]},500)},$scope.tagkeywords="",$scope.keywordList=[],$scope.storeKeyword=function(index){if($scope.keywords=[],$scope.keywordIndex=-1,$scope.seen=!0,$scope.tagkeywords="","object"==typeof index){for(var i=0;i<$scope.keywordList.length;i++)$scope.keywordList[i].name==index.name&&($scope.seen=!1);1==$scope.seen&&$scope.keywordList.push(index)}else{if(""===index||void 0===index)return!1;-1===$scope.keywordList.indexOf(index)&&$scope.keywordList.push(index)}},$scope.removeKeyword=function(index){$scope.keywordList.indexOf(index);$scope.keywordList.splice(index,1)},$scope.dp={},$scope.confirm=!1;var today=new Date,stoday=today.toISOString();$scope.todayDate=stoday,$scope.showMesge=!1,$scope.errorMesg=!1,$scope.confirmAwards=function(){return void 0===$scope.dp.discountPosition||""==$scope.dp.discountPosition?(focus("radio1"),!1):($scope.confirm=!0,$scope.valueDp=$scope.dp.discountPosition,$scope.conMsg=!0,void $timeout(function(){$scope.conMsg=!1},5e3))},$scope.createDp=function(){if($scope.discountSubmitted=!0,!$scope.confirm)return focus("radio1"),!1;if(void 0==$scope.dp.discountPosition||""==$scope.dp.discountPosition)return focus("radio1"),!1;$scope.showLoader=!0,$scope.hideButton=!0;var param=(APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id,new Object),option=new Object,keywordtagged=[];if($scope.keywordList.length>0)for(var i=0;i<$scope.keywordList.length;i++)keywordtagged.push(" "+$scope.keywordList[i].name+" ");var keyword=keywordtagged.join();option.keywords=keyword,option.sex=$scope.checkedSex;var tagged=[],taggfriend={};if($scope.storedFriend.length>0)for(var i=0;i<$scope.storedFriend.length;i++)taggfriend._id=$scope.storedFriend[i].user_info.id.toString(),taggfriend.name=$scope.storedFriend[i].user_info.first_name+$scope.storedFriend[i].user_info.last_name,tagged.push(taggfriend);var friends=new Object;friends.$insert=tagged,option.tag_friends=friends;var shopdetail=new Object;shopdetail._id=$scope.routeId,option.shop_id=shopdetail,option.credit=$scope.dp.discountPosition,option.start_date=$scope.todayDate;var array=[];array.push(option),param.$insert=array,param.$collection="sixc_shopdp";var main=[];main.push(param),$scope.showErrorDp=!1,OfferService.addUpdateApplaneData(main,function(data){"ok"===data.status&&200===data.code?($scope.showLoader=!1,$scope.showMesge=!0,$scope.hideButton=!1,$scope.dp={},$scope.storedFriend.length=0,$scope.keywordList.length=0,$scope.checkedSex.length=0,$scope.valueDp="",$timeout(function(){$scope.showMesge=!1},15e3),$scope.discountSubmitted=!1,$scope.getlistingData()):"error"===data.status&&1==data.message?($scope.showErrorDp=!0,$scope.showLoader=!1,$scope.ShowErrorResponse=data.response,$scope.dp={},$scope.storedFriend.length=0,$scope.keywordList.length=0,$scope.checkedSex.length=0,$scope.valueDp="",$scope.hideButton=!1,$scope.discountSubmitted=!1,$timeout(function(){$scope.showErrorDp=!1},11e4)):($scope.showLoader=!1,$scope.errorMesg=!0,$scope.hideButton=!1,$scope.discountSubmitted=!1,$timeout(function(){$scope.errorMesg=!1},15e3))})},$scope.getlistingData=function(){$scope.offerlistingObject=[],$scope.showCouponListMsg=!1,$scope.couponListingLoader=!0;var option=new Object;option.$collection="sixc_shopdp";var getlisting=new Object;getlisting.value=1,getlisting.start_date=1,getlisting.end_date=1,getlisting.credit=1,getlisting.debit=1,getlisting.balance=1,option.$fields=getlisting;var filters=new Object,bal=new Object;bal.$gt=0,filters.shop_id=$scope.routeId,filters.balance=bal,option.$filter=filters;var history=new Object;history["__history.__createdOn"]=-1,option.$sort=history,option.$limit=5,option.$skip=0,$scope.noResult=!1,OfferService.getApplaneData(option,function(data){"ok"===data.status&&200===data.code?($scope.couponListingLoader=!1,$scope.offerlistingObject=data.response.result,$scope.dpLength=0,0==$scope.offerlistingObject.length&&($scope.showCouponListMsg=!0)):$scope.couponListingLoader=!1})},$scope.getlistingData()}]),app.controller("CreateCampaignController",["$scope","$http","$rootScope","$routeParams","$location","$timeout","focus","CommerialService","ProfileService","OfferService","fileReader","FileUploader","DateToMongoDate",function($scope,$http,$rootScope,$routeParams,$location,$timeout,focus,CommerialService,ProfileService,OfferService,fileReader,FileUploader,DateToMongoDate){$scope.formSubmitted=!1,$scope.showSucessMesge=!1,$scope.startDate=$scope.i18n.coupon.start_date,$scope.endDate=$scope.i18n.coupon.end_date,$scope.sex=[{dbvalue:"Male",value:$scope.i18n.coupon.man},{dbvalue:"Female",value:$scope.i18n.coupon.women}],$scope.checkedSex=[],$scope.toggleCheck=function(dbvalue){-1===$scope.checkedSex.indexOf(dbvalue)?$scope.checkedSex.push(dbvalue):$scope.checkedSex.splice($scope.checkedSex.indexOf(dbvalue),1)};var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;angular.element("#searchTagFriend").keypress(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.tagFriendSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.showFrom=!1,$scope.tagFriendSuggestion=function(){$scope.cancelFriendSearch=!1,$scope.showFriendList=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.friendName,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&($scope.friends=data.data.users,0==$scope.friends.length)})},$scope.storedFriend=[],$scope.dublicate=!1,$scope.selectFriend=function(friendInfo){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.storedFriend,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.storedFriend.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1))},$scope.removeTagFriend=function(friendIndex){$scope.storedFriend.splice(friendIndex,1)},$scope.lostFormFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.friendTaggIndex=-1,$scope.keyUpDownControl=function(event){40===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex+1!==$scope.friends.length&&$scope.friendTaggIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex-1!==-1&&$scope.friendTaggIndex--):13===event.keyCode&&$scope.selectFriend($scope.friends[$scope.friendTaggIndex])},$("#categoryKeyword").keypress(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchKeyword()},DELAY_TIME_BEFORE_POSTING)}),$scope.keywords=[],$scope.searchKeyword=function(){var opts={};opts.keyword=$scope.tagkeywords,opts.session_id=APP.currentUser.id,$scope.cancelKeywordRequest=!1,$scope.showCatKeyLoading=!0,ProfileService.searchCatagoryKeyword(opts,function(data){$scope.showCatKeyLoading=!1,101===data.code&&"SUCCESS"===data.message&&$scope.cancelKeywordRequest===!1&&($scope.keywords=data.data.keyword)})},$scope.keywordIndex=-1,$scope.keywordKeyDown=function(event){if(40===event.keyCode)event.preventDefault(),$scope.keywordIndex+1!==$scope.keywords.length&&$scope.keywordIndex++;else if(38===event.keyCode)event.preventDefault(),$scope.keywordIndex-1!==-1&&$scope.keywordIndex--;else if(13===event.keyCode)if(void 0===$scope.keywords[$scope.keywordIndex]){if(""!==$scope.tagkeywords.trim()){var opts={};opts.user_id=APP.currentUser.id,opts.keyword=$scope.tagkeywords,ProfileService.addKeywords(opts,function(data){101===data.code&&"SUCCESS"===data.message&&($scope.keywords=data.data.keyword,$scope.storeKeyword($scope.keywords))})}}else $scope.storeKeyword($scope.keywords[$scope.keywordIndex])},$scope.cancelKeywordRequest=!1,$scope.clearKeyList=function(){$scope.cancelKeywordRequest=!0,$timeout(function(){$scope.keywords=[]},500)},$scope.tagkeywords="",$scope.keywordList=[],$scope.storeKeyword=function(index){if($scope.keywords=[],$scope.keywordIndex=-1,$scope.seen=!0,$scope.tagkeywords="","object"==typeof index){for(var i=0;i<$scope.keywordList.length;i++)$scope.keywordList[i].name==index.name&&($scope.seen=!1);1==$scope.seen&&$scope.keywordList.push(index)}else{if(""===index||void 0===index)return!1;-1===$scope.keywordList.indexOf(index)&&$scope.keywordList.push(index)}},$scope.removeKeyword=function(index){$scope.keywordList.indexOf(index);$scope.keywordList.splice(index,1)},$scope.campaign={},$scope.campaign.cardValue=20,$scope.dateDiff=!1,$scope.errorMesg=!1,$scope.showMesge=!1,$scope.showLoader=!1,$scope.todayDiff=!1;var today=new Date,stoday=today.toISOString();$scope.todayDate=stoday,$scope.compareDate=function(){$scope.dt.toISOString()>$scope.dtt.toISOString()?$scope.dateDiff=!0:$scope.dateDiff=!1,$scope.dtt.toISOString()<$scope.todayDate?$scope.todayDiff=!0:$scope.todayDiff=!1},$scope.compareDateStart=function(){$scope.dtt&&($scope.dt.toISOString()>$scope.dtt.toISOString()?$scope.dateDiff=!0:$scope.dateDiff=!1)},$scope.createCampaign=function(){var newSDate=$scope.dt,dd=newSDate.getDate(),mm=newSDate.getMonth()+1,yyyy=newSDate.getFullYear();10>dd&&(dd="0"+dd),10>mm&&(mm="0"+mm);var newSDate=yyyy+"-"+mm+"-"+dd,newEDate=$scope.dtt,dd=newEDate.getDate(),mm=newEDate.getMonth()+1,yyyy=newEDate.getFullYear();10>dd&&(dd="0"+dd),10>mm&&(mm="0"+mm);var newEDate=yyyy+"-"+mm+"-"+dd;$scope.fileNotValid=!1,$scope.showErrorCard=!1,$scope.formSubmitted=!0;$scope.dt,$scope.dtt;if(void 0==$scope.campaign.cardValue||""==$scope.campaign.cardValue)return focus("checkboxG1"),!1;if(void 0==$scope.campaign.discount||""==$scope.campaign.discount)return focus("radio1"),!1;if(void 0==$scope.campaign.quantity||""==$scope.campaign.quantity)return focus("radio4"),!1;if(void 0==$scope.dt||""==$scope.dt)return focus("dt"),!1;if(void 0==$scope.dtt||""==$scope.dtt)return focus("dtt"),!1;if($scope.dt.toISOString()>$scope.dtt.toISOString())return $scope.dateDiff=!0,focus("dtt"),$timeout(function(){$scope.dateDiff=!1},5e3),!1;if($scope.dtt.toISOString()<$scope.todayDate)return $scope.todayDiff=!0,focus("dtt"),$timeout(function(){$scope.todayDiff=!1},5e3),!1;if(!$scope.campaign.descriptionCard||""==$scope.campaign.descriptionCard)return focus("description"),!1;if(!$scope.imageToUpload||0==$scope.imageToUpload.length)return focus("uploadpic"),!1;$scope.showLoader=!0,$scope.hideButton=!0;var parameters=(APP.service.addUpdateApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id,new Object),main=[];$scope.offer_type="551ce49e2aa8f00f20d93295";var option=new Object;option.code="",option.description=$scope.campaign.descriptionCard,option.discount=parseInt($scope.campaign.discount),option.end_date=newEDate;var keywordtagged=[];if($scope.keywordList.length>0)for(var i=0;i<$scope.keywordList.length;i++)keywordtagged.push(" "+$scope.keywordList[i].name+" ");var keyword=keywordtagged.join();option.keywords=keyword,option.name="";var type=new Object;type._id=$scope.offer_type,option.offer_type=type;var shopdetail=new Object;shopdetail._id=$scope.storeId,shopdetail.name=$scope.storeName,option.shop_id=shopdetail,option.start_date=newSDate;var tagged=[],taggfriend={};if($scope.storedFriend.length>0)for(var i=0;i<$scope.storedFriend.length;i++)taggfriend._id=$scope.storedFriend[i].user_info.id.toString(),taggfriend.name=$scope.storedFriend[i].user_info.first_name+$scope.storedFriend[i].user_info.last_name,tagged.push(taggfriend);var friends=new Object;friends.$insert=tagged,option.tag_friends=friends,option.title="",option.to_avail=parseInt($scope.campaign.quantity),option.value=parseInt($scope.campaign.cardValue);var media_link=[];angular.forEach($scope.imageToUpload,function(file){media_link.push(file.media_link)});var imageurls=media_link.join();option.imageurl=imageurls,option.sex=$scope.checkedSex;var array=[];array.push(option),parameters.$insert=array,parameters.$collection="sixc_offers",main.push(parameters),OfferService.addUpdateApplaneData(main,function(data){"ok"===data.status&&200===data.code?($scope.showLoader=!1,$scope.showMesge=!0,$scope.hideButton=!1,$scope.campaign={},$scope.dt="",$scope.dtt="",$scope.storedFriend.length=0,$scope.keywordList.length=0,$scope.imageToUpload=[],uploader.queue=[],$scope.checkedSex.length=0,$scope.campaign.cardValue=20,$timeout(function(){$scope.showMesge=!1},15e3),$scope.formSubmitted=!1,$scope.getlistingData()):"error"===data.status&&1==data.message?($scope.showErrorCard=!0,$scope.showLoader=!1,$scope.ShowErrorResponse=data.response,$scope.campaign={},$scope.dt="",$scope.dtt="",$scope.storedFriend.length=0,$scope.keywordList.length=0,$scope.imageToUpload=[],uploader.queue=[],$scope.checkedSex.length=0,$scope.campaign.cardValue=20,$scope.hideButton=!1,$scope.formSubmitted=!1,$timeout(function(){$scope.showErrorCard=!1},3e4)):($scope.showLoader=!1,$scope.errorMesg=!0,$scope.hideButton=!1,$scope.formSubmitted=!1,$timeout(function(){$scope.errorMesg=!1},15e3))})},$scope.fileNotValid=!1,$scope.fileNotValidMsg="",$scope.tempAlbumId="",$scope.albumImgLoader=[],$scope.imagePrvSrc=[],$scope.imageToUpload=[];var uploader=$scope.uploader=new FileUploader({url:APP.service.uploadstoreofferimages+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{shop_id:$scope.routeId,session_id:APP.currentUser.id},dataObjName:"reqObj",formDataName:"shop_offer_media[]"});uploader.filters.push({name:"user_media[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0;var queueLen=uploader.queue.length;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.albumImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imageToUpload[index]=response.data,$scope.imagePrvSrc[index]=response.data,$scope.albumImgLoader[index]=!1)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.albums.upload_media_invalid,$timeout(function(){$scope.fileNotValidMsg=""},4e3)},$scope.removeError=!1,$scope.removeImage=function(index){var tempImg=$scope.imagePrvSrc[index];$scope.imagePrvSrc.splice(index,1);var item=$scope.uploader.queue[index];item.remove();var opts={};opts.session_id=APP.currentUser.id,opts.media_path=tempImg.media_link,OfferService.deleteShopOfferMedias(opts,function(data){101==data.code||($scope.removeError=!0,$scope.imagePrvSrc[index]=tempImg,$timeout(function(){$scope.removeErrMsg=$scope.i18n.Campaign_work.remove_errormsg},4e3))})},$scope.getlistingData=function(){var today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();10>dd&&(dd="0"+dd),10>mm&&(mm="0"+mm);var today=yyyy+"-"+mm+"-"+dd;$scope.offerlistingObject=[],$scope.showCardListMsg=!1,$scope.cardListingLoader=!0,$scope.offer_id="551ce49e2aa8f00f20d93295";var option=new Object;option.$collection="sixc_offers";var getlisting=new Object;getlisting.value=1,getlisting.start_date=1,getlisting.end_date=1,getlisting.discount=1,getlisting.to_avail=1,option.$fields=getlisting;var filters=new Object,start=new Object;start.$lte=today;var end=new Object;end.$gte="$$CurrentDate",filters.start_date=start,filters.end_date=end,filters.offer_type=$scope.offer_id,filters.shop_id=$scope.routeId,option.$filter=filters;var history=new Object;history["__history.__createdOn"]=-1,option.$sort=history,option.$limit=15,option.$skip=0,$scope.noResult=!1,OfferService.getApplaneData(option,function(data){"ok"===data.status&&200===data.code?($scope.cardListingLoader=!1,$scope.offerlistingObject=data.response.result,0==$scope.offerlistingObject.length&&($scope.showCardListMsg=!0)):$scope.cardListingLoader=!1})},$scope.getlistingData()}]),app.controller("WorkCampaignController",["$scope","$http","$rootScope","$routeParams","$location","$timeout","focus","CommerialService","ProfileService","OfferService","StoreService","$window",function($scope,$http,$rootScope,$routeParams,$location,$timeout,focus,CommerialService,ProfileService,OfferService,StoreService,$window){$scope.grid=!1,$scope.isOpenBottomForm=!1,$scope.isOpenTopForm=!1,$scope.showMessage=!1,$scope.is_paypal_added=0,$scope.is_paypal_added=StoreService.getStoreData().is_paypal_added,$scope.showGrid=function(){$scope.grid=!$scope.grid},$scope.openBottomForm=function(){$scope.paypalErrCls="",$scope.paypalErrMsg="",$scope.paypal={},$scope.isOpenTopForm=!1,$scope.isOpenBottomForm=!0,$scope.isOpenBottomFormMsg=!0,$scope.paypalForm.$setPristine()},$scope.openTopForm=function(){$scope.paypalErrCls="",$scope.paypalErrMsg="",$scope.isOpenBottomForm=!1,$scope.isOpenTopForm=!0,$scope.isOpenBottomFormMsg=!1,$scope.paypal={},$scope.paypalForm.$setPristine()},$scope.closeForm=function(){$scope.paypal={},$scope.paypalForm.$setPristine(),$scope.isOpenBottomForm=!1,$scope.isOpenTopForm=!1},$scope.getSubscription=function(){var formData={};formData.shop_id=$scope.routeId,formData.user_id=APP.currentUser.id,formData.return_url=APP.payment.siteDomain+"#/shop/promotions/"+$scope.routeId,formData.cancel_url=APP.payment.siteDomain+"#/shop/view/"+$scope.routeId,CommerialService.getSubscription(formData,function(data){101==data.code&&""!=data.data.url?$window.location.href=data.data.url:$scope.getPaymentUrl=""})},$scope.unsubscribe=function(){$scope.subLoader=!0;var formData={};formData.shop_id=$scope.routeId,formData.user_id=APP.currentUser.id,CommerialService.unSubscribes(formData,function(data){101==data.code?($scope.subLoader=!1,$scope.subButtonHide=!0,$scope.is_subscribed=0,$scope.subMsg=!0,$timeout(function(){$scope.subMsg=!1,$location.path("/shop/view/"+$scope.routeId)},4e3)):($scope.subLoader=!1,$scope.subButtonHide=!1,$scope.subMsgError=!0,$timeout(function(){$scope.subMsgError=!1},8e3))})}}]),app.controller("ShopReviewController",["$scope","$http","$location","$routeParams","$cookieStore","StoreService","StoreCommentService","ProfileService","$modal","$timeout",function($scope,$http,$location,$routeParams,$cookieStore,StoreService,StoreCommentService,ProfileService,$modal,$timeout){$scope.storeMainId=$routeParams.id,$scope.delCommentErrMsg=[],$scope.delCommentErrCls=[],$scope.editCommentText=[],$scope.activeCommentEdit=[],$scope.isEditComment=[],$scope.commentErrorMsg=[],$scope.commentErrorCls=[],$scope.commentInProcess=[],$scope.showComments=[],$scope.frndId="",$scope.textLimit=APP.post_charecter_limit,$scope.storeData="",$scope.getPosts=function(){var limit_start=$scope.posts.length,opts={};opts.store_id=$scope.storeMainId,opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=5,""!=$scope.frndId&&(opts.friends_ids=$scope.frndId),($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes&&($scope.myRes=0,$scope.isLoading=!0,StoreService.listcustomersreviews(opts,function(data){if($scope.isLoading=!1,101==data.code){$scope.isLoading=!1;var items=data.data;$scope.storeData=StoreService.getStoreData(),void 0!=items&&($scope.posts=$scope.posts.concat(items)),$scope.totalSize=data.count}0==$scope.posts.length&&($scope.noContent=!0),$scope.myRes=1}))},$scope.showShopPostList=function(){$scope.posts=[],$scope.totalSize=0,$scope.myRes=1,$scope.noContent=!1,$scope.getPosts()},$scope.showShopPostList(),$scope.loadMoreFunc="loadMore()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMore()")},!0),$scope.loadMore=function(){$scope.posts.length>0&&$scope.getPosts()},$scope.frindBoughtCount=function(){var opts={};opts={"function":"UtilityService.friendsShoppingCount",parameters:[{asArray:!0,shop_id:[$scope.storeMainId],citizen_id:String(APP.currentUser.id)}]},StoreService.frindboughtcount(opts,function(data){void 0===data.response||""===data.response?$scope.frcount=0:$scope.frcount=data.response[0].count})},$scope.frindBoughtCount(),$scope.friendsId=[],$scope.searchFriend=function(){$scope.friendsId=[];var formData={};formData.user_id=$scope.currentUser.id,formData.shop_id=$scope.storeMainId,StoreService.getfriendboughtonstores(formData,function(data){if(101==data.code&&($scope.friendlist=data.data.friends,void 0!==$scope.friendlist))for(var i=0;i<$scope.friendlist.length;i++)$scope.friendsId.push(String(data.data.friends[i].id))})},$scope.singleArray=[],$scope.frndVal=function(){$scope.singleArray=[],null!=$scope.friends&&"all"!=$scope.friends?($scope.singleArray.push(String($scope.friends)),$scope.frndId=$scope.singleArray):"all"==$scope.friends?$scope.frndId=$scope.friendsId:$scope.frndId="",$scope.showShopPostList()},$scope.searchFriend(),$scope.deleteComment=function(postIndx,indx){var indx=indx,commentData=$scope.posts[postIndx].comments[indx];$scope.deleteCommentIndx=commentData.id;var post=$scope.posts[postIndx],formData={};formData.user_id=$scope.currentUser.id,formData.comment_id=commentData.id,StoreCommentService.deleteComment(formData,function(data){if(101==data.code){$scope.delCommentErrMsg[commentData.id]="",$scope.delCommentErrCls[commentData.id]="",$scope.deleteCommentIndx=-1;var opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.posts[postIndx].comments.splice(indx,1)}else $scope.delCommentErrMsg[commentData.id]=$scope.i18n.dashboard.postcomment.delete_comment_fail,$scope.delCommentErrCls[commentData.id]="text-red",$scope.deleteCommentIndx=-1,$scope.posts;$timeout(function(){$scope.delCommentErrCls[commentData.id]="",$scope.delCommentErrMsg[commentData.id]=""},15e3)})},$scope.deleteMediaComment=function(comment,postIndx,mediaIndx){var commentData=comment,post=$scope.posts[postIndx];$scope.deleteCommentIndx=commentData.id;var formData={};formData.user_id=$scope.currentUser.id,formData.comment_id=commentData.id,formData.comment_media_id=commentData.comment_media_info[0].id,StoreCommentService.deleteMediaComment(formData,function(data){if(101==data.code){$scope.deleteCommentIndx=-1;var opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)}else $scope.deleteCommentIndx=-1,$scope.posts})},$scope.updateComment=function(postIndx,indx){$("#commentBoxId-"+postIndx).hide(),$scope.commentInProcess[postIndx]=!0,$scope.commentErrorMsg[postIndx]="",$scope.commentErrorCls[postIndx]="";var comment=$scope.posts[postIndx].comments[indx],indx=indx;$scope.activeCommentEdit[postIndx]=comment.id,$scope.isEditComment[postIndx]=!1,$scope.editCommentText[postIndx]=comment.comment_text},$scope.editComment=function(postIndx,indx){var opts={},post=$scope.posts[postIndx],comment=$scope.posts[postIndx].comments[indx],newText=$scope.editCommentText[postIndx],indx=indx;return $scope.isEditComment[postIndx]=!0,$scope.commentErrorMsg[postIndx]="",void 0==newText||""==newText?($scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_comment,$timeout(function(){
$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3),!1):(opts.user_id=$scope.currentUser.id,opts.post_id=post.post_id,opts.comment_id=comment.id,opts.comment_author=comment.comment_user_info.id,opts.youtube_url=comment.youtube_url,opts.comment_text=newText,void StoreCommentService.updateComment(opts,function(data){101==data.code?($scope.posts[postIndx].comments[indx].comment_text=newText,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.commentInProcess[postIndx]=!1,$scope.editCommentText[postIndx]="",$("#commentBoxId-"+postIndx).show(),$scope.isEditComment[postIndx]=!1):($scope.commentInProcess[postIndx]=!1,$scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.not_posted,$("#commentBoxId-"+postIndx).show()),$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3)}))},$scope.cancelEditComment=function(postIndx,indx){$scope.commentInProcess=[],$scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]=[],$scope.activeCommentEdit[postIndx][indx]=-1,$scope.editCommentText[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$("#commentBoxId-"+postIndx).show()},$scope.allCommentLoad=[],$scope.showAllComments=function(postIndx){$scope.allCommentLoad[postIndx]=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx),$scope.showComments[postIndx]=!0},$scope.comments=[],$scope.getComments=function(opts,postIndx){$scope.comments[postIndx]=[],StoreCommentService.listComment(opts,function(data){100==data.code?($scope.posts[postIndx].comments=data.data.comment,$scope.allCommentLoad[postIndx]=!1,0!=$scope.comments[postIndx].length&&($scope.noComment=!0)):$scope.allCommentLoad[postIndx]=!0})},$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,$scope.creater=creater_info;var modalInstance=$modal.open({template:'<div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a href ng-click="viewFriendProile(friend.id)">{{friend.first_name}} {{friend.last_name}}</a></span></li></ul></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}}]),app.controller("FollowersController",["$cookieStore","$rootScope","$scope","$http","$location","$timeout","$routeParams","ProfileService",function($cookieStore,$rootScope,$scope,$http,$location,$timeout,$routeParams,ProfileService){$scope.resultNotFound=!1,$scope.followerObject=[],$scope.followerAllList=[],$scope.allRes=1,$scope.totalSize=0,$scope.getFollowersList=function(){var opts={},limit_start=$scope.followerAllList.length;opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.friend_list_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.followersLoader=!0,$scope.allRes=0,ProfileService.getFollowers(opts,function(data){$scope.allRes=1,"101"==data.code?($scope.totalSize=data.data.size,$scope.followersLoader=!1,$scope.followerObject=$scope.followerAllList=$scope.followerAllList.concat(data.data.followers)):($scope.followersLoader=!1,$scope.resultNotFound=!0)}))},$scope.getFollowersList(),$scope.loadMore=function(){$scope.getFollowersList()}}]),app.controller("FollowingsController",["$cookieStore","$rootScope","$scope","$http","$location","$timeout","$routeParams","ProfileService",function($cookieStore,$rootScope,$scope,$http,$location,$timeout,$routeParams,ProfileService){$scope.resultNotFound=!1,$scope.followingsObject=[],$scope.followerAllList=[],$scope.allRes=1,$scope.totalSize=0,$scope.getFollowingsList=function(){var opts={},limit_start=$scope.followerAllList.length;opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.friend_list_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.followersLoader=!0,$scope.allRes=0,ProfileService.getFollowings(opts,function(data){$scope.allRes=1,"101"==data.code?($scope.totalSize=data.data.size,$scope.followersLoader=!1,$scope.followingsObject=$scope.followerAllList=$scope.followerAllList.concat(data.data.followers)):($scope.followersLoader=!1,$scope.resultNotFound=!0)}))},$scope.getFollowingsList(),$scope.loadMore=function(){$scope.getFollowingsList()}}]),app.controller("ShopFollowersController",["$scope","$http","$routeParams","$location","$timeout","StoreService",function($scope,$http,$routeParams,$location,$timeout,StoreService){$scope.storeAllList=[],$scope.storeFollowersDetail=[],$scope.totalSize=0,$scope.notFound=!1,$scope.allRes=1,$scope.nofollow=!1,$scope.storeMainId=$routeParams.id,$scope.storeLoading=!0,$scope.shopFollowers=function(){var opts={},limit_start=$scope.storeAllList.length;opts.limit_start=limit_start,opts.limit_size=APP.store_list_pagination.end,opts.user_id=APP.currentUser.id,opts.shop_id=$scope.storeMainId,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.storeLoading=!0,$scope.allRes=0,StoreService.userfollowingshops(opts,function(data){101==data.code?($scope.allRes=1,$scope.totalSize=data.data.total,$scope.storeLoading=!1,$scope.storeFollowersDetail=$scope.storeAllList=$scope.storeAllList.concat(data.data.user_info),$scope.notFound=!1,$scope.nofollow=!0):($scope.storeFollowersDetail=[],$scope.storeLoading=!1,$scope.notFound=!0)}))},$scope.shopFollowers(),$scope.loadMore=function(){$scope.shopFollowers()}}]),app.controller("FriendController",["$cookieStore","$rootScope","$scope","$http","$location","$timeout","$routeParams","MessageService","ProfileService","fileReader",function($cookieStore,$rootScope,$scope,$http,$location,$timeout,$routeParams,MessageService,ProfileService,fileReader){$scope.frieandListObject=[],$scope.friendAllList=[],$scope.totalSize=0,$scope.allRes=1,$scope.albloader=!1,$scope.friendListLoader=!1,$scope.resultNotFound=!1,$scope.getAllFriend=function(){var opts={},limit_start=$scope.friendAllList.length;opts.friend_name=void 0===$scope.friendName?"":$scope.friendName,opts.user_id=APP.currentUser.id,opts.session_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.friend_list_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.friendListLoader=!0,$scope.allRes=0,MessageService.searchFriends(opts,function(data){$scope.allRes=1,"101"==data.code?($scope.totalSize=data.data.count,$scope.friendListLoader=!1,$scope.frieandListObject=$scope.friendAllList=$scope.friendAllList.concat(data.data.users)):($scope.friendListLoader=!1,$scope.resultNotFound=!0)}))},$scope.getAllFriend(),$scope.allList=function(){$scope.frieandListObject=[],$scope.friendAllList=[],$scope.friendName="",$scope.getAllFriend()},$scope.loadMore=function(){$scope.getAllFriend()};var key_count_global=0;$scope.searchFriend=function(e){8==e.keyCode?$timeout(function(){$scope.lookup(key_count_global)},500,!1):($scope.frieandListObject=[],$scope.friendAllList=[],$scope.getAllFriend())},$scope.lookup=function(keycount){key_count_global==keycount&&($scope.frieandListObject=[],$scope.friendAllList=[],$scope.getAllFriend())}}]),app.controller("FriendCoverProfileController",["$cookieStore","$rootScope","$scope","$route","$http","$location","$timeout","$interval","$routeParams","fileReader","ProfileService","saveFriendDate","UserService",function($cookieStore,$rootScope,$scope,$route,$http,$location,$timeout,$interval,$routeParams,fileReader,ProfileService,saveFriendDate,UserService){$scope.RespontToRequest_personal=function(){$("#RespontToRequest_personal").click(function(e){e.stopPropagation(),$(".request-links-professional").hide(),$(".request-links-personal").slideToggle("slow")})},$scope.RespontToRequest_professional=function(){$("#RespontToRequest_professional").click(function(e){e.stopPropagation(),$(".request-links-personal").hide(),$(".request-links-professional").slideToggle("slow")})},$(document).click(function(){$(".request-links-personal").hide(),$(".request-links-professional").hide()}),$rootScope.friendlineActive="about";var str=$location.path().replace("/","");"viewfriend"!=str.split("/",1)[0]?$scope.friendDetailId=str.split("/",1)[0]:$scope.friendDetailId=str.split("/",2)[1];var activeUrl=str.substring(str.lastIndexOf("/")+1);switch(-1!=str.indexOf("friend/images")&&(activeUrl="pictures"),activeUrl){case"friends":$rootScope.friendlineActive="friends";break;case"album":$rootScope.friendlineActive="album";break;case"clubs":$rootScope.friendlineActive="club";break;case"shope":$rootScope.friendlineActive="shope";break;case"about":$rootScope.friendlineActive="about";break;case"pictures":$rootScope.friendlineActive="pictures";break;default:$rootScope.friendlineActive="timeline"}$scope.friendViewLoader=!0,$scope.sendFriendRequestLoader=!1,$scope.showRequestButton=!1,$scope.addFriend_personal=!1,$scope.requestSent_personal=!1,$scope.IsFriend_personal=!1,$scope.respond_personal=!1,$scope.addFriend_professional=!1,$scope.requestSent_professional=!1,$scope.IsFriend_professional=!1,$scope.respond_professional=!1,$scope.sendPersonalRequestLoader=!1,$scope.sendProfessionalRequestLoader=!1,$scope.RejectRequest=function(request_type){1===request_type?$scope.sendPersonalRequestLoader=!0:2===request_type&&($scope.sendProfessionalRequestLoader=!0);var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=$scope.friendDetailId,opts.action="0",opts.request_type=request_type,ProfileService.rejectFriendRequest(opts,function(data){101==data.code&&(2===request_type?($scope.addFriend_professional=!0,$scope.respond_professional=!1,$scope.sendProfessionalRequestLoader=!1):1===request_type&&($scope.addFriend_personal=!0,$scope.respond_personal=!1,$scope.sendPersonalRequestLoader=!1),$rootScope.getAllFriendNotification())})},$scope.AcceptRequest=function(request_type){1===request_type?$scope.sendPersonalRequestLoader=!0:2===request_type&&($scope.sendProfessionalRequestLoader=!0);var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=$scope.friendDetailId,opts.action="1",opts.request_type=request_type,ProfileService.acceptFriendRequest(opts,function(data){101==data.code&&(2===request_type?($scope.IsFriend_professional=!0,$scope.respond_professional=!1,$scope.sendProfessionalRequestLoader=!1):1===request_type&&($scope.IsFriend_personal=!0,$scope.respond_personal=!1,$scope.sendPersonalRequestLoader=!1),$rootScope.getAllFriendNotification())})},$scope.addFriend=function(type){var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=$scope.friendDetailId,opts.msg="Friend Request",1===type?(opts.request_type=1,$scope.sendPersonalRequestLoader=!0):2===type&&(opts.request_type=2,$scope.sendProfessionalRequestLoader=!0),ProfileService.sendFriendRequests(opts,function(data){101==data.code||100==data.code&&"FRIEND_REQUEST_HAS_ALREADY_RECEIVED"===data.message?($scope.friendProfile.is_friend=2,$scope.sendFriendRequestLoader=!1,2===type?($scope.friendProfile.user_info.professional_pending=1,$scope.addFriend_professional=!1,$scope.requestSent_professional=!0,$scope.sendProfessionalRequestLoader=!1):1===type&&($scope.friendProfile.user_info.personal_pending=1,$scope.addFriend_personal=!1,$scope.requestSent_personal=!0,$scope.sendPersonalRequestLoader=!1)):109==data.code&&($scope.friendProfile.is_friend=2,$scope.sendFriendRequestLoader=!1,$scope.friendProfile.is_sent=1,$scope.sendProfessionalRequestLoader=!1,$scope.sendPersonalRequestLoader=!1)})},$scope.removeFriend=function(friendDetail,type){$scope.sendFriendRequestLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=friendDetail.user_id,opts.action="0",opts.request_type=type,1===type?$scope.sendPersonalRequestLoader=!0:2===type&&($scope.sendProfessionalRequestLoader=!0),ProfileService.rejectFriendRequest(opts,function(data){101==data.code||113==data.code&&"FRIEND_REQUEST_HAS_ALREADY_REMOVED"===data.message?($scope.sendFriendRequestLoader=!1,2===type?($scope.friendProfile.user_info.friend_type=$scope.friendProfile.user_info.friend_type-2,$scope.sendProfessionalRequestLoader=!1,$scope.addFriend_professional=!0,$scope.IsFriend_professional=!1):1===type&&($scope.friendProfile.user_info.friend_type=$scope.friendProfile.user_info.friend_type-1,$scope.sendPersonalRequestLoader=!1,$scope.addFriend_personal=!0,$scope.IsFriend_personal=!1),0===$scope.friendProfile.user_info.friend_type&&($scope.friendProfile.is_friend=0)):($scope.friendProfile.is_friend=0,$scope.sendFriendRequestLoader=!1)})},$scope.friendRequestStatus=function(){var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=$scope.friendDetailId,ProfileService.friendRequestStatus(opts,function(data){101==data.code&&(0==data.data.personal.is_friend&&0==data.data.personal.is_sent&&0==data.data.personal.is_respond&&($scope.addFriend_personal=!0),0==data.data.professional.is_friend&&0==data.data.professional.is_sent&&0==data.data.professional.is_respond&&($scope.addFriend_professional=!0),1==data.data.personal.is_sent&&($scope.requestSent_personal=!0),1==data.data.professional.is_sent&&($scope.requestSent_professional=!0),1==data.data.personal.is_friend&&($scope.IsFriend_personal=!0),1==data.data.professional.is_friend&&($scope.IsFriend_professional=!0),1==data.data.personal.is_respond&&($scope.respond_personal=!0),1==data.data.professional.is_respond&&($scope.respond_professional=!0))})},$scope.friendRequestStatus(),$scope.skillobj=[],$scope.viewFriendProfile=function(){$scope.searchFrind="",$("#search").val("");var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=$scope.friendDetailId,ProfileService.friendProfileView(opts,function(data){if($scope.showRequestButton=!0,101==data.code){$scope.getTotalIncome(),data.data.user_id==APP.currentUser.id&&$location.path("timeline/"+data.data.user_id),$scope.friendProfile=data.data,1==$rootScope.mobileView&&$scope.changeCordinatevalue();for(var i=0;11>=i;i++)null!=data.data.user_info.date_of_birth?data.data.user_info.date_of_birth.date.substring(5,7)==i&&($scope.birthmonth=$scope.months[i-1].name):($scope.birthmonth="",$scope.comma="");if(null!==data.data.user_info.skills&&data.data.user_info.skills.length>0&&($scope.tempskills=data.data.user_info.skills.split(",")),null!==data.data.user_info.skills&&data.data.user_info.skills.length>0)for(var i=0;i<$scope.tempskills.length;i++)$scope.tempobj={name:$scope.tempskills[i]},$scope.skillobj.push($scope.tempobj);if($scope.personaledu=!1,$scope.professionedu=!1,$scope.personaljob=!1,$scope.professionjob=!1,null!=$scope.friendProfile.user_info.educationDetail&&""!=$scope.friendProfile.user_info.educationDetail&&void 0!=$scope.friendProfile.user_info.educationDetail)for(var i=0;i<$scope.friendProfile.user_info.educationDetail.length;i++)(1==$scope.friendProfile.user_info.educationDetail[i].visibility_type||3==$scope.friendProfile.user_info.educationDetail[i].visibility_type)&&($scope.personaledu=!0),(2==$scope.friendProfile.user_info.educationDetail[i].visibility_type||3==$scope.friendProfile.user_info.educationDetail[i].visibility_type)&&($scope.professionedu=!0);if(null!=$scope.friendProfile.user_info.jobDetails&&""!=$scope.friendProfile.user_info.jobDetails&&void 0!=$scope.friendProfile.user_info.jobDetails)for(var i=0;i<$scope.friendProfile.user_info.jobDetails.length;i++)(1==$scope.friendProfile.user_info.jobDetails[i].visibility_type||3==$scope.friendProfile.user_info.jobDetails[i].visibility_type)&&($scope.personaljob=!0),(2==$scope.friendProfile.user_info.jobDetails[i].visibility_type||3==$scope.friendProfile.user_info.jobDetails[i].visibility_type)&&($scope.professionjob=!0);var opts1={};opts1.sender_id=APP.currentUser.id,opts1.to_id=$scope.friendProfile.user_id,opts1.session_id=APP.currentUser.id,ProfileService.checkfollowUser(opts1,function(data1){(151==data1.code||1==data1.is_follow)&&($scope.followUser=!1),(152==data1.code||0==data1.is_follow)&&($scope.followUser=!0)});var copts={};copts.user_id=$scope.friendDetailId,copts.session_id=APP.currentUser.id,ProfileService.getConnectedProfil(copts,function(data){(data.code=101)&&($scope.friendProfile.connectedProfile=data.data),$scope.friendViewLoader=!1})}else $scope.friendViewLoader=!1})},$scope.showButton=!1,$scope.pause=!1,$("body").click(function(){1==$scope.showButton&&0==$scope.pause&&1==$rootScope.mobileView&&($scope.showButton=!1)}),$scope.toogleImage=function(){$scope.showButton===!1?($scope.showButton=!0,$scope.pause=!0,setTimeout(function(){$scope.pause=!1},100)):$scope.showButton=!1},$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="600"?(1==$rootScope.mobileView&&$timeout(function(){$scope.changeCordinatevalue()},1e3),$rootScope.mobileView=!0):$rootScope.mobileView=!1,$scope.windowWidth<=768?$scope.showButton=!1:$scope.showButton=!0},!0);var img=new Image;$scope.changeCordinatevalue=function(){void 0!=$scope.friendProfile&&(img=null,img=new Image,img.src=$scope.friendProfile.user_info.cover_image_thumb,img.onload=function(){$scope.windowWidth<="400"?img.width<=910?""!=$scope.friendProfile.user_info.y_cord?($scope.friendProfile.user_info.y_cord>100?$rootScope.friendMobileY_Cord=$scope.friendProfile.user_info.y_cord/3:$rootScope.friendMobileY_Cord=$scope.friendProfile.user_info.y_cord/4,$rootScope.friendMobileX_Cord=0):($scope.friendProfile.user_info.x_cord=0,$scope.friendProfile.user_info.y_cord=0,$rootScope.friendMobileX_Cord=0,$rootScope.friendMobileY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.friendProfile.user_info.cover_image_thumb.x_cord?($scope.friendProfile.x_cord>100?$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/4:$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/5,$rootScope.friendMobileY_Cord=0):($scope.friendProfile.user_info.x_cord=0,$scope.friendProfile.user_info.y_cord=0,$rootScope.friendMobileX_Cord=0,$rootScope.friendMobileY_Cord=0):img.width>1300&&(""!=$scope.friendProfile.user_info.cover_image_thumb.x_cord?($scope.friendProfile.x_cord>100?$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/5:$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/6,$rootScope.friendMobileY_Cord=0):($scope.friendProfile.user_info.x_cord=0,$scope.friendProfile.user_info.y_cord=0,$rootScope.friendMobileX_Cord=0,$rootScope.friendMobileY_Cord=0)):$scope.windowWidth>"400"&&$scope.windowWidth<="600"&&(img.width<=910?""!=$scope.friendProfile.user_info.y_cord?($scope.friendProfile.user_info.y_cord>100?$rootScope.friendMobileY_Cord=$scope.friendProfile.user_info.y_cord/1.8:$rootScope.friendMobileY_Cord=$scope.friendProfile.user_info.y_cord/2,$rootScope.friendMobileX_Cord=0):($scope.friendProfile.user_info.x_cord=0,$scope.friendProfile.user_info.y_cord=0,$rootScope.friendMobileX_Cord=0,$rootScope.friendMobileY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.friendProfile.user_info.x_cord?($scope.friendProfile.user_info.x_cord>100?$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/2:$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/2.2,$rootScope.friendMobileY_Cord=0):($scope.friendProfile.user_info.x_cord=0,$scope.friendProfile.user_info.y_cord=0,$rootScope.friendMobileX_Cord=0,$rootScope.friendMobileY_Cord=0):img.width>1300&&(""!=$scope.friendProfile.user_info.x_cord?($scope.friendProfile.user_info.x_cord>100?$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/2.8:$rootScope.friendMobileX_Cord=$scope.friendProfile.user_info.x_cord/3,$rootScope.friendMobileY_Cord=0):($scope.friendProfile.user_info.x_cord=0,$scope.friendProfile.user_info.y_cord=0,$rootScope.friendMobileX_Cord=0,$rootScope.friendMobileY_Cord=0)))})},$scope.getTotalIncome=function(){var opts4={};opts4.idcard=$scope.friendDetailId,UserService.getCreditAndIncome(opts4,function(data){var currentCredit={};101==data.code?(currentCredit.totalCredit=data.data.saldoc/1e6,currentCredit.totCreditMicro=data.data.saldorm+data.data.saldorc,currentCredit.totalIncome=data.data.tot_income,currentCredit.totalIncomeShow=data.data.tot_income,$scope.creditAndIncome=currentCredit):$scope.creditAndIncome=data.data})},$scope.followRequestLoader=!1,$scope.followFriend=function(friendId){$scope.followRequestLoader=!0;var opts={};opts.sender_id=APP.currentUser.id,opts.to_id=friendId,ProfileService.followUser(opts,function(data){101==data.code&&($scope.friendProfile.is_follow=1,$scope.followUser=!1,$scope.followRequestLoader=!1)})},$scope.unFollowFriend=function(friendId){$scope.followRequestLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=friendId,ProfileService.unFollowUser(opts,function(data){101==data.code&&($scope.friendProfile.is_follow=0,$scope.followUser=!0,$scope.followRequestLoader=!1)})},$scope.viewFriendProfile(),$scope.storeFriendDate=function(detail){saveFriendDate.saveFriendObject(detail),$location.path("/message/"+detail.user_info.id)}}]),app.controller("FriendFriendController",["$cookieStore","$rootScope","$scope","$route","$http","$location","$timeout","$interval","$routeParams","MessageService",function($cookieStore,$rootScope,$scope,$route,$http,$location,$timeout,$interval,$routeParams,MessageService){$scope.frieandListObject=[],$scope.friendAllList=[],$scope.totalSize=0,$scope.allRes=1,$scope.friendListLoader=!1,$scope.resultNotFound=!1,$scope.getAllFriend=function(){var opts={},limit_start=$scope.friendAllList.length;opts.friend_name=void 0===$scope.friendName?"":$scope.friendName,opts.user_id=$routeParams.id,opts.session_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.friend_list_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.friendListLoader=!0,$scope.allRes=0,MessageService.searchFriends(opts,function(data){$scope.allRes=1,"101"==data.code?($scope.totalSize=data.data.count,$scope.friendListLoader=!1,$scope.frieandListObject=$scope.friendAllList=$scope.friendAllList.concat(data.data.users)):($scope.friendListLoader=!1,$scope.resultNotFound=!0)}))},$scope.getAllFriend(),$scope.allList=function(){$scope.frieandListObject=[],$scope.friendAllList=[],$scope.friendName="",$scope.getAllFriend()},$scope.loadMore=function(){$scope.getAllFriend()};var key_count_global=0;$scope.searchFriend=function(e){8==e.keyCode?$timeout(function(){$scope.lookup(key_count_global)},500,!1):($scope.frieandListObject=[],$scope.friendAllList=[],$scope.getAllFriend())},$scope.lookup=function(keycount){key_count_global==keycount&&($scope.frieandListObject=[],$scope.friendAllList=[],$scope.getAllFriend())}}]),app.controller("FriendClubController",["$scope","$http","GroupService","$routeParams",function($scope,$http,GroupService,$routeParams){$scope.createGroupData={},$scope.clubMyList=[],$scope.userGroupList=[],$scope.myFrndRes=1,$scope.totalSize=0,$scope.myTotalSize=0,$scope.noContent=!1,$scope.groupPublicActive="current",$scope.groupMyClubActive="",$scope.isLoading=!0,$scope.limitCheck=65,$scope.firstPage=APP.group_pagination.end,$scope.itemsPerPage=APP.group_pagination.end,$scope.currentPage=1,$scope.range=[],$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.loadMore()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMore()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.loadMore()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.getFriendGroup($scope.tab,$scope.itemsPerPage)},$scope.clubcheck=0,$scope.getFriendGroup=function(tab,itemsPerPage){$scope.tab=tab,$scope.clubMyList=[],$scope.groupMyClubActive="current",$scope.groupPublicActive="";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,opts.friend_id=$routeParams.id,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,($scope.myTotalSize>limit_start||0==$scope.myTotalSize)&&1==$scope.myFrndRes&&($scope.isLoading=!0,$scope.myFrndRes=0,GroupService.getUserFriendGroups(opts,function(data){if(101==data.code){$scope.totalItems=data.data.size,$scope.myTotalSize=data.data.size,$scope.myFrndRes=1,$scope.userGroupList=$scope.clubMyList=data.data.groups,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.isLoading=!1,0==$scope.userGroupList.length&&($scope.noContent=!0)}else $scope.totalItems=0,$scope.myFrndRes=1,$scope.isLoading=!1}))},$scope.loadMore=function(){"myclub"==$scope.tab?($scope.clubMyList=[],$scope.getFriendGroup($scope.tab,$scope.itemsPerPage)):($scope.clubMyList=[],$scope.getFriendGroup($scope.tab,$scope.itemsPerPage))},$scope.getFriendGroup("myclub",$scope.itemsPerPage),$scope.listActive="active",$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.joinPublicGroups=function(groupId){$("#groupjoing"+groupId).hide(),$("#joinloader"+groupId).show(),$scope.requestMessage="";var opts={};opts.user_id=APP.currentUser.id,opts.group_id=groupId,GroupService.joinPublicGroup(opts,function(data){101==data.code?($("#requestsent"+groupId).show(),$("#joinloader"+groupId).hide()):118==data.code?($("#requestpending"+groupId).show(),$("#joinloader"+groupId).hide()):($("#groupjoing"+groupId).show(),$("#joinloader"+groupId).hide())})}}]),app.controller("FriendShopController",["$scope","$http","GroupService","$routeParams",function($scope,$http,GroupService,$routeParams){console.log("friend shope controller")}]),app.controller("FriendAlbumController",["$scope","$http","$modal","AlbumService","$routeParams","$location",function($scope,$http,$modal,AlbumService,$routeParams,$location){$scope.listAlbum=[],$scope.totalSize=0,$scope.allRes=1,$scope.listload=!1,$scope.tagged_photo=[],$scope.albumListing=function(type){$scope.noAlbums=!1,"listing"===type?$scope.albloader=!1:$scope.albloader=!0;var limit_start=$scope.listAlbum.length;$scope.user_id=$routeParams.id;var opts={};opts.user_id=$scope.currentUser.id,opts.friend_id=$scope.user_id,opts.limit_start=limit_start,opts.limit_size=12,opts.friend_id=$routeParams.id,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.listload=!0,$scope.allRes=0,AlbumService.albumListing(opts,function(data){if(101==data.code){if($scope.noAlbums=!0,$scope.albloader=!1,$scope.allRes=1,$scope.listAlbum=$scope.listAlbum.concat(data.data.albums),$scope.tagged_photo_available=data.data.tagged_photo,$scope.tagged_photo_available&&"Photo Of You"===$scope.tagged_photo_available.album_name){var opts={};opts.user_id=$routeParams.id,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=12,AlbumService.getTaggedPhoto(opts,function(data){$scope.tagged_photo=data.data})}$scope.totalSize=data.data.size,$scope.listload=!1}else $scope.albloader=!1,$scope.listload=!1}))},$scope.imageModal=function(index,photos){$scope.index=index,$scope.photos=photos,$scope.pre_visible=!0,$scope.loader=!1,$scope.next_visible=!0,0===index&&($scope.pre_visible=!1),photos.length-1===index&&($scope.next_visible=!1);var modalInstance=$modal.open({template:'<style>.modal-content img.tag-imgae{max-height: 100%;max-height: 100%;position: absolute;right: 0;left: 0;top: 0;bottom: 0;margin: auto}.modal.in .modal-dialog{max-width: 80%;margin: auto;height: 90%;left: 0;right: 0;top: 0;bottom: 0;position: absolute}.modal .modal-content{border: none;height: 100%}.modal-img-inner{background: #000;height: 100%}.modal-img-tag-desc .modal-tag-frnds-input input[type="text"]{width: auto;background: none;border: 1px solid #666;color: #aaa;padding: 5px 10px;box-shadow: rgb(204, 204, 204) 0px 0px 1px 0px !important;-moz-box-shadow: rgb(204, 204, 204) 0px 0px 1px 0px !important;-webkit-box-shadow: rgb(204, 204, 204) 0px 0px 1px 0px !important;}.modal-img-tag-desc{padding: 10px; z-index: 8042;}.modal.in .modal-dialog .fancybox-wrap{position: relative}.modal-img-tag-desc{background-color: rgba(0, 0, 0, .8);width: 100%;position:absolute;bottom: 0}.modal-img-tag-desc > span{display: inline-block;vertical-align: middle}.modal-img-tag-desc span.tag-list-block .tag-friends{display: inline-block;vertical-align: middle;margin: 0 0px 0 5px;background: rgba(255, 255, 255, .2);color: #fff;padding: 4px 6px;font-size: 12px;font-weight: 400;border-radius: 3px}.modal-img-tag-desc span.tag-list-block .tag-friends b{margin-left: 5px}.modal-content .modal-img-tag{font-weight: bold;position: absolute;top: 10px;right: 10px;background: #fff;padding: 4px 8px;-webkit-border-radius: 2px;-moz-border-radius: 2px;-ms-border-radius: 2px;-o-border-radius: 2px;border-radius: 2px;box-shadow:0px 0px 2px 1px #ddd;-moz-box-shadow:0px 0px 2px 1px #ddd;-webkit-box-shadow:0px 0px 2px 1px #ddd;z-index: 8042;}.modal-content .modal-img-tag img{width: 15px;height: auto; margin: 0 0 0 5px;}</style><div class="modal-img-inner"><img src="'+photos[index].media_path+'" class="tag-imgae"><div class="slide-contros"><a data-ng-show="pre_visible" data-ng-click="pre_image(index,photos)" class="pre slide-btn" href><span></span><a/><a data-ng-click="next_image(index,photos)" data-ng-show = "next_visible" class="next slide-btn" href><span></span><a/></div><span class="sideloader" data-ng-show="loader"><img title="" alt="" src="app/assets/images/ajax-loader.gif"></span><div data-ng-hide="loader" data-ng-if="photos[index].creater_id==='+APP.currentUser.id+'" class="modal-img-tag" ng-click="untagg()">Untag <img titile="" alt="Tag Friends" src="app/assets/images/tag-icon-remove.png" ></div></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){}),$scope.untagg=function(){$scope.loader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=$routeParams.id,opts.media_id=$scope.photos[$scope.index].id,console.log("friend.js---",opts),AlbumService.removeTaggedPhoto(opts,function(data){if(console.log(data),101===data.code){modalInstance.close();var tempIndex=$scope.tagged_photo.indexOf($scope.photos[$scope.index]);$scope.tagged_photo.splice(tempIndex,1)}else $scope.loader=!1})},$scope.pre_image=function(index,photos){modalInstance.close(),$scope.imageModal(index-1,photos)},$scope.next_image=function(index,photos,leng){modalInstance.close(),$scope.imageModal(index+1,photos)}},$scope.albumListing("listing"),$scope.loadMore=function(){$scope.albumListing("listing")},$scope.redirectUrl=function(album_id,album_name,id){""==album_name?(album_name="Untitled",$location.path(id+"/friend/images/"+album_id+"/"+album_name)):$location.path(id+"/friend/images/"+album_id+"/"+album_name)}}]),app.controller("FriendViewController",["$scope","$http","AlbumService","$routeParams","$location",function($scope,$http,AlbumService,$routeParams,$location){$scope.totalSizeImg=0,$scope.allResImg=1,$scope.noPhotos=!1,$scope.imageCount=0,$scope.viewalbum=[],$scope.friendId=$routeParams.id,$scope.viewAlbum=function(type){
"listing"===type?$scope.albloader=!1:$scope.albloader=!0;var limit_start=$scope.viewalbum.length,albumId=$routeParams.album_id;$scope.albumId=$routeParams.album_id,$scope.user_id=$routeParams.id,$scope.albumname=$routeParams.album_name;var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=$routeParams.id,opts.album_id=albumId,opts.limit_start=limit_start,opts.limit_size=12,($scope.totalSizeImg>limit_start||0==$scope.totalSizeImg)&&1==$scope.allResImg&&($scope.listload=!0,$scope.allResImg=0,AlbumService.viewAlbum(opts,function(data){101==data.code?($scope.imageCount=data.data.size,$scope.albloader=!1,$scope.noPhotos=!0,$scope.allResImg=1,$scope.totalSizeImg=data.data.size,$scope.viewalbum=$scope.viewalbum.concat(data.data.media),$scope.albumDetails=data.data.album,$scope.listload=!1):($scope.albloader=!1,$scope.noPhotos=!0,$scope.listload=!1)}))},$scope.loadMoreImage=function(){$scope.viewalbum.length<$scope.imageCount&&$scope.viewAlbum("listing")},$scope.viewAlbum("listing")}]),app.controller("FriendRequestView",["$cookieStore","$scope","$rootScope","$http","$timeout","ProfileService",function($cookieStore,$scope,$rootScope,$http,$timeout,ProfileService){$scope.friendRequestLoading=!1,$scope.frientreqResponse=1,$scope.FriendRequests=[],$scope.endLimit=12,$scope.allTotal=0,$scope.getFriendReqNotification=function(){var limit_start=$scope.FriendRequests.length;opts={},opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=$scope.endLimit,($scope.allTotal>limit_start||0==$scope.allTotal)&&1==$scope.frientreqResponse&&($scope.friendRequestLoading=!0,$scope.frientreqResponse=0,ProfileService.getPendingFreindReq(opts,function(data){$scope.frientreqResponse=1,101==data.code?($scope.FriendRequests=$scope.FriendRequests.concat(data.data.requests),$scope.allTotal=data.data.size,$scope.friendRequestLoading=!1):$scope.friendRequestLoading=!1}))},$scope.getFriendReqNotification(),$scope.loadMore=function(){$scope.getFriendReqNotification()},$scope.AcceptRequest=function(friendInfo,id){$("#notification-request-friend-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.friend_id=friendInfo.friend_id,opts.action=1,1==friendInfo.personal?opts.request_type=1:1==friendInfo.professional&&(opts.request_type=2),ProfileService.acceptFriendRequest(opts,function(data){101==data.code?($("#notification-request-friend-"+id).hide(),$rootScope.getAllFriendNotification(),$scope.getFriendReqNotification()):($("#notification-request-friend-"+id).show(),$scope.getFriendReqNotification())})},$scope.RejectRequest=function(friend,id){$("#notification-request-friend-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.friend_id=friend.friend_id,opts.action="0",1==friend.personal?opts.request_type=1:1==friend.professional&&(opts.request_type=2),ProfileService.rejectFriendRequest(opts,function(data){101==data.code?($("#notification-request-friend-"+id).hide(),$rootScope.getAllFriendNotification(),$scope.getFriendReqNotification()):($("#notification-request-friend-"+id).hide(),$scope.getFriendReqNotification())})}}]),app.controller("MediaSingleController",["$cookieStore","$scope","$rootScope","$http","$timeout","$routeParams","$modal","$log","ProfileService","SingleMediaDetailService","AlbumService",function($cookieStore,$scope,$rootScope,$http,$timeout,$routeParams,$modal,$log,ProfileService,SingleMediaDetailService,AlbumService){$scope.postPageLoader=!0,$scope.postPageNotFound=!1,$scope.data=[];var opts={};opts.media_id=$routeParams.mediaId,opts.album_type=$routeParams.albumType,opts.album_id=$routeParams.parentId,opts.user_id=APP.currentUser.id,opts.owner_id=$routeParams.supportId,$scope.parent_id=$routeParams.parentId,$scope.media_id=$routeParams.mediaId,$scope.max=5,$scope.isReadonly=!1,$scope.media_index=0,"user"==$routeParams.albumType?$scope.parent_type="user_profile_album_photo":"club"==$routeParams.albumType?$scope.parent_type="club_album_photo":"shop"==$routeParams.albumType?$scope.parent_type="store_media":$scope.parent_type="user_profile_album_photo",$scope.mediaType=$routeParams.albumType,SingleMediaDetailService.getMediaInfo(opts,function(data){101==data.code?($scope.data=data.data,$scope.postPageLoader=!1):($scope.data=[],$scope.postPageLoader=!1,$scope.postPageNotFound=!0)}),$scope.UpdateTag=!1,$scope.Tagtoggle=function(){$scope.UpdateTag=!$scope.UpdateTag},$scope.tagFriendSuggestion=function(event,friendname){if(40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex+1!==$scope.friends.length&&$scope.friendTagIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex-1!==-1&&$scope.friendTagIndex--):13===event.keyCode&&$scope.friends.length>0&&-1!==$scope.friendTagIndex&&$scope.selectFriend($scope.friends[$scope.friendTagIndex]),""===$("#searchTagFriend").val().trim()&&($scope.showFriendList=!1),event.keyCode>=65&&event.keyCode<=95){$scope.cancelFriendSearch=!1;var opts={};opts.user_id=APP.currentUser.id,friendname?opts.friend_name=friendname:opts.friend_name="",opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&(data.data.users.length>0?$scope.showFriendList=!0:$scope.showFriendList=!1,$scope.friends=data.data.users)})}},$scope.selectFriend=function(friendInfo){$scope.dublicate=!1,$scope.choose=!1,angular.forEach($scope.data.tagged_friends_info,function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.data.tagged_friends_info.push(friendInfo.user_info),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1)},$scope.taggService=function(){var pre_visible_status=$scope.pre_visible,next_visible_status=$scope.next_visible;$scope.pre_visible=!1,$scope.next_visible=!1;var frnd_array=[];angular.forEach($scope.data.tagged_friends_info,function(index){frnd_array.push(index.id)});var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.parent_id,opts.post_type=1,opts.media_id=[$scope.media_id],opts.tagged_friends=frnd_array.join(","),$scope.UpdateTag=!1,$scope.TagLoader=!0,AlbumService.photoTaging(opts,function(data){101===data.code&&($scope.choose=!0,$scope.TagLoader=!1),$scope.pre_visible=pre_visible_status,$scope.next_visible=next_visible_status})},$scope.removeTagFriend=function(friendIndex){$scope.data.tagged_friends_info.splice(friendIndex,1)},$scope.lostFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.waitRateResponse=!1,$scope.ratePicture=function(rating,picture_id,mediaIndex){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type_id=picture_id,opts.rate=rating,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,update=$scope.data.is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.data.avg_rate=data.data.avg_rate,$scope.data.no_of_votes=data.data.no_of_votes,$scope.data.is_rated=!0,$scope.data.current_user_rate=data.data.current_user_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.data.current_user_rate=0,$scope.data.is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeRating=function(pictureIndex,mediaIndex){var opts={};opts.user_id=APP.currentUser.id,opts.type_id=pictureIndex,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,$scope.waitRateResponse===!1&&($scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.data.current_user_rate=0,$scope.data.avg_rate=data.data.avg_rate,$scope.data.no_of_votes=data.data.no_of_votes,$scope.data.is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.data.current_user_rate=0,$scope.data.is_rated=!1),$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return void 0!=rating?new Array(Math.ceil(rating)):void 0},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.findPeopleRate=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}}]),app.controller("GroupController",["$scope","$http","$location","GroupService","fileReader","$timeout","ProfileService","$modal","$log","focus",function($scope,$http,$location,GroupService,fileReader,$timeout,ProfileService,$modal,$log,focus){$scope.groupTypes=APP.groupTypes,$scope.createGroupData={},$scope.removeImage=!1,$scope.noContent=!1,$scope.groupPublicActive="current",$scope.groupMyClubActive="",$scope.groupInvitActive="",$scope.isLoading=!0,$scope.reqRes=1,$scope.myGrpRes=1,$scope.inviteGrpRes=1,$scope.inviteCLub=0,$scope.userGroupList=[],$scope.clubAllList=[],$scope.inviteGroupList=[],$scope.inviteClubList=[],$scope.totalSize=0,$scope.totalMyClub=0,$scope.totalinviteClub=0,$scope.limitCheck=120,$scope.firstPage=APP.group_pagination.end,$scope.itemsPerPage=APP.group_pagination.end,$scope.currentPage=1,$scope.range=[],$scope.hidepagi=!1,$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.loadMore()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMore()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.loadMore()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.searchPublicGroup($scope.tab,$scope.itemsPerPage)},$scope.myGroup=function(tab,itemsPerPage){$scope.inviteCLub=0,$scope.tab=tab,$scope.clubAllList=[],$scope.groupMyClubActive="current",$scope.groupPublicActive="",$scope.groupInvitActive="";var formData={},limit_start=($scope.currentPage-1)*itemsPerPage;formData.user_id=APP.currentUser.id,formData.group_owner_id=APP.currentUser.id,formData.limit_start=limit_start,formData.limit_size=itemsPerPage,($scope.totalMyClub>limit_start||0==$scope.totalMyClub)&&1==$scope.myGrpRes&&($scope.myGrpRes=0,$scope.isLoading=!0,GroupService.getUserGroups(formData,function(data){if(101==data.code){$scope.userGroupList=$scope.clubMyList=data.data.groups,$scope.isLoading=!1,$scope.myGrpRes=1,$scope.totalMyClub=data.data.size,0!=$scope.totalMyClub?$scope.hidepagi=!0:$scope.hidepagi=!1,$scope.totalItems=data.data.size,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);0==$scope.userGroupList.length&&($scope.noContent=!0)}else $scope.myGrpRes=1,$scope.isLoading=!1,$scope.totalItems=0}))},$scope.clubcheck=0,$scope.searchPublicGroup=function(tab,itemsPerPage){$scope.inviteCLub=0,$scope.tab=tab,$scope.clubMyList=[],$scope.groupPublicActive="current",$scope.groupMyClubActive="",$scope.groupInvitActive="";var limit_start=($scope.currentPage-1)*itemsPerPage,formData={};formData.user_id=APP.currentUser.id,formData.group_name=void 0===$scope.clubTitle?"":$scope.clubTitle,formData.limit_start=limit_start,formData.limit_size=itemsPerPage,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.reqRes&&($scope.reqRes=0,$scope.isLoading=!0,GroupService.searchGroup(formData,function(data){if(101==data.code){$scope.clubcheck=data.data.my_group,$scope.userGroupList=$scope.clubAllList=data.data.groups,$scope.isLoading=!1,$scope.totalSize=data.data.size,0!=$scope.totalSize?$scope.hidepagi=!0:$scope.hidepagi=!1,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.reqRes=1,$scope.searchReqRes=1,0==$scope.userGroupList.length&&($scope.noContent=!0)}else $scope.totalItems=0,$scope.reqRes=1,$scope.searchReqRes=1,$scope.isLoading=!1}))},$scope.searchPublicGroup("allclub",$scope.itemsPerPage),$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.tabChange=function(tab){$scope.currentPage=1,$scope.userGroupList=[],$scope.clubAllList=[],$scope.clubMyList=[],$scope.inviteClubList=[],$scope.tab=tab,$scope.isLoading=!1,"allclub"==tab?($scope.inviteCLub=0,$scope.searchPublicGroup(tab,$scope.itemsPerPage)):"myclub"==tab?($scope.inviteCLub=0,$scope.myGroup(tab,$scope.itemsPerPage)):"inviteclub"==tab&&($scope.inviteCLub=1,$scope.InvitedClub(tab,$scope.itemsPerPage))},$scope.InvitedClub=function(tab,itemsPerPage){$scope.tab=tab,$scope.clubAllList=[],$scope.clubMyList=[],$scope.groupInvitActive="current",$scope.groupMyClubActive="",$scope.groupPublicActive="";var formData={},limit_start=($scope.currentPage-1)*itemsPerPage;formData.user_id=APP.currentUser.id,formData.limit_start=limit_start,formData.limit_size=itemsPerPage,($scope.totalinviteClub>limit_start||0==$scope.totalinviteClub)&&1==$scope.inviteGrpRes&&($scope.inviteGrpRes=0,$scope.isLoading=!0,GroupService.getInviteGroups(formData,function(data){if(101==data.code){$scope.inviteGroupList=$scope.inviteClubList=data.data,$scope.isLoading=!1,$scope.inviteGrpRes=1,$scope.totalinviteClub=data.size,$scope.hidepagi=!0,$scope.totalItems=Math.ceil(data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);0==$scope.inviteGroupList.length&&($scope.noContent=!0)}else $scope.totalItems=0,$scope.inviteGrpRes=1,$scope.isLoading=!1,0!=$scope.totalinviteClub?$scope.hidepagi=!0:$scope.hidepagi=!1}))},$scope.clubTitle="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#clubserchbox").keypress(function(){$scope.clubTitle;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.searchClub("allclub")},DELAY_TIME_BEFORE_POSTING)}),$scope.searchReqRes=0,$scope.searchClub=function(tab){$scope.searchReqRes=0,$scope.clubTitle.length>=3?($scope.clubMyList=[],$scope.clubAllList=[],$scope.userGroupList=[],$scope.tab=tab,$scope.groupPublicActive="current",$scope.searchPublicGroup("allclub",$scope.itemsPerPage)):($scope.clubAllList=[],$scope.userGroupList.slice())},$scope.loadMore=function(){var a=$scope.itemsPerPage,tempTab=$scope.tab;"allclub"==tempTab?($scope.inviteCLub=0,$scope.searchPublicGroup(tempTab,a)):"myclub"==tempTab?($scope.inviteCLub=0,$scope.myGroup(tempTab,a)):"inviteclub"==tempTab&&($scope.inviteCLub=1,$scope.InvitedClub(tempTab,a))},$scope.createGroupToggleTag=!0,$scope.createGroupStart=!1,$scope.createGroupToggle=function(){$scope.createGroupData.groupTypeID=0,$scope.createGroupToggleTag=$scope.createGroupToggleTag===!1?!0:!1},$scope.cancelCreateGroupToggle=function(){$scope.createGroupData={},$scope.files="",$scope.myFile="",$scope.imageSrc="",$scope.createGroupToggle()},$scope.clubFormSubmitted=!1,$scope.createGroup=function(){$scope.clubFormSubmitted=!0;var opts={};$scope.createGroupError=!1;var groupStatusIdx=$scope.createGroupData.groupTypeID,groupStatusData=$scope.groupTypes[groupStatusIdx];return opts.user_id=APP.currentUser.id,opts.group_name=$scope.createGroupData.name,opts.group_status=groupStatusData.groupTypeID,void 0===$scope.createGroupData.name||""===$scope.createGroupData.name?($scope.createClub.clubname.$dirty=!0,$scope.createClub.clubname.$invalid=!0,$scope.createClub.clubname.$error.required=!0,focus("clubname"),!1):0===$scope.createGroupData.groupTypeID||""===$scope.createGroupData.groupTypeID?($scope.createClub.clubstatus.$dirty=!0,$scope.createClub.clubstatus.$invalid=!0,$scope.createClub.clubstatus.$error.required=!0,focus("clubstatus"),!1):void 0===$scope.createGroupData.description||""===$scope.createGroupData.description?($scope.createGroupStart=!1,$scope.createGroupError=!0,$scope.createClub.clubdescription.$dirty=!0,$scope.createClub.clubdescription.$invalid=!0,$scope.createClub.clubdescription.$error.required=!0,focus("clubdescription"),!1):($scope.createGroupStart=!0,opts.group_description=$scope.createGroupData.description,opts.group_media="",0==opts.group_status&&(opts.group_status=1),GroupService.createGroup(opts,$scope.myFile,function(data){101==data.code?$location.path("/club/view/"+data.data.group_id+"/"+data.data.group_status):($scope.createGroupStart=!1,$scope.createGroupError=!0)}),void 0)},$scope.myFile="",$scope.imageSrc="",$scope.getFile=function(){$scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.imageSrc=result,$scope.removeImage=!0})},$scope.removeClubDp=function(){$scope.myFile="",$scope.imageSrc="",$scope.imageSrc=!1,$scope.removeImage=!1},$scope.listActive="active",$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.cancelGroup=function(idx){var formData={};$scope.isLoading=!0;var groupData=$scope.inviteGroupList[idx];formData.user_id=groupData.sender_info.id,formData.request_id=groupData.request_id,GroupService.cancelGroup(formData,function(data){101==data.code?($scope.message=$scope.i18n.clubs.invitation_cancel,$timeout(function(){$scope.message=""},15e3),$timeout(function(){$scope.commentErrMsg=""},15e3),$scope.inviteGroupList.splice(idx,1),$scope.isLoading=!1):($scope.message=$scope.i18n.clubs.invitation_cancel_failed,$timeout(function(){$scope.commentErrMsg=""},15e3),$scope.isLoading=!1)})},$scope.requestMessage="",$scope.showMessage=!0,$scope.joinPublicGroups=function(groupId){console.log("asadsadsadadadddadad"),$("#groupjoing"+groupId).hide(),$("#groupjoinglist"+groupId).hide(),$("#joinloader"+groupId).show(),$("#joinloaderlist"+groupId).show(),$scope.requestMessage="";var opts={};opts.user_id=APP.currentUser.id,opts.group_id=groupId,GroupService.joinPublicGroup(opts,function(data){101==data.code?(console.log("aaaaaaaadadadddadad"),$("#requestsent"+groupId).show(),$("#requestsentlist"+groupId).show(),$("#joinloader"+groupId).hide(),$("#joinloaderlist"+groupId).hide()):118==data.code?($("#requestpending"+groupId).show(),$("#requestpendinglist"+groupId).show(),$("#joinloader"+groupId).hide(),$("#joinloaderlist"+groupId).hide()):($("#groupjoing"+groupId).show(),$("#groupjoinglist"+groupId).show(),$("#joinloader"+groupId).hide(),$("#joinloaderlist"+groupId).hide())})},$scope.deleteGroup=function(idx){var formData={};$scope.isLoading=!0;var groupData=$scope.userGroupList[idx];formData.user_id=APP.currentUser.id,formData.group_owner_id=groupData.owner_id,formData.group_id=groupData.group_id,GroupService.deleteGroup(formData,function(data){101==data.code?($scope.message=$scope.i18n.clubs.delete_success,$scope.userGroupList.splice(idx,1),$timeout(function(){$scope.message=""},15e3),$scope.isLoading=!1):($scope.message=$scope.i18n.clubs.delete_fail,$scope.isLoading=!1)})}}]),app.controller("ClubNotificationController",["$scope","$http","GroupService",function($scope,$http,GroupService){$scope.getClubNotification=function(){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,opts={},opts.user_id=APP.currentUser.id,GroupService.getAllClubNotifications(opts,function(data){101==data.code&&0!=data.data.length?($scope.notifications=data.data,$scope.NotificationFound=!0):$scope.NotificationNotFound=!0})},$scope.getClubNotification(),$scope.acceptRequest=function(senderId,requestId,groupId,groupType,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=1,GroupService.responseClubNotification(opts,function(data){101==data.code&&$scope.getClubNotification()})},$scope.rejectRequest=function(senderId,requestId,groupId,groupType,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=2,GroupService.responseClubNotification(opts,function(data){101==data.code&&$scope.getClubNotification()})}}]),app.controller("ClubSpecificationNotification",["$scope","$http","$routeParams","GroupService",function($scope,$http,$routeParams,GroupService){$scope.getClubNotification=function(){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,opts={},opts.user_id=APP.currentUser.id,opts.group_id=$routeParams.clubId,GroupService.getGroupNotifications(opts,function(data){101==data.code?0!=data.data.length?($scope.notifications=data.data,$scope.NotificationFound=!0):$scope.NotificationNotFound=!0:500==data.code?$scope.NotificationNotFound=!0:$scope.NotificationNotFound=!0})},$scope.getClubNotification(),$scope.acceptRequest=function(senderId,requestId,groupId,groupType,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=1,GroupService.responseClubNotification(opts,function(data){101==data.code&&$scope.getClubNotification()})},$scope.rejectRequest=function(senderId,requestId,groupId,groupType,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.sender_id=senderId,opts.group_id=groupId,1==groupType?opts.request_type="admin":opts.request_type="user",opts.response=2,GroupService.responseClubNotification(opts,function(data){101==data.code&&$scope.getClubNotification()})}}]),app.controller("MyClubController",["$scope","$http","GroupService","$location","$timeout","ProfileService","$modal","$log","focus",function($scope,$http,GroupService,$location,$timeout,ProfileService,$modal,$log,focus){$scope.groupTypes=APP.groupTypes,$scope.createGroupData={},$scope.userGroupList=[],$scope.noContent=!1,$scope.groupMyClubActive="current",$scope.groupInvitActive="",$scope.isLoading=!0,$scope.myFile=[],$scope.myReqRes=1,$scope.totalSize=0,$scope.myClubList=[],$scope.getMyClub=function(){$scope.groupMyClubActive="current",$scope.groupPublicActive="";var formData={},limit_start=$scope.userGroupList.length;formData.user_id=APP.currentUser.id,formData.group_owner_id=APP.currentUser.id,formData.limit_start=limit_start,formData.limit_size=APP.group_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myReqRes&&($scope.myReqRes=0,$scope.isLoading=!0,GroupService.getUserGroups(formData,function(data){101==data.code?($scope.userGroupList=$scope.myClubList=$scope.myClubList.concat(data.data.groups),$scope.isLoading=!1,$scope.myReqRes=1,$scope.totalSize=data.data.size,0==$scope.userGroupList.length&&($scope.noContent=!0)):($scope.myReqRes=1,$scope.isLoading=!1)}))},$scope.loadMore=function(){$scope.getMyClub()},$scope.clubFormSubmitted=!1,$scope.createGroup=function(){$scope.clubFormSubmitted=!0;var opts={};$scope.createGroupError=!1,$scope.createGroupStart=!0;var groupStatusIdx=$scope.createGroupData.groupTypeID,groupStatusData=$scope.groupTypes[groupStatusIdx];return opts.user_id=APP.currentUser.id,void 0===$scope.createGroupData.name||""===$scope.createGroupData.name?($scope.createGroupStart=!1,$scope.createGroupError=!0,$scope.createClub.clubname.$dirty=!0,$scope.createClub.clubname.$invalid=!0,$scope.createClub.clubname.$error.required=!0,focus("clubname"),!1):void 0===groupStatusData.groupTypeID||""==groupStatusData.groupTypeID?($scope.createGroupStart=!1,$scope.createGroupError=!0,$scope.createClub.clubstatus.$dirty=!0,$scope.createClub.clubstatus.$invalid=!0,$scope.createClub.clubstatus.$error.required=!0,focus("clubstatus"),!1):void 0===$scope.createGroupData.description||""===$scope.createGroupData.description?($scope.createGroupStart=!1,$scope.createGroupError=!0,$scope.createClub.clubdescription.$dirty=!0,$scope.createClub.clubdescription.$invalid=!0,$scope.createClub.clubdescription.$error.required=!0,focus("clubdescription"),!1):(opts.group_name=$scope.createGroupData.name,opts.group_status=groupStatusData.groupTypeID,opts.group_description=$scope.createGroupData.description,opts.group_media="",0==opts.group_status&&(opts.group_status=1),void GroupService.createGroup(opts,$scope.myFile,function(data){101==data.code?$location.path("/club/view/"+data.data.group_id+"/"+data.data.group_status):($scope.createGroupStart=!1,$scope.createGroupError=!0)}))},$scope.listActive="active",$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.deleteGroup=function(idx){var formData={};$scope.isLoading=!0;var groupData=$scope.userGroupList[idx];formData.user_id=APP.currentUser.id,formData.group_owner_id=groupData.owner_id,formData.group_id=groupData.group_id,GroupService.deleteGroup(formData,function(data){101==data.code?($scope.message=$scope.i18n.clubs.delete_success,$scope.userGroupList.splice(idx,1),$timeout(function(){$scope.message=""},15e3),$scope.isLoading=!1):($scope.message=$scope.i18n.clubs.delete_fail,$scope.isLoading=!1)})},$scope.createGroupToggleTag=!0,$scope.createGroupStart=!1,$scope.createGroupToggle=function(){$scope.createGroupData.groupTypeID=0,$scope.createGroupToggleTag=$scope.createGroupToggleTag===!1?!0:!1},$scope.cancelCreateGroupToggle=function(){$scope.createGroupData={},$scope.files="",$scope.myFile="",$scope.imageSrc="",$scope.createGroupToggle()},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}}]),app.controller("GroupDetailController",["$scope","$http","$rootScope","$location","$routeParams","$interval","$window","GroupService","ProfileService","fileReader","$timeout","$modal","$log","focus",function($scope,$http,$rootScope,$location,$routeParams,$interval,$window,GroupService,ProfileService,fileReader,$timeout,$modal,$log,focus){$scope.friend_id=0,$scope.listMember=[],$scope.UserName=APP.currentUser.username;var str1=$location.path().replace("/",""),str=str1.split("/"),activeUrl=str[0]+"/"+str[1];switch(activeUrl){case"album/club":$rootScope.clubCoverActive="photos";break;default:$rootScope.clubCoverActive="about"}$scope.removeClb=!0,$scope.rmClub=!0,$scope.clubsection=!0,$scope.$on("updateClubProfileCover",function(event,imgData){$scope.groupDetail.profile_img_cover=imgData.cover,$scope.groupDetail.profile_img_original=imgData.original,$scope.groupDetail.media_id=imgData.media_id,$scope.coverLoadHide=!1,$scope.fileUrl="",$timeout(function(){$scope.repositionImage()},50)}),$scope.removeClub=function(){$scope.clubloader=!0,$scope.rmClub=!1;var groupId=$routeParams.clubId,opts={};opts.user_id=APP.currentUser.id,opts.club_id=groupId,GroupService.unjoinclubs(opts,function(data){101==data.code?($scope.successClub=!0,$scope.clubloader=!1,$scope.rmClub=!1,$timeout(function(){$scope.clubsection=!1},3e3)):($scope.clubloader=!1,$scope.rmClub=!1)})},$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="780"?1==$rootScope.mobileView?$timeout(function(){$scope.resizeClubMediaCoordinate()},1e3):$rootScope.mobileView=!0:$rootScope.mobileView=!1},!0);var img=new Image;$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0,$scope.resizeClubMediaCoordinate=function(){void 0!=$scope.groupDetail&&(img=null,img=new Image,img.src=$scope.groupDetail.profile_img_cover,$scope.windowWidth<="480"?img.onload=function(){img.width<=910?""!=$scope.groupDetail.y_cord?($scope.groupDetail.y_cord>100?$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/3:$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/4,$scope.mobileClubX_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/4:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/5,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>1300&&(""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/5:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/6,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0))}:$scope.windowWidth>"480"&&$scope.windowWidth<"650"&&(img.onload=function(){img.width<=910?""!=$scope.groupDetail.y_cord?($scope.groupDetail.y_cord>100?$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/1.8:$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/2,$scope.mobileClubX_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2.2,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>1300&&(""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2.8:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/3,
$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0))}))},$scope.displayGroupDetail=function(){$scope.groupTypes=APP.groupTypes,$scope.groupDetailLoading=!1,$scope.showAllMembers=!1,$scope.editGroupStatus=!1,$scope.editGroupObject={};var groupId=$routeParams.clubId,groupStatus=$routeParams.clubType;$scope.groupViewLoader=!0,opts={},opts.user_id=APP.currentUser.id,opts.group_id=groupId,opts.group_status=groupStatus,$scope.listMember=[],GroupService.getGroupDetail(opts,function(data){$scope.groupViewLoader=!1,101==data.code&&($scope.groupDetail=data.data,data.data.owner_id!==APP.currentUser.id&&angular.element("#checkUser").css("display","none"),$scope.editGroupObject=$scope.groupDetail,$scope.groupDetailLoading=!0,$scope.listMember=data.data.members,$scope.allMemberTotal=data.data.members.length,1==$rootScope.mobileView&&(img=null,img=new Image,img.src=$scope.groupDetail.profile_img_cover,$scope.windowWidth<="480"?img.onload=function(){img.width<=910?""!=$scope.groupDetail.y_cord?($scope.groupDetail.y_cord>100?$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/3:$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/4,$scope.mobileClubX_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/4:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/5,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>1300&&(""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/5:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/6,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0))}:$scope.windowWidth>"480"&&$scope.windowWidth<"650"&&(img.onload=function(){img.width<=910?""!=$scope.groupDetail.y_cord?($scope.groupDetail.y_cord>100?$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/1.8:$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/2,$scope.mobileClubX_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2.2,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>1300&&(""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2.6:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/3,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0))})),$scope.canPost=!1,21!=data.data.role&&($scope.canPost=!0),data.data.owner_id==APP.currentUser.id?$scope.uploadButton=!0:$scope.uploadButton=!1)})},$scope.deleteMember=function(idx){var opts={},groupId=$routeParams.clubId,memberData=$scope.listMember[idx];opts.owner_id=APP.currentUser.id,opts.member_id=memberData.id,opts.club_id=groupId,opts.session_id=APP.currentUser.id,GroupService.deleteClubMember(opts,function(data){101==data.code?($scope.memberMessage=$scope.i18n.clubs.member_success,$scope.msgClass="text-success text-center display-block-inline",$timeout(function(){$scope.memberMessage=""},1e4),$scope.listMember.splice(idx,1)):100==data.code?($scope.memberMessage=$scope.i18n.validation.missed_param,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.memberMessage=""},1e4)):78==data.code?($scope.memberMessage=$scope.i18n.clubs.member_club,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.memberMessage=""},1e4)):79==data.code?($scope.memberMessage=$scope.i18n.clubs.member_owner,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.memberMessage=""},1e4)):85==data.code?($scope.memberMessage=$scope.i18n.clubs.member_account,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.memberMessage=""},1e4)):80==data.code&&($scope.memberMessage=$scope.i18n.clubs.member_owner_delete,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.memberMessage=""},1e4))})},$scope.displayGroupDetail(),$scope.aboutsection=!0,$scope.showInvite=!1,$scope.toggleInvite=function(){$rootScope.clubCoverActive="invite",$scope.showInvite=!$scope.showInvite,$scope.showRole=!1,$scope.aboutclub=!1,$scope.showMember=!1,$scope.aboutsection=!0,$scope.albumshow=!1,$scope.invite.userAddress=""},$scope.aboutclub=!1,$scope.aboutClub=function(id){$rootScope.clubCoverActive="about",$scope.showRole=!1,$scope.showInvite=!1,$scope.showMember=!1,$scope.aboutsection=!0,$location.path("/club/view/"+id+"/"+$routeParams.clubType)},$scope.showRole=!1,$scope.toggleRole=function(){$rootScope.clubCoverActive="changerole",$scope.aboutclub=!1,$scope.showRole=!$scope.showRole,$scope.showInvite=!1,$scope.showMember=!1,$scope.aboutsection=!0,$scope.albumshow=!1},$scope.showMember=!1,$scope.albumshow=!0,$scope.toggleMember=function(){$rootScope.clubCoverActive="member",$scope.showMember=!0,$scope.showRole=!1,$scope.aboutclub=!1,$scope.showInvite=!1,$scope.aboutsection=!1,$scope.albumshow=!1,$scope.invite.userAddress=""},$scope.togglePhotos=function(){$rootScope.clubCoverActive="photos",$scope.albumshow=!0,$scope.showRole=!1,$scope.aboutclub=!1,$scope.showInvite=!1,$scope.aboutsection=!1,$scope.showMember=!1,$scope.invite.userAddress=""},$scope.hideRoleInvite=function(){$scope.showRole=!1,$scope.showInvite=!1},$scope.assignRoleToGroup=function(groupId){var opts={};return $scope.ChangeRoleError=!1,null===$scope.role.member||void 0===$scope.role.member||""==$scope.role.member.id?($scope.changeroleErrorMsg=$scope.i18n.clubs.cover.select_member,$scope.ChangeRoleError=!0,$timeout(function(){$scope.changeroleErrorMsg=""},5e3),!1):void 0===$scope.role.selectedRole||""==$scope.role.selectedRole?($scope.changeroleErrorMsg=$scope.i18n.groupcontrol.enter_role,$scope.ChangeRoleError=!0,$timeout(function(){$scope.changeroleErrorMsg=""},5e3),!1):(opts.user_id=APP.currentUser.id,opts.friend_id=$scope.role.member.id,opts.acl_access=$scope.role.selectedRole,opts.group_id=groupId,void GroupService.assignRoleToGroup(opts,function(data){101==data.code?($scope.ChangeRoleMessage="Role changed successfully",$timeout(function(){$scope.ChangeRoleMessage=""},1e4)):($scope.Message=data.message,$timeout(function(){$scope.changeroleErrorMsg=""},1e4))}))},$scope.requestMessage="",$scope.showMessage=!0,$scope.joinPublicGroups=function(groupId){$(".join-club-request").hide(),$("#groupjoing"+groupId).hide(),$("#joinloader"+groupId).show(),$scope.requestMessage="";var opts={};opts.user_id=APP.currentUser.id,opts.group_id=groupId,GroupService.joinPublicGroup(opts,function(data){101==data.code?($("#requestsent"+groupId).show(),$(".join-club-request-sent").show(),$("#joinloader"+groupId).hide()):118==data.code?($("#requestpending"+groupId).show(),$("#joinloader"+groupId).hide(),$timeout(function(){$("#requestpending"+groupId).hide()},1e4)):($(".join-club-request-sent").hide(),$("#groupjoing"+groupId).show(),$("#joinloader"+groupId).hide(),$(".join-club-request").show())})},$scope.invite={},$scope.userList=[],$scope.cancelRequest=0,$scope.showUserList=!1,$scope.searchUser=function(){$scope.cancelRequest=0,$scope.albloader=!0;var opts={};""!=$scope.invite.userAddress?($scope.showUserList=!0,opts.user_id=APP.currentUser.id,opts.friend_name=$scope.invite.userAddress,opts.limit_start=APP.user_list_pagination.start,opts.limit_size=APP.user_list_pagination.end,ProfileService.searchUser(opts,function(data){0==$scope.cancelRequest&&($scope.userList=[],101==data.code?0!=data.data.count&&0!=data.data.users.length?($scope.albloader=!1,$scope.userList=$scope.userList.concat(data.data.users)):$scope.showUserList=!1:$scope.albloader=!1)})):($scope.userList=[],$scope.userList.slice(),$scope.cancelRequest=1,$scope.showUserList=!1)},$("body").click(function(){stop=$interval(function(){$scope.cancelRequest=1,$scope.showList=!1,$scope.showUserList=!1},200,1)}),$scope.setUser=function(firstName,lastName,userId){$scope.invite.userAddress=firstName+" "+lastName,$scope.friend_id=userId},$scope.joinPrivateGroups=function(groupId){var opts={};return $scope.InviteUserError=!1,$scope.showinvite=!0,void 0===$scope.friend_id||""==$scope.friend_id?($scope.inviteuserErrorMsg=$scope.i18n.groupcontrol.enter_user,$scope.InviteUserError=!0,$scope.showinvite=!1,$timeout(function(){$scope.inviteuserErrorMsg=""},6e3),!1):void 0===$scope.invite.role||""==$scope.invite.role?($scope.inviteuserErrorMsg=$scope.i18n.groupcontrol.enter_role,$scope.InviteUserError=!0,$scope.showinvite=!1,$timeout(function(){$scope.inviteuserErrorMsg=""},6e3),!1):(opts.user_id=APP.currentUser.id,opts.group_id=groupId,opts.friend_id=$scope.friend_id,opts.access_role=$scope.invite.role,void GroupService.joinPrivateGroups(opts,function(data){101==data.code?($scope.Message=$scope.i18n.groupcontrol.join_group,$scope.showinvite=!1,stop=$interval(function(){$scope.showInvite=!1,$scope.Message="",$scope.friend_id="",$scope.invite.role=""},1e4,1)):118==data.code?($scope.Message=$scope.i18n.groupcontrol.REQUEST_IS_PENDING_FOR_USER_APPROVAL,$scope.showinvite=!1,stop=$interval(function(){$scope.showInvite=!1,$scope.Message="",$scope.invite.role="",$scope.friend_id=""},1e4,1)):117==data.code?($scope.Message=$scope.i18n.groupcontrol.Already_member,$scope.showinvite=!1,stop=$interval(function(){$scope.showInvite=!1,$scope.Message="",$scope.invite.role="",$scope.friend_id=""},1e4,1)):($scope.Message=$scope.i18n.groupcontrol.permission_denied,$scope.showinvite=!1,stop=$interval(function(){$scope.Message="",$scope.showInvite=!1},1e4,1))}))},$scope.showGroupMembers=function(){$scope.showAllMembers=$scope.showAllMembers===!1?!0:!1},$scope.editGroup=function(){$scope.editGroupObject.groupTypeID=$scope.editGroupObject.group_status,$scope.editGroupStatus=$scope.editGroupStatus===!1?!0:!1,$scope.files="",$scope.myFile="",$scope.imageSrc=""},$scope.myFile="",$scope.invalidCoverImage=!1,$scope.getFile=function(){$scope.progress=0,$scope.invalidCoverImageMgs=$scope.i18n.groupcontrol.correct_file_size,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.readImage($scope.myFile,function(data){0!=data.length&&data.width>=910&&data.height>=400?$scope.uploadClubCover():($("#invalidCoverImage").show(),$timeout(function(){$("#invalidCoverImage").hide()},2e3))})})},$scope.readImage=function(file,callback){var reader=new FileReader,image=new Image;reader.readAsDataURL(file),reader.onload=function(_file){var filedata={};image.src=_file.target.result,image.onload=function(){{var w=this.width,h=this.height;file.type,file.name,~~(file.size/1024)+"KB"}filedata.width=w,filedata.height=h,callback(filedata)},image.onerror=function(){callback(filedata)}}},$scope.clubEditSUbmitted=!1,$scope.updateGroup=function(){$scope.createGroupError=!1,$scope.clubEditSUbmitted=!0;var groupStatusIdx=$scope.editGroupObject.groupTypeID,groupStatusData=$scope.groupTypes[groupStatusIdx];return void 0===$scope.editGroupObject.title||""===$scope.editGroupObject.title?($scope.clubEditForm.editclubname.$dirty=!0,$scope.clubEditForm.editclubname.$invalid=!0,$scope.clubEditForm.editclubname.$error.required=!0,focus("editclubname"),!1):0===$scope.editGroupObject.groupTypeID||""===$scope.editGroupObject.groupTypeID?($scope.clubEditForm.editclubstatus.$dirty=!0,$scope.clubEditForm.editclubstatus.$invalid=!0,$scope.clubEditForm.editclubstatus.$error.required=!0,focus("editclubstatus"),!1):void 0===$scope.editGroupObject.description||""==$scope.editGroupObject.description?($scope.clubEditForm.editclubdesc.$dirty=!0,$scope.clubEditForm.editclubdesc.$invalid=!0,$scope.clubEditForm.editclubdesc.$error.required=!0,focus("editclubdesc"),!1):($scope.createGroupStart=!0,opts.user_id=APP.currentUser.id,$scope.editGroupObject.owner_id==APP.currentUser.id&&(opts.group_owner_id=$scope.editGroupObject.owner_id),opts.group_id=$scope.editGroupObject.id,opts.group_name=$scope.editGroupObject.title,opts.group_status=groupStatusData.groupTypeID,opts.group_description=$scope.editGroupObject.description,void 0===$scope.editGroupObject.title||void 0===$scope.myFile,0==opts.group_status&&(opts.group_status=1),opts.group_media="",GroupService.updateGroup(opts,$scope.myFile,function(data){101==data.code?($scope.createGroupStart=!1,$scope.editGroupObject={},$scope.myFile=void 0,$scope.editGroup(),$scope.displayGroupDetail()):($scope.createGroupStart=!1,$scope.createGroupError=!0)}),void 0)},$scope.newImage=!1,$scope.uploadClubCover=function(){$scope.showCoverOption=!1,$scope.coverImageUploadStart=!0;var opts={};if(opts.group_id=$routeParams.clubId,opts.session_id=APP.currentUser.id,void 0!==$scope.myFile){var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);if("gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType)return $scope.createGroupErrorMsg=$scope.i18n.groupcontrol.upload_media,!1}$scope.fileUrl=null,GroupService.uploadClubCover(opts,$scope.myFile,function(data){101==data.code?($scope.newImage=!0,$scope.groupDetail.profile_img_cover=data.data.cover_thumb_image_path,$scope.groupDetail.profile_img_original=data.data.profile_img_original,$scope.coverImageUploadStart=!1,$scope.fileUrl=data.data.cover_thumb_image_path,$scope.groupDetail.media_id=data.data.media_id,$scope.showCanves=!0,$scope.coverLoadHide=!0):$scope.coverImageUploadStart=!1})},$scope.imageCropResult=null,$scope.imageCropResult2=null,$scope.imageWidth=null,$scope.imageHeight=null,$scope.showImageCropper=!1,$scope.showImageCropper2=!1,$scope.imageString="",$scope.file={},$scope.coverLoadHide=!1,$scope.$watch("imageCropResult2",function(newVal){newVal&&console.log("imageCropResult2",newVal)}),$scope.imageXPosition=0,$scope.imageYPosition=0,$scope.setImageCordinate=function(){$scope.groupDetail.x_cord=-1*$rootScope.club.x_cord,$scope.groupDetail.y_cord=-1*$rootScope.club.y_cord,$scope.saveCordinate()},$rootScope.club={},$scope.showCanves=!1,$scope.repositionImage=function(){$scope.showCanves=!0,$scope.fileUrl=$scope.groupDetail.profile_img_cover,"NaN"==$scope.groupDetail.x_cord?($scope.imageXPosition=0,$scope.imageYPosition=0,$scope.coverLoadHide=!0):($scope.imageXPosition=-1*$scope.groupDetail.x_cord,$scope.imageYPosition=-1*$scope.groupDetail.y_cord,$scope.coverLoadHide=!0)},$scope.saveCordinate=function(){$scope.hideUpdateCoverButton=!0,$scope.showCanves=!1;var opts={};opts.media_id=$scope.groupDetail.media_id,opts.session_id=APP.currentUser.id,opts.x=""+$scope.groupDetail.x_cord,opts.y=""+$scope.groupDetail.y_cord,GroupService.setClubMediaCoordinate(opts,function(data){101==data.code&&"SUCCESS"==data.message&&($scope.groupDetail.x_cord=data.data.x_cord,$scope.groupDetail.y_cord=data.data.y_cord,$scope.coverLoadHide=!1,$scope.file=null,$scope.fileUrl=null,$scope.hideUpdateCoverButton=!1,$scope.showCanves=!1,1==$rootScope.mobileView&&(img=null,img=new Image,img.src=$scope.groupDetail.profile_img_cover,$scope.windowWidth<="480"?img.onload=function(){img.width<=910?""!=$scope.groupDetail.y_cord?($scope.groupDetail.y_cord>100?$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/3:$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/4,$scope.mobileClubX_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/4:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/5,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>1300&&(""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/5:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/6,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0))}:$scope.windowWidth>"480"&&$scope.windowWidth<"650"&&(img.onload=function(){img.width<=910?""!=$scope.groupDetail.y_cord?($scope.groupDetail.y_cord>100?$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/1.8:$scope.mobileClubY_Cord=$scope.groupDetail.y_cord/2,$scope.mobileClubX_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2.2,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0):img.width>1300&&(""!=$scope.groupDetail.x_cord?($scope.groupDetail.x_cord>100?$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/2.6:$scope.mobileClubX_Cord=$scope.groupDetail.x_cord/3,$scope.mobileClubY_Cord=0):($scope.groupDetail.x_cord=0,$scope.groupDetail.y_cord=0,$scope.mobileClubX_Cord=0,$scope.mobileClubY_Cord=0))})))})},$scope.showcrossactive=!0,$scope.showcrossactive1=function(){$scope.showcrossactive=!1},$scope.showCoverOption=!1,$scope.showCoverDropDown=function($event){$scope.showCoverOption=!$scope.showCoverOption,$event.stopPropagation()},window.onclick=function(){$timeout(function(){$scope.showCoverOption&&($scope.showCoverOption=!1,$scope.$apply())},100)},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.ratePost=function(rating,post_id){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="club",opts.type_id=post_id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.groupDetail.is_rated?"update":"add",waitRequest=ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.groupDetail.avg_rate=data.data.avg_rate,$scope.groupDetail.no_of_votes=data.data.no_of_votes,$scope.groupDetail.is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.groupDetail.is_rated=!1,$scope.groupDetail.current_user_rate=0),$scope.waitRateResponse=!1})},$scope.WaitDeleteResponse=!1,$scope.removeRating=function(post_id,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.type="club",opts.type_id=post_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.groupDetail.current_user_rate=0,$scope.groupDetail.is_rated=!1,$scope.groupDetail.no_of_votes=data.data.no_of_votes,$scope.groupDetail.avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.groupDetail.current_user_rate=0,$scope.groupDetail.is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.stars=[],$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.rateThis=function(value,id){$scope.ratePost(value,id)},$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}],$scope.showPeopleLoader=!1,$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}}]),app.controller("GroupPostController",["$scope","PostService","$location","$timeout","$routeParams","CommentService","FileUploader","ProfileService","$modal","$log",function($scope,PostService,$location,$timeout,$routeParams,CommentService,FileUploader,ProfileService,$modal,$log){$scope.currentUser=$scope.currentUser,$scope.noComment=!1,$scope.postErrMsg="";var groupId=$routeParams.clubId,groupStatus=$routeParams.clubType;$scope.postContentStart=!1,$scope.posts=[],$scope.myRes=1,$scope.tempPostId="",$scope.postErrCls="",$scope.textLimit=APP.post_charecter_limit,$scope.createPost=function(){var link_type,opts={};$scope.postInProcess=!0,$scope.postContentStart=!0,$scope.postContentLoader=!0;var filescount=$scope.imageSrc.length,descval=$("#preview_lp1").html(),href=$("#previewUrl_lp1").html(),textarea=$("#text_lp1").val(),description="";description=textarea;var regex=/src="([^"]+)"/,src=description.split(regex)[1];return void 0!=src&&""!=src&&(description=src),description=escapeHtmlEntities(description),""==href?link_type="0":(description="<p>"+description+"</p>",description+=descval,link_type="1"),void 0!=description&&""!=description||0!=filescount?(opts.user_id=APP.currentUser.id,opts.group_id=groupId,opts.post_title="Not in use on frontend",opts.post_desc=description,opts.youtube="",opts.post_media="",opts.post_id=$scope.tempPostId,opts.link_type=link_type,opts.post_type="1",opts.media_id=[],angular.forEach($scope.imageSrc,function(file){opts.media_id.push(file.media_id)}),void PostService.createPost(opts,function(data){if(101==data.code){var newpost={};for(newpost=data.data[0],newpost.comments=[],$scope.posts.unshift(newpost),$scope.noContent=!1,$scope.postInProcess=!1,$scope.postErrMsg="",$scope.postErrCls="",uploader.data.post_id={};uploader.queue.length;)uploader.queue[0].remove();0==$scope.posts.length&&($scope.noContent=!0),$scope.imageSrc=[],$scope.postFiles=[],$scope.postText=void 0,$scope.isImage=!1,$scope.imgUpload=!1,$scope.isUpload=!1,$scope.uploadBox=!1,$scope.postContentStart=!1,$scope.postContentLoader=!1,$scope.tempPostId="",$("#text_lp1").val(""),$("#text_lp1").attr("style",""),$timeout(function(){$("#closePreview_lp1").click()},100)}else 0==$scope.posts.length&&($scope.noContent=!0),$scope.postInProcess=!1,$scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.post_unable,$scope.imageSrc=[],$scope.postFiles=[],$scope.isImage=!1,$scope.imgUpload=!1,$scope.isUpload=!1,$scope.uploadBox=!1,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.postContentStart=!1,$scope.postContentLoader=!1})):($scope.postInProcess=!1,$scope.postErrMsg=$scope.i18n.editprofile.attach_link,$scope.postErrCls="text-red",$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.postContentStart=!1,$scope.postContentLoader=!1,!1)},$scope.getPosts=function(){$scope.isLoading=!0,$scope.noContent=!1;var limit_start=$scope.posts.length,opts={};opts.user_group_id=groupId,opts.user_id=APP.currentUser.id,opts.group_type=groupStatus,opts.limit_start=limit_start,opts.limit_size=APP.group_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes?($scope.myRes=0,$scope.isLoading=!1,PostService.listPost(opts,function(data){if(101==data.code){var items=data.data;(void 0!=items||0!=items.length)&&($scope.posts=$scope.posts.concat(items)),$scope.myRes=1,$scope.totalSize=data.total,0==$scope.posts.length&&($scope.noContent=!0)}else $scope.noContent=!0,$scope.isLoading=!1,$scope.posts})):$timeout(function(){$scope.isLoading=!1},1e3)},$scope.showClubPostList=function(){$scope.isLoading=!0,$scope.posts=[],$scope.totalSize=0,$scope.myRes=1,$scope.noContent=!1,$scope.getPosts()},$scope.showClubPostList(),$scope.loadMore=function(){$scope.totalSize>$scope.posts.length&&$scope.getPosts()},$scope.showComments=[],$scope.commentLoading=[],$scope.getComments=function(opts,postIndx){$scope.posts[postIndx].comments=[],$scope.showComments[postIndx]=!0,$scope.commentLoading[postIndx]=!0,CommentService.listComment(opts,function(data){100==data.code?($scope.posts[postIndx].comments=data.data.comments,$scope.commentLoading[postIndx]=!1,0!=$scope.posts[postIndx].comments.length&&($scope.noComment=!0)):$scope.commentLoading[postIndx]=!1})},$scope.showAllComments=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.session_id=$scope.currentUser.id,opts.limit_size=null,opts.limit_start=0,$scope.getComments(opts,postIndx)},$scope.showLimitedComment=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.session_id=$scope.currentUser.id,opts.limit_size=APP.group_pagination.end,opts.limit_start=APP.group_pagination.start,$scope.getComments(opts,postIndx)},$scope.deleteErrMsg=[],$scope.deleteErrCls=[],$scope.deletePost=function(indx){$scope.deletePostIndx=indx;var postData={};postData=$scope.posts[indx];var formData={};formData.user_id=$scope.currentUser.id,formData.post_id=postData.post_id,PostService.deletePost(formData,function(data){101==data.code?($scope.posts.splice(indx,1),0==$scope.posts.length&&($scope.noContent=!0)):($scope.deleteErrCls[indx]="text-red",$scope.deleteErrMsg[indx]=$scope.i18n.dashboard.postcomment.delete_post_fail,$scope.posts),$timeout(function(){$scope.deleteErrCls[indx]="",$scope.deleteErrMsg[indx]=""},15e3)})},$scope.imageSrc=[],$scope.postFiles=[],$scope.postImgLoader=[],$scope.tempPostId="";var uploader=$scope.uploader=new FileUploader({url:APP.service.createGroupPost+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id,group_id:groupId,title:"Not in use on frontend",description:"",youtube_url:"",to_id:APP.currentUser.id,link_type:"0",post_type:"0",post_id:$scope.tempPostId},dataObjName:"reqObj",formDataName:"post_media[]"});uploader.filters.push({name:"post_media[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0,uploader.data.post_id=$scope.tempPostId;var queueLen=uploader.queue.length-1;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.postImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imageSrc[index]=response.data,$scope.postImgLoader[index]=!1,$scope.tempPostId=response.data.id,uploader.data.post_id=response.data.id)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.postErrMsg=$scope.i18n.groupcontrol.incorrect_upload,$scope.postErrCls="text-red",$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3)},$scope.isImage=!1,$scope.isUpload=!1,$scope.uploadBox=!1,$scope.addImage=function(){var href=$("#previewUrl_lp1").html();""!=href&&$timeout(function(){$("#closePreview_lp1").click()},100),$scope.isImage=!0,$scope.imageSrc=[],$scope.postFiles=[],$scope.uploadBox=!0,uploader.queue=[],$scope.isUpload=!1},$scope.addPost=function(){$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.isPost=!0,$scope.imageSrc=[],$scope.postFiles=[],uploader.queue=[]},$scope.saveUpdatePost=function(indx){$scope.editPostErrorMsg=[],$scope.editPostErrorCls=[];var opts={};$scope.updatePostInProcess=!0;var editPostText=escapeHtmlEntities($scope.updateBody[indx]),post=$scope.posts[indx];if(void 0===editPostText||""===editPostText)return $scope.updatePostInProcess=!1,$scope.editPostErrorMsg[indx]=$scope.i18n.groupcontrol.write_to_post,$scope.editPostErrorCls[indx]="text-red",!1;var regex=/src="([^"]+)"/,src=editPostText.split(regex)[1];void 0!=src&&""!=src&&(editPostText=src),opts.user_id=$scope.currentUser.id,opts.user_group_id=groupId,opts.group_type=$scope.groupDetail.group_status,opts.post_id=post.post_id,opts.post_title=post.post_title,opts.post_desc=editPostText,opts.youtube="";var myFile="";PostService.updatePost(opts,myFile,function(data){101==data.code?($scope.updatePostInProcess=!1,$scope.editPostErrorMsg[indx]="",$scope.editPostErrorCls[indx]="",$scope.posts[indx].post_description=editPostText,$scope.editPostText="",$scope.activeEdit[indx]=!1):($scope.updatePostInProcess=!1,$scope.activeEdit[indx]=!1,$scope.editPostErrorCls[indx]="text-red",$scope.editPostErrorMsg[indx]=$scope.i18n.groupcontrol.not_send_post),$timeout(function(){$scope.editPostErrorCls[indx]="",$scope.editPostErrorMsg[indx]=""},15e3)})},$scope.updateBody=[],$scope.activeEdit=[],$scope.editPostErrorCls=[],$scope.editPostErrorMsg=[],$scope.updatePost=function(indx){var post=$scope.posts[indx];autosize(document.querySelectorAll(".editpostbox"));var str=$.trim(post.post_description.replace(/\n\n\n+/g,"\n\n")),htmlstr=str.replace(/\n/g,"<br />"),height=$('<div style="display:block;" id="postedit-hidden-div"></div>').html(htmlstr).appendTo("#post_"+post.post_id).height();$("#editpost_"+post.post_id).css("height",height+"px"),str=$("#postedit-hidden-div").html(str).text(),$("#postedit-hidden-div").remove(),$scope.updateBody[indx]=str,$scope.activeEdit[indx]=!0,$timeout(function(){$("#editpost_"+post.post_id).putCursorAtStart()},200)},$scope.cancelPost=function(indx){$("#postedit-hidden-div").remove(),$scope.updateBody[indx]="",$scope.activeEdit[indx]=!1,$scope.editPostErrorCls[indx]="",$scope.editPostErrorMsg[indx]=""},$scope.removeImage=function(index){var tempImg=$scope.imageSrc[index];$scope.imageSrc.splice(index,1);var item=$scope.uploader.queue[index];item.remove();var formData={};formData.user_id=APP.currentUser.id,formData.media_id=tempImg.media_id,formData.post_id=$scope.tempPostId,formData.session_id=APP.currentUser.id,PostService.deletePostMedia(formData,function(data){101==data.code||($scope.imageSrc[index]=tempImg,$scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.dashboard.postcomment.remove_img_fail,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3))})},$scope.loadMoreFunc="loadMore()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMore()")},!0),$(".fancybox").fancybox()}]).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("MediaController",["$scope","MediaService",function($scope,MediaService){$scope.uploadmedia=function(){var opts={};opts.user_id="",opts.album_id="",opts.form_file="",MediaService.uploadmedia(opts,function(data){101==data.code})},$scope.listmedia=function(){$scope.signupStart=!0;var opts={};opts.user_id="",opts.limit_start="",MediaService.listmedia(opts,function(data){101==data.code})},$scope.deletemedia=function(){$scope.signupStart=!0;var opts={};opts.user_id="",opts.album_id="",MediaService.deletemedia(opts,function(data){101==data.code})},$scope.searchmedia=function(){$scope.signupStart=!0;var opts={};opts.search_text="",opts.user_id="",opts.access_token="",opts.limit_size="",opts.limit_start="",MediaService.searchmedia(opts,function(data){101==data.code})}}]),app.controller("MessageController",["$scope","$rootScope","$interval","$timeout","fileReader","MessageService","saveFriendId","threadAndPass","$routeParams","saveFriendDate","FileUploader",function($scope,$rootScope,$interval,$timeout,fileReader,MessageService,saveFriendId,threadAndPass,$routeParams,saveFriendDate,FileUploader){
$scope.loadUserMessage=!1,$scope.errorMessage="";var oneClicklistMsg=0,oneClickReadMsg=0,oneClickMsgInb=0;$scope.totalUnreadMsg=0,$scope.showMsgSearch=!1,$scope.storeReceiverObj=[],$scope.isNewMessage=!1,$scope.showSetting=!1,$scope.user_id=[],$scope.noMsg=!0,$scope.isAddUser=!1,$scope.storeThreadMembers=[],$scope.body="",$scope.MessageUserid=$routeParams.mid,$scope.response={},$scope.messageInbox=function(){var opts={};$scope.loadUserMessage=!0,opts.user_id=$scope.currentUser.id,opts.limit_start=APP.friend_list_pagination.start,opts.limit_size=APP.friend_list_pagination.end,0==oneClickMsgInb&&(oneClickMsgInb=1,MessageService.listGroupInbox(opts,function(data){101==data.code?(oneClickMsgInb=0,$scope.loadUserMessage=!1,$scope.response=data.data,data.total>0?($scope.storeThreadMembers=data.data[0].thread_members,""==$scope.MessageUserid||void 0==$scope.MessageUserid?($scope.listGroupMessages(data.data[0].thread_id,$scope.storeThreadMembers),$timeout(function(){$("#list-"+data.data[0].thread_id).addClass("active")},500)):$scope.sendFriendMessage()):($scope.newMessageShow(),$scope.noMsg=!0,$scope.listmessage=[])):$scope.loadUserMessage=!1}))},$scope.MessageHide=function(){1==$scope.isGroupThread&&($scope.showSetting=!0),$scope.custom=!1,$scope.noMsg=!1,$scope.emptyMessageError=!1,$scope.createMessageerror="",$scope.isNewMessage=!1,$scope.isJoinGroup=!1},$scope.newMessageShow=function(){1==$scope.isGroupThread&&($scope.showSetting=!1),$scope.isJoinGroup=!1,$scope.user_id=[],$scope.tags=[],$scope.storeReceiverObj=[],$scope.custom=!0,$scope.recipientAddress="",$scope.createMessageerror="",$scope.emptyMessageError=!1,$scope.isNewMessage=!0},$scope.createMessageshow=!1,$scope.createMessage=function(){var opts={};if(opts.session_id=$scope.currentUser.id,1==$scope.isNewMessage||1==$scope.isJoinGroup){if(void 0==$scope.tags||0==$scope.tags.length)return $scope.emptyMessageError=!0,$scope.createMessageerror=$scope.i18n.msg_message.message_create,$timeout(function(){$scope.emptyMessageError=!1},15e3),!1;for(i=0;i<$scope.tags.length;i++)$scope.user_id.push($scope.tags[i].user_id);opts.recipient=$scope.user_id,1==$scope.isJoinGroup?opts.thread_id=$scope.storeThread:opts.thread_id="0"}else opts.recipient=$scope.storeRecipient,opts.thread_id=$scope.storeThread;return void 0!=$scope.myFile&&""!=$scope.myFile||void 0!=$scope.body&&""!=$scope.body?(opts.body=$scope.body,""==$scope.myFile,$scope.createMessageshow=!0,$scope.emptyMessageError=!1,void($scope.sendMessage=MessageService.groupMessageSends(opts,$scope.myFile,function(data){101==data.code?($scope.custom=!1,$scope.createMessageshow=!1,1==$scope.isNewMessage||1==$scope.isAddUser?($scope.messageInbox(),0==$scope.isNewMessage):($scope.listGroupMessages($scope.storeThread,$scope.storeThreadMembers),$scope.listingmsge()),$scope.imageSrc="",$scope.myFile="",$scope.body="",$scope.user_id=[],$scope.tags=[]):($scope.custom=!1,$scope.createMessageshow=!1)}))):($scope.emptyMessageError=!0,$scope.createMessageerror=$scope.i18n.msg_message.message_first,$timeout(function(){$scope.emptyMessageError=!1},15e3),!1)},$scope.listGroupMessages=function(thread_id,threadMembers){$scope.MessageHide();var count=1;$scope.names=[],$scope.storeRecipient=[],$scope.listmessage=[],$scope.storeThreadMembers="",$scope.storeReceiverName=[],$scope.receiverName="",$scope.loadMessage=!0,$scope.showMsgSearch=!1;var opts={};opts.user_id=$scope.currentUser.id,opts.thread_id=thread_id,opts.limit_size=APP.message_list_pagination.end,opts.limit_start=APP.message_list_pagination.start,0==oneClicklistMsg&&(oneClicklistMsg=1,MessageService.listGroupMessages(opts,function(data){if(101==data.code){if(oneClicklistMsg=0,$scope.listmessage=data.data.messages,$scope.storeThread=data.data.group_id,$scope.loadMessage=!1,$scope.expandButton=!1,$scope.memberName=!0,$scope.collapseButton=!0,$scope.storeReceiverObj=threadMembers,$scope.storeThreadMembers=threadMembers,$rootScope.listUnReadMessages(),"group"==data.data.group_type){if($scope.storeRecipient=data.data.recipient,$scope.isGroupThread=!0,$scope.showSetting=!0,1==$scope.storeThreadMembers.length)$scope.storeReceiverName.push($scope.storeThreadMembers[0].first_name+" "+$scope.storeThreadMembers[0].last_name),$scope.receiverName=$scope.storeThreadMembers[0].first_name+" "+$scope.storeThreadMembers[0].last_name;else if(2==$scope.storeThreadMembers.length)$scope.storeReceiverName.push($scope.storeThreadMembers[0].first_name+" "+$scope.storeThreadMembers[0].last_name),$scope.storeReceiverName.push($scope.storeThreadMembers[1].first_name+" "+$scope.storeThreadMembers[1].last_name),$scope.receiverName=$scope.storeThreadMembers[0].first_name+" "+$scope.storeThreadMembers[0].last_name+", ",$scope.receiverName+=$scope.storeThreadMembers[1].first_name+" "+$scope.storeThreadMembers[1].last_name;else if($scope.storeThreadMembers.length>2)for(var i=0;i<$scope.storeThreadMembers.length;i++)$scope.storeReceiverName.push($scope.storeThreadMembers[i].first_name+" "+$scope.storeThreadMembers[i].last_name),$scope.receiverName+=$scope.storeThreadMembers[i].first_name+" "+$scope.storeThreadMembers[i].last_name+", ",count==$scope.storeThreadMembers.length&&($scope.receiverName=$scope.receiverName.replace(/,\s*$/,"")),count+=1}else $scope.storeRecipient=data.data.recipient,$scope.isGroupThread=!1,$scope.showSetting=!1,$scope.storeReceiverName.push($scope.storeThreadMembers[0].first_name+" "+$scope.storeThreadMembers[0].last_name),$scope.receiverName=$scope.storeThreadMembers[0].first_name+" "+$scope.storeThreadMembers[0].last_name;$scope.readMessage(data.data.group_id),$(".messages-onscroll").animate({scrollTop:$(".messages-onscroll")[0].scrollHeight},"fast"),$timeout(function(){$(".scrollable-block li").removeClass("active"),$("#list-"+thread_id).addClass("active")},500)}else $scope.loadMessage=!1}))},$scope.readMessage=function(threadId){var opts={};opts.session_id=$scope.currentUser.id,opts.thread_id=threadId,0==oneClickReadMsg&&(oneClickReadMsg=1,$scope.read=MessageService.readGroupMessages(opts,function(data){101==data.code?($scope.getUnreadMessage(),oneClickReadMsg=0,$("#list-"+threadId).removeClass("bold")):oneClickReadMsg=0}))},$scope.deleteMessage=function(messageId,threadId){var opts={},r=confirm($scope.i18n.msg_message.message_confirm);1==r&&(opts.session_id=$scope.currentUser.id,opts.message_id=messageId,MessageService.deleteGroupMessages(opts,function(data){101==data.code&&($scope.listGroupMessages(threadId,$scope.storeThreadMembers),$scope.listingmsge())}))},$scope.listingmsge=function(){var opts={};$scope.loadUserMessage=!0,opts.user_id=$scope.currentUser.id,opts.limit_start=APP.friend_list_pagination.start,opts.limit_size=APP.friend_list_pagination.end,MessageService.listGroupInbox(opts,function(data){101==data.code&&($scope.loadUserMessage=!1,$scope.response=data.data)})},$("#myTextarea").keydown(function(e){e.ctrlKey&&13==e.keyCode&&$scope.createMessage()}),$scope.edit=!0,$scope.model={},$scope.model.updateBody="",$scope.assignUpdate=function(data){$scope.model.updateBody=data},$scope.updateMessage=function(messageId,threadId){var opts={};opts.session_id=$scope.currentUser.id,opts.message_id=messageId,opts.body=$scope.model.updateBody,""==$scope.model.updateBody?$scope.deleteMessage(messageId,threadId):$scope.update=MessageService.updateMessage(opts,function(data){101==data.code&&($scope.listGroupMessages(threadId,$scope.storeThreadMembers),$scope.edit=!0,$scope.model.updateBody="")})},$scope.freezeRequest=0,$scope.loadMessageUser="false",$scope.loadMoreList=function(){var opts={};opts.user_id=APP.currentUser.id,opts.limit_start=$scope.response.length,opts.limit_size=APP.friend_list_pagination.end,$scope.loadMessageUser="true",0==$scope.freezeRequest&&($scope.freezeRequest=1,MessageService.messageInbox(opts,function(data){100==data.code&&0!=data.total?($scope.freezeRequest=0,$scope.loadMessageUser="false",$scope.response=$scope.response.concat(data.data)):($scope.loadMessageUser="false",$scope.freezeRequest=0)}))},$scope.canLoad=!0,$scope.loadMore=function(threadId){$scope.canLoad=!0,$scope.loadMoremessages(threadId)},$scope.showImage=!1,$scope.loadMoreMessage=!1,$scope.listmessage={},$scope.blockRequest=0,$scope.loadMoremessages=function(threadid){$scope.loadMoreMessage=!0;var opts={};opts.user_id=APP.currentUser.id,opts.thread_id=threadid,opts.limit_start=$scope.listmessage.length,opts.limit_size=APP.message_list_pagination.end-4,0==$scope.blockRequest&&($scope.blockRequest=1,MessageService.listGroupMessages(opts,function(data){100==data.code&&data.data.messages.length>0?($scope.blockRequest=0,$scope.loadMoreMessage=!1,$scope.userid=APP.currentUser.id,$scope.listmessage=$scope.listmessage.concat(data.data.messages),stop=$interval(function(){$(".load-more-onscroll").scrollTop(10)},1e3,2)):($scope.loadMoreMessage=!1,$scope.blockRequest=0)}))},$scope.names=[],$scope.cancelRequest=0,$scope.noData=!1,$scope.WaitFriendList=!1,$scope.listFriend=function(){$scope.cancelRequest=0,$scope.WaitFriendList=!0,$scope.names=[];var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.recipientAddress,opts.session_id=APP.currentUser.id,opts.limit_size=APP.friend_list_pagination.end,opts.limit_start=APP.friend_list_pagination.start,MessageService.searchFriends(opts,function(data){$scope.WaitFriendList=!1,0==$scope.cancelRequest?($scope.names.splice(0,10),101==data.code?(angular.forEach(data.data.users,function(user){$scope.names.push(user),$scope.noData=!1}),"0"==data.data.count&&($scope.noData=!0)):$scope.noData=!1):$scope.listfriend=[]})},$scope.recipientAddress="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#searchfrnd").keydown(function(){var model=$scope.recipientAddress;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){model.length>1?$scope.listFriend():($scope.noData=!1,$scope.names=[])},DELAY_TIME_BEFORE_POSTING)}),$scope.searchUserThread=function(){var opts={};$scope.noResult=!1,opts.user_id=APP.currentUser.id,opts.firstname=$scope.nameSearch,$scope.loadUserMessage=!0,opts.limit_start=APP.message_list_pagination.start,opts.limit_size=APP.message_list_pagination.end,""==$scope.nameSearch?($scope.noResult=!1,$scope.messageInbox()):MessageService.searchUserThread(opts,function(data){100==data.code&&($scope.loadUserMessage=!1,$scope.response=data.data,$scope.noResult=!1,0==data.total&&($scope.noResult=!0))})},$scope.nameSearch="";var DELAY_TIME_BEFORE_POSTING_SEARCH=300;$("#searchuser").keydown(function(){var model=$scope.nameSearch;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){model.length>1?$scope.searchUserThread():($scope.messageInbox(),$scope.noResult=!1)},DELAY_TIME_BEFORE_POSTING_SEARCH)}),$scope.clearList=function(){stop=$interval(function(){$scope.cancelRequest=1,$scope.names=[]},200,1)},$scope.tags=[],$scope.selectFriend=function(name){$scope.names=[],$scope.recipientAddress=name.user_info.first_name+" "+name.user_info.last_name,$scope.seen=!0;for(var i=0;i<$scope.tags.length;i++)$scope.tags[i].user_id==name.user_info.id&&($scope.seen=!1);1==$scope.seen&&$scope.tags.push({recipient:$scope.recipientAddress,user_id:name.user_id}),$scope.recipientAddress=""},$scope.remove=function(idx){var tempTag=$scope.tags[idx];if(1==$scope.isJoinGroup){var opts={};opts.session_id=APP.currentUser.id,opts.deleted_user_id=tempTag.user_id,opts.thread_id=$scope.storeThread,MessageService.removeGroupUsers(opts,function(data){101==data.code&&($scope.getUnreadMessage(),$scope.tags.splice(idx,1))})}else $scope.tags.splice(idx,1)},$scope.expandButton=!1,$scope.collapseButton=!0,$scope.memberName=!0,$scope.hideFirstButton=function(){$scope.memberName=!0,$scope.expandButton=!1,$scope.collapseButton=!0},$scope.hideSecondButton=function(){$scope.memberName=!1,$scope.expandButton=!0,$scope.collapseButton=!1},$scope.getUnreadMessage=function(){var opts={};opts.user_id=APP.currentUser.id,opts.limit_size=APP.friend_list_pagination.end,opts.limit_start=APP.friend_list_pagination.start,opts.is_view=1,MessageService.listGroupUnreadMessages(opts,function(data){101==data.code&&data.total>0?$scope.totalUnreadMsg=data.total:$scope.totalUnreadMsg=0})},$scope.removeGroupUsers=function(threadId){var r=confirm($scope.i18n.msg_message.message_confirm);if(1==r){var opts={};opts.session_id=APP.currentUser.id,opts.deleted_user_id=APP.currentUser.id,opts.thread_id=threadId,MessageService.removeGroupUsers(opts,function(data){101==data.code&&($scope.getUnreadMessage(),$scope.receiverName="",$scope.tags=[],$scope.messageInbox(""),$scope.storeReceiverName=[])})}},$scope.addUserGroup=function(threadId){$scope.tags=[],$scope.custom=!0,$scope.isAddUser=!0;var recipienName="";if($scope.recipientAddress="",$scope.createMessageerror="",$scope.emptyMessageError=!1,$scope.fileuperror=!1,$scope.uploadfileerror="",0!=$scope.storeReceiverObj.length&&void 0!=$scope.storeReceiverObj)for(i=0;i<$scope.storeReceiverObj.length;i++)recipienName=$scope.storeReceiverObj[i].first_name+" "+$scope.storeReceiverObj[i].last_name,$scope.tags.push({recipient:recipienName,user_id:$scope.storeReceiverObj[i].id});$scope.isJoinGroup=!0,$scope.storeThread=threadId},$scope.loadSearch=!1,$scope.noSearch=!1,$scope.searchMessage=function(){var opts={};$scope.loadSearch=!0,opts.user_id=APP.currentUser.id,opts.thread_id=$scope.storeThread,opts.keyword=$scope.resultMsg,MessageService.searchThreadMessages(opts,function(data){100==data.code&&($scope.loadMessage=!1,$scope.loadSearch=!1,$scope.noSearch=!0,$scope.listmessage=data.data.messages,$scope.nouserSearch=data.total)})},$scope.openSearchBox=function(){$scope.showMsgSearch=!0,$("#searchMsg").val(""),$scope.noSearch=!1};var DELAY_TIME_BEFORE_POSTING_THREAD=300,currentTimeout=null;$("#searchMsg").keydown(function(){var model=$scope.resultMsg;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){model.length>1?$scope.searchMessage():$scope.listGroupMessages($scope.storeThread,$scope.storeThreadMembers)},DELAY_TIME_BEFORE_POSTING_THREAD)}),$scope.cancelSearch=function(){$scope.cancelRequest=1,$scope.listmessage=[],$scope.loadMessage=!1,$scope.showMsgSearch=!1,$scope.listGroupMessages($scope.storeThread,$scope.storeThreadMembers)},$scope.myFile="",$scope.imageSrc="",$scope.getFile=function(){$scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType&&"GIF"!=imageType&&"PNG"!=imageType&&"JPG"!=imageType&&"JPEG"!=imageType?($scope.uploadfileerror=$scope.i18n.msg_directive.upload_media_file,$scope.msgUploadError=!0,$scope.imageSrc="",$scope.myFile="",$scope.fileuperror=!0,$scope.deleteImage=!1,$timeout(function(){$scope.fileuperror=!1,$scope.msgUploadError=!1},2e3)):($scope.uploadfileerror="",$scope.msgUploadError=!1,$scope.imageSrc=result,$scope.fileuperror=!1,$scope.deleteImage=!0)})},$scope.removeImage=function(){$scope.imageSrc="",$scope.myFile="",$scope.deleteImage=!1},$scope.sendFriendMessage=function(){if(""!=$scope.MessageUserid&&void 0!=$scope.MessageUserid){var frind=saveFriendDate.getFriendIdObject();if(frind&&void 0!=frind.user_id){$scope.newMessageShow();var friendAddress=frind.user_info.first_name+" "+frind.user_info.last_name;$scope.tags.push({recipient:friendAddress,user_id:parseInt(frind.user_id)}),$scope.MessageUserid=void 0}}}}]),app.controller("ModalController",["$scope","$modalInstance",function($scope,$modalInstance){$scope.$on("closeModal",function(){$modalInstance.dismiss("cancel")}),$scope.closeModal=function(){$modalInstance.dismiss("cancel")},$scope.averageRating=function(rating){return void 0!=rating?new Array(Math.ceil(rating)):void 0},$scope.blankStar=function(rating){return void 0!=rating?5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0:void 0}}]),app.controller("NotificationController",["$scope","NotificationService",function($scope,NotificationService){$scope.sendEmailNotification=function(){var formData={};formData.message_type="Friend Request",formData.from="abhinav.nehra@daffodilsw.com",formData.to="vidhi.srivastava@daffodilsw.com",formData.mail_subject="edit by post man",formData.notification_type="Email",formData.message="send from vidhi daffodil to vidhi123",formData.sender_userid=21,formData.receiver_userid=39,$scope.response=NotificationService.sendEmailNotification(formData,function(data){console.log(101==data.code?"success":"failure")})},$scope.getEmailNotification=function(){var formData={};formData.notification_type="Email",formData.receiver_userid=39,formData.limit_start=0,formData.limit_size=20,$scope.response=NotificationService.getEmailNotification(formData,function(data){console.log(101==data.code?"success":"failure")})},$scope.readUnreadEmailNotifications=function(){var formData={};formData.notification_type="Email",formData.message_id="",formData.session_id=APP.currentUser.id,formData.read_value="",$scope.response=NotificationService.readUnreadEmailNotifications(formData,function(data){console.log(101==data.code?"success":"failure")})},$scope.deleteEmailNotifications=function(){var formData={};formData.notification_type="Email",formData.message_id="53d8b2088fd8cd98dd8b4567",formData.session_id=APP.currentUser.id,$scope.response=NotificationService.deleteEmailNotifications(formData,function(data){console.log(101==data.code?"success":"failure")})},$scope.searchEmailNotifications=function(){var formData={};formData.notification_type="Email",formData.search_text="send",formData.receiver_userid=39,formData.limit_start=0,formData.limit_size=4,$scope.response=NotificationService.searchEmailNotifications(formData,function(data){console.log(101==data.code?"success":"failure")})}}]),app.controller("CardController",["$scope","OfferService","$routeParams","StoreService","$timeout","$cookieStore","ProfileService",function($scope,OfferService,$routeParams,StoreService,$timeout,$cookieStore,ProfileService){var map,geocoder;geocoder=new google.maps.Geocoder;var markers=[];$scope.latitute=41.9,$scope.longitude=12.4833,$scope.Default_lat=41.9,$scope.Default_long=12.4833,$scope.Shopid_loc=[],$scope.selectedRange=50,$scope.gridActive="",$scope.listActive="active",$scope.locationSearch=!1,$scope.filterme="",$scope.orderBy="",$scope.firstPage=10,$scope.itemsPerPage=10,$scope.currentPage=1,$scope.totalItems=0,$scope.range=[],$scope.offerlodar=!0,$scope.noResultFound=!1,$scope.offerlistingObject=[],$scope.citizenIncome=0,$scope.shop_id=[],$scope.map_pins=[],$scope.frcount=[],$scope.friendlist=[],$scope.categories=[],$scope.sortby="_id",$scope.nofndlist=!1,$scope.currentLanguage=$cookieStore.get("activeLanguage"),$scope.searchResult=!1,$scope.iscomingSoon=!1,$scope.collection="sixc_offers";var openedInfoWindow=null;$scope.format=function(n,currency){return n=Number(n),currency+""+n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")},$scope.getstorecredit=function(storeId){var today=new Date,dd=today.getDate(),mm=today.getMonth(),yr=today.getFullYear(),date=new Date(yr,mm,dd),opts={"function":"UtilityService.shopWiseCitizenIncome",parameters:[{shop_id:[storeId],citizen_id:String(APP.currentUser.id),date:String(date.toISOString())}]};StoreService.getstorecredit(opts,function(data){void 0===data.response||""===data.response||0===data.response.length||$(".ca-html").html($scope.format(data.response[0].total_credit,"€"))})},$scope.initializeMap=function(){var centerLatLng=new google.maps.LatLng($scope.latitute,$scope.longitude),input=document.getElementById("pac-input"),mapProp={center:centerLatLng,zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),mapProp);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var searchBox=new google.maps.places.SearchBox(input);google.maps.event.addListener(searchBox,"places_changed",function(){var address=document.getElementById("pac-input").value;geocoder.geocode({address:address},function(results,status){status===google.maps.GeocoderStatus.OK&&($scope.locationSearch=!0,$scope.latitute=results[0].geometry.location.lat(),$scope.longitude=results[0].geometry.location.lng(),$scope.geolocation())})}),google.maps.event.addListener(map,"click",function(e){var geocoder=new google.maps.Geocoder;geocoder.geocode({latLng:e.latLng},function(results,status){if(status===google.maps.GeocoderStatus.OK){var placeName=results[0].formatted_address;document.getElementById("pac-input").value=placeName}}),$scope.locationSearch=!0,$scope.latitute=e.latLng.lat(),$scope.longitude=e.latLng.lng(),$scope.geolocation()}),markers=[],$scope.map_pins.forEach(function(data){if(void 0!=data.latitude&&void 0!=data.longitude){var markerpos=new google.maps.LatLng(data.latitude,data.longitude),marker=new google.maps.Marker({position:markerpos,map:map});markers.push(marker);for(var votestructure="",num=parseFloat(data.vote).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'></li>":num>=k+.6?"<li class='active'></li>":"<li></li>";var pic="<img src='app/assets/images/store-prod.jpg'>";""!==data.pic&&(pic="<img src='"+data.pic+"'>");var mapfrndcount="<img src='app/assets/images/group-count.png'><span class='number map-frnd-count-number'>0</span>",infowindow=new google.maps.InfoWindow,content="<div class='offermapinfo-block'><div class='pic-container'>"+pic+"</div><div class='description'><div class='map-frnd-count'>"+mapfrndcount+"</div><div class='offer-map-heading'><a href='#/shop/view/"+data.id+"'>"+data.name+"</a></div><div><div class='vote-count'><ul>"+votestructure+"</ul></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span class='ca-html'>0€</span></div><div class='categories'>"+data.cat+"</div></div>";google.maps.event.addListener(marker,"click",function(marker,content){return function(){null!=openedInfoWindow&&openedInfoWindow.close(),$scope.getstorecredit(data.id),$scope.frindBoughtCount(data.id),infowindow.setContent(content),infowindow.open(map,marker),openedInfoWindow=infowindow,google.maps.event.addListener(infowindow,"closeclick",function(){openedInfoWindow=null})}}(marker,content))}})},navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(position){$scope.latitute=position.coords.latitude,$scope.longitude=position.coords.longitude,$scope.Default_lat=position.coords.latitude,$scope.Default_long=position.coords.longitude,$scope.initializeMap()},function(){}),"1"===$routeParams.id?void 0!=$scope.i18n.left_menu?$scope.offerDropdownVal=$scope.i18n.left_menu.offer_card:$scope.offerDropdownVal="Shopping card":("3"===$routeParams.id&&($scope.filterme="selected",$scope.collection="sixc_citizen_offers"),void 0!=$scope.i18n.left_menu?$scope.offerDropdownVal=$scope.i18n.left_menu.offer_coupons:$scope.offerDropdownVal="Coupons"),$scope.offerDropdown=["Shopping card","Coupons","Promotions E-commerce"],$scope.ConvertCategory=function(id){var cat="";return $scope.categories.forEach(function(Item){String(Item.id)===id&&(cat=Item.category_name)}),cat},$scope.fireSearch=function(event){13===event.which&&$scope.getlistingData($scope.itemsPerPage)},$scope.removepins=function(){for(var i=0;i<markers.length;i++)markers[i].setMap(null)},$scope.searchCategory=function(currentLanguage){$scope.categories=[];var opts={};opts.lang_code=currentLanguage,opts.session_id=APP.currentUser.id,ProfileService.searchCatagory(opts,function(data){101===data.code&&"SUCCESS"===data.message&&data.data.length>0&&$timeout(function(){$scope.$apply(function(){$scope.categories=data.data})},0)})},$scope.$watch("currentLanguage",function(newValue,oldValue){$scope.searchCategory(newValue)}),$scope.changeCat=function(){$scope.getlistingData($scope.itemsPerPage)},$scope.OfferChange=function(){$scope.offerDropdownVal===$scope.i18n.offer_shoppingcard.promotion?($scope.iscomingSoon=!0,$scope.offerlistingObject=[],$scope.range=[],$scope.noResultFound=!1,$scope.removepins()):($scope.iscomingSoon=!1,$scope.offerDropdownVal===$scope.i18n.left_menu.offer_card?($scope.Offercard="selected",$scope.Offercoupon="",$scope.offer_id="551ce49e2aa8f00f20d93295",$scope.offer_type="Card"):($scope.Offercard="",$scope.Offercoupon="selected",$scope.offer_id="551ce49e2aa8f00f20d9328f",$scope.offer_type="Coupon"),$scope.getlistingData($scope.itemsPerPage))},$scope.frindBoughtCount=function(id){var opts={};opts=void 0===id?{"function":"UtilityService.friendsShoppingCount",parameters:[{asArray:!0,shop_id:$scope.shop_id,citizen_id:String(APP.currentUser.id)}]}:{"function":"UtilityService.friendsShoppingCount",parameters:[{asArray:!0,shop_id:[String(id)],citizen_id:String(APP.currentUser.id)}]},StoreService.frindboughtcount(opts,function(data){void 0===data.response||""===data.response?$scope.frcount=[]:void 0===id?$timeout(function(){$scope.$apply(function(){$scope.frcount=data.response})},0):$(".map-frnd-count-number").html(data.response[0].count)})},$scope.getfrndlist=function(event,shopid){if($scope.friendlist=[],$scope.nofndlist=!1,$(event.target).nextAll("ul.friend-list:first").is(":visible"))$(event.target).nextAll("ul.friend-list:first").hide();else{$scope.frndlistloader=!0,$(event.target).nextAll("ul.friend-list:first").show();var formData={};formData.user_id=APP.currentUser.id,formData.shop_id=shopid,$scope.friendlist=[],StoreService.getfriendboughtonstores(formData,function(data){$scope.frndlistloader=!1,101===data.code&&void 0!=data.data.friends&&data.data.friends.length>0?($scope.nofndlist=!1,$scope.friendlist=data.data.friends):$scope.nofndlist=!0})}},$scope.getcount=function(itemsPerPage){var opt={};opt.$collection=$scope.collection;var filter={};if(filter.offer_type=$scope.offer_id,filter.start_date={$lte:"$$CurrentDate"},filter.end_date={$gte:"$$CurrentDate"},$scope.Shopid_loc.length>0){var shopfilter={};shopfilter.$in=$scope.Shopid_loc,filter.shop_id=shopfilter}""!==$scope.searchText&&void 0!=$scope.searchText&&(filter.$text={$search:$scope.searchText}),void 0!=$scope.selectedcat&&(filter["shop_id.category_id"]=String($scope.selectedcat.id)),opt.$filter=filter,opt.$group={count:{$sum:1},_id:null},OfferService.getApplaneData(opt,function(data){if("ok"===data.status&&200===data.code&&data.response.result.length>0){$scope.totalItems=Math.ceil(data.response.result[0].count/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}})},$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.getlistingData($scope.itemsPerPage)},$scope.calculateprice=function(val,dis){var halfprice=val/2,obc={};return obc.price_purchase=val-val*dis/100,obc.price_sixth=halfprice,$scope.citizenIncome<halfprice&&(obc.price_sixth=$scope.citizenIncome),obc.onlyForYou=obc.price_purchase-obc.price_sixth,obc},$scope.getCitizenIncome=function(){var opts={};opts.$collection="sixc_bucks",opts.$filter={citizen_id:String(APP.currentUser.id)},opts.$group={_id:null,amount:{$sum:"$amount"},debit:{$sum:"$debit"},credit:{$sum:"$credit"}},OfferService.getApplaneData(opts,function(data){"ok"===data.status&&200===data.code&&data.response.result.length>0&&null!=data.response.result[0].amount&&($scope.citizenIncome=data.response.result[0].amount)})},$scope.getCitizenIncome(),$scope.getlistingData=function(itemsPerPage){void 0!=$scope.i18n.left_menu&&($scope.offerDropdown=[$scope.i18n.left_menu.offer_card,$scope.i18n.left_menu.offer_coupons,$scope.i18n.offer_shoppingcard.promotion]);var option={};option.$collection=$scope.collection,$scope.range=[],$scope.shop_id=[],$scope.noResultFound=!1,$scope.removepins(),$scope.offerlodar=!0,$scope.offerlistingObject=[];var limit_start=($scope.currentPage-1)*itemsPerPage,filter={};if(filter.offer_type=$scope.offer_id,$scope.Shopid_loc.length>0){var shopfilter={};shopfilter.$in=$scope.Shopid_loc,filter.shop_id=shopfilter}void 0!=$scope.selectedcat&&(filter["shop_id.category_id"]=String($scope.selectedcat.id)),""!==$scope.searchText&&void 0!=$scope.searchText&&(filter.$text={$search:$scope.searchText}),filter.start_date={$lte:"$$CurrentDate"},filter.end_date={$gte:"$$CurrentDate"};var sort={};if(sort[$scope.sortby]=-1,option.$sort=sort,option.$limit=itemsPerPage,option.$skip=limit_start,option.$filter=filter,"sixc_citizen_offers"===$scope.collection){var myofferopts={};myofferopts={"function":"SixcServices.offerForMe",parameters:[{citizen_id:String(APP.currentUser.id),count:!0,$filter:filter,$sort:sort,$limit:itemsPerPage,$skip:limit_start}]},OfferService.getApplaneInvoke(myofferopts,function(data){if($scope.offerlodar=!1,void 0===data.response||""===data.response)$scope.noResultFound=!0,$scope.initializeMap();else if(0===data.response.myOffer.result.length)$scope.noResultFound=!0,$scope.initializeMap();else{$scope.noResultFound=!1,$scope.offerlistingObject=data.response.myOffer.result,$scope.offerlistingObject.forEach(function(val,index){$scope.shop_id.push(val.shop_id._id);var pin={};pin.longitude=val.shop_id.longitude,pin.latitude=val.shop_id.latitude,pin.id=val.shop_id._id,pin.name=val.shop_id.name,void 0!=val.shop_id.average_anonymous_rating?pin.vote=val.shop_id.average_anonymous_rating:pin.vote=0,void 0!=val.shop_id.shop_thumbnail_img?pin.pic=val.shop_id.shop_thumbnail_img:pin.pic="",void 0!=val.shop_id.category_id?pin.cat=$scope.ConvertCategory(val.shop_id.category_id._id):pin.cat="",$scope.map_pins.push(pin)}),$scope.initializeMap(),$scope.frindBoughtCount(),$scope.totalItems=Math.ceil(data.response.myOfferCount.result/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}})}else OfferService.getApplaneData(option,function(data){$scope.offerlodar=!1,"ok"===data.status&&200===data.code&&data.response.result.length>0?($scope.noResultFound=!1,$scope.offerlistingObject=data.response.result,$scope.offerlistingObject.forEach(function(val,index){$scope.shop_id.push(val.shop_id._id);var pin={};pin.longitude=val.shop_id.longitude,pin.latitude=val.shop_id.latitude,pin.id=val.shop_id._id,pin.name=val.shop_id.name,void 0!=val.shop_id.average_anonymous_rating?pin.vote=val.shop_id.average_anonymous_rating:pin.vote=0,void 0!=val.shop_id.shop_thumbnail_img?pin.pic=val.shop_id.shop_thumbnail_img:pin.pic="",void 0!=val.shop_id.category_id?pin.cat=$scope.ConvertCategory(val.shop_id.category_id._id):pin.cat="",$scope.map_pins.push(pin)}),$scope.initializeMap(),$scope.frindBoughtCount(),$scope.getcount(itemsPerPage)):($scope.initializeMap(),$scope.noResultFound=!0)})},$scope.geolocation=function(){$scope.Shopid_loc=[];var opts={};opts.longitude=$scope.longitude,opts.latitute=$scope.latitute,opts.radius=$scope.selectedRange,opts.session_id=APP.currentUser.id,OfferService.searchstoreondimensions(opts,function(data){101===data.code&&"SUCCESS"===data.message&&data.data.stores.forEach(function(rsl){$scope.Shopid_loc.push(rsl.id)}),$scope.locationSearch===!1&&($scope.Shopid_loc=[]),$scope.OfferChange()})},$scope.search=function(search){},$scope.searchMapText=function(){""===$scope.searchMap&&($scope.locationSearch=!1,$scope.latitute=$scope.Default_lat,$scope.longitude=$scope.Default_long,$scope.geolocation())},$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.filterChange=function(){"selected"===$scope.filterme?($scope.filterme="",$scope.collection="sixc_offers"):($scope.filterme="selected",$scope.collection="sixc_citizen_offers"),$scope.getlistingData($scope.itemsPerPage)},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.getlistingData($scope.itemsPerPage)},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.getlistingData($scope.itemsPerPage)},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.getlistingData($scope.itemsPerPage)},$scope.paginate=function(){$scope.currentPage=1},$scope.nextPageDisabled=function(){
return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.$watch("selectedRange",function(value){$scope.selectedRange=value,$scope.geolocation()}),$scope.buyCoupon=function(index,id){$scope["buyCouponbtn"+index]=1,$scope["buyCouponloder"+index]=!0;var opts={};opts={"function":"ApplyCouponBL.applyCoupon",parameters:[{offer_id:String(id),citizen_id:String(APP.currentUser.id)}]},OfferService.getApplaneInvoke(opts,function(data){void 0===data.response||""===data.response?$scope["buyCouponErr"+index]=!0:"ok"===data.status&&200===data.code?$scope["buyCouponSuccess"+index]=!0:"Coupon is already purchased"===data.response?$scope["buyCouponalready"+index]=!0:$scope["buyCouponErr"+index]=!0,$scope["buyCouponloder"+index]=!1,$timeout(function(){$scope["buyCouponbtn"+index]=0,$scope["buyCouponloder"+index]=!1,$scope["buyCouponSuccess"+index]=!1,$scope["buyCouponErr"+index]=!1,$scope["buyCouponalready"+index]=!1},8e3)})},$scope.Sorting=function(type){$scope.sortby=type,$scope.getlistingData($scope.itemsPerPage)}}]),app.controller("CardDetailsController",["$scope","$timeout","$routeParams","OfferService","StoreService","$modal","$location","$window",function($scope,$timeout,$routeParams,OfferService,StoreService,$modal,$location,$window){var map,IMAGE_WIDTH=405,colorArray=["#0b7eba","#cccbca","#ffce30"];$scope.offer_id=$routeParams.id,$scope.reviews=[],$scope.totalreview=0,$scope.reviewRes=1,$scope.isLoading=!0,$scope.textLimit=200,$scope.loadMoreFunc="loadMore()",$scope.friendsId=[],$scope.frndlistshow=!0,$scope.storeId,$scope.cardData,$scope.citizenIncome=0,$scope.PieChartData=[],$scope.galleryData=[],$scope.Imageselected,$scope.price_sixth=0,$scope.price_purchase=0,$scope.onlyForYou=0,$scope.nofndlist=!1,$scope.FrndArray=[],$scope.vote=0,$scope.pic="",$scope.format=function(n,currency){return n=Number(n),currency+""+n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")},$scope.getCitizenIncome=function(){var opts={};opts.$collection="sixc_bucks",opts.$filter={citizen_id:String(APP.currentUser.id)},opts.$group={_id:null,amount:{$sum:"$amount"},debit:{$sum:"$debit"},credit:{$sum:"$credit"}},OfferService.getApplaneData(opts,function(data){"ok"===data.status&&200===data.code&&data.response.result.length>0&&null!=data.response.result[0].amount&&($scope.citizenIncome=data.response.result[0].amount)})},$scope.getCitizenIncome(),$scope.calculateprice=function(val,dis){var halfprice=val/2,discount=val*dis/100;$timeout(function(){$scope.$apply(function(){$scope.price_sixth=halfprice,$scope.price_purchase=val-val*dis/100,$scope.citizenIncome<halfprice&&($scope.price_sixth=$scope.citizenIncome),$scope.onlyForYou=$scope.price_purchase-$scope.price_sixth,$scope.onlyForYou=Math.round(100*$scope.onlyForYou)/100,$scope.PieChartData=[{key:$scope.i18n.offer_shoppingcard.price_for_me,y:Math.round(100*$scope.onlyForYou)/100},{key:$scope.i18n.offer_shoppingcard.price_discount,y:Math.round(100*discount)/100},{key:$scope.i18n.offer_shoppingcard.price_app_cont,y:Math.round(100*$scope.price_sixth)/100}]})},500)},$scope.frindBoughtCount=function(id){console.log(id);var opts={};opts=void 0===id?{"function":"UtilityService.friendsShoppingCount",parameters:[{asArray:!0,shop_id:[String($scope.storeId)],citizen_id:String(APP.currentUser.id)}]}:{"function":"UtilityService.friendsShoppingCount",parameters:[{asArray:!0,shop_id:[String(id)],citizen_id:String(APP.currentUser.id)}]},StoreService.frindboughtcount(opts,function(data){void 0===data.response||""===data.response?$scope.frcount=[]:void 0===id?$timeout(function(){$scope.$apply(function(){$scope.frcount=data.response})},0):$(".map-frnd-count-number").html(data.response[0].count)})};var option={};option.$collection="sixc_offers",$scope.getData=function(itemsPerPage){$scope.cardData=[],$scope.noResultFound=!1;var filter=(($scope.currentPage-1)*itemsPerPage,{});filter._id=$scope.offer_id,option.$filter=filter,OfferService.getApplaneData(option,function(data){$scope.offerlodar=!1,"ok"===data.status&&200===data.code&&data.response.result.length>0?($scope.noResultFound=!1,$scope.cardData=data.response.result[0],void 0!=$scope.cardData.shop_id.average_anonymous_rating&&($scope.vote=$scope.cardData.shop_id.average_anonymous_rating),void 0!=$scope.cardData.shop_id.shop_thumbnail_img&&($scope.pic=$scope.cardData.shop_id.shop_thumbnail_img),$scope.storeId=$scope.cardData.shop_id._id,$scope.storename=$scope.cardData.shop_id.name,$scope.getreviews($scope.storeId),$scope.frindBoughtCount(),$scope.searchFriend($scope.storeId),$scope.calculateprice($scope.cardData.value,$scope.cardData.discount),$scope.initializeMap($scope.cardData.shop_id.longitude,$scope.cardData.shop_id.latitude),$scope.galleryData=$scope.cardData.imageurl.split(","),$scope.Imageselected=$scope.galleryData[0]):$scope.noResultFound=!0})},$scope.getData(),$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,$scope.creater=creater_info;var modalInstance=$modal.open({template:'<div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a href ng-click="viewFriendProile(friend.id)">{{friend.first_name}} {{friend.last_name}}</a></span></li></ul></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.getreviews=function(shopid){var limit_start=$scope.reviews.length,opts={};opts.store_id=shopid,opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=5,$scope.FrndArray.length>0&&(opts.friends_ids=$scope.FrndArray),($scope.totalreview>limit_start||0==$scope.totalreview)&&1==$scope.reviewRes&&($scope.reviewRes=0,$scope.isLoading=!0,StoreService.listcustomersreviews(opts,function(data){if($scope.isLoading=!1,"101"===data.code){$scope.isLoading=!1;var items=data.data;void 0!=items&&($scope.reviews=$scope.reviews.concat(items)),$scope.totalreview=data.count}0===$scope.reviews.length&&($scope.noContent=!0),$scope.reviewRes=1}))},$scope.frndVal=function(id){$scope.FrndArray=[],"all"===id||$scope.FrndArray.push(String(id)),$scope.totalreview=0,1==$scope.reviewRes,$scope.reviews=[],$scope.getreviews($scope.storeId)},$scope.showmoredesc=function(index,event){$(event.target).hide(),$(".full-desc"+index).show(),$(".limit-desc"+index).hide()},$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMore()")},!0),$scope.loadMore=function(){$scope.reviews.length>0&&$scope.getreviews($scope.storeId)},$scope.searchFriend=function(frndId){$scope.nofndlist=!1;var opt={};opt.user_id=APP.currentUser.id,opt.shop_id=frndId,StoreService.getfriendboughtonstores(opt,function(data){101===data.code&&void 0!=data.data.friends&&data.data.friends.length>0?$scope.friendlist=data.data.friends:$scope.nofndlist=!0})},$scope.scrollTo=function(image,ind,element){$(".thumbnailanchor").removeClass("active"),$(element.target).parent().addClass("active"),$scope.listposition={left:IMAGE_WIDTH*ind*-1+"px"},$scope.Imageselected=image},$scope.xFunction=function(){return function(d){return d.key}},$scope.yFunction=function(){return function(d){return d.y}},$scope.descriptionFunction=function(){return function(d){return d.key}},$scope.colorFunction=function(){return function(d,i){return colorArray[i]}},$scope.buycard=function(val,dis){$scope.buyclass="disabled",$scope.buylodar=!0;var opts={};opts.session_id=String(APP.currentUser.id),opts.shop_id=String($scope.storeId),opts.offer_id=String($scope.offer_id),opts.total_value=val,opts.discount=dis,opts.cancel_url=APP.payment.siteDomain+"#/buycard_cancel",opts.return_url=APP.payment.siteDomain+"#/buycard_success",OfferService.buyshoppingcard(opts,function(data){101===data.code&&"SUCCESS"===data.message?$window.location.href=data.data.link:($scope.buyerror=!0,$scope.buyclass="",$scope.buylodar=!1),$timeout(function(){$scope.buyerror=!1,$scope.buyclass="",$scope.buylodar=!1},8e3)})},$scope.getstorecredit=function(storeId){var today=new Date,dd=today.getDate(),mm=today.getMonth(),yr=today.getFullYear(),date=new Date(yr,mm,dd),opts={"function":"UtilityService.shopWiseCitizenIncome",parameters:[{shop_id:[storeId],citizen_id:String(APP.currentUser.id),date:String(date.toISOString())}]};StoreService.getstorecredit(opts,function(data){void 0===data.response||""===data.response||0===data.response.length||$(".ca-html").html($scope.format(data.response[0].total_credit,"€"))})},$scope.initializeMap=function(longitude,latitude){var centerLatLng=new google.maps.LatLng(latitude,longitude),mapProp={center:centerLatLng,zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),mapProp);var markers=[],markerpos=new google.maps.LatLng(latitude,longitude),marker=new google.maps.Marker({position:markerpos,map:map});markers.push(marker);for(var votestructure="",num=parseFloat($scope.vote).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'></li>":num>=k+.6?"<li class='active'></li>":"<li></li>";var pic="<img src='app/assets/images/store-prod.jpg'>";""!==$scope.pic&&(pic="<img src='"+$scope.pic+"'>");var mapfrndcount="<img src='app/assets/images/group-count.png'><span class='number map-frnd-count-number'>0</span>",infowindow=new google.maps.InfoWindow,content="<div class='offermapinfo-block'><div class='pic-container'>"+pic+"</div><div class='description'><div class='map-frnd-count'>"+mapfrndcount+"</div><div class='offer-map-heading'><a href='#/shop/view/"+$scope.storeId+"'>"+$scope.storename+"</a></div><div><div class='vote-count'><ul>"+votestructure+"</ul></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span class='ca-html'>0€</span></div></div>",infowindow=new google.maps.InfoWindow;google.maps.event.addListener(marker,"click",function(marker,content){return function(){$scope.getstorecredit($scope.storeId),$scope.frindBoughtCount($scope.storeId),infowindow.setContent(content),infowindow.open(map,marker)}}(marker,content))},$timeout(function(){$("#scroll-pane").perfectScrollbar("update")},2e3),$("#scroll-pane").perfectScrollbar()}]),app.controller("BuyCardController",["$scope","OfferService","$routeParams","$location",function($scope,OfferService,$routeParams,$location){$scope.sendresponse=function(){var opts={};opts.session_id=String(APP.currentUser.id),opts.shop_id=String($scope.shop_id),opts.transaction_id=$scope.transaction_id,opts.type=$scope.success_type,OfferService.responsebuycards(opts,function(data){})},$scope.isLoading=!0;var searchObject=$location.search();$scope.success_type="SUCCESS",void 0!=searchObject.transaction_id&&void 0!=searchObject.shop_id?($scope.transaction_id=searchObject.transaction_id,$scope.shop_id=searchObject.shop_id,$scope.isLoading=!1,"/buycard_cancel"===$location.path().trim()?($scope.message="error",$scope.success_type="CANCELED"):$scope.message="success",$scope.sendresponse()):$location.path("/")}]),app.controller("ProfileController",["$cookieStore","$rootScope","$scope","$http","$location","$timeout","$interval","$routeParams","$modal","$log","UserService","ProfileService","fileReader","threadAndPass",function($cookieStore,$rootScope,$scope,$http,$location,$timeout,$interval,$routeParams,$modal,$log,UserService,ProfileService,fileReader,threadAndPass){$(".nav li").removeClass("active"),$(".home").addClass("active"),$(".nav li").click(function(){$(".nav li").removeClass("active"),$(this).addClass("active")}),$(".dropdown-menu li").click(function(){$(".nav li").removeClass("active")}),$scope.editUser={},$scope.renderProfile=!1,$scope.friendProfile=!1,$scope.requestSend=!0,$scope.alreadtSend=!0,$scope.broker=0,$scope.userDetails="",$scope.getUserProfile=function(profileType){var opts={};$scope.editMessage="",opts.user_id=APP.currentUser.id,opts.profile_type=profileType,ProfileService.getProfile(opts,function(data){$scope.userDetails=data.data,$scope.renderProfile=!0})},$scope.deleteProfile=function(){var opts={};opts.user_id=APP.currentUser.id,ProfileService.deleteProfile(opts,function(data){})},$scope.searchFrind="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#search").keydown(function(){$scope.searchFrind;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.searchUser()},DELAY_TIME_BEFORE_POSTING)}),$scope.userList=[],$scope.cancelRequest=0,$scope.showList=!1,$scope.searchUser=function(){$scope.showList=!0,$scope.cancelRequest=0,$scope.albloader=!0;var opts={};$scope.searchFrind.length>=3?(opts.user_id=APP.currentUser.id,opts.friend_name=$scope.searchFrind,opts.limit_start=APP.user_list_pagination.start,opts.limit_size=APP.user_list_pagination.end,ProfileService.searchAllProfile(opts,function(data){0==$scope.cancelRequest&&($scope.userList=[],101==data.code?0!=data.data.count?($scope.userList=[],$scope.albloader=!1,$scope.userList=$scope.userList.concat(data.data)):$scope.showList=!1:$scope.albloader=!1)})):($scope.showList=!1,$scope.userList=[],$scope.userList.slice(),$scope.cancelRequest=1)},$scope.clearList=function(name){stop=$interval(function(){$scope.cancelRequest=1,$scope.showList=!1,"blank"!==name&&($scope.searchFrind=name)},1e3,1)},$scope.searchFriend=function(){var opts={};opts.user_id=APP.currentUser.id,opts.friend_name="liju",opts.session_id=APP.currentUser.id,opts.limit_start=APP.user_list_pagination.start,opts.limit_size=APP.user_list_pagination.end,ProfileService.searchFriend(opts,function(data){})},$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,$scope.creater=creater_info;var modalInstance=$modal.open({template:'<div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a ng-href="#/viewfriend/{{friend.id}}">{{friend.first_name}} {{friend.last_name}}</a><span class="frnd-details"><a href>{{friend.about_me}}</a></span></span><span data-ng-if="creater.id === currentUser.id || currentUser.id === friend.id" ng-click="RemoveTagFriend(friend, creater.id)" class="rmv-tag"><a href>{{i18n.profile_post.remove_tagged_friend}}</a></span></li></ul></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.RemoveTagFriend=function(friend,createrId){var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=friend.id,opts.post_id=$scope.post_id,ProfileService.removeTagedFriends(opts,function(data){if(101===data.code){var index=$scope.allTagFriends.indexOf(friend);$scope.allTagFriends.splice(index,1),createrId!=APP.currentUser.id&&modalInstance.close(),0===$scope.allTagFriends.length&&modalInstance.close()}})}},$scope.validate=!1,$scope.checkTagUser=function(allTaggedFriend){return $scope.tagInfo=allTaggedFriend,$scope.validate=!1,angular.forEach($scope.tagInfo,function(index){index.id===APP.currentUser.id&&($scope.validate=!0)}),$scope.validate===!0?!0:void 0},$(".fancybox").fancybox()}]).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("ProfileNotiController",["$cookieStore","$scope","$http","$location","$timeout","ProfileService","$rootScope","storeHistorySelection",function($cookieStore,$scope,$http,$location,$timeout,ProfileService,$rootScope,storeHistorySelection){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,$(document).click(function(){$scope.$apply(function(){$rootScope.groupNotificationList=!1,$rootScope.showNewMessageList=!1,$rootScope.showNotificationList=!1,$rootScope.showFriendNotificationList=!1,$rootScope.loadGroupNotification=!1,$scope.scopeVar2=!1,$scope.scopeVar=!1,$scope.scopeVar1=!1,$scope.scopeVar3=!1})}),$scope.getNotification=function(){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,opts={},opts.user_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=12,ProfileService.getPendingFreindReq(opts,function(data){101==data.code&&0!=data.data.length?($scope.FriendRequests=data.data,$scope.NotificationFound=!0):$scope.NotificationNotFound=!0})},$scope.AcceptRequest=function(friendId){opts={},opts.user_id=APP.currentUser.id,opts.friend_id=friendId,opts.action="1",ProfileService.acceptFriendRequest(opts,function(data){101==data.code&&$scope.getNotification()})},$scope.RejectRequest=function(friendId,id){$("#notii-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.friend_id=friendId,opts.action="0",ProfileService.rejectFriendRequest(opts,function(data){101==data.code&&$scope.getNotification()})};var today=new Date,dd=today.getDate(),mm=today.getMonth(),yr=today.getFullYear(),date=new Date(yr,mm,dd),newdate=new Date(date);newdate.setDate(newdate.getDate()+1);var nd=new Date(newdate);$scope.getTodayCredit=function(){opts={},opts={$collection:String(APP.applaneTables.today_credit),$group:{credit:{$sum:"$credit"},_id:null,$fields:!1},$filter:{citizen_id:String(APP.currentUser.id),"__history.__createdOn":{$gte:String(date.toISOString()),$lt:String(nd.toISOString())}},$skip:0},ProfileService.getTodayCredit(opts,function(data){void 0===data.response||""===data.response.result||data.response.result.length<1?$scope.todayCredit=0:$scope.todayCredit=data.response.result[0].credit})},$scope.getTodayCredit(),$scope.storeSelection=function(){storeHistorySelection.storeTodayYouGain()}}]),app.controller("passwordChangeController",["$cookieStore","$scope","$http","$location","$timeout","$interval","$routeParams","ProfileService",function($cookieStore,$scope,$http,$location,$timeout,$interval,$routeParams,ProfileService){$scope.changeLoder=!0,$scope.changePassword=function(){var opts={};return void 0==$scope.previousPassword||""==$scope.previousPassword?($scope.changeMessage=$scope.i18n.passchange.old_password,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.changeMessage=""},8e3),!1):void 0==$scope.oldPassword||""==$scope.oldPassword?($scope.changeMessage=$scope.i18n.passchange.new_password,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.changeMessage=""},8e3),!1):void 0==$scope.newPassword||""==$scope.newPassword?($scope.changeMessage=$scope.i18n.passchange.retype_password,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.changeMessage=""},8e3),!1):$scope.newPassword!==$scope.oldPassword?($scope.changeMessage=$scope.i18n.passchange.password_mismatch,$scope.msgClass="login-error text-red text-center display-block-inline",$timeout(function(){$scope.changeMessage=""},8e3),!1):(opts.user_id=APP.currentUser.id,opts.old_password=$.base64.encode($scope.previousPassword),opts.password1=$.base64.encode($scope.oldPassword),opts.password2=$.base64.encode($scope.newPassword),$scope.changeLoder=!1,void ProfileService.changePassword(opts,function(data){101==data.code?($scope.changeLoder=!0,$scope.msgClass="text-success text-center display-block-inline",$scope.changeMessage=$scope.i18n.passchange.updated_password,$timeout(function(){$scope.changeMessage=""},8e3)):139==data.code?($scope.changeLoder=!0,$scope.msgClass="login-error text-red text-center display-block-inline",$scope.changeMessage=$scope.i18n.validation.password_not_blank,$timeout(function(){$scope.changeMessage=""},8e3)):138==data.code?($scope.changeLoder=!0,$scope.msgClass="login-error text-red text-center display-block-inline",$scope.changeMessage=$scope.i18n.validation.password_not_match,$timeout(function(){$scope.changeMessage=""},8e3)):174==data.code?($scope.changeLoder=!0,$scope.msgClass="login-error text-red text-center display-block-inline",$scope.changeMessage=$scope.i18n.validation.password_not_match,$timeout(function(){$scope.changeMessage=""},8e3)):100==data.code?($scope.changeLoder=!0,$scope.msgClass="login-error text-red text-center display-block-inline",$scope.changeMessage=$scope.i18n.validation.account_inactive,$timeout(function(){$scope.changeMessage=""},8e3)):96==data.code?($scope.changeLoder=!0,$scope.msgClass="login-error text-red text-center display-block-inline",$scope.changeMessage=$scope.i18n.validation.error_occured,$timeout(function(){$scope.changeMessage=""},8e3)):($scope.changeLoder=!0,$scope.msgClass="login-error text-red text-center display-block-inline",$scope.changeMessage=data.message,$timeout(function(){$scope.changeMessage=""},8e3))}))},$scope.go=function(path){$location.path(path)}}]),app.controller("FriendProfile",["$cookieStore","$scope","$http","$location","$timeout","$interval","$routeParams","$modal","$log","$rootScope","ProfileService","AlbumService","AffiliatedkService",function($cookieStore,$scope,$http,$location,$timeout,$interval,$routeParams,$modal,$log,$rootScope,ProfileService,AlbumService,AffiliatedkService){$scope.friendViewLoader=!0,$scope.months=[{value:0,name:"January"},{value:1,name:"February"},{value:2,name:"March"},{value:3,name:"April"},{value:4,name:"May"},{value:5,name:"June"},{value:6,name:"July"},{value:7,name:"August"},{value:8,name:"September"},{value:9,name:"October"},{value:10,name:"November"},{value:11,name:"December"}],$scope.sendFriendRequestLoader=!1,$scope.showRequestButton=!1,$scope.addFriend_personal=!1,$scope.requestSent_personal=!1,$scope.IsFriend_personal=!1,$scope.respond_personal=!1,$scope.addFriend_professional=!1,$scope.requestSent_professional=!1,$scope.IsFriend_professional=!1,$scope.respond_professional=!1,$scope.showButton=!0,$(window).width()<=768&&($scope.showButton=!1),$scope.loaduseralbumimages=function(){$scope.noalbumimages=!1;var opts={};opts.user_id=$scope.currentUser.id,opts.friend_id=$routeParams.friendId,opts.limit_start=0,opts.limit_size=4,AlbumService.albumListing(opts,function(data){101==data.code?($scope.userlatestalbum=data.data.albums,0==$scope.userlatestalbum.length&&($scope.noalbumimages=!0)):$scope.userlatestalbum=""})},$scope.loaduseralbumimages(),$scope.getAffiliateCounts=function(){var opts={};opts.user_id=$routeParams.friendId,opts.session_id=APP.currentUser.id,AffiliatedkService.getAllcounts(opts,function(data){101==data.code&&($scope.totalCounts=data.data)})},$scope.redirectUrl=function(album_id,album_name,id){""==album_name?(album_name="Untitled",$location.path(id+"/friend/images/"+album_id+"/"+album_name)):$location.path(id+"/friend/images/"+album_id+"/"+album_name)},$scope.getAffiliateCounts(),$scope.pendingProfessional=!1,$scope.pendingPersonal=!1,$scope.sendFriendRequests=function(friendId,id){var modalInstance=$modal.open({template:'<div id="friendModal"class="modal-header"> <h3 class="modal-title">{{i18n.friends.send_request}}</h3> </div><div class="modal-body"><ul><li><div class="friend-req-block"><span class="req-img"><img alt="" ng-if="friendProfile.user_info.profile_image_thumb != \'\'" src="{{friendProfile.user_info.profile_image}}"><img alt="" ng-if="friendProfile.user_info.profile_image_thumb == \'\'" src="app/assets/images/prof-pic.jpg"></span ><span class="req-frnd-content"><span class="req-frnd-name">{{(friendProfile.user_info.first_name+\' \'+friendProfile.user_info.last_name).length>19?((friendProfile.user_info.first_name+\' \'+friendProfile.user_info.last_name) | limitTo: 16)+\'...\':(friendProfile.user_info.first_name+\' \'+friendProfile.user_info.last_name)}}</span><span class="req-frnd-tagline">{{i18n.friends.add_as_friend}}</span><span class="req-view-page"><span class="viewlabel"></span><div class="register-sixth-two-half"> <div class="register-sixth-one-radio" data-ng-show="friendProfile.user_info.friend_type != 1"> <div class="shipping_input_radio"> <input type="radio" name="viewIn" value="Per" id="select_per" class="register-sixth-radio" data-ng-model="friendType"> <label for="select_per"><span>{{i18n.friends.add_as_personal}}</span></label> </div><label for="select_per">{{i18n.friends.add_as_personal}}<label> </label></label></div><div class="register-sixth-two-radio" data-ng-show="friendProfile.user_info.friend_type != 2"> <div class="shipping_input_radio"> <input type="radio" name="viewIn" value="pro" id="select_pro" class="register-sixth-radio" data-ng-model="friendType"> <label for="select_pro"><span>{{i18n.friends.add_as_professional}}</span></label> </div><label for="select_pro">{{i18n.friends.add_as_professional}}</label> </div></span></span></div></li></ul></div><div class="modal-footer"> <button class="btn btn-primary" ng-click="addFriend(friendType)" data-ng-hide="sendFriendRequestLoader">{{i18n.friends.send_button}}</button><img class="sent-requestloading" data-ng-show="sendFriendRequestLoader" src="app/assets/images/proceed.gif" alt="{{i18n.friends.loading}}..." /></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.cancel=function(){modalInstance.close()},$scope.addFriend=function(type){if(void 0===type||null===type||""===type)return!1;$scope.sendFriendRequestLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=$routeParams.friendId,opts.msg="Friend Request";"Per"===type?opts.request_type=1:"pro"===type&&(opts.request_type=2),ProfileService.sendFriendRequests(opts,function(data){101==data.code?($scope.friendProfile.is_friend=2,$scope.sendFriendRequestLoader=!1,modalInstance.close(),"pro"===type?$scope.friendProfile.user_info.professional_pending=1:"Per"===type&&($scope.friendProfile.user_info.personal_pending=1)):109==data.code&&($scope.friendProfile.is_friend=2,$scope.sendFriendRequestLoader=!1,modalInstance.close(),$scope.friendProfile.is_sent=1)})}}}]),app.controller("friendAlbumController",["$scope","ProfileService","$location","$routeParams","$timeout",function($scope,ProfileService,$location,$routeParams,$timeout){$scope.friendAlbumListing=function(){$scope.friendId=$routeParams.friendId,$scope.userId=$routeParams.id,$scope.albloader=!0;var opts={};opts.user_id=$routeParams.id,opts.friend_id=$scope.friendId,opts.limit_start=0,opts.limit_size=20,ProfileService.friendAlbumListing(opts,function(data){101==data.code?($scope.listAlbum=data.data,$scope.noAlbums=!0,$scope.albloader=!1):$scope.albloader=!1})},$scope.friendAlbumListing(),$scope.friendAlbumImage=function(){$scope.albloader=!0;var albumId=$routeParams.id;$scope.albumname=$routeParams.name,$scope.frndUserId=$routeParams.userId;var opts={};opts.user_id=$routeParams.userId,opts.album_id=albumId,ProfileService.friendAlbumImage(opts,function(data){101==data.code?($scope.albloader=!1,$scope.viewalbum=data.data,$scope.noPhotos=!0):($scope.albloader=!1,$scope.noPhotos=!0)})},$scope.friendAlbumImage(),$(".fancybox").fancybox(),$scope.redirectUrl=function(album_id,album_name,userId){$location.path("/friend/image/"+album_id+"/"+album_name+"/"+userId)}}]),app.controller("EditProfileController",["$scope","ProfileService","$location","$routeParams","$timeout",function($cookieStore,$rootScope,$scope,$http,$location,$timeout,$interval,$routeParams,ProfileService,threadAndPass,fileReader){if($scope.months=[{value:1,name:"January"},{value:2,name:"February"},{value:3,name:"March"},{value:4,name:"April"},{value:5,name:"May"},{value:6,name:"June"},{value:7,name:"July"},{value:8,name:"August"},{value:9,name:"September"},{value:10,name:"October"},{value:11,name:"November"},{value:12,name:"December"}],$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],$scope.monthChange=function(){$scope.editUser.month.value<=6?$scope.editUser.month.value%2==0?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:1==$scope.editUser.month.value?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:$scope.editUser.month.value%2!=0?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]},$scope.getyears=function(){var currentYear=(new Date).getFullYear();$scope.years=[];for(var i=1970;currentYear>=i;i++)$scope.years.push(i)},$scope.getyears(),$scope.loadEditProfile=!0,$scope.basicProfile=function(type){var opts={};opts.user_id=APP.currentUser.id,type?opts.profile_type=type:opts.profile_type=4,ProfileService.viewMultiProfile(opts,function(data){if(101==data.code){if(1==type)for(var i=0;i<APP.countries.length;i++)data.data.region==APP.countries[i].name&&($scope.editUser.country=APP.countries[i]);else{$scope.editUser.firstName=data.data.firstname,$scope.editUser.lastName=data.data.lastname,$scope.editUser.gender=data.data.gender;for(var i=0;i<APP.countries.length;i++)data.data.country.code==APP.countries[i].id&&($scope.editUser.country=APP.countries[i]);var currVal=data.data.date_of_birth.date;currVal=currVal.substring(0,10);var dtArray=currVal.split("-"),dtDay=parseInt(dtArray[2]),dtMonth=parseInt(dtArray[1]),dtYear=parseInt(dtArray[0]);$scope.editUser.year=dtYear,$scope.editUser.day=dtDay,$scope.editUser.month=$scope.months[dtMonth-1]}$scope.broker=data.data.broker_profile,$rootScope.currentUser.basicProfile=data.data}})},$scope.viewMultiProfile=function(profileType){var opts={};$scope.editUser={},$scope.editMessage="",opts.user_id=APP.currentUser.id,opts.profile_type=profileType,ProfileService.viewMultiProfile(opts,function(data){101==data.code?1==profileType?($scope.userDetails=data.data,$scope.renderProfile=!0,$scope.editUser.region=data.data.region,$scope.editUser.zip=parseInt(data.data.zip,10),$scope.editUser.city=data.data.city,$scope.editUser.address=data.data.address,$scope.editUser.referral_id=data.data.referral_info.id,$scope.editUser.latitude=data.data.latitude,$scope.editUser.longitude=data.data.longitude,$scope.editUser.place=data.data.map_place,$scope.basicProfile(),$scope.loadEditProfile=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,$timeout(function(){$scope.initialize()},1e3)):($scope.editUser.phone=parseInt(data.data.phone,10),$scope.editUser.vatnumber=data.data.vat_number,$scope.editUser.fiscalcode=data.data.fiscal_code,$scope.editUser.iban=data.data.iban,$scope.editUser.brokerplace=data.data.map_place,$scope.editUser.brokerreferral_id=data.data.referral_info.id,$scope.editUser.brokerlatitude=data.data.latitude,$scope.editUser.brokerlongitude=data.data.longitude,$scope.editUser.idcard=data.data.idcard,$scope.editUser.ssn=data.data.ssn,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude):$scope.basicProfile()})},"{}"!=JSON.stringify(APP.currentUser)&&($scope.viewMultiProfile(1),$scope.viewMultiProfile(2)),$scope.edit=!0,$scope.brokerprofile=!1,
$scope.showTab=function(tab){"edit1"===tab?($(".profile-tab-container ul li").removeClass("active"),$(".profile-tab-container ul li").eq(0).addClass("active")):"edit"===tab?($(".profile-tab-container ul li").removeClass("active"),$(".profile-tab-container ul li").eq(0).addClass("active"),$scope.edit=!0,$scope.brokerprofile=!1,$timeout(function(){$scope.initialize()},1e3)):"brokerprofile"===tab&&($(".profile-tab-container ul li").removeClass("active"),$(".profile-tab-container ul li").eq(1).addClass("active"),$scope.edit=!1,$scope.brokerprofile=!0,$timeout(function(){$scope.initializesecond()},1e3))},$scope.getIdCardFile=function(){var imageType=$scope.idCardFile.name.substring($scope.idCardFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.editMessage=$scope.i18n.idcard.invalid_upload,$scope.idCardFile=null):fileReader.readAsDataUrl($scope.idCardFile,$scope).then(function(result){$scope.idCardFilePre=result})},$scope.getSsnFile=function(){var imageType=$scope.ssnFile.name.substring($scope.ssnFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.editMessage=$scope.i18n.idcard.invalid_ssn,$scope.ssnFile=null):fileReader.readAsDataUrl($scope.ssnFile,$scope).then(function(result){$scope.ssnFilePre=result})},$scope.removePreviewIdCard=function(){$scope.idCardFilePre="",$scope.idCardFile=[]},$scope.removePreviewSSN=function(){$scope.ssnFilePre="",$scope.ssnFile=[]},"{}"!=JSON.stringify(APP.currentUser)){var type=$routeParams.type;$scope.showTab(type)}$scope.editMessage="",$scope.showloading=!1,$scope.msgClass="",$scope.editProfile=function(profileType){var opts={};return opts.user_id=APP.currentUser.id,opts.type=profileType,void 0==$scope.editUser.gender?($scope.editMessage=$scope.i18n.editprofile.select_gender,!1):(1==profileType?(opts.firstname=$scope.editUser.firstName,opts.lastname=$scope.editUser.lastName,opts.birthday=$scope.editUser.day+"-"+$scope.editUser.month.name+"-"+$scope.editUser.year,opts.gender=$scope.editUser.gender,opts.country=$scope.editUser.country.id,opts.region=$scope.editUser.country.country,opts.map_place=document.getElementById("mapplace").value,opts.zip=$scope.editUser.zip,opts.city=$scope.editUser.city,opts.address=$scope.editUser.address,opts.latitude=document.getElementById("lat").value,opts.longitude=document.getElementById("lon").value,opts.referral_id=$scope.editUser.referral_id):2==profileType&&(opts.phone=$scope.editUser.phone,opts.vat_number=$scope.editUser.vatnumber,opts.fiscal_code=$scope.editUser.fiscalcode,opts.iban=$scope.editUser.iban,opts.referral_id=$scope.editUser.brokerreferral_id,opts.map_place=document.getElementById("mapplace1").value,opts.latitude=document.getElementById("lat1").value,opts.longitude=document.getElementById("lon1").value,void 0==typeof $scope.idcard&&(opts.idcard=$scope.editUser.idcard),void 0==typeof $scope.ssnFile&&(opts.ssn=$scope.editUser.ssn)),$scope.showloading=!0,void ProfileService.editProfileDetail(opts,$scope.idCardFile,$scope.ssnFile,function(data){101==data.code?($scope.msgClass="alert-success",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.save_success,$scope.showloading=!1,$timeout(function(){$scope.msgClass="",$scope.editMessage=""},2e3),1==profileType&&($scope.shouldBeFocus=!0,$scope.basicProfile(),$timeout(function(){$scope.basicProfile(1)},2e3))):132==data.code?($scope.msgClass="alert-danger",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.invalid_profile_type,$scope.showloading=!1):100==data.code?($scope.msgClass="alert-info",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.account_not_active,$scope.showloading=!1):131==data.code?($scope.msgClass="alert-danger",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.invalid_date_format,$scope.showloading=!1):137==data.code?($scope.msgClass="alert-danger",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.invalid_user,$scope.showloading=!1):95==data.code?($scope.msgClass="alert-danger",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.you_must_choose_iamge,$scope.showloading=!1):($scope.msgClass="alert-danger",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.YOU_MUST_CHOOSE_AN_IMAGE,$scope.showloading=!1),$timeout(function(){$scope.msgClass="",$scope.editMessage=""},2e3)}))},$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:8},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("lat").value=countryPlace.geometry.location.k,document.getElementById("lon").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$scope.initializesecond=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:8},map2=new google.maps.Map(document.getElementById("map-canvas-second"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map2.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map2.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map2);var infowindow=new google.maps.InfoWindow,marker2=new google.maps.Marker({map2:map2,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker2.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("lat1").value=countryPlace.geometry.location.k,document.getElementById("lon1").value=countryPlace.geometry.location.D,document.getElementById("mapplace1").value=countryPlace.formatted_address,place.geometry.viewport?map2.fitBounds(place.geometry.viewport):(map2.setCenter(place.geometry.location),map2.setZoom(17)),marker2.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker2.setPosition(place.geometry.location),marker2.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map2,marker2)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])}}]),app.controller("EditUserProfileController",["$cookieStore","$rootScope","$scope","$location","$http","$timeout","$interval","$routeParams","ProfileService","threadAndPass","fileReader","focus",function($cookieStore,$rootScope,$scope,$location,$http,$timeout,$interval,$routeParams,ProfileService,threadAndPass,fileReader,focus){function Leap(Year,type){Year%4==0?Year%100==0?$scope.Result=Year%400==0:$scope.Result=1:$scope.Result=0,0==type?$scope.monthChange():1==type?$scope.professionalMonthStart():2==type&&$scope.professionalMonthEnd()}$scope.editDays=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],$scope.Result=0,$scope.$watch("editUser.year",function(val){Leap(val,0)}),$scope.$watch("professional.yearStart",function(val){Leap(val,1)}),$scope.$watch("professional.yearEnd",function(val){Leap(val,2)}),$scope.monthChange=function(){if(void 0===$scope.editUser.month||""===$scope.editUser.month||null===$scope.editUser.month);else{var normalValue=$scope.editUser.month.value-1;6>=normalValue?normalValue%2==0?$scope.editDays=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.editUser.month.value-1==1?$scope.Result?$scope.editDays=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]:$scope.editDays=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]:$scope.editDays=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:normalValue%2!=0?$scope.editDays=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.editDays=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]}},$scope.jobDaysStart=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],$scope.professionalMonthStart=function(){if(void 0===$scope.professional.monthStart||""===$scope.professional.monthStart||null===$scope.professional.monthStart);else{var normalValue=$scope.professional.monthStart.value-1;6>=normalValue?normalValue%2==0?$scope.jobDaysStart=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.professional.monthStart.value-1==1?$scope.Result||void 0==$scope.professional.yearStart?$scope.jobDaysStart=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]:$scope.jobDaysStart=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]:$scope.jobDaysStart=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:normalValue%2!=0?$scope.jobDaysStart=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.jobDaysStart=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]}},$scope.jobDaysEnd=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],$scope.professionalMonthEnd=function(){if(void 0===$scope.professional.monthEnd||""===$scope.professional.monthEnd||null===$scope.professional.monthEnd);else{var normalValue=$scope.professional.monthEnd.value-1;6>=normalValue?normalValue%2==0?$scope.jobDaysEnd=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.professional.monthEnd.value-1==1?$scope.Result||void 0==$scope.professional.yearEnd?$scope.jobDaysEnd=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]:$scope.jobDaysEnd=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]:$scope.jobDaysEnd=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:normalValue%2!=0?$scope.jobDaysEnd=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.jobDaysEnd=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]}},$scope.getyears=function(){var currentYear=(new Date).getFullYear();$scope.years=[];for(var i=1914;currentYear>=i;i++)$scope.years.push(i)},$scope.getyears(),$scope.loadEditProfile=!0,$scope.educationDetails=[],$scope.professionalDetails=[],$scope.allCatagories=[],$scope.allRelatives=[],$scope.relationshipstatus=APP.relationshipstatus,$scope.showSync=!1,$scope.showLink=!1,$scope.sync_to_fb=function(){nonuserAccessToken(function(access_token,fbId){if(access_token){var opts={};opts.user_id=APP.currentUser.id,opts.facebook_id=fbId,opts.facebook_accesstoken=access_token,ProfileService.updateFbAccessToken(opts,function(data){101==data.code&&($scope.showSync=!1,$scope.showLink=!1)})}})},$scope.basicProfile=function(type){var opts={};opts.user_id=APP.currentUser.id,type?opts.profile_type=type:opts.profile_type=4,ProfileService.viewMultiProfile(opts,function(data){if(101==data.code){var expiryDayCount=parseInt(data.data.facebook_profile.expires);if(!isNaN(expiryDayCount)&&0>=expiryDayCount&&($scope.showSync=!0),""===data.data.facebook_profile.expires&&($scope.showLink=!0),1==type){for(var i=0;i<APP.countries.length;i++)data.data.region==APP.countries[i].name&&($scope.editUser.country=APP.countries[i]);$rootScope.currentUser.basicProfile=data.data.baisc_profile_info}else{$scope.editUser.firstName=data.data.firstname,$scope.editUser.lastName=data.data.lastname,$scope.editUser.gender=data.data.gender;for(var i=0;i<APP.countries.length;i++)data.data.country.code==APP.countries[i].id&&($scope.editUser.country=APP.countries[i]);for(var i=0;i<$scope.i18n.profile.relationshipstatus.length;i++)data.data.relationship==$scope.i18n.profile.relationshipstatus[i].status&&($scope.editUser.relationshipsts=$scope.i18n.profile.relationshipstatus[i]);var currVal=data.data.date_of_birth.date;currVal=currVal.substring(0,10);var dtArray=currVal.split("-"),dtDay=parseInt(dtArray[2]),dtMonth=parseInt(dtArray[1]),dtYear=parseInt(dtArray[0]);$scope.editUser.year=dtYear,$scope.editUser.day=dtDay,$scope.editUser.month=$scope.months[dtMonth-1],$scope.editUser.brokeresists=data.data.broker_profile.broker_profile_exists,$scope.editUser.citizenesists=data.data.citizen_profile,$rootScope.currentUser.basicProfile=data.data,$scope.educationDetails=data.data.educationDetail,$scope.professionalDetails=data.data.jobDetails,$scope.allCatagories=data.data.categoryKeywords,$scope.allRelatives=data.data.userRelatives}$scope.broker=data.data.broker_profile}})},$scope.searchText="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#searchInput").keydown(function(){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.searchsuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.suggestions=[],$scope.selectedTags=[],$scope.selectedIndex=-1,$scope.hobbyarray=[],$scope.removeTag=function(index){$scope.selectedTags.splice(index,1)},$scope.searchsuggestion=function(){var opts={};opts.session_id=APP.currentUser.id,opts.name=$scope.searchText,opts.type="hobby",$scope.cancelHobbiesRequest=!1,ProfileService.searchSuggestion(opts,function(data){101===data.code&&$scope.cancelHobbiesRequest===!1&&data.data.length>0&&($scope.suggestions=data.data,$scope.selectedIndex=-1)})};var hobbytimer;if($scope.addToSelectedTags=function(index){if(""!=$scope.searchText){var duplicate=!1;if(-1!=index){if(-1===$scope.selectedTags.indexOf($scope.suggestions[index]))if(void 0===$scope.suggestions[index]||null===$scope.suggestions[index]);else{for(var i=0;i<$scope.selectedTags.length;i++)$scope.selectedTags[i].name==$scope.suggestions[index].name&&(duplicate=!0);0==duplicate?$scope.selectedTags.push($scope.suggestions[index]):($scope.hobbymsgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.hobbyMessage=$scope.i18n.profile.edit_profile.hobby_cannot_be_duplicate,hobbytimer=$timeout(function(){$scope.hobbymsgClass="",$scope.hobbyMessage=""},5e3)),$scope.searchText="",$scope.suggestions=[]}}else{for(var i=0;i<$scope.selectedTags.length;i++)$scope.selectedTags[i].name.toLowerCase()==$scope.searchText.toLowerCase()&&(duplicate=!0);if(0==duplicate){var temphobby={name:$scope.searchText,type:"hobby"};$scope.selectedTags.push(temphobby),$scope.searchText="",$scope.suggestions=[]}else $scope.hobbymsgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.hobbyMessage=$scope.i18n.profile.edit_profile.hobby_cannot_be_duplicate,hobbytimer=$timeout(function(){$scope.hobbymsgClass="",$scope.hobbyMessage=""},5e3)}}},$scope.checkKeyDown=function(event){40===event.keyCode?(event.preventDefault(),$scope.selectedIndex+1!==$scope.suggestions.length&&$scope.selectedIndex++):38===event.keyCode?(event.preventDefault(),$scope.selectedIndex-1!==-1&&$scope.selectedIndex--):13===event.keyCode&&$scope.addToSelectedTags($scope.selectedIndex)},$scope.$watch("selectedIndex",function(val){-1!==val&&($scope.searchText=$scope.suggestions[$scope.selectedIndex].name)}),$scope.cancelHobbiesRequest=!1,$scope.clearHobbyList=function(){$scope.cancelHobbiesRequest=!0,$timeout(function(){$scope.suggestions=[]},500)},$scope.viewMultiProfile=function(profileType){var opts={};$scope.editUser={},$scope.editMessage="",opts.user_id=APP.currentUser.id,opts.profile_type=profileType,$scope.temprelobj={},$scope.temphobbies={},ProfileService.viewMultiProfile(opts,function(data){if(101==data.code)if(1==profileType){if($scope.tempobj={},$scope.userDetails=data.data,$scope.renderProfile=!0,$scope.editUser.region=data.data.region,$scope.editUser.state=data.data.baisc_profile_info.state,$scope.editUser.zip=parseInt(data.data.zip),$scope.editUser.city=data.data.city,$scope.editUser.city_born=data.data.baisc_profile_info.city_born,null!==data.data.address&&data.data.address.length>0&&($scope.editUser.address=data.data.address.trim()),null!==data.data.baisc_profile_info.about_me&&data.data.baisc_profile_info.about_me.length>0&&($scope.editUser.about_me=data.data.baisc_profile_info.about_me.trim()),$scope.currentValue=data.data.baisc_profile_info.hobbies,null!==$scope.currentValue&&$scope.currentValue.length>0&&($scope.currentValue=$scope.currentValue.trim(),$scope.temphobbies=$scope.currentValue.split(",")),$scope.tempobj={},null!==$scope.currentValue&&$scope.currentValue.length>0)for(var i=0;i<$scope.temphobbies.length;i++)$scope.tempobj={name:$scope.temphobbies[i],type:"hobby"},$scope.selectedTags.push($scope.tempobj);$scope.editUser.referral_id=data.data.referral_info.id,data.data.referral_info.id?$scope.editUser.referral_id=data.data.referral_info.id:$scope.editUser.referral_id="",$scope.editUser.latitude=data.data.latitude.trim(),$scope.editUser.longitude=data.data.longitude.trim(),$scope.editUser.place=data.data.map_place.trim(),$scope.editUser.zip=data.data.zip,$scope.basicProfile(),$scope.loadEditProfile=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,angular.element("#pac-input").val($scope.editUser.place),$timeout(function(){$scope.initialize()},1e3)}else $scope.basicProfile(),$scope.editUser.phone=parseInt(data.data.phone,10),$scope.editUser.vatnumber=data.data.vat_number,$scope.editUser.fiscalcode=data.data.fiscal_code,$scope.editUser.iban=data.data.iban,$scope.editUser.brokerplace=data.data.map_place,$scope.editUser.brokerreferral_id=data.data.referral_info.id,$scope.editUser.brokerlatitude=data.data.latitude,$scope.editUser.brokerlongitude=data.data.longitude,$scope.editUser.idcard=data.data.idcard,$scope.editUser.ssn=data.data.ssn,$scope.loadEditProfile=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,$timeout(function(){$scope.initializesecond()},1e3);else $scope.basicProfile()})},"{}"!=JSON.stringify(APP.currentUser)){var type=$routeParams.type;$scope.viewMultiProfile(type)}if($scope.edit=!0,$scope.brokerprofile=!1,$scope.getIdCardFile=function(){var imageType=$scope.idCardFile.name.substring($scope.idCardFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.editMessage=$scope.i18n.idcard.invalid_upload,$scope.idCardFile=null):fileReader.readAsDataUrl($scope.idCardFile,$scope).then(function(result){$scope.idCardFilePre=result})},$scope.getSsnFile=function(){var imageType=$scope.ssnFile.name.substring($scope.ssnFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.editMessage=$scope.i18n.idcard.invalid_ssn,$scope.ssnFile=null):fileReader.readAsDataUrl($scope.ssnFile,$scope).then(function(result){$scope.ssnFilePre=result})},$scope.removePreviewIdCard=function(){$scope.idCardFilePre="",$scope.idCardFile=[]},$scope.removePreviewSSN=function(){$scope.ssnFilePre="",$scope.ssnFile=[]},"{}"!=JSON.stringify(APP.currentUser))var type=$routeParams.type;$scope.hobbyarray=[],$scope.editMessage="",$scope.showloading=!1;var editTimer;$scope.preventEnter=function(event){return 13==event.keyCode&&"textarea"!=event.target.type?(event.preventDefault(),!1):void 0},$scope.editProfile=function(profileType,valid,event){var opts={};if(opts.user_id=APP.currentUser.id,opts.type=profileType,$scope.errorIndex=null,$scope.errorIndex=0,1==profileType){if(void 0==$scope.editUser.firstName||""==$scope.editUser.firstName?($scope.errorIndex=1,$scope.editUsers.firstname.$dirty=!0,$scope.editUsers.firstname.$invalid=!0,$scope.editUsers.firstname.$error.required=!0,focus("user_First_Name")):void 0==$scope.editUser.lastName||""==$scope.editUser.lastName?($scope.errorIndex=1,$scope.editUsers.lastname.$dirty=!0,$scope.editUsers.lastname.$invalid=!0,$scope.editUsers.lastname.$error.required=!0,focus("user_Last_Name")):void 0==$scope.editUser.month||""==$scope.editUser.month||null==$scope.editUser.month?($scope.errorIndex=1,$scope.editUsers.birthmonth.$dirty=!0,$scope.editUsers.birthmonth.$invalid=!0,$scope.editUsers.birthmonth.$error.required=!0,focus("birthmonth")):void 0==$scope.editUser.day||""==$scope.editUser.day?($scope.errorIndex=1,$scope.editUsers.birthdate.$dirty=!0,$scope.editUsers.birthdate.$invalid=!0,$scope.editUsers.birthdate.$error.required=!0,focus("birthdate")):void 0==$scope.editUser.year||""==$scope.editUser.year?($scope.errorIndex=1,$scope.editUsers.birthyear.$dirty=!0,$scope.editUsers.birthyear.$invalid=!0,$scope.editUsers.birthyear.$error.required=!0,focus("birthyear")):void 0==$scope.editUser.gender?($scope.errorIndex=1,focus("register_male")):void 0==$scope.editUser.country||void 0==$scope.editUser.country.country||""==$scope.editUser.country.country?($scope.errorIndex=1,$scope.editUsers.nation.$dirty=!0,$scope.editUsers.nation.$invalid=!0,$scope.editUsers.nation.$error.required=!0,focus("countryId")):void 0==$scope.editUser.state||""==$scope.editUser.state||0==isNaN($scope.editUser.state)?($scope.errorIndex=1,$scope.editUsers.states.$dirty=!0,$scope.editUsers.states.$invalid=!0,$scope.editUsers.states.$error.required=!0,focus("state")):void 0==$scope.editUser.zip||""==$scope.editUser.zip||$scope.editUser.zip.length<5||$scope.editUser.zip.length>5||1==isNaN($scope.editUser.zip)?($scope.errorIndex=1,$scope.editUsers.zipcode.$dirty=!0,$scope.editUsers.zipcode.$invalid=!0,$scope.editUsers.zipcode.$error.required=!0,focus("zipcode")):void 0==$scope.editUser.city||""==$scope.editUser.city||0==isNaN($scope.editUser.city)?($scope.errorIndex=1,$scope.editUsers.place.$dirty=!0,$scope.editUsers.place.$invalid=!0,$scope.editUsers.place.$error.required=!0,focus("place")):(void 0==$scope.editUser.city_born||""==$scope.editUser.city_born||0==isNaN($scope.editUser.city_born))&&($scope.errorIndex=1,$scope.editUsers.cityborn.$dirty=!0,$scope.editUsers.cityborn.$invalid=!0,$scope.editUsers.cityborn.$error.required=!0,focus("city_born")),1==$scope.errorIndex)return!1;var bDate=$scope.editUser.month.value+"-"+$scope.editUser.day+"-"+$scope.editUser.year+" 00:00:00",birthDayObject=new Date(bDate).getTime(),currentDateObject=(new Date).getTime();if(birthDayObject>currentDateObject&&($scope.birthdateclass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.birthdateError=$scope.i18n.register.birthday_invalid,$scope.errorIndex=1,focus("birthmonth"),editTimer=$timeout(function(){$scope.birthdateclass="",$scope.birthdateError=""},1e4)),1==$scope.errorIndex)return!1;var temparr=[];if(void 0==$scope.selectedTags||""==$scope.selectedTags||null==$scope.selectedTags)temparr.push(" ");else for(var i=0;i<$scope.selectedTags.length;i++)temparr.push($scope.selectedTags[i].name);void 0==$scope.editUser.relationshipsts||""==$scope.editUser.relationshipsts?opts.relationship=" ":opts.relationship=$scope.editUser.relationshipsts.status,void 0==$scope.editUser.about_me||""==$scope.editUser.about_me?opts.about_me=" ":opts.about_me=$scope.editUser.about_me,void 0==$scope.editUser.address||""==$scope.editUser.address?opts.address=" ":opts.address=$scope.editUser.address,void 0==document.getElementById("lat").value||""==document.getElementById("lat").value?opts.latitude=" ":opts.latitude=document.getElementById("lat").value,void 0==document.getElementById("lon").value||""==document.getElementById("lon").value?opts.longitude=" ":opts.longitude=document.getElementById("lon").value,void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value?opts.map_place=" ":opts.map_place=document.getElementById("mapplace").value,$scope.hobbyarray=temparr,$scope.hobbyarray=$scope.hobbyarray.join(),opts.firstname=$scope.editUser.firstName,opts.lastname=$scope.editUser.lastName,opts.birthday=$scope.editUser.day+"-"+$scope.editUser.month.value+"-"+$scope.editUser.year,opts.gender=$scope.editUser.gender,opts.country=$scope.editUser.country.id,opts.region=$scope.editUser.country.country,opts.state=$scope.editUser.state,opts.referral_id="",opts.zip=$scope.editUser.zip,opts.city=$scope.editUser.city,opts.city_born=$scope.editUser.city_born,opts.hobbies=$scope.hobbyarray,$timeout.cancel(editTimer)}else if(2==profileType){if(void 0==$scope.editUser.phone||""==$scope.editUser.phone||1==isNaN($scope.editUser.phone))return $scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.brokerMsg=$scope.i18n.broker.enter_brokernumber,!1;if(void 0==$scope.editUser.fiscalcode||""==$scope.editUser.fiscalcode)return $scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.broker.enter_brokerfiscal,!1;if(void 0==$scope.editUser.iban||""==$scope.editUser.iban)return $scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.broker.enter_brokeriban,!1;if(void 0==document.getElementById("lat1").value||""==document.getElementById("lat1").value)return $scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.register.enter_businesslat,!1;if(void 0==document.getElementById("lon1").value||""==document.getElementById("lon1").value)return $scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.register.enter_businesslog,!1;if(void 0==document.getElementById("mapplace1").value||""==document.getElementById("mapplace1").value)return $scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.register.enter_businessmap,!1;opts.phone=$scope.editUser.phone,opts.vat_number=$scope.editUser.vatnumber,opts.fiscal_code=$scope.editUser.fiscalcode,opts.iban=$scope.editUser.iban,$scope.editUser.brokerreferral_id?opts.referral_id=$scope.editUser.brokerreferral_id:opts.referral_id="",opts.map_place=document.getElementById("mapplace1").value,opts.latitude=document.getElementById("lat1").value,opts.longitude=document.getElementById("lon1").value,void 0==typeof $scope.idcard&&(opts.idcard=$scope.editUser.idcard),void 0==typeof $scope.ssnFile&&(opts.ssn=$scope.editUser.ssn)}$scope.showloading=!0,$scope.editloader=!0,$scope.msgClass="",$scope.editMessage="",ProfileService.updateProfileDetail(opts,$scope.idCardFile,$scope.ssnFile,function(data){101==data.code?($scope.msgClass="text-success display-block-inline fr",$scope.editMessage=$scope.i18n.validation.save_success,$scope.editloader=!1,$scope.showloading=!1,editTimer=$timeout(function(){$scope.msgClass="",$scope.editMessage=""},15e3),1==profileType&&($scope.basicProfile(),editTimer=$timeout(function(){},1e4))):132==data.code?($scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.invalid_profile_type,$scope.showloading=!1,$scope.editloader=!1):100==data.code?($scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.account_not_active,$scope.showloading=!1,$scope.editloader=!1):131==data.code?($scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.invalid_date_format,$scope.showloading=!1,$scope.editloader=!1):137==data.code?($scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.invalid_user,$scope.showloading=!1,$scope.editloader=!1):95==data.code?($scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.you_must_choose_iamge,$scope.showloading=!1,$scope.editloader=!1):($scope.msgClass="text-red display-block-inline fr",$scope.shouldBeFocus=!0,$scope.editMessage=$scope.i18n.validation.YOU_MUST_CHOOSE_AN_IMAGE,$scope.showloading=!1,$scope.editloader=!1),editTimer=$timeout(function(){$scope.msgClass="",$scope.editMessage=""},15e3)})};$scope.educations=[],$scope.education={},$scope.showEducationForm=!1,$scope.toggleEducationForm=function(){$scope.education={},$scope.formValid=!0,$scope.editEducationBUtton=!1,$scope.showEducationForm===!1?($scope.showEducationForm=!0,focus("school_start")):($scope.educations.$setPristine(),$timeout(function(){$scope.showEducationForm=!1},100))};var educationTimer;$scope.saveEducation=function(type){$scope.educationFocus=!1,$scope.formValid=!0;var opts={};if(void 0===$scope.education.school||""===$scope.education.school||null===$scope.education.school?($scope.formValid=!1,$scope.educations.schoolName.$dirty=!0,$scope.educations.schoolName.$invalid=!0,$scope.educations.schoolName.$error.required=!0,focus("schoolSuggestion")):void 0==$scope.education.yearStart||""==$scope.education.yearStart||null==$scope.education.yearStart?($scope.formValid=!1,$scope.educations.startYear.$dirty=!0,$scope.educations.startYear.$invalid=!0,$scope.educations.startYear.$error.required=!0,focus("school_start")):void 0===$scope.education.currently_attending||""===$scope.education.currently_attending||null===$scope.education.currently_attending?($scope.formValid=!1,$scope.educations.ca.$dirty=!0,$scope.educations.ca.$invalid=!0,$scope.educations.ca.$error.required=!0,focus("school_start")):0!=$scope.education.currently_attending||void 0!==$scope.education.yearEnd&&""!==$scope.education.yearEnd&&null!==$scope.education.yearEnd?void 0===$scope.education.degree||""===$scope.education.degree||null===$scope.education.degree?($scope.formValid=!1,$scope.educations.degreeName.$dirty=!0,$scope.educations.degreeName.$invalid=!0,$scope.educations.degreeName.$error.required=!0,focus("degree_name")):void 0===$scope.education.Field_Of_Study||""===$scope.education.Field_Of_Study||null===$scope.education.Field_Of_Study?($scope.formValid=!1,$scope.educations.studyField.$dirty=!0,$scope.educations.studyField.$invalid=!0,$scope.educations.studyField.$error.required=!0,focus("studySuggestion")):void 0===$scope.education.grade||""===$scope.education.grade||null===$scope.education.grade?($scope.formValid=!1,$scope.educations.grad.$dirty=!0,$scope.educations.grad.$invalid=!0,$scope.educations.grad.$error.required=!0,
focus("school_grade")):void 0===$scope.education.description||""===$scope.education.description||null===$scope.education.description?($scope.formValid=!1,$scope.educations.desc.$dirty=!0,$scope.educations.desc.$invalid=!0,$scope.educations.desc.$error.required=!0,focus("desc_option")):(void 0===$scope.education.visibility||""===$scope.education.visibility||null===$scope.education.visibility)&&($scope.formValid=!1,$scope.educations.visible.$dirty=!0,$scope.educations.visible.$invalid=!0,$scope.educations.visible.$error.required=!0,focus("visible_option")):($scope.formValid=!1,$scope.educations.endYear.$dirty=!0,$scope.educations.endYear.$invalid=!0,$scope.educations.endYear.$error.required=!0,focus("end_year")),0==$scope.formValid)return!1;var eDate,sDate=$scope.education.yearStart;return 1==$scope.education.currently_attending?eDate=" ":(eDate=$scope.education.yearEnd,sDate>eDate&&($scope.formValid=!1,focus("end_year"))),0==$scope.formValid?($scope.formValid=!0,!1):(""===type?opts.id="":opts.id=$scope.educationId,opts.user_id=APP.currentUser.id,opts.type=1,opts.school=$scope.education.school,opts.start_date=$scope.education.yearStart,0==$scope.education.currently_attending?opts.currently_attending=!1:opts.currently_attending=!0,opts.end_date=eDate,opts.degree=$scope.education.degree.degree,opts.field_of_study=$scope.education.Field_Of_Study,opts.grade=$scope.education.grade,void 0===$scope.education.activity_society||""===$scope.education.activity_society||null===$scope.education.activity_society?opts.activities="":opts.activities=$scope.education.activity_society,opts.desc=$scope.education.description,opts.visibility_type=$scope.education.visibility.id,$scope.errorClass="",$scope.educationMessage="",$scope.wait=!0,$timeout.cancel(educationTimer),void ProfileService.saveUserEducation(opts,function(data){$scope.wait=!1,"101"===data.code&&"SUCCESS"===data.message?($scope.editEducationBUtton=!1,""===type?$scope.educationDetails=data.data:$scope.educationDetails=data.data,$scope.errorClass="text-success text-center",$scope.educationMessage=$scope.i18n.profile.edit_profile.education_saved,educationTimer=$timeout(function(){$scope.errorClass="",$scope.educationMessage=""},15e3),$scope.toggleEducationForm()):($scope.errorClass="text-red text-center",$scope.educationMessage=data.message,educationTimer=$timeout(function(){$scope.errorClass="",$scope.educationMessage=""},15e3))}))},$scope.visibleWait=[],$scope.updateEducationVisibility=function(index,type){$scope.visibleWait[index.id]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.id=index.id,opts.type=1,opts.visibility_type=type,ProfileService.updateEducationVisibility(opts,function(data){if($scope.visibleWait[index.id]=!1,"101"===data.code&&"SUCCESS"===data.message)for(var i=0;i<$scope.educationDetails.length;i++)$scope.educationDetails[i].id===index.id&&($scope.educationDetails[i].visibility_type=type)})},$scope.currentFullDate=(new Date).getFullYear(),$scope.educationFocus=!1,$scope.editEducationBUtton=!1,$scope.editEducation=function(index,id){focus(id),$scope.editEducationBUtton=!0,$scope.education={},$scope.showEducationForm=!0,$scope.education.school=index.school,$scope.education.yearStart=parseInt(index.start_date),$scope.education.yearEnd=parseInt(index.end_date),$scope.education.grade=index.grade,$scope.education.activity_society=index.activities,$scope.education.Field_Of_Study=index.field_of_study,$scope.education.description=index.description,index.currently_attending===!0?$scope.education.currently_attending=1:$scope.education.currently_attending=0;for(var i=0;i<$scope.degrees.length;i++)index.degree===$scope.degrees[i].degree&&($scope.education.degree=$scope.degrees[i]);for(var i=0;i<$scope.visibility.length;i++)$scope.visibility[i].id===index.visibility_type&&($scope.education.visibility=$scope.visibility[i]);$scope.educationId=index.id,$scope.educationFocus=!0},$scope.deleteEducation=function(index,id){var opts={};opts.user_id=index.user_id,opts.type=1,opts.id=index.id,$scope.wait=!0,angular.element(".deleteEducation"+id).css("display","none"),$timeout.cancel(educationTimer),ProfileService.deleteEducation(opts,function(data){if($scope.wait=!1,101==data.code&&"SUCCESS"==data.message){$scope.showEducationForm=!1;var indexNo=$scope.educationDetails.indexOf(index);$scope.educationDetails.splice(indexNo,1),$scope.errorClass="text-success text-center",$scope.educationMessage=$scope.i18n.profile.edit_profile.edu_deleted_success,educationTimer=$timeout(function(){$scope.errorClass="",$scope.educationMessage=""},15e3)}else angular.element(".deleteEducation"+id).css("display","block"),$scope.errorClass="text-red text-center",$scope.educationMessage=data.message,educationTimer=$timeout(function(){$scope.errorClass="",$scope.educationMessage=""},15e3)})},$scope.deleteCategories=function(index){var opts={};opts.user_id=APP.currentUser.id,opts.type=1,opts.id=index.id,ProfileService.deleteCategory(opts,function(data){(data.message="SUCCESS")&&console.log("category deleted")})},$scope.education.school="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#schoolSuggestion").keydown(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.schoolSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.schools=[],$scope.schoolLoader=!1,$scope.schoolSuggestion=function(){var opts={};opts.name=$scope.education.school,opts.type="school",opts.session_id=APP.currentUser.id,$scope.cancelSchoolRequest=!1,$scope.schoolLoader=!0,ProfileService.searchSuggestion(opts,function(data){101===data.code&&"SUCCESS"===data.message&&($scope.cancelSchoolRequest===!1?($scope.schools=data.data,$scope.schoolLoader=!1):$scope.schoolLoader=!1)})},$scope.education.school="",$scope.addSchool=function(index){$scope.education.school=index.name,$scope.schoolIndex=-1,$scope.schools=[]},$scope.schoolIndex=-1,$scope.schoolDropDowm=function(event){40===event.keyCode?(event.preventDefault(),$scope.schoolIndex+1!==$scope.schools.length&&$scope.schoolIndex++):38===event.keyCode?(event.preventDefault(),$scope.schoolIndex-1!==-1&&$scope.schoolIndex--):13===event.keyCode&&$scope.addSchool($scope.schools[$scope.schoolIndex])},$scope.cancelSchoolRequest=!1,$scope.clearSchoolList=function(){$scope.cancelSchoolRequest=!0,$timeout(function(){$scope.schools=[]},500)},$("#studySuggestion").keydown(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.studySuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.studies=[],$scope.studyLoader=!1,$scope.studySuggestion=function(){var opts={};opts.name=$scope.education.Field_Of_Study,opts.type="study",opts.session_id=APP.currentUser.id,$scope.cancelFeildRequest=!1,$scope.studyLoader=!0,ProfileService.searchSuggestion(opts,function(data){101===data.code&&"SUCCESS"===data.message?($scope.cancelFeildRequest===!1&&($scope.studies=data.data),$scope.studyLoader=!1):$scope.studyLoader=!1})},$scope.education.Field_Of_Study="",$scope.addStudy=function(index){$scope.education.Field_Of_Study=index.name,$scope.studyIndex=-1,$scope.studies=[]},$scope.studyIndex=-1,$scope.studyDropDown=function(event){40===event.keyCode?(event.preventDefault(),$scope.studyIndex+1!==$scope.studies.length&&$scope.studyIndex++):38===event.keyCode?(event.preventDefault(),$scope.studyIndex-1!==-1&&$scope.studyIndex--):13===event.keyCode&&$scope.addStudy($scope.studies[$scope.studyIndex])},$scope.cancelFeildRequest=!1,$scope.clearFeildOfStudy=function(){$timeout(function(){$scope.studies=[]},500),$scope.cancelFeildRequest=!0},$scope.showProfessionForm=!1,$scope.toggleProfessionForm=function(){$scope.professionFormValidate=!1,$scope.editProfessionButton=!1,$scope.professional={},$scope.showProfessionForm===!1?($scope.showProfessionForm=!0,focus("companySearch")):($scope.professionals.$setPristine(),$timeout(function(){$scope.showProfessionForm=!1},100))},$scope.professional={},$scope.saveProfession=function(type){$scope.professionFocus=!1,$scope.dateError=!1,$scope.professionFormValidate=!1;var opts={};if(void 0===$scope.professional.company||""===$scope.professional.company||null===$scope.professional.company?($scope.professionals.companyName.$dirty=!0,$scope.professionals.companyName.$invalid=!0,$scope.professionals.companyName.$error.required=!0,$scope.professionFormValidate=!0,focus("companySearch")):void 0===$scope.professional.title||""===$scope.professional.title||null===$scope.professional.title?($scope.professionals.Role.$dirty=!0,$scope.professionals.Role.$invalid=!0,$scope.professionals.Role.$error.required=!0,$scope.professionFormValidate=!0,focus("jobTitle")):void 0===$scope.professional.monthStart||""===$scope.professional.monthStart||null===$scope.professional.monthStart?($scope.professionals.job_Month_Start.$dirty=!0,$scope.professionals.job_Month_Start.$invalid=!0,$scope.professionals.job_Month_Start.$error.required=!0,$scope.professionFormValidate=!0,focus("job_month_start")):void 0===$scope.professional.dayStart||""===$scope.professional.dayStart||null===$scope.professional.dayStart?($scope.professionals.job_day_start.$dirty=!0,$scope.professionals.job_day_start.$invalid=!0,$scope.professionals.job_day_start.$error.required=!0,$scope.professionFormValidate=!0,focus("job_day_start")):void 0===$scope.professional.yearStart||""===$scope.professional.yearStart||null===$scope.professional.yearStart?($scope.professionals.job_year_start.$dirty=!0,$scope.professionals.job_year_start.$invalid=!0,$scope.professionals.job_year_start.$error.required=!0,$scope.professionFormValidate=!0,focus("job_year_start")):void 0===$scope.professional.currently_working||""===$scope.professional.currently_working||null===$scope.professional.currently_working?($scope.professionals.cw.$dirty=!0,$scope.professionals.cw.$invalid=!0,$scope.professionals.cw.$error.required=!0,$scope.professionFormValidate=!0,focus("condition_current")):1==$scope.professional.currently_working&&void 0!=$scope.professional.currently_working||void 0!==$scope.professional.monthEnd&&""!==$scope.professional.monthEnd&&null!==$scope.professional.monthEnd?1==$scope.professional.currently_working||void 0!==$scope.professional.dayEnd&&""!==$scope.professional.dayEnd&&null!==$scope.professional.dayEnd?1==$scope.professional.currently_working||void 0!==$scope.professional.yearEnd&&""!==$scope.professional.yearEnd&&null!==$scope.professional.yearEnd?void 0===$scope.professional.description||""===$scope.professional.description||null===$scope.professional.description?($scope.professionals.job_desc.$dirty=!0,$scope.professionals.job_desc.$invalid=!0,$scope.professionals.job_desc.$error.required=!0,$scope.professionFormValidate=!0,focus("job_description")):(void 0===$scope.professional.visibility||""===$scope.professional.visibility||null===$scope.professional.visibility)&&($scope.professionals.visibility_type.$dirty=!0,$scope.professionals.visibility_type.$invalid=!0,$scope.professionals.visibility_type.$error.required=!0,$scope.professionFormValidate=!0,focus("job_visibility")):($scope.professionals.job_year_end.$dirty=!0,$scope.professionals.job_year_end.$invalid=!0,$scope.professionals.job_year_end.$error.required=!0,$scope.professionFormValidate=!0,focus("job_years_ends")):($scope.professionals.job_day_end.$dirty=!0,$scope.professionals.job_day_end.$invalid=!0,$scope.professionals.job_day_end.$error.required=!0,$scope.professionFormValidate=!0,focus("job_days_ends")):($scope.professionals.job_month_end.$dirty=!0,$scope.professionals.job_month_end.$invalid=!0,$scope.professionals.job_month_end.$error.required=!0,$scope.professionFormValidate=!0,focus("job_month_ends")),$scope.professionFormValidate===!0)return!1;var eDate,endingDate,sDate=$scope.professional.yearStart+"-"+$scope.professional.monthStart.value+"-"+$scope.professional.dayStart+" 00:00:00",arr1=sDate.split(/[- :]/),startingDate=new Date(arr1[0],arr1[1]-1,arr1[2],arr1[3],arr1[4],arr1[5]);if(0==$scope.professional.currently_working){eDate=$scope.professional.yearEnd+"-"+$scope.professional.monthEnd.value+"-"+$scope.professional.dayEnd+" 00:00:00";var arr2=eDate.split(/[- :]/);endingDate=new Date(arr2[0],arr2[1]-1,arr2[2],arr2[3],arr2[4],arr2[5]),endingDate>new Date&&($scope.professionFormValidate=!0,$scope.errorClass="text-red text-center",$scope.professionMessage=$scope.i18n.profile.edit_profile.end_date_wrong,timer=$timeout(function(){$scope.errorClass="",$scope.professionMessage=""},15e3))}else endingDate=new Date,$scope.professional.yearEnd=endingDate.getFullYear(),$scope.professional.monthEnd={value:endingDate.getMonth(),name:$scope.months[parseInt(endingDate.getMonth())].name},$scope.professional.dayEnd=endingDate.getDate();return $scope.dateError=!1,startingDate>endingDate&&($scope.dateError=!0,$scope.professionFormValidate=!0,focus("job_month_ends")),$scope.professionFormValidate===!0?($scope.professionFormValidate=!1,!1):(""===type?opts.id="":opts.id=$scope.professional.id,opts.user_id=APP.currentUser.id,opts.type=1,opts.company=$scope.professional.company,opts.title=$scope.professional.title,opts.start_date=$scope.professional.yearStart+"-"+$scope.professional.monthStart.value+"-"+$scope.professional.dayStart,opts.end_date=$scope.professional.yearEnd+"-"+$scope.professional.monthEnd.value+"-"+$scope.professional.dayEnd,opts.currently_working=$scope.professional.currently_working,opts.headline="",opts.location="",opts.description=$scope.professional.description,opts.visibility_type=$scope.professional.visibility.id,$scope.errorClass="",$scope.professionMessage="",$scope.wait=!0,$timeout.cancel(timer),void ProfileService.saveUserProfession(opts,function(data){$scope.wait=!1,"101"===data.code&&"SUCCESS"===data.message?($scope.editProfessionButton=!1,""===type?($scope.professionalDetails=data.data,$scope.errorClass="text-success text-center",$scope.professionMessage=$scope.i18n.profile.edit_profile.job_successfully_saved):($scope.professionalDetails=data.data,$scope.errorClass="text-success text-center",$scope.professionMessage=$scope.i18n.profile.edit_profile.job_successfully_update),$scope.toggleProfessionForm(),timer=$timeout(function(){$scope.errorClass="",$scope.professionMessage=""},15e3)):($scope.errorClass="text-red text-center",$scope.professionMessage=data.message,$scope.toggleProfessionForm(),timer=$timeout(function(){$scope.errorClass="",$scope.professionMessage=""},15e3))}))},$scope.jobVisibleWait=[],$scope.updateProfessionVisibility=function(index,type){$scope.jobVisibleWait[index.id]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.id=index.id,opts.type=1,opts.visibility_type=type,ProfileService.updateProfessionVisibility(opts,function(data){if($scope.jobVisibleWait[index.id]=!1,"101"===data.code&&"SUCCESS"===data.message)for(var i=0;i<$scope.professionalDetails.length;i++)$scope.professionalDetails[i].id===index.id&&($scope.professionalDetails[i].visibility_type=type)})},$scope.professionFocus=!1,$scope.editProfessionButton=!1,$scope.editProfession=function(index,focusId){$scope.editProfessionButton=!0,focus(focusId),$scope.professional={},$scope.showProfessionForm=!0,$scope.professional.company=index.company,$scope.professional.title=index.title;var startDate=index.start_date.date.substring(0,10),dtArray=startDate.split("-"),dtDay=parseInt(dtArray[2]),dtMonth=parseInt(dtArray[1]),dtYear=parseInt(dtArray[0]);$scope.professional.yearStart=dtYear,$scope.professional.monthStart=$scope.months[dtMonth-1],$scope.professional.dayStart=dtDay;var endDate=index.end_date.date.substring(0,10),enddtArray=endDate.split("-"),enddtDay=parseInt(enddtArray[2]),enddtMonth=parseInt(enddtArray[1]),enddtYear=parseInt(enddtArray[0]);$scope.professional.yearEnd=enddtYear,$scope.professional.monthEnd=$scope.months[enddtMonth-1],$scope.professional.dayEnd=enddtDay,$scope.professional.currently_working=index.currently_working,$scope.professional.headline=index.headline,$scope.professional.location=index.location,$scope.professional.description=index.description;for(var i=0;i<$scope.visibility.length;i++)$scope.visibility[i].id===index.visibility_type&&($scope.professional.visibility=$scope.visibility[i]);$scope.professional.id=index.id,$scope.professionFocus=!0};var timer;$scope.deleteProfession=function(index,id){var opts={};opts.user_id=index.user_id,opts.type=1,opts.id=index.id,angular.element(".deleteProfession"+id).css("display","none"),$scope.wait=!0,$scope.errorClass="",$scope.professionMessage="",$timeout.cancel(timer),$scope.showProfessionForm=!1,ProfileService.deleteProfession(opts,function(data){if($scope.wait=!1,101==data.code&&"SUCCESS"==data.message){var indexNo=$scope.professionalDetails.indexOf(index);$scope.professionalDetails.splice(indexNo,1),$scope.errorClass="text-center text-success",$scope.professionMessage=$scope.i18n.profile.edit_profile.job_successfully_deleted,timer=$timeout(function(){$scope.errorClass="",$scope.professionMessage=""},15e3)}else angular.element("#deleteProfession"+id).css("display","block")})},$("#companySearch").keydown(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.companySuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.companies=[],$scope.companySuggestion=function(){var opts={};opts.name=$scope.professional.company,opts.type="company",opts.session_id=APP.currentUser.id,$scope.cancelCompanyRequest=!1,ProfileService.searchSuggestion(opts,function(data){101===data.code&&"SUCCESS"===data.message&&$scope.cancelCompanyRequest===!1&&($scope.companies=data.data)})},$scope.professional.company="",$scope.addCompany=function(index){$scope.professional.company=index.name,$scope.companyIndex=-1,$scope.companies=[]},$scope.companyIndex=-1,$scope.companyDropDown=function(event){40===event.keyCode?(event.preventDefault(),$scope.companyIndex+1!==$scope.companies.length&&$scope.companyIndex++):38===event.keyCode?(event.preventDefault(),$scope.companyIndex-1!==-1&&$scope.companyIndex--):13===event.keyCode&&$scope.addCompany($scope.companies[$scope.companyIndex])},$scope.cancelCompanyRequest=!1,$scope.clearCompanyList=function(){$scope.cancelCompanyRequest=!0,$timeout(function(){$scope.companies=[]},500)},$("#jobTitle").keydown(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.titleSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.titles=[],$scope.titleSuggestion=function(){var opts={};opts.name=$scope.professional.title,opts.type="jobtitle",opts.session_id=APP.currentUser.id,$scope.cancelJobTitlerequest=!1,ProfileService.searchSuggestion(opts,function(data){101===data.code&&"SUCCESS"===data.message&&$scope.cancelJobTitlerequest===!1&&($scope.titles=data.data)})},$scope.professional.title="",$scope.addTitle=function(index){$scope.professional.title=index.name,$scope.titleIndex=-1,$scope.titles=[]},$scope.titleIndex=-1,$scope.jobTitleDropDown=function(event){40===event.keyCode?(event.preventDefault(),$scope.titleIndex+1!==$scope.titles.length&&$scope.titleIndex++):38===event.keyCode?(event.preventDefault(),$scope.titleIndex-1!==-1&&$scope.titleIndex--):13===event.keyCode&&$scope.addTitle($scope.titles[$scope.titleIndex])},$scope.cancelJobTitlerequest=!1,$scope.clearJobTitle=function(){$scope.cancelJobTitlerequest=!0,$timeout(function(){$scope.titles=[]},500)},$scope.showCatageoryForm=!1,$scope.toogleCatageory=function(){$scope.cathaserror=!1,$scope.catkeyerror=!1,$scope.catErrClsMsg="",$scope.catErrCls="",$scope.editCategoryButton=!1,$scope.selectedCategory="",$scope.categoryKeyword="",$scope.keywordList=[],$scope.showCatageoryForm===!1?$scope.showCatageoryForm=!0:$scope.showCatageoryForm=!1};var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$scope.searchicn="",$scope.showCatLoading=!1,$scope.categories=[],$scope.$watch("currentLanguage",function(newValue,oldValue){$scope.searchCatagory(newValue),$timeout(function(){$scope.degrees=$scope.i18n.profile.degree,$scope.relationshipstatus=$scope.i18n.profile.relationshipstatus,$scope.visibility=$scope.i18n.profile.profile_visibility,$scope.relatives=$scope.i18n.profile.relationtype,$scope.months=$scope.i18n.profile.months},400)}),$scope.searchCatagory=function(currentLanguage){var opts={};opts.lang_code=currentLanguage,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,ProfileService.searchCatagory(opts,function(data){101===data.code&&"SUCCESS"===data.message&&(data.data.length>0&&($scope.categories=data.data),$scope.showCatLoading=!1)})},$scope.searchCatagory($scope.currentLanguage),$scope.enableKeyword=!0,$scope.focusKeyword=function(){void 0===$scope.selectedCategory||""===$scope.selectedCategory||null===$scope.selectedCategory?($scope.enableKeyword=!0,$scope.editCategoryButton=!1):$scope.enableKeyword=!1},$scope.showCatKeyLoading=!1,$scope.srchkeyicn="",$("#categoryKeyword").keydown(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchKeyword()},DELAY_TIME_BEFORE_POSTING)}),$scope.keywords=[],$scope.searchKeyword=function(){var opts={};opts.category_id=$scope.selectedCategory.id.toString(),opts.session_id=APP.currentUser.id,opts.keyword=$scope.categoryKeyword,$scope.cancelKeywordRequest=!1,$scope.showCatKeyLoading=!0,ProfileService.searchCatagoryKeyword(opts,function(data){$scope.showCatKeyLoading=!1,101===data.code&&"SUCCESS"===data.message&&$scope.cancelKeywordRequest===!1&&($scope.keywords=data.data.keyword)})},$scope.keywordIndex=-1,$scope.keywordKeyDown=function(event){if(40===event.keyCode)event.preventDefault(),$scope.keywordIndex+1!==$scope.keywords.length&&$scope.keywordIndex++;else if(38===event.keyCode)event.preventDefault(),$scope.keywordIndex-1!==-1&&$scope.keywordIndex--;else if(13===event.keyCode)if(void 0===$scope.keywords[$scope.keywordIndex]){if(""!==$scope.categoryKeyword.trim()){var opts={};opts.user_id=APP.currentUser.id,opts.keyword=$scope.categoryKeyword,ProfileService.addKeywords(opts,function(data){})}$scope.storeKeyword($scope.categoryKeyword)}else $scope.storeKeyword($scope.keywords[$scope.keywordIndex])},$scope.cancelKeywordRequest=!1,$scope.clearKeyList=function(){$scope.cancelKeywordRequest=!0,$timeout(function(){$scope.keywords=[]},500)},$scope.categoryKeyword="",$scope.keywordList=[],$scope.storeKeyword=function(index){if($scope.keywords=[],$scope.keywordIndex=-1,$scope.categoryKeyword="","object"==typeof index)-1===$scope.keywordList.indexOf(index.name)&&$scope.keywordList.push(index.name);else{if(""===index||void 0===index)return!1;-1===$scope.keywordList.indexOf(index)&&$scope.keywordList.push(index)}},$scope.clearKeywordList=function(){$timeout(function(){$scope.keywords=[]},500)},$scope.removeKeyword=function(index){$scope.keywordList.splice(index,1)},$scope.saveCat=!1,$scope.saveCategory=function(type){$scope.cathaserror=!1,$scope.catkeyerror=!1,$scope.catErrClsMsg="",$scope.catErrCls="",$scope.saveCat=!0;var catId=$scope.selectedCategory.id,catKey=$scope.keywordList;if(void 0===catId||""===catId)return $scope.catErrClsMsg=$scope.i18n.editprofile.invalidCat,$scope.cathaserror=!0,$scope.catErrCls="text-red text-center",$timeout(function(){$scope.catErrCls="",$scope.catErrClsMsg=""},15e3),!1;if(void 0===$scope.keywordList||0===$scope.keywordList.length||""===$scope.keywordList)return $scope.catErrClsMsg=$scope.i18n.editprofile.invalidCatKey,$scope.catkeyerror=!0,$scope.catErrCls="text-red text-center",$timeout(function(){$scope.catErrCls="",$scope.catErrClsMsg=""},15e3),!1;for(var i=0;i<$scope.allCatagories.length;i++)if($scope.allCatagories[i].category_id==catId)if($scope.allCatagories[i].keywords!=catKey);else if(""===type)return $scope.catErrClsMsg=$scope.i18n.editprofile.duplicateCatKey,$scope.catkeyerror=!0,$scope.catErrCls="text-red text-center",$timeout(function(){$scope.catErrCls="",$scope.catErrClsMsg=""},15e3),!1;var opts={};opts.user_id=APP.currentUser.id,opts.type=1,""===type?opts.id="":opts.id=$scope.categoryId,opts.category_id=$scope.selectedCategory.id,opts.keywords=$scope.keywordList.toString(),opts.lang_code=$scope.currentLanguage,$scope.wait=!0,$timeout.cancel(timer),$scope.catErrCls="",$scope.catErrClsMsg="",ProfileService.saveCategory(opts,function(data){if($scope.wait=!1,"101"===data.code&&"SUCCESS"===data.message){if($scope.editCategoryButton=!1,$scope.showCatageoryForm=!1,$scope.enableKeyword=!0,$scope.keywordList=[],""===type)$scope.allCatagories.push(data.data);else{for(var indexNo=0,i=0;i<$scope.allCatagories.length;i++)if($scope.allCatagories[i].id===data.data.id){indexNo=i;break}$scope.allCatagories.splice(indexNo,1),$scope.allCatagories.push(data.data)}$scope.catErrCls="text-success text-center",$scope.catErrClsMsg=$scope.i18n.editprofile.category_save,$timeout(function(){$scope.catErrCls="",$scope.catErrClsMsg=""},15e3),$scope.categoryKeyword="",$scope.categorySearch="",$scope.saveCat=!1}else $scope.catErrCls="text-red text-center",$scope.catErrClsMsg=$scope.i18n.editprofile.category_service_error,$timeout(function(){$scope.catErrCls="",$scope.catErrClsMsg=""},15e3)})},$scope.editCategoryButton=!1,$scope.categoryId="",$scope.editCatagory=function(index){$scope.editCategoryButton=!0,$scope.enableKeyword=!1;for(var i=0;i<$scope.categories.length;i++)index.category_name===$scope.categories[i].category_name&&($scope.selectedCategory=$scope.categories[i]);index.keywords.length>0&&($scope.keywordList=index.keywords.split(",")),$scope.categoryId=index.id,$scope.showCatageoryForm=!0,focus("selectCategoryFocus")},$scope.isDelCat=[],$scope.deleteCategories=function(index){var category=$scope.allCatagories[index];$scope.isDelCat[index]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.type=1,opts.id=category.id,$scope.selectedCategory="",$scope.categoryKeyword="",$scope.showCatageoryForm=!1,$scope.keywordList=[],ProfileService.deleteCategory(opts,function(data){"101"===data.code?($scope.allCatagories.splice(index,1),$scope.catErrClsMsg=$scope.i18n.editprofile.category_Delete,$scope.catErrCls="text-success text-center",$timeout(function(){$scope.catErrCls="",$scope.catErrClsMsg=""},15e3),$scope.isDelCat[index]=!1):($scope.catErrClsMsg=$scope.i18n.editprofile.category_service_error,$scope.catErrCls="text-red text-center",$timeout(function(){$scope.catErrCls="",$scope.catErrClsMsg=""},15e3),$scope.isDelCat[index]=!1)})},$scope.convertString=function(stringArray){return stringArray.length>0?stringArray.split(","):[]};$scope.searchFrind="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#searchrelative").keydown(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.selectFriend()},DELAY_TIME_BEFORE_POSTING)}),$scope.relativeSuggesions=[],$scope.noFriend=!1,$scope.selectFriend=function(){$scope.noFriend=!1;var opts={};opts.user_id=APP.currentUser.id,opts.user_name=$scope.searchRelative,$scope.cancelRelativeRequest=!1,$scope.relativeloader=!0,ProfileService.selectFriend(opts,function(data){if(101===data.code&&"SUCCESS"===data.message&&$scope.cancelRelativeRequest===!1){$scope.relativeloader=!1,$scope.relativeSuggesions=[];var temp=data.data.users.user_info;temp.length>0?$scope.relativeSuggesions=temp:$scope.noFriend=!0}})},$scope.selectIndex=-1,$scope.downUpKeyPress=function(event){0==$scope.searchRelative.length&&($scope.storeRelative={},$scope.relativeSuggesions=[]),40===event.keyCode?(event.preventDefault(),$scope.selectIndex+1!==$scope.relativeSuggesions.length&&$scope.selectIndex++):38===event.keyCode?(event.preventDefault(),$scope.selectIndex-1!==-1&&$scope.selectIndex--):13===event.keyCode&&$scope.selectedRelative($scope.relativeSuggesions[$scope.selectIndex])},$scope.searchRelative="",$scope.storeRelative={},$scope.selectedRelative=function(index){$scope.relativeSuggesions=[],$scope.searchRelative="",$scope.storeRelative={},void 0!=index&&($scope.storeRelative=index,$scope.searchRelative=index.firstname+" "+index.lastname)},$scope.wait=!1,$scope.saveRelative=function(type){if($scope.relativeRelError=!1,$scope.relativeFrndError=!1,$scope.relativeError=!1,void 0===$scope.searchRelative||""===$scope.searchRelative||null===$scope.searchRelative)return $scope.errorClass="text-red text-center",$scope.relativeMessage=$scope.i18n.profile.edit_profile.please_enter_friend,$scope.relativeFrndError=!0,timer=$timeout(function(){$scope.errorClass="",$scope.relativeMessage=""},15e3),!1;if(void 0===$scope.storeRelative.user_id||""===$scope.storeRelative.user_id||null===$scope.storeRelative.user_id)return $scope.errorClass="text-red text-center",$scope.relativeMessage=$scope.i18n.profile.edit_profile.please_enter_friend,timer=$timeout(function(){$scope.errorClass="",$scope.relativeMessage=""},15e3),!1;if(void 0===$scope.releativeSearch||""===$scope.releativeSearch||null===$scope.releativeSearch)return $scope.errorClass="text-red text-center",$scope.relativeMessage=$scope.i18n.profile.edit_profile.please_enter_relation,$scope.relativeRelError=!0,timer=$timeout(function(){$scope.errorClass="",$scope.relativeMessage=""},15e3),!1;$scope.relativesavebtn=!0;var opts={};""===type?opts.id="":opts.id=$scope.RelativeId,opts.user_id=APP.currentUser.id,opts.type=1,opts.relative_id=$scope.storeRelative.user_id,opts.relation=$scope.releativeSearch.id,$scope.wait=!0,$scope.errorClass="",$scope.relativeMessage="",$timeout.cancel(timer),ProfileService.saveRelative(opts,function(data){if($scope.wait=!1,"101"==data.code&&"SUCCESS"==data.message){if(""===type)$scope.allRelatives.push({id:data.data.id,user_id:data.data.user_id,relative_id:data.data.relative_id,lastname:data.data.relative_detail[0].lastname,firstname:data.data.relative_detail[0].firstname,email:data.data.relative_detail[0].profileImg,profileImg:data.data.relative_detail[0].profileImg,relationName:data.data.relative_detail[0].relationName,relationId:data.data.relation}),$scope.relativeMessage=$scope.i18n.profile.edit_profile.realtion_saved;else{for(var indexNo=0,i=0;i<$scope.allRelatives.length;i++)if($scope.allRelatives[i].id===data.data.id){indexNo=i;break}$scope.allRelatives.splice(indexNo,1),$scope.allRelatives.push({id:data.data.id,user_id:data.data.user_id,relative_id:data.data.relative_id,lastname:data.data.relative_detail[0].lastname,firstname:data.data.relative_detail[0].firstname,email:data.data.relative_detail[0].profileImg,profileImg:data.data.relative_detail[0].profileImg,relationName:data.data.relative_detail[0].relationName,relationId:data.data.relation}),$scope.relativeMessage=$scope.i18n.profile.edit_profile.relation_updated}$scope.errorClass="text-success text-center",timer=$timeout(function(){$scope.errorClass="",$scope.relativeMessage=""},15e3),$scope.relativesavebtn=!1,$scope.editRelativeButton=!1,$scope.searchRelative="",$scope.storeRelative={},$scope.releativeSearch={},$scope.toogleRelative()}else $scope.errorClass="text-red text-center",$scope.relativeMessage=$scope.i18n.profile.edit_profile.invalid_request,timer=$timeout(function(){$scope.errorClass="",$scope.relativeMessage=""},15e3)})},$scope.showRelativeForm=!1,$scope.toogleRelative=function(){$scope.errorClass="",$scope.relativeMessage="",$scope.relativeRelError=!1,$scope.relativeFrndError=!1,$scope.searchRelative="",$scope.releativeSearch="",$scope.editRelativeButton=!1,$scope.showRelativeForm===!1?$scope.showRelativeForm=!0:$scope.showRelativeForm=!1},$scope.editRelativeButton=!1,$scope.editRelative=function(index){$scope.showRelativeForm=!0,$scope.editRelativeButton=!0,$scope.searchRelative=index.firstname+" "+index.lastname,$scope.releativeSearch=$scope.relatives[index.relationId-1],$scope.storeRelative={user_id:index.relative_id,firstname:index.firstname,lastname:index.lastname,relationId:index.relationId},$scope.RelativeId=index.id,focus("searchrelative")},$scope.deleteRelative=function(index,id){var opts={};opts.user_id=index.user_id,opts.type=1,opts.id=index.id,$scope.wait=!0,angular.element(".deleteRelative"+id).css("display","none"),
$scope.errorClass="",$scope.relativeMessage="",$timeout.cancel(timer),$scope.searchRelative="",$scope.releativeSearch="",$scope.editRelativeButton=!1,$scope.showRelativeForm=!1,ProfileService.deleteRelative(opts,function(data){if($scope.wait=!1,101==data.code&&"SUCCESS"==data.message){var indexNo=$scope.allRelatives.indexOf(index);$scope.allRelatives.splice(indexNo,1),$scope.errorClass="text-success text-center",$scope.relativeMessage=$scope.i18n.profile.edit_profile.relation_successfully_deleted,timer=$timeout(function(){$scope.errorClass="",$scope.relativeMessage=""},15e3)}else angular.element(".deleteRelative"+id).css("display","block"),$scope.errorClass="text-red text-center",$scope.relativeMessage=$scope.i18n.profile.edit_profile.error_in_relation_deletion,timer=$timeout(function(){$scope.errorClass="",$scope.relativeMessage=""},15e3)})},$scope.cancelRelativeRequest=!1,$scope.clearRelative=function(){$scope.relativeloader=!1,$scope.cancelRelativeRequest=!0,$scope.noFriend=!1,$timeout(function(){$scope.relativeSuggesions=[]},500)},$scope.$watch("searchRelative",function(val){""===val&&($scope.editRelativeButton=!1)}),$scope.addSkillBox=!1,$scope.viewskill=!0,$scope.temprarySkillCheck=!1,$scope.toggleSkillForm=function(){if($scope.skillMesError=!1,$scope.skillMessage="",$scope.skillClass="",$scope.storeSkills=[],void 0!==$scope.storeSkillss&&$scope.storeSkillss.length>0)for(var i=0;i<$scope.storeSkillss.length;i++)$scope.storeSkills.push($scope.storeSkillss[i]);$scope.viewskill===!1?($scope.viewskill=!0,void 0===$scope.storeSkillss&&($scope.emptyskill=!0)):$scope.viewskill=!1,$scope.addSkillBox===!1?$scope.addSkillBox=!0:$scope.addSkillBox=!1},$scope.closeSkillForm=function(){if($scope.skillMesError=!1,$scope.skillMessage="",$scope.skillClass="",1==$scope.temprarySkillCheck&&$scope.storeTempSkill.length>0){for(var i=0;i<$scope.storeTempSkill.length;i++)-1==$scope.storeSkills.indexOf($scope.storeTempSkill[i])&&$scope.storeSkills.push($scope.storeTempSkill[i]);$scope.temprarySkillCheck=!1}$scope.storeTempSkill=[],$scope.viewskill===!1?($scope.viewskill=!0,void 0===$scope.storeSkillss&&($scope.emptyskill=!0)):$scope.viewskill=!1,$scope.addSkillBox===!1?$scope.addSkillBox=!0:$scope.addSkillBox=!1};var DELAY_TIME_BEFORE_POSTING=300;$("#searchSkill").keydown(function(event){$scope.searchFrind;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchSkills()},DELAY_TIME_BEFORE_POSTING)}),$scope.skillLoader=!1,$scope.searchSkills=function(){$scope.skillLoader=!0;var opts={};opts.type="skill",opts.name=$scope.searchSkill,opts.session_id=APP.currentUser.id,$scope.cancelSkillRequest=!1,ProfileService.searchSuggestion(opts,function(data){101===data.code&&"SUCCESS"===data.message?($scope.cancelSkillRequest===!1&&($scope.skills=data.data),$scope.skillLoader=!1):$scope.skillLoader=!1})},$scope.addSkill=function(){$scope.skillMesError=!1;var opts={};return void 0===$scope.storeSkills||null==$scope.storeSkills||0===$scope.storeSkills.length?($scope.skillMessage=$scope.i18n.skill.insert_msg,$scope.skillMesError=!0,$scope.skillClass="text-red text-center",timer=$timeout(function(){$scope.skillMessage="",$scope.skillClass=""},15e3),!1):(opts.user_id=APP.currentUser.id,opts.skills=$scope.storeSkills.toString(),$scope.wait=!0,$scope.skills=[],void ProfileService.addUserSkills(opts,function(data){101===data.code&&"SUCCESS"===data.message?($scope.temprarySkillCheck=!1,$scope.storeSkillss=data.data.skills.skills.split(","),$scope.wait=!1,$scope.toggleSkillForm(),$scope.emptyskill=!1,$scope.skillMessage=$scope.i18n.skill.save_msg,$scope.skillClass="text-success text-center",$timeout(function(){$scope.skillMessage="",$scope.skillClass=""},15e3),$scope.cancelSkillRequest=!0,$scope.viewskill=!0):($scope.wait=!1,$scope.skillMessage=data.message,$scope.skillClass="text-red text-center",timer=$timeout(function(){$scope.skillMessage="",$scope.skillClass=""},15e3))}))},$scope.skillIndex=-1,$scope.pressDownKey=function(event){40===event.keyCode?(event.preventDefault(),$scope.skillIndex+1!==$scope.skills.length&&$scope.skillIndex++):38===event.keyCode?(event.preventDefault(),$scope.skillIndex-1!==-1&&$scope.skillIndex--):13===event.keyCode&&($scope.emptyskill=!1,$scope.addToSelectedSkill(-1===$scope.skillIndex?{name:$scope.searchSkill}:$scope.skills[$scope.skillIndex]))},$scope.storeSkills=[],$scope.addToSelectedSkill=function(index){$scope.skillMessage="",$scope.skillClass="",$scope.skillIndex=-1,$timeout.cancel(timer),-1===$scope.storeSkills.indexOf(index.name)?(void 0===index.name||null===index.name||""===index.name||$scope.storeSkills.push(index.name),$scope.searchSkill=""):($scope.skillMessage=$scope.i18n.skill.duplicate_msg,$scope.skillClass="text-red text-center",timer=$timeout(function(){$scope.skillMessage="",$scope.skillClass=""},15e3)),$timeout(function(){$scope.skills=[]},500)},$scope.cancelSkillRequest=!1,$scope.clearSkillList=function(){$scope.cancelSkillRequest=!0,$scope.skillIndex=-1,$timeout(function(){$scope.skills=[]},500)},$scope.emptyskill=!0,$scope.skills=[],$scope.getSkills=function(){var opts={};opts.user_id=APP.currentUser.id,ProfileService.getUserSkills(opts,function(data){101===data.code&&"SUCCESS"===data.message&&(data.data.skills.skills.length>0?($scope.storeSkillss=data.data.skills.skills.split(","),$scope.emptyskill=!1):$scope.emptyskill=!0)})},$scope.getSkills(),$scope.storeTempSkill=[],$scope.removeSkill=function(index){$scope.addSkillBox=!0,$scope.storeTempSkill.push($scope.storeSkills[index]),$scope.temprarySkillCheck=!0,$scope.storeSkills.splice(index,1)},$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}if(latitudeMap)var mapOptions={center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:6,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};else var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:6,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};var map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var current=new google.maps.LatLng(latitudeMap,longitudeMap),infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,position:current,anchorPoint:new google.maps.Point(0,-20)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("lat").value=countryPlace.geometry.location.lat(),document.getElementById("lon").value=countryPlace.geometry.location.lng(),document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$scope.initializesecond=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:8,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,draggable:!1},map2=new google.maps.Map(document.getElementById("map-canvas-second"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map2.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map2.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map2);var infowindow=new google.maps.InfoWindow,marker2=new google.maps.Marker({map2:map2,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker2.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("lat1").value=countryPlace.geometry.location.k,document.getElementById("lon1").value=countryPlace.geometry.location.D,document.getElementById("mapplace1").value=countryPlace.formatted_address,place.geometry.viewport?map2.fitBounds(place.geometry.viewport):(map2.setCenter(place.geometry.location),map2.setZoom(17)),marker2.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker2.setPosition(place.geometry.location),marker2.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map2,marker2)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])}}]),app.controller("ProfileImageController",["$scope","$rootScope","ProfileImageService","$location","$routeParams","$timeout","fileReader","FileUploader",function($scope,$rootScope,ProfileImageService,$location,$routeParams,$timeout,fileReader,FileUploader){$scope.albloader=!1,$scope.propic=!1,$scope.picloader=!1,$scope.successMsg="",$scope.uploaduserprofileimages=function(){if($scope.successMsg="",$scope.fileNotValidMsg="",$scope.fileNotValid=!1,void 0==$scope.myFile||""==$scope.myFile)return $scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.editprofile.select_image,$timeout(function(){$scope.fileNotValidMsg="",$scope.fileNotValid=!1},15e3),!1;$scope.albloader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.user_media=$scope.myFile;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);return"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType&&"GIF"!=imageType&&"PNG"!=imageType&&"JPG"!=imageType&&"JPEG"!=imageType?($scope.albloader=!1,$scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.editprofile.invalid_media,!1):($scope.fileNotValidMsg="",$scope.fileNotValid=!1,ProfileImageService.uploaduserprofileimages(opts,$scope.myFile,function(data){101==data.code?($scope.albloader=!1,$("#addPhoto").show(),$("input[type='file']").val(""),$scope.postFiles="",$scope.imageSrc="",$scope.myFile="",$scope.successMsg=data.message,$timeout(function(){$scope.successMsg=""},15e3),$scope.viewmultiprofiles()):($scope.albloader=!1,$("#addPhoto").show())}),void 0)},$scope.myFile="",$scope.imageSrc="",$scope.fileNotValid=!1,$scope.fileNotValidMsg="",$scope.getFile=function(){void 0==$scope.file?$scope.$apply(function(){$scope.removeImage()}):($scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.imageSrc=result;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType&&"GIF"!=imageType&&"PNG"!=imageType&&"JPG"!=imageType&&"JPEG"!=imageType?($scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.groupcontrol.upload_media,$scope.postFiles="",$scope.imageSrc="",$scope.myFile=""):$scope.fileNotValid=!1}))},$scope.removeImage=function(){$scope.postFiles="",$scope.imageSrc="",$scope.myFile="",$("input[type='file']").val("")},$scope.viewmultiprofiles=function(){$scope.albloader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.profile_type=4,ProfileImageService.viewmultiprofiles(opts,function(data){101==data.code?($scope.albloader=!1,$scope.picloader=!1,$scope.propic=!0,$rootScope.currentUser.basicProfile=data.data):($scope.propic=!0,$scope.picloader=!1)})}}]),app.controller("ProfileImageUploadController",["$scope","$rootScope","ProfileImageService","$location","$routeParams","$timeout","fileReader","FileUploader",function($scope,$rootScope,ProfileImageService,$location,$routeParams,$timeout,fileReader,FileUploader){$scope.albloader=!1,$scope.propic=!1,$scope.picloader=!1,$scope.successMsg="",$scope.imagePrvSrc="",$scope.imgProgress="",$scope.postImgLoader="",$scope.progress="";var uploader=$scope.uploader=new FileUploader({url:APP.service.uploaduserprofileimages+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id},dataObjName:"reqObj",formDataName:"user_media"});uploader.onAfterAddingFile=function(fileItem){uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imagePrvSrc=response.data)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){$timeout(function(){$scope.fileNotValidMsg=$scope.i18n.editprofile.no_media_valid},4e3)},$scope.removeImage=function(){$scope.postFiles="",$scope.imageSrc="",$("input[type='file']").val("")}}]),app.controller("UserCoverProfileController",["$cookieStore","$rootScope","$scope","$route","$http","$location","$timeout","$interval","$routeParams","fileReader","ProfileService","AffiliatedkService","TranslationService",function($cookieStore,$rootScope,$scope,$route,$http,$location,$timeout,$interval,$routeParams,fileReader,ProfileService,AffiliatedkService,TranslationService){$scope.coverImageUploadStart=!1,$rootScope.timelineActive="profiles";var activeUrl=$location.path().replace("/","");switch(-1!=activeUrl.indexOf("album/images")&&(activeUrl="album"),-1!=activeUrl.indexOf("timeline")&&(activeUrl="timeline"),$scope.i18n.storealbum?$scope.invalidCoverImageMgs=$scope.i18n.storealbum.album_invalidCoverImageMgs:TranslationService.getTranslationWithCallback($scope,$scope.activeLanguage,function(data){$scope.i18n=data,$scope.invalidCoverImageMgs=$scope.i18n.storealbum.album_invalidCoverImageMgs}),$scope.imageCropResult=null,$scope.imageCropResult2=null,$scope.imageWidth=null,$scope.imageHeight=null,$scope.showImageCropper=!1,$scope.showImageCropper2=!1,$scope.imageString="",$scope.file={},$scope.coverLoadHide=!1,activeUrl){case"wallets":$rootScope.timelineActive="wallets";break;case"friends":$rootScope.timelineActive="friends";break;case"album":$rootScope.timelineActive="album";break;case"myclubs":$rootScope.timelineActive="club";break;case"club":$rootScope.timelineActive="club";break;case"timeline":$rootScope.timelineActive="timeline";break;case"shope":$rootScope.timelineActive="shope";break;case"myshops/1":$rootScope.timelineActive="shope";break;case"myshops/2":$rootScope.timelineActive="shope";break;case"about":$rootScope.timelineActive="about";break;case"profiles":$rootScope.timelineActive="profiles";break;case"profiles/"+APP.profileType.brokerProfile:$rootScope.timelineActive="profiles";break;case"profiles/"+APP.profileType.citizenProfile:$rootScope.timelineActive="profiles";break;case"followers":$rootScope.timelineActive="more";break;case"citizen/affiliates":$rootScope.timelineActive="more";break;case"broker/affiliates":$rootScope.timelineActive="more";break;case"shop/affiliates":$rootScope.timelineActive="more";break;case"followings":$rootScope.timelineActive="more";break;default:$rootScope.timelineActive="profiles"}$scope.imageXPosition=0,$scope.imageYPosition=0,$scope.setImageCordinate=function(){$scope.imageXPosition=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord,$scope.imageYPosition=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord,$scope.saveCordinate()},$scope.showCanves=!1,$scope.repositionImage=function(){$scope.showCanves=!0,$scope.fileUrl=$rootScope.currentUser.basicProfile.profile_cover_img.thumb,$scope.imageXPosition=-1*$rootScope.currentUser.basicProfile.profile_cover_img.x_cord,$scope.imageYPosition=-1*$rootScope.currentUser.basicProfile.profile_cover_img.y_cord,$scope.coverLoadHide=!0},$scope.showcrossactive=!0,$scope.showcrossactive1=function(){$scope.showcrossactive=!1},$scope.myFile="",$scope.invalidCoverImage=!1,$scope.getFile=function(){$scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.readImage($scope.myFile,function(data){0!=data.length&&data.width>=910&&data.height>=400?$scope.uploadProfileCover():($("#invalidCoverImage").show(),$timeout(function(){$("#invalidCoverImage").hide()},2e3))})})},$scope.readImage=function(file,callback){var reader=new FileReader,image=new Image;reader.readAsDataURL(file),reader.onload=function(_file){var filedata={};image.src=_file.target.result,image.onload=function(){{var w=this.width,h=this.height;file.type,file.name,~~(file.size/1024)+"KB"}$scope.imageWidth=this.width,$scope.imageHeight=this.height,filedata.width=w,filedata.height=h,callback(filedata)},image.onerror=function(){callback(filedata)}}},$scope.newImage=!1,$scope.uploadProfileCover=function(){$scope.showCoverOption=!1,$scope.coverImageUploadStart=!0;var opts={};opts.user_id=APP.currentUser.id,opts.user_media=$scope.myFile,opts.base_64_data=$scope.imageString,$scope.fileUrl="",$scope.showCanves=!0,ProfileService.uploadCoverPhoto(opts,$scope.myFile,function(data){"101"==data.code?($rootScope.currentUser.basicProfile.profile_cover_img.original=data.data.user_info.cover_image,$rootScope.currentUser.basicProfile.profile_cover_img.thumb=data.data.user_info.cover_image_thumb,$scope.coverImageUploadStart=!1,$scope.fileUrl=data.data.user_info.cover_image_thumb,$scope.newImage=!0,$rootScope.currentUser.basicProfile.profile_cover_img.media_id=data.data.user_info.media_id,$scope.showCanves=!0,$scope.coverLoadHide=!0):($scope.coverImageUploadStart=!1,$scope.coverLoadHide=!0,$scope.showCanves=!0)})},$scope.getAffiliateCounts=function(){var opts={};opts.user_id=APP.currentUser.id,opts.session_id=APP.currentUser.id,AffiliatedkService.getAllcounts(opts,function(data){101==data.code&&($scope.totalCounts=data.data)})},$scope.getAffiliateCounts();var img=new Image;$scope.saveCordinate=function(){$scope.hideUpdateCoverButton=!0,$scope.showCanves=!1;var opts={};opts.session_id=APP.currentUser.id,opts.media_id=$rootScope.currentUser.basicProfile.profile_cover_img.media_id,opts.session_id=APP.currentUser.id,opts.x=""+-1*$rootScope.currentUser.basicProfile.profile_cover_img.x_cord,opts.y=""+-1*$rootScope.currentUser.basicProfile.profile_cover_img.y_cord,ProfileService.sendMediaCoordinate(opts,function(data){101==data.code&&"SUCCESS"==data.message&&($scope.coverLoadHide=!1,$scope.file=null,$scope.fileUrl=null,$scope.hideUpdateCoverButton=!1,$scope.showCoverOption=!1,$scope.showCanves=!1,$rootScope.currentUser.basicProfile.profile_cover_img.x_cord=data.data.x_cord,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=data.data.y_cord,1==$rootScope.mobileView&&(img=null,img=new Image,img.src=$rootScope.currentUser.basicProfile.profile_cover_img.thumb,$scope.windowWidth<="480"?img.onload=function(){img.width<=910?""!=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord?($rootScope.currentUser.basicProfile.profile_cover_img.y_cord>100?$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/3:$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/4,$rootScope.mobileX_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>910&&img.width<=1300?""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/4:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/5,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>1300&&(""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/5:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/6,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0))}:$scope.windowWidth>"480"&&$scope.windowWidth<="768"&&(img.onload=function(){img.width<=910?""!=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord?($rootScope.currentUser.basicProfile.profile_cover_img.y_cord>100?$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/1.8:$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/2,$rootScope.mobileX_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>910&&img.width<=1300?""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/2:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/2.2,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>1300&&(""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/2.8:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/3,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0))})))})},$scope.showCoverOption=!1,$scope.showCoverDropDown=function($event){$scope.showCoverOption=!$scope.showCoverOption,$event.stopPropagation()},window.onclick=function(){$timeout(function(){$scope.showCoverOption&&($scope.showCoverOption=!1,$scope.$apply())},100)},$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?(1==$rootScope.mobileView&&$timeout(function(){$scope.changeCordinatevalue()},1e3),$rootScope.mobileView=!0):$rootScope.mobileView=!1},!0),$scope.changeCordinatevalue=function(){void 0!==$rootScope.currentUser&&(img=null,img=new Image,img.src=$rootScope.currentUser.basicProfile.profile_cover_img.thumb,$scope.windowWidth<="480"?img.onload=function(){img.width<=910?""!=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord?($rootScope.currentUser.basicProfile.profile_cover_img.y_cord>100?$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/3:$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/4,$rootScope.mobileX_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>=910&&img.width<=1300?""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/4:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/5,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>1300&&(""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/5:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/6,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0))}:$scope.windowWidth>"480"&&$scope.windowWidth<="768"&&(img.onload=function(){img.width<=910?""!=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord?($rootScope.currentUser.basicProfile.profile_cover_img.y_cord>100?$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/1.8:$rootScope.mobileY_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.y_cord/2,$rootScope.mobileX_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>910&&img.width<1300?""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/2:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/2.2,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0):img.width>1300&&(""!=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord?($rootScope.currentUser.basicProfile.profile_cover_img.x_cord>100?$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/2.8:$rootScope.mobileX_Cord=$rootScope.currentUser.basicProfile.profile_cover_img.x_cord/3,$rootScope.mobileY_Cord=0):($rootScope.currentUser.basicProfile.profile_cover_img.x_cord=0,$rootScope.currentUser.basicProfile.profile_cover_img.y_cord=0,$rootScope.mobileX_Cord=0,$rootScope.mobileY_Cord=0))}))}}]),app.controller("ProfilePostController",["$scope","$timeout","ProfileService","FileUploader","$sce",function($scope,$timeout,ProfileService,FileUploader,$sce){$scope.postErrMsg="",$scope.postContentStart=!1,$scope.showComments=[],$scope.commentsShowLimit=[],$scope.commentsLength=[],$scope.commentLoading=[],$scope.getComments=function(postIndx){var post=$scope.userPostList[postIndx];$scope.userPostList[postIndx].comments=[];var opts={};opts.post_id=post.id,opts.limit_start=0,opts.limit_size=20,ProfileService.getDashboardComments(opts,function(data){100==data.code?($scope.userPostList[postIndx].comments=data.data.comment,$scope.commentLoading[postIndx]=!1,$scope.showComments[postIndx]=!1,$scope.commentsShowLimit[postIndx]=4,$scope.commentsLength[postIndx]=$scope.userPostList[postIndx].comments.length,0!=$scope.userPostList[postIndx].comments.length&&($scope.noComment=!0)):$scope.commentLoading[postIndx]=!1})},$scope.deletePostMedia=function(indx){var postData={};postData=$scope.userPostList[indx];var formData={};formData.user_id=APP.currentUser.id,formData.post_media_id=postData.media_info[0].id,ProfileService.deletePostMedia(formData,function(data){101==data.code?$scope.userPostList[indx].media_info.splice(0,1):($scope.message=data.message,$scope.userPostList)})},$(".fancybox").fancybox()}]).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("SinglePostController",["$scope","$rootScope","ipCookie","$http","$routeParams","$location","PublicService",function($scope,$rootScope,ipCookie,$http,$routeParams,$location,PublicService){if(ipCookie("loggedInUser")&&ipCookie("access_token"))$location.path("post/"+$routeParams.postId);else{$rootScope.isPublic=!0,$scope.postPageLoader=!0,$scope.postPageNotFound=!1;var opts={};opts.post_id=$routeParams.postId,opts.post_type="user",PublicService.getPublicPost(opts,function(data){101==data.code?($scope.postPageLoader=!1,$scope.posts=data.data.post,$rootScope.publicUser=data.data.post[0]):($scope.posts=[],$scope.postPageLoader=!1,$scope.postPageNotFound=!0)})}}]),app.controller("ClubSinglePostController",["$scope","$rootScope","ipCookie","$http","$routeParams","$location","PublicService",function($scope,$rootScope,ipCookie,$http,$routeParams,$location,PublicService){if(ipCookie("loggedInUser")&&ipCookie("access_token"))$location.path("/club/"+$routeParams.postId+"/post/"+$routeParams.postId+"/"+$routeParams.status);else{$rootScope.isPublic=!0,$scope.postPageLoader=!0,$scope.postPageNotFound=!1;var opts={};opts.post_id=$routeParams.postId,opts.post_type="club",PublicService.getPublicPost(opts,function(data){101==data.code?($scope.postPageLoader=!1,$scope.posts=data.data.post,$rootScope.publicUser=data.data.post[0]):($scope.posts=[],$scope.postPageLoader=!1,$scope.postPageNotFound=!0)})}}]),app.controller("ShopSinglePostController",["$scope","$rootScope","ipCookie","$http","$routeParams","$location","PublicService",function($scope,$rootScope,ipCookie,$http,$routeParams,$location,PublicService){if(ipCookie("loggedInUser")&&ipCookie("access_token"))$location.path("/shop/"+$routeParams.shopId+"/post/"+$routeParams.postId);else{$rootScope.isPublic=!0,$scope.postPageLoader=!0,$scope.postPageNotFound=!1;var opts={};opts.post_id=$routeParams.postId,opts.post_type="shop",PublicService.getPublicPost(opts,function(data){101==data.code?($scope.postPageLoader=!1,$scope.posts=data.data.post,$rootScope.publicUser=data.data.post[0]):($scope.posts=[],$scope.postPageLoader=!1,$scope.postPageNotFound=!0)})}}]),app.controller("PostTaggedDetail",["$cookieStore","$scope","$rootScope","$http","$timeout","$routeParams","ProfileService",function($cookieStore,$scope,$rootScope,$http,$timeout,$routeParams,ProfileService){$scope.readNotification=function(id){opts={},opts.user_id=APP.currentUser.id.toString(),opts.notification_id=id,ProfileService.markReadNotification(opts,function(data){101==data.code})}}]),app.controller("ShopPostDetail",["$cookieStore","$modal","$location","$scope","$rootScope","$http","$timeout","$routeParams","StoreService",function($cookieStore,$modal,$location,$scope,$rootScope,$http,$timeout,$routeParams,StoreService){$scope.storeId=$routeParams.shopId,$scope.posts=[],$scope.storePostLoading=!0,$scope.textLimit=APP.post_charecter_limit,opts={},opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.shopId,opts.post_id=$routeParams.postId,StoreService.getStorePostDetail(opts,function(data){101==data.code?$scope.posts=data.data:$scope.posts=[],$scope.storePostLoading=!1}),$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,
$scope.creater=creater_info;var modalInstance=$modal.open({template:'<div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a href ng-click="viewFriendProile(friend.id)">{{friend.first_name}} {{friend.last_name}}</a></span></li></ul></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}}]),app.controller("ClubPostDetail",["$cookieStore","$scope","$rootScope","$http","$timeout","$routeParams","GroupService",function($cookieStore,$scope,$rootScope,$http,$timeout,$routeParams,GroupService){$scope.posts=[],$scope.groupPostDetailLoading=!1,$scope.textLimit=APP.post_charecter_limit,opts={},opts.user_id=APP.currentUser.id,opts.user_group_id=$routeParams.clubId,opts.post_id=$routeParams.postId,GroupService.getClubPostDetail(opts,function(data){101==data.code?$scope.posts=data.data:$scope.posts=[],$scope.groupPostDetailLoading=!0})}]),app.controller("GroupDetailNotiController",["$scope","$http","$rootScope","$location","$routeParams","$interval","GroupService","ProfileService","fileReader","$timeout","$modal","$log",function($scope,$http,$rootScope,$location,$routeParams,$interval,GroupService,ProfileService,fileReader,$timeout,$modal,$log){$scope.displayGroupNotiDetail=function(){var groupId=$routeParams.clubId,groupStatus=$routeParams.status;opts={},opts.user_id=APP.currentUser.id,opts.group_id=groupId,opts.group_status=groupStatus,GroupService.getGroupDetail(opts,function(data){$scope.groupViewLoader=!1,101==data.code&&($scope.groupDetail=data.data,$scope.editGroupObject=$scope.groupDetail)})},$scope.displayGroupNotiDetail()}]),app.directive("rateCommonClubPost",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/rating_star_post.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.avg_rate=!0,$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.showPeopleLoader=!1,$scope.max=5,$scope.isReadonly=!1,$scope.WaitDeleteResponse=!1,$scope.stars=[],$scope.findPeople=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type="club_post",opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.ratePost=function(rating,post_id,index){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="club_post",opts.type_id=post_id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.posts[index].is_rated?"update":"add",waitRequest=ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.posts[index].avg_rate=data.data.avg_rate,$scope.posts[index].no_of_votes=data.data.no_of_votes,$scope.posts[index].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[index].is_rated=!1,$scope.posts[index].current_user_rate=0),$scope.waitRateResponse=!1})},$scope.removeRating=function(post_id,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.type="club_post",opts.type_id=post_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.posts[postIndx].current_user_rate=0,$scope.posts[postIndx].is_rated=!1,$scope.posts[postIndx].no_of_votes=data.data.no_of_votes,$scope.posts[postIndx].avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[postIndx].current_user_rate=0,$scope.posts[postIndx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]),app.directive("rateCommonStorePost",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/rating_star_post.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.avg_rate=!0,$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.showPeopleLoader=!1,$scope.max=5,$scope.isReadonly=!1,$scope.WaitDeleteResponse=!1,$scope.stars=[],$scope.findPeople=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type="store_post",opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.ratePost=function(rating,post_id,index){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="store_post",opts.type_id=post_id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.posts[index].is_rated?"update":"add",waitRequest=ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.posts[index].avg_rate=data.data.avg_rate,$scope.posts[index].no_of_votes=data.data.no_of_votes,$scope.posts[index].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[index].is_rated=!1,$scope.posts[index].current_user_rate=0),$scope.waitRateResponse=!1})},$scope.removeRating=function(post_id,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.type="store_post",opts.type_id=post_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.posts[postIndx].current_user_rate=0,$scope.posts[postIndx].is_rated=!1,$scope.posts[postIndx].no_of_votes=data.data.no_of_votes,$scope.posts[postIndx].avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[postIndx].current_user_rate=0,$scope.posts[postIndx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]),app.controller("ReportController",["$scope","$rootScope","$routeParams","$timeout","StoreService",function($scope,$rootScope,$routeParams,$timeout,StoreService){var arrTransactionMarker=[];$scope.storeId=$routeParams.id;var map,locations=[],geocoder=new google.maps.Geocoder,circle=null,gmarkers=[];$scope.setAllMarker=function(map){for(var i=0;i<arrTransactionMarker.length;i++)arrTransactionMarker[i].setMap(map)},$scope.setgmarkersMarker=function(map){for(var i=0;i<gmarkers.length;i++)gmarkers[i].setMap(map)};var arrId=[];$scope.activeClassFirst="",$scope.activeClassSecond="",$scope.reportTransaction=function(value){$scope.maploader=!0,locations=[],$scope.setAllMarker(null),$scope.setgmarkersMarker(null),arrTransactionMarker=[],gmarkers=[],$scope.displayLoader=!0;var opts={};2===value?($scope.activeClassFirst="",$scope.activeClassSecond="active",opts={$collection:"sixc_transactions",$fields:{transaction_value:1,"citizen_id.name":1,"citizen_id.address_l1":1,"citizen_id.address_l2":1,"citizen_id.city":1,"citizen_id.country":1,"citizen_id.state":1,"citizen_id.user_thumbnail_image":1,"citizen_id.longitude":1,"citizen_id.latitude":1},$filter:{shop_id:String($scope.storeId),status:"Approved",transaction_type_id:{$in:["553209267dfd81072b176bba","553209267dfd81072b176bbc"]}},$sort:{date:-1}}):($scope.activeClassFirst="active",$scope.activeClassSecond="",opts={$collection:"sixc_transactions",$fields:{transaction_value:1,"citizen_id.name":1,"citizen_id.address_l1":1,"citizen_id.address_l2":1,"citizen_id.city":1,"citizen_id.country":1,"citizen_id.state":1,"citizen_id.user_thumbnail_image":1,"citizen_id.longitude":1,"citizen_id.latitude":1},$filter:{shop_id:String($scope.storeId),"offer_id.start_date":{$lte:"$$CurrentDate"},"offer_id.end_date":{$gte:"$$CurrentDate"},status:"Approved",transaction_type_id:{$in:["553209267dfd81072b176bba"]}},$sort:{date:-1}}),StoreService.getReportTransacation(opts,function(data){if($scope.maploader=!1,200==data.code&&"ok"==data.status){$scope.reportlist=data.response.result,$scope.reportlistsearch=data.response.result,$scope.reportlist.length>$scope.itemsPerPage&&($scope.pagination=!0);for(var i=0;i<$scope.reportlist.length;i++){var mi=new Array($scope.reportlist[i].citizen_id.latitude,$scope.reportlist[i].citizen_id.longitude,$scope.reportlist[i].citizen_id._id,$scope.reportlist[i].citizen_id.user_thumbnail_image,$scope.reportlist[i].citizen_id.name,$scope.reportlist[i].transaction_value,$scope.reportlist[i].citizen_id.address_l2,$scope.reportlist[i]._id);locations.push(mi)}$scope.initializeReportMap()}else $scope.pagination=!1})},$scope.reportTransactionTab=function(value){circle&&circle.setMap(null),$scope.maploader=!0,locations=[],$scope.setAllMarker(null),$scope.setgmarkersMarker(null),arrTransactionMarker=[],gmarkers=[],$scope.displayLoader=!0,$("#pac-input").val("");var opts={};2===value?($scope.activeClassFirst="",$scope.activeClassSecond="active",opts={$collection:"sixc_transactions",$fields:{transaction_value:1,"citizen_id.name":1,"citizen_id.address_l1":1,"citizen_id.address_l2":1,"citizen_id.city":1,"citizen_id.country":1,"citizen_id.state":1,"citizen_id.user_thumbnail_image":1,"citizen_id.longitude":1,"citizen_id.latitude":1},$filter:{shop_id:String($scope.storeId),status:"Approved",transaction_type_id:{$in:["553209267dfd81072b176bba","553209267dfd81072b176bbc"]}},$sort:{date:-1}}):($scope.activeClassFirst="active",$scope.activeClassSecond="",opts={$collection:"sixc_transactions",$fields:{transaction_value:1,"citizen_id.name":1,"citizen_id.address_l1":1,"citizen_id.address_l2":1,"citizen_id.city":1,"citizen_id.country":1,"citizen_id.state":1,"citizen_id.user_thumbnail_image":1,"citizen_id.longitude":1,"citizen_id.latitude":1},$filter:{shop_id:String($scope.storeId),"offer_id.start_date":{$lte:"$$CurrentDate"},"offer_id.end_date":{$gte:"$$CurrentDate"},status:"Approved",transaction_type_id:{$in:["553209267dfd81072b176bba"]}},$sort:{date:-1}}),StoreService.getReportTransacation(opts,function(data){if($scope.maploader=!1,200==data.code&&"ok"==data.status){$scope.reportlist=data.response.result,$scope.reportlistsearch=data.response.result,$scope.reportlist.length>$scope.itemsPerPage&&($scope.pagination=!0);for(var i=0;i<$scope.reportlist.length;i++){var mi=new Array($scope.reportlist[i].citizen_id.latitude,$scope.reportlist[i].citizen_id.longitude,$scope.reportlist[i].citizen_id._id,$scope.reportlist[i].citizen_id.user_thumbnail_image,$scope.reportlist[i].citizen_id.name,$scope.reportlist[i].transaction_value,$scope.reportlist[i].citizen_id.address_l2,$scope.reportlist[i]._id);locations.push(mi)}map.setCenter(new google.maps.LatLng(41.9,12.4833)),map.setZoom(6);for(var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},i=0;i<locations.length;i++)marker=new google.maps.Marker({position:new google.maps.LatLng(locations[i][0],locations[i][1]),map:map,icon:pin}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){void 0==locations[i][6]&&(locations[i][6]=""),infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><a href='#/viewfriend/"+locations[i][2]+"'><img src='app/assets/images/prof-pic.jpg'></a></div><div class='desc'><a href='#/viewfriend/"+locations[i][2]+"'><span class='name'>"+locations[i][4]+"</span></a><span class='add-map'>"+locations[i][6]+"</span><span class='currency'>"+locations[i][5]+" euro</span></div></div>":"<div class='mappopup'><div class='pic-container'><a href='#/viewfriend/"+locations[i][2]+"'><img src='"+locations[i][3]+"'></a></div><div class='desc'><a href='#/viewfriend/"+locations[i][2]+"'><span class='name'>"+locations[i][4]+"</span></a><span class='add-map'>"+locations[i][6]+"</span><span class='currency'>"+locations[i][5]+" euro</span></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrTransactionMarker.push(marker),gmarkers.push(marker)}else $scope.pagination=!1})},$scope.initializeReportMap=function(){var mapOptions={zoom:6,center:new google.maps.LatLng(41.9,12.4833)};map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions);for(var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},i=0;i<locations.length;i++)marker=new google.maps.Marker({position:new google.maps.LatLng(locations[i][0],locations[i][1]),map:map,icon:pin}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){void 0==locations[i][6]&&(locations[i][6]=""),infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><a href='#/viewfriend/"+locations[i][2]+"'><img src='app/assets/images/prof-pic.jpg'></a></div><div class='desc'><a href='#/viewfriend/"+locations[i][2]+"'><span class='name'>"+locations[i][4]+"</span></a><span class='add-map'>"+locations[i][6]+"</span><span class='currency'>"+locations[i][5]+" euro</span></div></div>":"<div class='mappopup'><div class='pic-container'><a href='#/viewfriend/"+locations[i][2]+"'><img src='"+locations[i][3]+"'></a></div><div class='desc'><a href='#/viewfriend/"+locations[i][2]+"'><span class='name'>"+locations[i][4]+"</span></a><span class='add-map'>"+locations[i][6]+"</span><span class='currency'>"+locations[i][5]+" euro</span></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrTransactionMarker.push(marker),gmarkers.push(marker);var input=document.getElementById("pac-input");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);var searchBox=new google.maps.places.SearchBox(input);google.maps.event.addListener(searchBox,"places_changed",function(){arrId=[];var address=document.getElementById("pac-input").value;document.getElementById("pac-input").value=address;var radius=1e3*parseInt(50,10);geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){var searchCenter=results[0].geometry.location,latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng(),marker=(new google.maps.LatLng(latitude,longitude),new google.maps.Marker({map:map,position:results[0].geometry.location}));marker.setMap(null),circle&&circle.setMap(null),circle=new google.maps.Circle({center:searchCenter,strokeWeight:2,map:map});for(var bounds=new google.maps.LatLngBounds,i=0;i<gmarkers.length;i++)if(google.maps.geometry.spherical.computeDistanceBetween(gmarkers[i].getPosition(),searchCenter)<radius){arrId.push(locations[i][7]);var marker,i,infowindow=new google.maps.InfoWindow;gmarkers[i].getPosition(),google.maps.event.addListener(marker,"click",function(marker,i){return function(){void 0==locations[i][6]&&(locations[i][6]=""),infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><a href='#/viewfriend/"+locations[i][2]+"'><img src='app/assets/images/prof-pic.jpg'></a></div><div class='desc'><a href='#/viewfriend/"+locations[i][2]+"'><span class='name'>"+locations[i][4]+"</span></a><span class='add-map'>"+locations[i][6]+"</span><span class='currency'>"+locations[i][5]+" euro</span></div></div>":"<div class='mappopup'><div class='pic-container'><a href='#/viewfriend/"+locations[i][2]+"'><img src='"+locations[i][3]+"'></a></div><div class='desc'><a href='#/viewfriend/"+locations[i][2]+"'><span class='name'>"+locations[i][4]+"</span></a><span class='add-map'>"+locations[i][6]+"</span><span class='currency'>"+locations[i][5]+" euro</span></div></div>"),infowindow.open(map,marker)}}(marker,i)),bounds.extend(gmarkers[i].getPosition()),gmarkers[i].setMap(map)}else gmarkers[i].setMap(null);arrId.length>0?(map.fitBounds(bounds),map.setZoom(9)):(map.setCenter(new google.maps.LatLng(latitude,longitude)),map.setZoom(6)),$scope.newArraylist()}else alert("Geocode was not successful for the following reason: "+status)})}),google.maps.event.addListener(map,"bounds_changed",function(){var bounds=map.getBounds();searchBox.setBounds(bounds)})},$scope.reportTransaction(2);var resultArray=[];$scope.newArraylist=function(){resultArray=[];for(var j=0;j<arrId.length;j++)for(var k=0;k<$scope.reportlistsearch.length;k++)$scope.reportlistsearch[k]._id==arrId[j]&&resultArray.push($scope.reportlistsearch[k]);$scope.reportlist=resultArray,$scope.currentPage=0,$timeout(function(){$scope.range()},2e3)},$scope.currentPage=0,$scope.itemsPerPage=8,$scope.pagination=!1,$scope.totalsize=[],$scope.range=function(){var start,rangeSize=Math.ceil($scope.reportlist.length/$scope.itemsPerPage),ret=[];start=$scope.currentPage,start>$scope.pageCount()-rangeSize&&(start=$scope.pageCount()-rangeSize+1);for(var i=start;start+rangeSize>i;i++)ret.push(i);return $scope.totalsize=ret,ret},$scope.prevPage=function(){$scope.currentPage>0&&$scope.currentPage--},$scope.prevPageDisabled=function(){return 0===$scope.currentPage?"disabled":""},$scope.pageCount=function(){return void 0!==$scope.reportlist?Math.ceil($scope.reportlist.length/$scope.itemsPerPage)-1:void 0},$scope.nextPage=function(){$scope.currentPage<$scope.pageCount()&&$scope.currentPage++},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.pageCount()?"disabled":""},$scope.setPage=function(n){$scope.currentPage=n},$scope.pageinit=function(){$scope.currentPage=0}}]),app.controller("InvitedUserJoinSite",["$cookieStore","$rootScope","ipCookie","$scope","$http","TopLinkService","$timeout","$routeParams","$location",function($cookieStore,$rootScope,ipCookie,$scope,$http,TopLinkService,$timeout,$routeParams,$location){$scope.coming_user_id=$routeParams.user_id,$scope.profile_type=$routeParams.type,$scope.isValid=0,$scope.validInvitedUser=!1,$scope.checkingloader=!0;var opts={};opts.user_id=$routeParams.user_id,opts.type=$routeParams.type,4==opts.type?($scope.validInvitedUser=!0,$scope.checkingloader=!1,TopLinkService.setNoAffiliated(!0)):5==opts.type?($scope.validInvitedUser=!0,$scope.checkingloader=!1):TopLinkService.checkIsValidAffiliation(opts,function(data){var Affiliated={};Affiliated.affiliator_id=opts.user_id,Affiliated.type=opts.type,3==Affiliated.type?localStorage.setItem("ShopAffiliatedObject",JSON.stringify(Affiliated)):1==Affiliated.type&&localStorage.setItem("CitizenAffiliatedObject",JSON.stringify(Affiliated)),TopLinkService.setAffiliationObject(opts),101==data.code?(1==opts.type?$location.path("/citizen_affiliation_regis"):$scope.checkingloader=!1,$scope.validInvitedUser=!0):($scope.validInvitedUser=!1,$scope.checkingloader=!1)})}]),app.controller("ShopLanding2Controller",["$cookieStore","$scope","$rootScope","$window","ipCookie","$http","$routeParams","$timeout","$location","AffiliatedkService","TopLinkService","UserService","EMAILPATTERN","focus",function($cookieStore,$scope,$rootScope,$window,ipCookie,$http,$routeParams,$timeout,$location,AffiliatedkService,TopLinkService,UserService,EMAILPATTERN,focus){if($scope.showLoading=!0,$scope.sameAccount=!1,$scope.newAccount=!1,$scope.newLogin=!1,$scope.profileType=$routeParams.profileType,$scope.months=$scope.i18n.profile.months,$scope.countries=$scope.i18n.countries,$scope.years=[],$scope.getYears=function(){var currentYear=(new Date).getFullYear();$scope.years=[];for(var i=currentYear;i>=1914;i--)$scope.years.push({id:i,value:i})},$scope.getYears(),$scope.$watch("currentLanguage",function(newValue,oldValue){$timeout(function(){$scope.months=$scope.i18n.profile.months,$scope.countries=$scope.i18n.countries},400)}),$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],$scope.$watch("user.month",function(newValue){newValue&&newValue.value-7<=0?newValue.value%2==1?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:newValue&&newValue.value%2==1?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],newValue&&2==newValue.value&&($scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28])}),$scope.$watch("user.year",function(newValue){newValue&&newValue.value%4==0&&2==$scope.user.month.value&&($scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29])}),TopLinkService.getAffiliationObject().hasOwnProperty("user_id")){var affiliate=TopLinkService.getAffiliationObject();$scope.isreferralId=affiliate.user_id,$scope.referralId=affiliate.user_id,$scope.filtertypeId=affiliate.type}$scope.currentUser.id?$scope.currentUser.basicProfile?($scope.sameAccount=!0,$scope.oldUser={},$scope.oldUser.userEmail=$scope.currentUser.basicProfile.email,$scope.oldUser.userPassword=123456,$scope.oldUser.firstName=$scope.currentUser.basicProfile.firstname,$scope.oldUser.lastName=$scope.currentUser.basicProfile.lastname,$scope.oldUser.gender=$scope.currentUser.basicProfile.gender,$scope.oldUser.dob=$scope.currentUser.basicProfile.date_of_birth?$scope.currentUser.basicProfile.date_of_birth.date:"",$scope.oldUser.country=$scope.currentUser.basicProfile.country.name):$location.path("/"):$scope.newAccount=!0,$scope.changeLoginAccount=function(){$scope.sameAccount=!1,$scope.newAccount=!1,$scope.newLogin=!0},$scope.alreadyUserLogin=function(){var isAlreadyUser={};isAlreadyUser.yes=!0,isAlreadyUser.profileType=$scope.profileType,TopLinkService.setIsAlreadyUserLogin(isAlreadyUser),$location.path("/")},$scope.createNewAccount=function(){$scope.sameAccount=!1,$scope.newAccount=!0,$scope.newLogin=!1},$scope.back=function(){$scope.sameAccount=!0,$scope.newAccount=!1,$scope.newLogin=!1},$scope.backLocation=function(){$window.history.back()},$scope.changeAccountSubmitted=!1,$scope.proceedWithNewAccount=function(){if($scope.changeAccountSubmitted=!0,void 0===$scope.changeUser.userName||""===$scope.changeUser.userName)return $scope.user.email.$dirty=!0,$scope.user.email.$invalid=!0,$scope.user.email.$error.required=!0,focus("changeemailid"),!1;if(void 0===$scope.changeUser.password||""===$scope.changeUser.password)return $scope.user.changepassword.$dirty=!0,$scope.user.changepassword.$invalid=!0,$scope.user.changepassword.$error.required=!0,focus("changepassword"),!1;$scope.loginStart=!0;var opts1={reqObj:{client_id:APP.keys.client_id,client_secret:APP.keys.client_secret,grant_type:APP.keys.grant_type,username:$scope.changeUser.userName,password:$.base64.encode($scope.changeUser.password)}};UserService.getAccessToken(opts1).then(function(data){if("invalid_request"!=data.data.error){APP.accessToken=data.data.access_token;var opts2={};opts2.username=$scope.changeUser.userName,opts2.password=$.base64.encode($scope.changeUser.password),UserService.getLoginUser(opts2,function(data){if(data.data&&100!=data.code){APP.currentUser=data.data,ipCookie("loggedInUser",data.data,{expires:365}),ipCookie("access_token",APP.accessToken,{expires:3e3}),$rootScope.currentUser=data.data,$rootScope.isLoggedIn=!0,$scope.selectlanguage("IT"==APP.currentUser.country?"it":"en");var opts3={};opts3.user_id=APP.currentUser.id,opts3.profile_type=4,UserService.getBasicProfile(opts3,function(data){101==data.code&&($rootScope.currentUser.basicProfile=data.data);var opts4={};opts4.idcard=$rootScope.currentUser.basicProfile.user_id,UserService.getCreditAndIncome(opts4,function(data){var currentCredit={};101==data.code?(currentCredit.totalCredit=data.data.saldoc/1e6,currentCredit.totCreditMicro=data.data.saldorm+data.data.saldorc,currentCredit.totalIncome=data.data.tot_income,currentCredit.totalIncomeShow=data.data.tot_income,$rootScope.currentUser.creditAndIncome=currentCredit):$rootScope.currentUser.creditAndIncome=data.data})}),$scope.$parent.loggedIn=!0,$location.path("/shop/register/3")}else $scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.loginError=!1},15e3)})}else $scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.loginError=!1},15e3)},function(error){"invalid_request"===data.data.error?($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.loginError=!1},15e3)):($scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.server_not_responding,$timeout(function(){$scope.loginError=!1},15e3))})},$scope.invalidSelectedDob=!1,$scope.formSubmitted=!1,$scope.registerCitizen=function(){var currentDOB=new Date;$scope.formSubmitted=!0;var opts={};return void 0===$scope.user.userEmail||""===$scope.user.userEmail?($scope.user.emailCitizenReg.$dirty=!0,$scope.user.emailCitizenReg.$invalid=!0,$scope.user.emailCitizenReg.$error.required=!0,focus("emailCitizenReg"),!1):void 0===$scope.user.userPassword||""===$scope.user.userPassword?($scope.user.pwdCitizenReg.$dirty=!0,$scope.user.pwdCitizenReg.$invalid=!0,$scope.user.pwdCitizenReg.$error.required=!0,focus("pwdCitizenReg"),!1):void 0===$scope.user.firstName||""===$scope.user.firstName?($scope.user.fname.$dirty=!0,$scope.user.fname.$invalid=!0,$scope.user.fname.$error.required=!0,focus("fname"),!1):void 0===$scope.user.lastName||""===$scope.user.lastName?($scope.user.lname.$dirty=!0,$scope.user.lname.$invalid=!0,$scope.user.lname.$error.required=!0,focus("lname"),!1):void 0===$scope.user.month.value||""===$scope.user.month.value?($scope.user.dobmonth.$dirty=!0,$scope.user.dobmonth.$invalid=!0,$scope.user.dobmonth.$error.required=!0,focus("dobmonth"),!1):void 0===$scope.user.day||""===$scope.user.day?($scope.user.dobday.$dirty=!0,$scope.user.dobday.$invalid=!0,$scope.user.dobday.$error.required=!0,focus("dobday"),!1):void 0===$scope.user.year.value||""===$scope.user.year.value?($scope.user.dobyear.$dirty=!0,$scope.user.dobyear.$invalid=!0,$scope.user.dobyear.$error.required=!0,focus("dobyear"),!1):void 0===$scope.user.gender||0===$scope.user.gender?($scope.user.genCitizenreg.$dirty=!0,$scope.user.genCitizenreg.$invalid=!0,$scope.user.genCitizenreg.$error.required=!0,focus("genCitizenreg"),!1):$scope.user.year.value===currentDOB.getFullYear()&&$scope.user.month.value>=currentDOB.getMonth()+1&&$scope.user.day>currentDOB.getDate()?($scope.invalidSelectedDob=!0,focus("dobday"),$timeout(function(){$scope.invalidSelectedDob=!1},2e3),!1):void 0===$scope.user.country||void 0===$scope.user.country.id||""===$scope.user.country.id?($scope.user.countryReg.$dirty=!0,$scope.user.countryReg.$invalid=!0,$scope.user.countryReg.$error.required=!0,focus("countryReg"),!1):(TopLinkService.getNoAffiliated()||localStorage.getItem("ShopAffiliatedObject")&&(opts.referral_id=JSON.parse(localStorage.getItem("ShopAffiliatedObject")).affiliator_id),opts.email=$scope.user.userEmail,opts.firstname=$scope.user.firstName,opts.lastname=$scope.user.lastName,opts.password=$.base64.encode($scope.user.userPassword),opts.birthday=$scope.user.day+"-"+$scope.user.month.value+"-"+$scope.user.year.id,opts.gender=$scope.user.gender,opts.country=$scope.user.country.id,opts.type=1,$scope.showLoading=!1,UserService.registration(opts,function(data){if(101==data.code){if(1==data.data.profile_type){var opts1={reqObj:{client_id:APP.keys.client_id,client_secret:APP.keys.client_secret,grant_type:APP.keys.grant_type,username:$scope.user.userEmail,password:$.base64.encode($scope.user.userPassword)}};UserService.getAccessToken(opts1).then(function(data){APP.accessToken=data.data.access_token;var opts2={};opts2.username=$scope.user.userEmail,opts2.password=$.base64.encode($scope.user.userPassword),UserService.getLoginUser(opts2,function(data){if(data.data&&100!=data.code){APP.currentUser=data.data,ipCookie("loggedInUser",data.data,{expires:365}),ipCookie("access_token",APP.accessToken,{expires:3e3}),$rootScope.currentUser=data.data,$rootScope.isLoggedIn=!0,$scope.selectlanguage("IT"==APP.currentUser.country?"it":"en");var opts3={};opts3.user_id=APP.currentUser.id,opts3.profile_type=4,UserService.getBasicProfile(opts3,function(data){101==data.code&&($rootScope.currentUser.basicProfile=data.data);var opts4={};opts4.idcard=$rootScope.currentUser.basicProfile.user_id,UserService.getCreditAndIncome(opts4,function(data){var currentCredit={};101==data.code?(currentCredit.totalCredit=data.data.saldoc/1e6,currentCredit.totCreditMicro=data.data.saldorm+data.data.saldorc,currentCredit.totalIncome=data.tot_income,currentCredit.totalIncomeShow=data.tot_income,$rootScope.currentUser.creditAndIncome=currentCredit):$rootScope.currentUser.creditAndIncome=data.data})}),$scope.$parent.loggedIn=!0,$location.path("/shop/register/"+$scope.profileType)}else $scope.showLoading=!0,$scope.signUpSuccessMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.signUpSuccessMsg=""},15e3)})},function(error){"invalid_grant"===error.error?($scope.showLoading=!0,$scope.signUpSuccessMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.signUpSuccessMsg=""},15e3)):($scope.showLoading=!0,$scope.signUpSuccessMsg=$scope.i18n.home.server_not_responding,$timeout(function(){$scope.signUpSuccessMsg=""},15e3))})}}else 136==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.user_exists,$scope.showLoading=!0):154==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.citizen_not_exists,$scope.showLoading=!0):137==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.broker_not_exists,$scope.showLoading=!0):131==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.date_format_incorrect,$scope.showLoading=!0):100==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.missed_param,
$scope.showLoading=!0):129==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.invalid_country_code,$scope.showLoading=!0):130==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.invalid_gender_type,$scope.showLoading=!0):133==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.invalid_profile_setting,$scope.showLoading=!0):143==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.referral_id_needed,$scope.showLoading=!0):135==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.email_invalid,$scope.showLoading=!0):($scope.signUpSuccessMsg=data.message,$scope.showLoading=!0);$timeout(function(){$scope.signUpSuccessMsg=""},15e3)}),void 0)}}]),app.controller("ShopRegisterController",["$cookieStore","$rootScope","ipCookie","$scope","$http","StoreService","$timeout","$routeParams","$location","TopLinkService","ProfileService","focus",function($cookieStore,$rootScope,ipCookie,$scope,$http,StoreService,$timeout,$routeParams,$location,TopLinkService,ProfileService,focus){$scope.store={},$scope.store.storecategory={},$scope.store.storecategory.id=0;var tempcat=$scope.store.storecategory.id;if($scope.regions=APP.regions,$scope.enableKeyword=!0,$scope.enableSubcategory=!0,TopLinkService.getAffiliationObject().hasOwnProperty("user_id")){var affiliate=TopLinkService.getAffiliationObject();$scope.isreferralId=affiliate.user_id,$scope.referralId=affiliate.user_id,$scope.filtertypeId=affiliate.type}$scope.$watch("currentLanguage",function(newValue,oldValue){$scope.searchCategory(newValue),""!=tempcat&&0!=tempcat&&$scope.getSubCategory()}),$scope.backLocation=function(){$location.path("/citizen/register/"+$routeParams.profileType)},$scope.searchCategory=function(currentLanguage){var opts={};opts.lang_code=currentLanguage,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,opts.session_id=APP.currentUser.id,ProfileService.searchCatagory(opts,function(data){101===data.code&&"SUCCESS"===data.message&&data.data.length>0&&($scope.categories=data.data)})},$scope.getSubCategory=function(){if(""!=$scope.store.storecategory.id&&0!=$scope.store.storecategory.id){$scope.enableKeyword=!1,$scope.enableSubcategory=!1;var opts={};opts.lang_code=$scope.currentLanguage,opts.cat_id=$scope.store.storecategory.id,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,StoreService.getSubCategoryList(opts,function(data){101===data.code&&"SUCCESS"===data.message&&($scope.subcategories=data.data)})}else $scope.enableKeyword=!0,$scope.enableSubcategory=!0},$scope.searchCategory($scope.currentLanguage),$scope.createStoreLoader=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.store={},$scope.legalForms=APP.legalForms,$scope.countries=$scope.i18n.countries,$scope.createShopErrorMgs="",$scope.vatNumberInvalid=!1,$scope.ibanNumberInvalid=!1,$scope.registerShop=function(){if($scope.createStoreLoader=!0,$scope.formSubmitted=!0,void 0==$scope.store.name||""==$scope.store.name)return $scope.inputname="storename",$scope.shopCreateForm.storename.$dirty=!0,$scope.shopCreateForm.storename.$invalid=!0,$scope.shopCreateForm.storename.$error.required=!0,focus("storename"),$scope.createStoreError=!0,$scope.createStoreLoader=!1,!1;if(void 0==$scope.store.companyName||""==$scope.store.companyName)return $scope.inputname="companyName",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.storecompany.$dirty=!0,$scope.shopCreateForm.storecompany.$invalid=!0,$scope.shopCreateForm.storecompany.$error.required=!0,focus("storecompany"),!1;if(void 0==$scope.store.legalForm||""==$scope.store.legalForm)return $scope.inputname="legalForm",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.legalform.$dirty=!0,$scope.shopCreateForm.legalform.$invalid=!0,$scope.shopCreateForm.legalform.$error.required=!0,focus("legalForm"),!1;if(void 0==$scope.store.vatNumber||""==$scope.store.vatNumber)return $scope.inputname="vatNumber",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.vatnumber.$dirty=!0,$scope.shopCreateForm.vatnumber.$invalid=!0,$scope.shopCreateForm.vatnumber.$error.required=!0,focus("vatNumber"),!1;if(void 0==$scope.store.taxNumber||""==$scope.store.taxNumber)return $scope.inputname="taxNumber",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.taxnumber.$dirty=!0,$scope.shopCreateForm.taxnumber.$invalid=!0,$scope.shopCreateForm.taxnumber.$error.required=!0,focus("taxNumber"),!1;if(void 0==$scope.store.email||""==$scope.store.email)return $scope.inputname="email",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.shopemail.$dirty=!0,$scope.shopCreateForm.shopemail.$invalid=!0,$scope.shopCreateForm.shopemail.$error.required=!0,focus("email"),!1;if(void 0==$scope.store.confirmemail||""==$scope.store.confirmemail||$scope.store.email!==$scope.store.confirmemail)return $scope.inputname="confirmemail",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.confirmemail.$dirty=!0,$scope.shopCreateForm.confirmemail.$invalid=!0,$scope.shopCreateForm.confirmemail.$error.required=!0,focus("confirmemail"),!1;if(void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone))return $scope.inputname="phone",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.shopphone.$dirty=!0,$scope.shopCreateForm.shopphone.$invalid=!0,$scope.shopCreateForm.shopphone.$error.required=!0,focus("phone"),!1;if(void 0==$scope.store.iban||""==$scope.store.iban)return $scope.inputname="iban",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.iban.$dirty=!0,$scope.shopCreateForm.iban.$invalid=!0,$scope.shopCreateForm.iban.$error.required=!0,focus("iban"),!1;if(void 0==$scope.store.storecategory||""==$scope.store.storecategory)return $scope.inputname="storecategory",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.storecategory.$dirty=!0,$scope.shopCreateForm.storecategory.$invalid=!0,$scope.shopCreateForm.storecategory.$error.required=!0,focus("storecategory"),!1;if(void 0==$scope.store.description||""==$scope.store.description)return $scope.inputname="description",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.description.$dirty=!0,$scope.shopCreateForm.description.$invalid=!0,$scope.shopCreateForm.description.$error.required=!0,focus("description"),!1;if(void 0==$scope.store.regOfficeCountry||""==$scope.store.regOfficeCountry)return $scope.inputname="regOfficeCountry",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.regofficecountry.$dirty=!0,$scope.shopCreateForm.regofficecountry.$invalid=!0,$scope.shopCreateForm.regofficecountry.$error.required=!0,focus("regOfficeCountry"),!1;if(void 0==$scope.store.regOfficeRegion||""==$scope.store.regOfficeRegion)return $scope.inputname="regOfficeRegion",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.regofficeregion.$dirty=!0,$scope.shopCreateForm.regofficeregion.$invalid=!0,$scope.shopCreateForm.regofficeregion.$error.required=!0,focus("regOfficeRegion"),!1;if(void 0==$scope.store.regOfficeCity||""==$scope.store.regOfficeCity)return $scope.inputname="regOfficeCity",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.regofficecity.$dirty=!0,$scope.shopCreateForm.regofficecity.$invalid=!0,$scope.shopCreateForm.regofficecity.$error.required=!0,focus("regOfficeCity"),!1;if(""==$scope.store.province||void 0==$scope.store.province)return $scope.inputname="province",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.province.$dirty=!0,$scope.shopCreateForm.province.$invalid=!0,$scope.shopCreateForm.province.$error.required=!0,focus("province"),!1;if(2!=$scope.store.province.length)return $scope.store.province="",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.province.$dirty=!0,$scope.shopCreateForm.province.$invalid=!0,$scope.shopCreateForm.province.$error.required=!0,focus("province"),!1;if(""==$scope.store.regOfficezip||void 0==$scope.store.regOfficezip||1==isNaN($scope.store.regOfficezip))return $scope.inputname="regOfficezip",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.regofficezip.$dirty=!0,$scope.shopCreateForm.regofficezip.$invalid=!0,$scope.shopCreateForm.regofficezip.$error.required=!0,focus("regOfficezip"),!1;if(5!=$scope.store.regOfficezip.length)return $scope.store.regOfficezip="",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.regofficezip.$dirty=!0,$scope.shopCreateForm.regofficezip.$invalid=!0,$scope.shopCreateForm.regofficezip.$error.required=!0,focus("regOfficezip"),!1;if(void 0==$scope.store.regOfficeStreet||""==$scope.store.regOfficeStreet)return $scope.inputname="regOfficeStreet",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.regofficestreet.$dirty=!0,$scope.shopCreateForm.regofficestreet.$invalid=!0,$scope.shopCreateForm.regofficestreet.$error.required=!0,focus("regOfficeStreet"),!1;if(void 0==$scope.store.HQCountry||""==$scope.store.HQCountry)return $scope.inputname="HQCountry",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqcountry.$dirty=!0,$scope.shopCreateForm.hqcountry.$invalid=!0,$scope.shopCreateForm.hqcountry.$error.required=!0,focus("HQCountry"),!1;if(""==$scope.store.HQRegion||void 0==$scope.store.HQRegion)return $scope.inputname="HQRegion",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqregion.$dirty=!0,$scope.shopCreateForm.hqregion.$invalid=!0,$scope.shopCreateForm.hqregion.$error.required=!0,focus("HQRegion"),!1;if(""==$scope.store.HQCity||void 0==$scope.store.HQCity)return $scope.inputname="HQCity",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqcity.$dirty=!0,$scope.shopCreateForm.hqcity.$invalid=!0,$scope.shopCreateForm.hqcity.$error.required=!0,focus("HQCity"),!1;if(""==$scope.store.HQProvince||void 0==$scope.store.HQProvince)return $scope.inputname="HQProvince",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqprovince.$dirty=!0,$scope.shopCreateForm.hqprovince.$invalid=!0,$scope.shopCreateForm.hqprovince.$error.required=!0,focus("HQProvince"),!1;if(2!=$scope.store.HQProvince.length)return $scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqprovince.$dirty=!0,$scope.shopCreateForm.hqprovince.$invalid=!0,$scope.shopCreateForm.hqprovince.$error.required=!0,focus("HQProvince"),!1;if(void 0==$scope.store.HQCap||""==$scope.store.HQCap||1==isNaN($scope.store.HQCap))return $scope.inputname="HQCap",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqcap.$dirty=!0,$scope.shopCreateForm.hqcap.$invalid=!0,$scope.shopCreateForm.hqcap.$error.required=!0,focus("HQCap"),!1;if(5!=$scope.store.HQCap.length)return $scope.store.HQCap="",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqcap.$dirty=!0,$scope.shopCreateForm.hqcap.$invalid=!0,$scope.shopCreateForm.hqcap.$error.required=!0,focus("HQCap"),!1;if(void 0==$scope.store.HQStreet||""==$scope.store.HQStreet)return $scope.inputname="HQStreet",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqstreet.$dirty=!0,$scope.shopCreateForm.hqstreet.$invalid=!0,$scope.shopCreateForm.hqstreet.$error.required=!0,focus("HQStreet"),!1;if(void 0==$scope.store.HQEmail||""==$scope.store.HQEmail)return $scope.inputname="HQEmail",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqemail.$dirty=!0,$scope.shopCreateForm.hqemail.$invalid=!0,$scope.shopCreateForm.hqemail.$error.required=!0,focus("HQEmail"),!1;if(void 0==$scope.store.HQPhone||""==$scope.store.HQPhone||1==isNaN($scope.store.HQPhone))return $scope.inputname="HQPhone",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.hqphone.$dirty=!0,$scope.shopCreateForm.hqphone.$invalid=!0,$scope.shopCreateForm.hqphone.$error.required=!0,focus("HQPhone"),!1;if(void 0==$scope.store.legalTaxCode||""==$scope.store.legalTaxCode)return $scope.inputname="legalTaxCode",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.legaltaxcode.$dirty=!0,$scope.shopCreateForm.legaltaxcode.$invalid=!0,$scope.shopCreateForm.legaltaxcode.$error.required=!0,focus("legalTaxCode"),!1;if(void 0==$scope.store.firstName||""==$scope.store.firstName)return $scope.inputname="firstName",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.firstname.$dirty=!0,$scope.shopCreateForm.firstname.$invalid=!0,$scope.shopCreateForm.firstname.$error.required=!0,focus("firstName"),!1;if(void 0==$scope.store.lastName||""==$scope.store.lastName)return $scope.inputname="lastName",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.lastname.$dirty=!0,$scope.shopCreateForm.lastname.$invalid=!0,$scope.shopCreateForm.lastname.$error.required=!0,focus("lastName"),!1;if(void 0==$scope.store.legalBirthPlace||""==$scope.store.legalBirthPlace)return $scope.inputname="legalBirthPlace",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.legaldobplace.$dirty=!0,$scope.shopCreateForm.legaldobplace.$invalid=!0,$scope.shopCreateForm.legaldobplace.$error.required=!0,focus("legalBirthPlace"),!1;if(void 0==$scope.store.dobDay||""==$scope.store.dobDay)return $scope.inputname="dobDay",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.dobday.$dirty=!0,$scope.shopCreateForm.dobday.$invalid=!0,$scope.shopCreateForm.dobday.$error.required=!0,focus("dobDay"),!1;if(void 0==$scope.store.dobMonth||""==$scope.store.dobMonth)return $scope.inputname="dobMonth",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.dobmonth.$dirty=!0,$scope.shopCreateForm.dobmonth.$invalid=!0,$scope.shopCreateForm.dobmonth.$error.required=!0,focus("dobDay"),!1;if(void 0==$scope.store.dobYear||""==$scope.store.dobYear)return $scope.inputname="dobYear",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.dobyear.$dirty=!0,$scope.shopCreateForm.dobyear.$invalid=!0,$scope.shopCreateForm.dobyear.$error.required=!0,focus("dobDay"),!1;if(void 0==$scope.store.legalEmail||""==$scope.store.legalEmail)return $scope.inputname="legalEmail",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.legalemail.$dirty=!0,$scope.shopCreateForm.legalemail.$invalid=!0,$scope.shopCreateForm.legalemail.$error.required=!0,focus("legalEmail"),!1;if(void 0==$scope.store.legalPhone||""==$scope.store.legalPhone||1==isNaN($scope.store.legalPhone))return $scope.inputname="legalPhone",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.legalphone.$dirty=!0,$scope.shopCreateForm.legalphone.$invalid=!0,$scope.shopCreateForm.legalphone.$error.required=!0,focus("legalPhone"),!1;if(void 0==$scope.store.permntAddress||""==$scope.store.permntAddress)return $scope.inputname="permntAddress",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.permntaddress.$dirty=!0,$scope.shopCreateForm.permntaddress.$invalid=!0,$scope.shopCreateForm.permntaddress.$error.required=!0,focus("permntAddress"),!1;if(void 0==$scope.store.permntProvince||""==$scope.store.permntProvince)return $scope.inputname="permntProvince",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.permntprovince.$dirty=!0,$scope.shopCreateForm.permntprovince.$invalid=!0,$scope.shopCreateForm.permntprovince.$error.required=!0,focus("permntProvince"),!1;if(2!=$scope.store.permntProvince.length)return $scope.store.permntProvince="",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.permntprovince.$dirty=!0,$scope.shopCreateForm.permntprovince.$invalid=!0,$scope.shopCreateForm.permntprovince.$error.required=!0,focus("permntProvince"),!1;if(void 0==$scope.store.permntCity||""==$scope.store.permntCity)return $scope.inputname="permntCity",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.permntcity.$dirty=!0,$scope.shopCreateForm.permntcity.$invalid=!0,$scope.shopCreateForm.permntcity.$error.required=!0,focus("permntCity"),!1;if(void 0==$scope.store.permntZip||""==$scope.store.permntZip||1==isNaN($scope.store.permntZip))return $scope.inputname="permntZip",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.permntzip.$dirty=!0,$scope.shopCreateForm.permntzip.$invalid=!0,$scope.shopCreateForm.permntzip.$error.required=!0,focus("permntZip"),!1;if(5!=$scope.store.permntZip.length)return $scope.store.permntZip="",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.permntzip.$dirty=!0,$scope.shopCreateForm.permntzip.$invalid=!0,$scope.shopCreateForm.permntzip.$error.required=!0,focus("permntZip"),!1;if(void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value)return $scope.inputname="pac-input",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.malLocationEmpty=!0,$timeout(function(){$scope.malLocationEmpty=!1},3e3),focus("pac-input"),!1;if(void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value)return $scope.inputname="pac-input",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.malLocationEmpty=!0,$timeout(function(){$scope.malLocationEmpty=!1},3e3),focus("pac-input"),!1;if(void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value)return $scope.inputname="pac-input",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.malLocationEmpty=!0,$timeout(function(){$scope.malLocationEmpty=!1},3e3),focus("pac-input"),!1;if(""!=$scope.store.referral_id&&void 0!=$scope.store.referral_id){if(isNaN($scope.store.referral_id))return $scope.createStoreErrorMgs=$scope.i18n.store.valid_ref_id,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1}else if(void 0!=$scope.store.dobYear||""!=$scope.store.dobYear){if($scope.store.dobDay.id>29&&2==$scope.store.dobMonth.value)return $scope.inputname="dobDay",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.dobday.$dirty=!0,$scope.shopCreateForm.dobday.$invalid=!0,focus("dobDay"),!1}else if(void 0!=$scope.store.dobYear||""!=$scope.store.dobYear){var isLeap=1==new Date($scope.store.dobYear.id,1,29).getMonth();if(0==isLeap&&$scope.store.dobDay.id>=29&&2==$scope.store.dobMonth.value)return $scope.inputname="dobYear",$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopCreateForm.dobyear.$dirty=!0,$scope.shopCreateForm.dobyear.$invalid=!0,focus("dobYear"),!1}var dd=$scope.store.dobDay.id,month=$scope.store.dobMonth.value+"-",year=$scope.store.dobYear.id+"-";$scope.store.dob=year.concat(month,dd);var opts={};TopLinkService.getNoAffiliated()||localStorage.getItem("ShopAffiliatedObject")&&(opts.referral_id=JSON.parse(localStorage.getItem("ShopAffiliatedObject")).affiliator_id),void 0!=$scope.keywordList||"0"!=$scope.keywordList.length?opts.shop_keyword=$scope.keywordList.join():opts.shop_keyword=[],opts.user_id=APP.currentUser.id,opts.name=$scope.store.name,opts.business_name=$scope.store.companyName,opts.legal_status=$scope.store.legalForm.id,opts.vat_number=$scope.store.vatNumber,opts.fiscal_code=$scope.store.taxNumber,opts.tax_number=$scope.store.taxNumber,opts.email=angular.lowercase($scope.store.email),opts.phone=$scope.store.phone,opts.iban=$scope.store.iban,opts.sale_catid=$scope.store.storecategory.id,opts.sale_subcatid=null,opts.description=$scope.store.description,opts.business_country=$scope.store.regOfficeCountry.id,opts.business_region=$scope.store.regOfficeRegion.id,opts.business_city=$scope.store.regOfficeCity,opts.province=$scope.store.province,opts.zip=$scope.store.regOfficezip,opts.business_address=$scope.store.regOfficeStreet,opts.sale_country=$scope.store.HQCountry.id,opts.sale_region=$scope.store.HQRegion.id,opts.sale_city=$scope.store.HQCity,opts.sale_province=$scope.store.HQProvince,opts.sale_zip=$scope.store.HQCap,opts.sale_address=$scope.store.HQStreet,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.sale_email=angular.lowercase($scope.store.HQEmail),opts.sale_phone_number=$scope.store.HQPhone,opts.repres_fiscal_code=$scope.store.legalTaxCode,opts.repres_first_name=$scope.store.firstName,opts.repres_last_name=$scope.store.lastName,opts.repres_place_of_birth=$scope.store.legalBirthPlace,opts.repres_dob=$scope.store.dob,opts.repres_email=angular.lowercase($scope.store.legalEmail),opts.repres_phone_number=$scope.store.legalPhone,opts.repres_address=$scope.store.permntAddress,opts.repres_province=$scope.store.permntProvince,opts.repres_city=$scope.store.permntCity,opts.repres_zip=$scope.store.permntZip,opts.business_type="not in current use",opts.call_type="2",opts.sale_description="not in current use",opts.sale_map="not in current use",opts.broker_id=0,$scope.createStoreErrorMgs="",StoreService.createStore(opts,function(data){101==data.code?(localStorage.removeItem("ShopAffiliatedObject"),$rootScope.tempStoreId=data.data.store_id,$cookieStore.put("tempStoreId",data.data.store_id),$location.path("/shop/"+data.data.store_id+"/contract")):154==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.citizen_not_exists,$scope.commonError=!0,$timeout(function(){$scope.commonError=!1},3e3),$scope.createStoreError=!0):100==data.code?($scope.createStoreLoader=!1,$scope.createShopErrorMgs=$scope.i18n.validation.missed_param,$scope.commonError=!0,$timeout(function(){$scope.commonError=!1},3e3),$scope.createStoreError=!0):116==data.code?($scope.createStoreLoader=!1,$scope.createShopErrorMgs=$scope.i18n.validation.enter_businessname,$scope.commonError=!0,$timeout(function(){$scope.commonError=!1},3e3),$scope.createStoreError=!0):138==data.code?($scope.createStoreLoader=!1,$scope.createShopErrorMgs=$scope.i18n.validation.vat_exists,$scope.vatNumberInvalid=!0,$scope.createStoreError=!0,$timeout(function(){$scope.vatNumberInvalid=!1},3e3),focus("vatNumber")):85==data.code?($scope.createStoreLoader=!1,$scope.createShopErrorMgs=$scope.i18n.validation.account_inactive,$scope.commonError=!0,$timeout(function(){$scope.commonError=!1},3e3),$scope.createStoreError=!0):165==data.code?($scope.createStoreLoader=!1,$scope.createShopErrorMgs=$scope.i18n.validation.vat_valid,$scope.vatNumberInvalid=!0,$scope.createStoreError=!0,$timeout(function(){$scope.vatNumberInvalid=!1},3e3),focus("vatNumber")):166==data.code?($scope.createStoreLoader=!1,$scope.createShopErrorMgs=$scope.i18n.validation.iban_valid,$scope.ibanNumberInvalid=!0,$scope.createStoreError=!0,$timeout(function(){$scope.ibanNumberInvalid=!1},3e3),focus("iban")):($scope.createStoreLoader=!1,$scope.createStoreError=!0),$timeout(function(){$scope.createShopErrorMgs="",$scope.vatNumberInvalid=!1,$scope.ibanNumberInvalid=!1,$scope.createStoreError=!1},15e3)})},$scope.resetStoreObject=function(){document.getElementById("mapplace").value="",document.getElementById("latitude").value="",document.getElementById("longitude").value="",$scope.store={}},$scope.$on("$viewContentLoaded",function(){$timeout(function(){$scope.initialize()},1e3)}),$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:13},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.lat(),document.getElementById("longitude").value=countryPlace.geometry.location.lng(),document.getElementById("mapplace").value=countryPlace.formatted_address,$scope.store.map_place=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$scope.months=$scope.i18n.profile.months,$scope.days=[],$scope.years=[],$scope.daysLimit=31,$scope.getDays=function(daysLimit){for(start=1;start<=daysLimit;start++)$scope.days.push({id:start,value:start})},$scope.getYears=function(){var currentYear=(new Date).getFullYear();$scope.years=[];for(var i=currentYear;i>=1914;i--)$scope.years.push({id:i,value:i})},$scope.getYears(),$scope.getDays($scope.daysLimit),$scope.changeShopMonth=function(){$scope.store.dobMonth.value%2==1?($scope.days=[],$scope.getDays(31)):2==$scope.store.dobMonth.value&&$scope.store.dobYear.value%4==0?($scope.days=[],$scope.getDays(29)):2==$scope.store.dobMonth.value?($scope.days=[],$scope.getDays(28)):($scope.days=[],$scope.getDays(30))},$scope.changeShopYear=function(){$scope.store.dobYear.value%4==0&&2==$scope.store.dobMonth.value?($scope.days=[],$scope.getDays(29)):$scope.store.dobYear.value%4!=0&&2==$scope.store.dobMonth.value?($scope.days=[],$scope.getDays(28)):$scope.store.dobYear.value%4!=0&&$scope.store.dobMonth.value%2==1?($scope.days=[],$scope.getDays(31)):($scope.days=[],$scope.getDays(30))};var currentTimeout=null,DELAY_TIME_BEFORE_POSTING=300;$("#categoryKeyword").keypress(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchKeyword()},DELAY_TIME_BEFORE_POSTING)}),$scope.keywords=[],$scope.searchKeyword=function(){var opts={};opts.category_id=$scope.store.storecategory.id.toString(),opts.keyword=$scope.store.keywords,opts.session_id=APP.currentUser.id,$scope.cancelKeywordRequest=!1,$scope.showCatKeyLoading=!0,opts.session_id=APP.currentUser.id,ProfileService.searchCatagoryKeyword(opts,function(data){$scope.showCatKeyLoading=!1,101===data.code&&"SUCCESS"===data.message&&$scope.cancelKeywordRequest===!1&&($scope.keywords=data.data.keyword)})},$scope.keywordIndex=-1,$scope.keywordKeyDown=function(event){40===event.keyCode?(event.preventDefault(),$scope.keywordIndex+1!==$scope.keywords.length&&$scope.keywordIndex++):38===event.keyCode?(event.preventDefault(),$scope.keywordIndex-1!==-1&&$scope.keywordIndex--):13===event.keyCode&&$scope.storeKeyword(void 0===$scope.keywords[$scope.keywordIndex]?$scope.categoryKeyword:$scope.keywords[$scope.keywordIndex])},$scope.cancelKeywordRequest=!1,$scope.clearKeyList=function(){$scope.cancelKeywordRequest=!0,$timeout(function(){$scope.keywords=[]},500)},$scope.categoryKeyword="",$scope.keywordList=[],$scope.storeKeyword=function(index){if($scope.keywords=[],$scope.keywordIndex=-1,$scope.categoryKeyword="","object"==typeof index)-1===$scope.keywordList.indexOf(index.name)&&$scope.keywordList.push(index.name);else{if(""===index||void 0===index)return!1;-1===$scope.keywordList.indexOf(index)&&$scope.keywordList.push(index)}},$scope.clearKeywordList=function(){$timeout(function(){$scope.keywords=[]},500)},$scope.removeKeyword=function(index){$scope.keywordList.splice(index,1)}}]),app.controller("ShopTermsandConditions",["$scope","$http","$rootScope","TopLinkService","$timeout","$routeParams","$location","StoreService","StorePaymentService","ProfileService",function($scope,$http,$rootScope,TopLinkService,$timeout,$routeParams,$location,StoreService,StorePaymentService,ProfileService){$scope.loeadingContract=!0,$scope.allowProceed=!1,$scope.ShopDetail=[],$scope.storePaymentUrl="",$scope.agree={},$scope.agree.flag1=0,$scope.agree.flag1=0,$scope.agree.flag1=0,$scope.currentData=new Date;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.shopId,StoreService.getStoreDetail(opts,function(data){$scope.ShopDetail=data.data;var catopts={};catopts.lang_code="it",catopts.cat_id=data.data.sale_catid,catopts.session_id=APP.currentUser.id,catopts.type="show",catopts.session_id=APP.currentUser.id,ProfileService.getCategories(catopts,function(data){101==data.code?$scope.ShopDetail.shop_category=data.data.category_name:$scope.ShopDetail.shop_category="";var opts1={};opts1.profile_id=$routeParams.shopId,opts1.user_id=APP.currentUser.id,opts1.payment_type=APP.card.add_type,opts1.cancel_url=APP.payment.siteDomain+"#/shop/paycancel",opts1.return_url=APP.payment.siteDomain+"#/shop/paysuccess",StorePaymentService.getOneClickPaymentUrls(opts1,function(data){101==data.code&&""!=data.data.url?($scope.loeadingContract=!1,$scope.storePaymentUrl=data.data.url):($scope.loeadingContract=!1,$scope.storePaymentUrl="")})})}),$scope.checkFlag=function(){$scope.agree.flag1&&$scope.agree.flag2&&$scope.agree.flag3&&$scope.agree.flag4?$scope.allowProceed=!0:$scope.allowProceed=!1}}]),app.controller("EditShopController",["$route","$scope","$http","$sce","$routeParams","$location","$timeout","StoreService","fileReader","ProfileService","focus",function($route,$scope,$http,$sce,$routeParams,$location,$timeout,StoreService,fileReader,ProfileService,focus){$scope.store={},$scope.store.storecategory="",$scope.store.sale_subcatid="",$scope.legalForms=APP.legalForms,$scope.countries=APP.countries,$scope.regions=APP.regions;var latitudeMap=0,longitudeMap=0;$scope.months=$scope.i18n.profile.months,$scope.days=[],$scope.years=[],$scope.daysLimit=31,$scope.getDays=function(daysLimit){for(start=1;start<=daysLimit;start++)$scope.days.push({id:start,value:start})},$scope.getYears=function(){var currentYear=(new Date).getFullYear();$scope.years=[];for(var i=1914;currentYear>=i;i++)$scope.years.push({id:i,value:i})},$scope.getYears(),$scope.getDays($scope.daysLimit),$scope.changeShopMonth=function(){$scope.store.dobMonth.value%2===1?($scope.days=[],$scope.getDays(31)):2===$scope.store.dobMonth.value&&$scope.store.dobYear.value%4===0?($scope.days=[],$scope.getDays(29)):2===$scope.store.dobMonth.value?($scope.days=[],$scope.getDays(28)):($scope.days=[],$scope.getDays(30))},$scope.changeShopYear=function(){$scope.store.dobYear.value%4===0&&2===$scope.store.dobMonth.value?($scope.days=[],$scope.getDays(29)):$scope.store.dobYear.value%4!==0&&2===$scope.store.dobMonth.value?($scope.days=[],$scope.getDays(28)):$scope.store.dobYear.value%4!==0&&$scope.store.dobMonth.value%2===1?($scope.days=[],$scope.getDays(31)):($scope.days=[],$scope.getDays(30))},$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var myLatlng=new google.maps.LatLng(latitudeMap,longitudeMap),mapOptions={center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:13},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),
map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,position:myLatlng,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.lat(),document.getElementById("longitude").value=countryPlace.geometry.location.lng(),document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$scope.loadDetails=function(){$scope.storeLoading=!0,$scope.updateStart=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.showEditForm=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.id,StoreService.getStoreDetail(opts,function(data){if(101==data.code){$scope.storeDetail=data.data,$scope.store=$scope.storeDetail,$scope.store.confirmemail=$scope.storeDetail.email,""!=$scope.storeDetail.shop_keyword&&void 0!=$scope.storeDetail.shop_keyword&&null!=$scope.storeDetail.shop_keyword&&($scope.keywordList=$scope.storeDetail.shop_keyword.split(","));{$scope.storeDetail.sale_catid}if($scope.store.storecategory={id:parseInt($scope.storeDetail.sale_catid)},$scope.store.subcategory={id:$scope.storeDetail.sale_subcatid},$scope.store.legal_status={id:$scope.storeDetail.legal_status},$scope.store.regOfficeCountry={id:$scope.storeDetail.business_country},$scope.store.sale_country={id:$scope.storeDetail.sale_country},$scope.store.regOfficeCountry={id:$scope.storeDetail.business_country},""!=$scope.store.repres_dob&&void 0!=$scope.store.repres_dob&&null!=$scope.store.repres_dob){var DOB=$scope.store.repres_dob.substring(0,10),dtArray=DOB.split("-");$scope.store.dobDay={id:parseInt(dtArray[2])},$scope.store.dobMonth={value:parseInt(dtArray[1])},$scope.store.dobYear={id:parseInt(dtArray[0])}}document.getElementById("latitude").value=$scope.storeDetail.latitude,document.getElementById("longitude").value=$scope.storeDetail.longitude,document.getElementById("mapplace").value=$scope.storeDetail.map_place,$scope.store.business_region={id:$scope.checkRegionExist(APP.regions,$scope.storeDetail.business_region)},$scope.store.sale_region={id:$scope.checkRegionExist(APP.regions,$scope.storeDetail.sale_region)},$scope.storeLoading=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,angular.element("#pac-input").val(data.data.map_place),$scope.initialize();var storeData={};storeData.storeId=$scope.storeDetail.owner_id;var mopts={};mopts.store_id=$scope.storeDetail.id,mopts.session_id=APP.currentUser.id,StoreService.getMobileAppUrl(mopts,function(data){101==data.code?$scope.store.mobileAppUrl=data.data.url:$scope.store.mobileAppUrl=""})}else $scope.storeLoading=!1,$scope.createStoreError=!0})},$scope.loadDetails(),$scope.checkRegionExist=function(p,k){for(var i=0;i<p.length;i++){var obj=p[i];if(obj.id===k)return k}return void 0},$scope.commonError=!1,$scope.vatNumberInvalid=!1,$scope.ibanNumberInvalid=!1,$scope.updateEditStore=function(){$scope.updateStart=!0,$scope.formSubmitted=!0;var opts={};if(opts.user_id=APP.currentUser.id,opts.store_id=$scope.store.id,void 0==$scope.store.name||""==$scope.store.name)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_name,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.storename.$dirty=!0,$scope.shopEditForm.storename.$invalid=!0,$scope.shopEditForm.storename.$error.required=!0,focus("storename"),!1;if(void 0==$scope.store.business_name||""==$scope.store.business_name)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storename,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.storecompany.$dirty=!0,$scope.shopEditForm.storecompany.$invalid=!0,$scope.shopEditForm.storecompany.$error.required=!0,focus("storecompany"),!1;if(void 0==$scope.store.legal_status||""==$scope.store.legal_status)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storestatus,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.legalstatus.$dirty=!0,$scope.shopEditForm.legalstatus.$invalid=!0,$scope.shopEditForm.legalstatus.$error.required=!0,focus("legalstatus"),!1;if(void 0==$scope.store.vat_number||""==$scope.store.vat_number)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storevat,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.vatnumber.$dirty=!0,$scope.shopEditForm.vatnumber.$invalid=!0,$scope.shopEditForm.vatnumber.$error.required=!0,focus("vatnumber"),!1;if(void 0==$scope.store.fiscal_code||""==$scope.store.fiscal_code)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storetax,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.fiscalcode.$dirty=!0,$scope.shopEditForm.fiscalcode.$invalid=!0,$scope.shopEditForm.fiscalcode.$error.required=!0,focus("fiscalcode"),!1;if(void 0==$scope.store.email||""==$scope.store.email)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storeemail,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.email.$dirty=!0,$scope.shopEditForm.email.$invalid=!0,$scope.shopEditForm.email.$error.required=!0,focus("email"),!1;if(void 0==$scope.store.confirmemail||""==$scope.store.confirmemail||$scope.store.email!==$scope.store.confirmemail)return $scope.inputname="confirmemail",$scope.createStoreErrorMgs=$scope.i18n.store.enter_storeemail,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.confirmemail.$dirty=!0,$scope.shopEditForm.confirmemail.$invalid=!0,$scope.shopEditForm.confirmemail.$error.required=!0,focus("confirmemail"),!1;if(void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone))return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storenumber,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.phone.$dirty=!0,$scope.shopEditForm.phone.$invalid=!0,$scope.shopEditForm.phone.$error.required=!0,focus("phone"),!1;if(void 0==$scope.store.iban||""==$scope.store.iban)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storeiban,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.iban.$dirty=!0,$scope.shopEditForm.iban.$invalid=!0,$scope.shopEditForm.iban.$error.required=!0,focus("iban"),!1;if(void 0==$scope.store.storecategory||""==$scope.store.storecategory)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storecategory,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.iban.$dirty=!0,$scope.shopEditForm.iban.$invalid=!0,$scope.shopEditForm.iban.$error.required=!0,focus("storecategory"),!1;if(void 0==$scope.store.description||""==$scope.store.description)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storedesc,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.description.$dirty=!0,$scope.shopEditForm.description.$invalid=!0,$scope.shopEditForm.description.$error.required=!0,focus("description"),!1;if(void 0==$scope.store.regOfficeCountry||""==$scope.store.regOfficeCountry)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_country,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.regofficecountry.$dirty=!0,$scope.shopEditForm.regofficecountry.$invalid=!0,$scope.shopEditForm.regofficecountry.$error.required=!0,focus("regofficecountry"),!1;if(void 0==$scope.store.business_region.id||""==$scope.store.business_region.id)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storeregregion,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.businessregion.$dirty=!0,$scope.shopEditForm.businessregion.$invalid=!0,$scope.shopEditForm.businessregion.$error.required=!0,focus("businessregion"),!1;if(void 0==$scope.store.business_city||""==$scope.store.business_city)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storeregcity,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.businesscity.$dirty=!0,$scope.shopEditForm.businesscity.$invalid=!0,$scope.shopEditForm.businesscity.$error.required=!0,focus("businesscity"),!1;if(void 0==$scope.store.province||""==$scope.store.province)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storeregprovince,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.province.$dirty=!0,$scope.shopEditForm.province.$invalid=!0,$scope.shopEditForm.province.$error.required=!0,focus("province"),!1;if($scope.store.province.length<2||$scope.store.province.length>2)return $scope.createStoreErrorMgs=$scope.i18n.validation.province_length,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.province.$dirty=!0,$scope.shopEditForm.province.$invalid=!0,$scope.shopEditForm.province.$error.required=!0,focus("province"),!1;if(void 0==$scope.store.zip||""==$scope.store.zip||$scope.store.zip.length<5||$scope.store.zip.length>5)return $scope.createStoreErrorMgs=$scope.i18n.register.enter_businesszip,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.storezip.$dirty=!0,$scope.shopEditForm.storezip.$invalid=!0,$scope.shopEditForm.storezip.$error.required=!0,focus("storezip"),!1;if(void 0==$scope.store.business_address||""==$scope.store.business_address)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storeregaddress,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.businessaddress.$dirty=!0,$scope.shopEditForm.businessaddress.$invalid=!0,$scope.shopEditForm.businessaddress.$error.required=!0,focus("businessaddress"),!1;if(void 0==$scope.store.sale_country||""==$scope.store.sale_country)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstorecountry,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salecountry.$dirty=!0,$scope.shopEditForm.salecountry.$invalid=!0,$scope.shopEditForm.salecountry.$error.required=!0,focus("salecountry"),!1;if(void 0==$scope.store.sale_region.id||""==$scope.store.sale_region.id)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstoreregion,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleregion.$dirty=!0,$scope.shopEditForm.saleregion.$invalid=!0,$scope.shopEditForm.saleregion.$error.required=!0,focus("saleregion"),!1;if(void 0==$scope.store.sale_city||""==$scope.store.sale_city)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstorecity,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salecity.$dirty=!0,$scope.shopEditForm.salecity.$invalid=!0,$scope.shopEditForm.salecity.$error.required=!0,focus("salecity"),!1;if(void 0==$scope.store.sale_province||""==$scope.store.sale_province)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstoreprovince,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleprovince.$dirty=!0,$scope.shopEditForm.saleprovince.$invalid=!0,$scope.shopEditForm.saleprovince.$error.required=!0,focus("saleprovince"),!1;if($scope.store.sale_province.length<2||$scope.store.sale_province.length>2)return $scope.createStoreErrorMgs=$scope.i18n.validation.hqprovincelength,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleprovince.$dirty=!0,$scope.shopEditForm.saleprovince.$invalid=!0,$scope.shopEditForm.saleprovince.$error.required=!0,focus("saleprovince"),!1;if(void 0==$scope.store.sale_zip||""==$scope.store.sale_zip)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstoreprovince,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salezip.$dirty=!0,$scope.shopEditForm.salezip.$invalid=!0,$scope.shopEditForm.salezip.$error.required=!0,focus("salezip"),!1;if($scope.store.sale_zip.length<5||$scope.store.sale_zip.length>5)return $scope.createStoreErrorMgs=$scope.i18n.validation.hqprovincelength,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salezip.$dirty=!0,$scope.shopEditForm.salezip.$invalid=!0,$scope.shopEditForm.salezip.$error.required=!0,focus("salezip"),!1;if(void 0==$scope.store.sale_address||""==$scope.store.sale_address)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstoreaddress,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleaddress.$dirty=!0,$scope.shopEditForm.saleaddress.$invalid=!0,$scope.shopEditForm.saleaddress.$error.required=!0,focus("saleaddress"),!1;if(void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storelat,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1;if(void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storelog,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1;if(void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storemap,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1;if(void 0==$scope.store.sale_email||""==$scope.store.sale_email)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstoreemail,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.emailaddress.$dirty=!0,$scope.shopEditForm.emailaddress.$invalid=!0,$scope.shopEditForm.emailaddress.$error.required=!0,focus("emailaddress"),!1;if(void 0==$scope.store.sale_phone_number||""==$scope.store.sale_phone_number||1==isNaN($scope.store.sale_phone_number))return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstorephone,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salephone.$dirty=!0,$scope.shopEditForm.salephone.$invalid=!0,$scope.shopEditForm.salephone.$error.required=!0,focus("salephone"),!1;if(void 0==$scope.store.repres_fiscal_code||""==$scope.store.repres_fiscal_code)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalTaxCode,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represfiscalcode.$dirty=!0,$scope.shopEditForm.represfiscalcode.$invalid=!0,$scope.shopEditForm.represfiscalcode.$error.required=!0,focus("represfiscalcode"),!1;if(void 0==$scope.store.repres_first_name||""==$scope.store.repres_first_name)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_firstName,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represfirstname.$dirty=!0,$scope.shopEditForm.represfirstname.$invalid=!0,$scope.shopEditForm.represfirstname.$error.required=!0,focus("represfirstname"),!1;if(void 0==$scope.store.repres_last_name||""==$scope.store.repres_last_name)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_lastName,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represlastname.$dirty=!0,$scope.shopEditForm.represlastname.$invalid=!0,$scope.shopEditForm.represlastname.$error.required=!0,focus("represlastname"),!1;if(void 0==$scope.store.repres_place_of_birth||""==$scope.store.repres_place_of_birth)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalBirthPlace,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represdobplace.$dirty=!0,$scope.shopEditForm.represdobplace.$invalid=!0,$scope.shopEditForm.represdobplace.$error.required=!0,focus("represdobplace"),!1;if(void 0==$scope.store.dobDay||""==$scope.store.dobDay)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntDd,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.dobday.$dirty=!0,$scope.shopEditForm.dobday.$invalid=!0,$scope.shopEditForm.dobday.$error.required=!0,focus("dobday"),!1;if(void 0==$scope.store.dobMonth||""==$scope.store.dobMonth)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntMonth,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.dobmonth.$dirty=!0,$scope.shopEditForm.dobmonth.$invalid=!0,$scope.shopEditForm.dobmonth.$error.required=!0,focus("dobmonth"),!1;if(void 0==$scope.store.dobYear||""==$scope.store.dobYear)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntYear,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.dobyear.$dirty=!0,$scope.shopEditForm.dobyear.$invalid=!0,$scope.shopEditForm.dobyear.$error.required=!0,focus("dobyear"),!1;if(void 0==$scope.store.repres_email||""==$scope.store.repres_email)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalEmail,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represemail.$dirty=!0,$scope.shopEditForm.represemail.$invalid=!0,$scope.shopEditForm.represemail.$error.required=!0,focus("represemail"),!1;if(void 0==$scope.store.repres_phone_number||""==$scope.store.repres_phone_number)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalPhone,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represphonenumber.$dirty=!0,$scope.shopEditForm.represphonenumber.$invalid=!0,$scope.shopEditForm.represphonenumber.$error.required=!0,focus("represphonenumber"),!1;if(void 0==$scope.store.repres_address||""==$scope.store.repres_address)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntAddress,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represaddress.$dirty=!0,$scope.shopEditForm.represaddress.$invalid=!0,$scope.shopEditForm.represaddress.$error.required=!0,focus("represaddress"),!1;if(void 0==$scope.store.repres_province||""==$scope.store.repres_province)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntProvince,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.represprovince.$dirty=!0,$scope.shopEditForm.represprovince.$invalid=!0,$scope.shopEditForm.represprovince.$error.required=!0,focus("represprovince"),!1;if($scope.store.repres_province.length<2||$scope.store.repres_province.length>2)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntProvince,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.represprovince.$dirty=!0,$scope.shopEditForm.represprovince.$invalid=!0,$scope.shopEditForm.represprovince.$error.required=!0,focus("represprovince"),!1;if(void 0==$scope.store.repres_city||""==$scope.store.repres_city)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntCity,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.represcity.$dirty=!0,$scope.shopEditForm.represcity.$invalid=!0,$scope.shopEditForm.represcity.$error.required=!0,focus("represcity"),!1;if(void 0==$scope.store.repres_zip||""==$scope.store.repres_zip)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntZip,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.represzip.$dirty=!0,$scope.shopEditForm.represzip.$invalid=!0,$scope.shopEditForm.represzip.$error.required=!0,focus("represzip"),!1;if($scope.store.repres_zip.length<5||$scope.store.repres_zip.length>5)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntProvince,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.represzip.$dirty=!0,$scope.shopEditForm.represzip.$invalid=!0,$scope.shopEditForm.represzip.$error.required=!0,focus("represzip"),!1;if(void 0!=$scope.store.dobYear||""!=$scope.store.dobYear){if($scope.store.dobDay.id>=29&&2==$scope.store.dobMonth.id)return $scope.createStoreErrorMgs=$scope.i18n.shop_affiliation.detail.enter_correct_dob,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.dobmonth.$dirty=!0,$scope.shopEditForm.dobmonth.$invalid=!0,$scope.shopEditForm.dobmonth.$error.required=!0,focus("dobmonth"),!1}else if(void 0!=$scope.store.dobYear||""!=$scope.store.dobYear){var isLeap=1==new Date($scope.store.dobYear.id,1,29).getMonth();if(0==isLeap&&$scope.store.dobDay.id>=29&&2==$scope.store.dobMonth.id)return $scope.createStoreErrorMgs=$scope.i18n.shop_affiliation.detail.enter_correct_dob,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.dobyear.$dirty=!0,$scope.shopEditForm.dobyear.$invalid=!0,$scope.shopEditForm.dobyear.$error.required=!0,focus("dobyear"),!1}var dd=$scope.store.dobDay.id,month=$scope.store.dobMonth.value+"-",year=$scope.store.dobYear.id+"-";$scope.store.dob=year.concat(month,dd),opts.name=$scope.store.name,opts.business_name=$scope.store.business_name,opts.legal_status=$scope.store.legal_status.id,opts.vat_number=$scope.store.vat_number,opts.fiscal_code=$scope.store.fiscal_code,opts.email=angular.lowercase($scope.store.email),opts.phone=$scope.store.phone,opts.iban=$scope.store.iban,opts.sale_catid=$scope.store.storecategory.id,void 0!=$scope.store.subcategory||"0"!=$scope.store.subcategory.id?opts.sale_subcatid=$scope.store.subcategory.id:opts.sale_subcatid=null,void 0!=$scope.keywordList||"0"!=$scope.keywordList.length?opts.shop_keyword=$scope.keywordList.join():opts.shop_keyword=[],opts.description=$scope.store.description,opts.business_country=$scope.store.regOfficeCountry.id,opts.business_region=$scope.store.business_region.id,opts.business_city=$scope.store.business_city,opts.province=$scope.store.province,opts.zip=$scope.store.zip,opts.business_address=$scope.store.business_address,opts.sale_country=$scope.store.sale_country.id,opts.sale_region=$scope.store.sale_region.id,opts.sale_city=$scope.store.sale_city,opts.sale_province=$scope.store.sale_province,opts.sale_zip=$scope.store.sale_zip,opts.sale_address=$scope.store.sale_address,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.sale_map=document.getElementById("mapplace").value,opts.sale_email=angular.lowercase($scope.store.sale_email),opts.sale_phone_number=$scope.store.sale_phone_number,opts.repres_fiscal_code=$scope.store.repres_fiscal_code,opts.repres_first_name=$scope.store.repres_first_name,opts.repres_last_name=$scope.store.repres_last_name,opts.repres_place_of_birth=$scope.store.repres_place_of_birth,opts.repres_dob=$scope.store.dob,opts.repres_email=angular.lowercase($scope.store.repres_email),opts.repres_phone_number=$scope.store.repres_phone_number,opts.repres_address=$scope.store.repres_address,opts.repres_province=$scope.store.repres_province,opts.repres_city=$scope.store.repres_city,opts.repres_zip=$scope.store.repres_zip,opts.referral_id=$scope.store.referral_info.id,opts.call_type=3,opts.business_type="not in current use",opts.sale_description="not in current use",opts.allow_access=$scope.store.is_allowed,$scope.createStoreErrorMgs="",StoreService.updateStore(opts,function(data){101==data.code?($scope.updateStart=!1,$scope.showEditForm=!1,$scope.createStoreLoader=!1,$scope.createGroupSuccess=!0,$scope.createStoreSuccessMgs=$scope.i18n.albums.update_sucess,$timeout(function(){$scope.createStoreSuccessMgs=""},15e3),$location.path("/shop/"+$scope.store.id+"/contract")):137==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.broker_not_exists,$scope.updateStart=!1,$scope.commonError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.commonError=!1},3e3)):100==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.missed_param,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.updateStart=!1,$scope.commonError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.commonError=!1},3e3)):90==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.account_inactive,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.commonError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.commonError=!1},3e3)):91==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_exists,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.vatNumberInvalid=!0,$timeout(function(){$scope.vatNumberInvalid=!1},3e3),focus("vatnumber")):126==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.invalid_store_forum_type,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.commonError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.commonError=!1},3e3)):500==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.permission_denied,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.commonError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.commonError=!1},3e3)):89==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.error_occured,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.commonError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.commonError=!1},3e3)):165==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_valid,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.vatNumberInvalid=!0,$timeout(function(){$scope.vatNumberInvalid=!1},3e3),focus("vatnumber")):166==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.iban_valid,$scope.createStoreError=!1,$scope.updateStart=!1,$scope.ibanNumberInvalid=!0,$timeout(function(){$scope.ibanNumberInvalid=!1},3e3),focus("iban")):($scope.createStoreErrorMgs=data.message,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.commonError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.commonError=!1},3e3))})},$scope.searchCategory=function(currentLanguage){var opts={};opts.lang_code=currentLanguage,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,opts.session_id=APP.currentUser.id,ProfileService.searchCatagory(opts,function(data){101===data.code&&"SUCCESS"===data.message&&data.data.length>0&&($scope.categories=data.data)})},$scope.searchCategory($scope.currentLanguage);var currentTimeout=null,DELAY_TIME_BEFORE_POSTING=300;$("#categoryKeyword").keypress(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchKeyword()},DELAY_TIME_BEFORE_POSTING)}),$scope.keywords=[],$scope.searchKeyword=function(){var opts={};opts.category_id=$scope.store.storecategory.id.toString(),opts.keyword=$scope.store.keywords,opts.session_id=APP.currentUser.id,$scope.cancelKeywordRequest=!1,$scope.showCatKeyLoading=!0,ProfileService.searchCatagoryKeyword(opts,function(data){$scope.showCatKeyLoading=!1,101===data.code&&"SUCCESS"===data.message&&$scope.cancelKeywordRequest===!1&&($scope.keywords=data.data.keyword)})},$scope.keywordIndex=-1,$scope.keywordKeyDown=function(event){40===event.keyCode?(event.preventDefault(),$scope.keywordIndex+1!==$scope.keywords.length&&$scope.keywordIndex++):38===event.keyCode?(event.preventDefault(),$scope.keywordIndex-1!==-1&&$scope.keywordIndex--):13===event.keyCode&&$scope.storeKeyword(void 0===$scope.keywords[$scope.keywordIndex]?$scope.categoryKeyword:$scope.keywords[$scope.keywordIndex])},$scope.cancelKeywordRequest=!1,$scope.clearKeyList=function(){$scope.cancelKeywordRequest=!0,$timeout(function(){$scope.keywords=[]},500)},$scope.categoryKeyword="",$scope.keywordList=[],$scope.storeKeyword=function(index){if($scope.keywords=[],$scope.keywordIndex=-1,$scope.categoryKeyword="","object"==typeof index)-1===$scope.keywordList.indexOf(index.name)&&$scope.keywordList.push(index.name);else{if(""===index||void 0===index)return!1;-1===$scope.keywordList.indexOf(index)&&$scope.keywordList.push(index)}},$scope.clearKeywordList=function(){$timeout(function(){$scope.keywords=[]},500)},$scope.removeKeyword=function(index){$scope.keywordList.indexOf(index);$scope.keywordList.splice(index,1)}}]),app.controller("RedirectToShopEdit",["$cookieStore","$rootScope","ipCookie","$scope","$http","$routeParams","$location","$timeout","StoreService","ProfileService","focus",function($cookieStore,$rootScope,ipCookie,$scope,$http,$routeParams,$location,$timeout,StoreService,ProfileService,focus){if(ipCookie("loggedInUser")||ipCookie("access_token")){var opts={};opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start=0,opts.limit_size=1,opts.lang_code=$scope.currentLanguage,opts.filter_type=1,StoreService.getStore(opts,function(data){$location.path(101===data.code?"/edit/shop/"+data.data.stores[0].id:"/")})}else $location.path("/")}]),app.controller("AutoLoginFromMobileApp",["$cookieStore","$rootScope","ipCookie","$scope","$http","$routeParams","$location","$timeout","ProfileService","UserService",function($cookieStore,$rootScope,ipCookie,$scope,$http,$routeParams,$location,$timeout,ProfileService,UserService){$scope.userToken=$routeParams.tokenId,$scope.userId=$routeParams.userId,$rootScope.currentUser={},APP.accessToken=$routeParams.tokenId;var opts3={};opts3.user_id=$routeParams.userId,opts3.profile_type=4,UserService.getBasicProfile(opts3,function(data){if(101==data.code){$rootScope.currentUser={id:data.data.user_id,username:data.data.email,email:data.data.email,enabled:!0,date_of_birth:data.data.date_of_birth,firstname:data.data.firstname,lastname:data.data.lastname,gender:data.data.gender,country:data.data.country_code,profile_img:data.data.profile_img.original,profile_img_thumb:data.data.profile_img.thumb,cover_img:data.data.profile_cover_img.original,cover_img_thumb:data.data.profile_cover_img.thumb,citizen_profile:data.data.citizen_profile,broker_profile:data.data.broker_profile,store_profile:data.data.store_profile,broker_profile_active:0,current_language:data.data.current_language},APP.currentUser=$rootScope.currentUser,ipCookie("loggedInUser",$rootScope.currentUser,{expires:365}),ipCookie("access_token",APP.accessToken,{expires:3e3}),$rootScope.isLoggedIn=!0,$scope.selectlanguage(data.data.current_language),$rootScope.currentUser.basicProfile=data.data;var opts4={};opts4.idcard=$rootScope.currentUser.basicProfile.user_id,UserService.getCreditAndIncome(opts4,function(data){var currentCredit={};101==data.code?(currentCredit.totalCredit=data.data.saldoc/1e6,currentCredit.totCreditMicro=data.data.saldorm+data.data.saldorc,currentCredit.totalIncome=data.data.tot_income,currentCredit.totalIncomeShow=data.data.tot_income,$rootScope.currentUser.creditAndIncome=currentCredit):$rootScope.currentUser.creditAndIncome=data.data}),$rootScope.allFriendTotal=0,$rootScope.getCountOfAllTypeNotificaton(),$scope.$parent.loggedIn=!0,$location.path("/offer/1")}else $location.path("/")})}]),app.controller("shopOfferController",["$scope","$routeParams","OfferService","StoreService","$timeout",function($scope,$routeParams,OfferService,StoreService,$timeout){$scope.isLoadingwallet=!1,$scope.storeId=$routeParams.id,$scope.citizenIncome=0,$scope.gridActive="",$scope.listActive="active",$scope.offer_type="card",$scope.firstPage=10,$scope.itemsPerPage=10,$scope.range=[],$scope.shop_id=[],$scope.getCitizenIncome=function(){var opts={};opts.$collection="sixc_bucks",opts.$filter={citizen_id:String(APP.currentUser.id)},opts.$group={_id:null,amount:{$sum:"$amount"},debit:{$sum:"$debit"},credit:{$sum:"$credit"}},OfferService.getApplaneData(opts,function(data){"ok"===data.status&&200===data.code&&data.response.result.length>0&&null!=data.response.result[0].amount&&($scope.citizenIncome=data.response.result[0].amount);

})},$scope.getCitizenIncome(),$scope.getcount=function(itemsPerPage){var opt={};opt.$collection="sixc_offers";var filter={};filter.offer_type=$scope.offer_id,filter.shop_id=$scope.storeId,opt.$filter=filter,opt.$group={count:{$sum:1},_id:null},OfferService.getApplaneData(opt,function(data){if("ok"===data.status&&200===data.code&&data.response.result.length>0){$scope.totalItems=Math.ceil(data.response.result[0].count/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}})},$scope.frindBoughtCount=function(){var opts={};opts={"function":"UtilityService.friendsShoppingCount",parameters:[{asArray:!0,shop_id:$scope.shop_id,citizen_id:String(APP.currentUser.id)}]},StoreService.frindboughtcount(opts,function(data){void 0===data.response||""===data.response?$scope.frcount=[]:$timeout(function(){$scope.$apply(function(){$scope.frcount=data.response})},0)})};var option={};option.$collection="sixc_offers",$scope.getlistingData=function(itemsPerPage){$scope.range=[],$scope.shop_id=[],$scope.noResultFound=!1,$scope.offerlodar=!0,$scope.offerlistingObject=[];var limit_start=($scope.currentPage-1)*itemsPerPage,filter={};filter.offer_type=$scope.offer_id,filter.shop_id=$scope.storeId,filter.start_date={$lte:"$$CurrentDate"},filter.end_date={$gte:"$$CurrentDate"},option.$limit=itemsPerPage,option.$skip=limit_start,option.$filter=filter,OfferService.getApplaneData(option,function(data){$scope.offerlodar=!1,"ok"===data.status&&200===data.code&&data.response.result.length>0?($scope.noResultFound=!1,$scope.offerlistingObject=data.response.result,$scope.offerlistingObject.forEach(function(val,index){$scope.shop_id.push(val.shop_id._id)}),$scope.frindBoughtCount(),$scope.getcount(itemsPerPage)):$scope.noResultFound=!0})},$scope.OfferChange=function(type){$scope.offer_type=type,"card"===type?$scope.offer_id="551ce49e2aa8f00f20d93295":$scope.offer_id="551ce49e2aa8f00f20d9328f",$scope.getlistingData($scope.itemsPerPage)},$scope.OfferChange($scope.offer_type),$scope.getfrndlist=function(event,shopid){if($scope.friendlist=[],$scope.nofndlist=!1,$(event.target).nextAll("ul.friend-list:first").is(":visible"))$(event.target).nextAll("ul.friend-list:first").hide();else{$scope.frndlistloader=!0,$(event.target).nextAll("ul.friend-list:first").show();var formData={};formData.user_id=APP.currentUser.id,formData.shop_id=shopid,$scope.friendlist=[],StoreService.getfriendboughtonstores(formData,function(data){$scope.frndlistloader=!1,101===data.code&&data.data.friends.length>0?($scope.nofndlist=!1,$scope.friendlist=data.data.friends):$scope.nofndlist=!0})}},$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.getlistingData($scope.itemsPerPage)},$scope.calculateprice=function(val,dis){var halfprice=val/2,obc={};return obc.price_purchase=val-val*dis/100,obc.price_sixth=halfprice,$scope.citizenIncome<halfprice&&(obc.price_sixth=$scope.citizenIncome),obc.onlyForYou=obc.price_purchase-obc.price_sixth,obc},$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.getlistingData($scope.itemsPerPage)},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.getlistingData($scope.itemsPerPage)},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.getlistingData($scope.itemsPerPage)},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.paginate=function(){$scope.currentPage=1},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.buyCoupon=function(index,id){$scope["buyCouponbtn"+index]=1,$scope["buyCouponloder"+index]=!0;var opts={};opts={"function":"ApplyCouponBL.applyCoupon",parameters:[{offer_id:String(id),citizen_id:String(APP.currentUser.id)}]},OfferService.getApplaneInvoke(opts,function(data){void 0===data.response||""===data.response?$scope["buyCouponErr"+index]=!0:"ok"===data.status&&200===data.code?$scope["buyCouponSuccess"+index]=!0:"Coupon is already purchased"===data.response?$scope["buyCouponalready"+index]=!0:$scope["buyCouponErr"+index]=!0,$scope["buyCouponloder"+index]=!1,$timeout(function(){$scope["buyCouponbtn"+index]=0,$scope["buyCouponloder"+index]=!1,$scope["buyCouponSuccess"+index]=!1,$scope["buyCouponErr"+index]=!1,$scope["buyCouponalready"+index]=!1},8e3)})}}]),app.controller("ShopTransactionController",["$timeout","$scope","$http","ShopTransactionService","StoreService","$routeParams","focus",function($timeout,$scope,$http,ShopTransactionService,StoreService,$routeParams,focus){$scope.shopListLoader=!0,$scope.isLoadTransaction=!1,$scope.isLoadMore=!1,$scope.transactioStoreList=[],$scope.transShopId=$routeParams.shopId,$routeParams.id=$routeParams.shopId,$scope.storeMainId=$routeParams.id,$scope.transUserId="",$scope.transAmount="",$scope.errorMsg="",$scope.errorCls="",$scope.inValidMsg="",$scope.totalSize=0,$scope.myRes=1,$scope.creditAmount={},$scope.transactionSelect={},$scope.totalSize=0,$scope.firstPage=APP.store_transaction.end,$scope.itemsPerPage=APP.store_transaction.end,$scope.currentPage=1,$scope.range=[],$scope.payRequest=!1,$scope.approveReq=!1,$scope.setStoreId=function(storeId){$scope.transShopId=storeId},$scope.transactionlist={},$scope.transactionObjectList=[],$scope.hasNext=!0,$scope.getTransactions=function(itemsPerPage){$scope.transactionSelect={},$scope.creditAmount.amount="",$scope.step=1,$scope.notFound=!1,$scope.errorMsg="",$scope.errorCls="";var limit_size=itemsPerPage,limit_start=($scope.currentPage-1)*itemsPerPage;if(""==$scope.transShopId)return $scope.errorMsg=$scope.i18n.shop_transaction.shop_not_selected,!1;var opts={};$scope.requestSending=!0,opts=void 0!==$scope.transactionlist.searchKey&&""!==$scope.transactionlist.searchKey?{$collection:APP.applaneTables.transaction,$parameters:{},$filter:{$or:[{"citizen_id.name":{$regex:".*"+$scope.transactionlist.searchKey+".*",$options:"i"}},{"citizen_id._id":{$regex:".*"+$scope.transactionlist.searchKey+".*",$options:"i"}}],status:{$in:["Initiated","Pending"]},"shop_id._id":$scope.transShopId},$limit:limit_size,$skip:limit_start,$sort:{date:-1}}:{$collection:APP.applaneTables.transaction,$parameters:{},$filter:{status:{$in:["Pending","Initiated"]},"shop_id._id":$scope.transShopId},$limit:limit_size,$skip:limit_start,$sort:{date:-1}},1===$scope.myRes&&($scope.myRes=0,ShopTransactionService.getTransactions(opts,function(data){if($scope.requestSending=!1,$scope.isLoadMore=!1,200==data.code){if(void 0!==data.response.result||0!==data.response.result.length){0==$scope.isLoadTransaction&&($scope.transactionObjectList=[]);var tempopts={};tempopts=void 0!==$scope.transactionlist.searchKey&&""!==$scope.transactionlist.searchKey?{$collection:APP.applaneTables.transaction,$filter:{$or:[{"citizen_id.name":{$regex:".*"+$scope.transactionlist.searchKey+".*",$options:"i"}},{"citizen_id._id":{$regex:".*"+$scope.transactionlist.searchKey+".*",$options:"i"}}],status:{$in:["Pending","Initiated"]},transaction_type_id:"553209267dfd81072b176bbc","shop_id._id":$scope.transShopId},$group:{count:{$sum:1},_id:null}}:{$collection:APP.applaneTables.transaction,$filter:{status:{$in:["Pending","Initiated"]},transaction_type_id:"553209267dfd81072b176bbc","shop_id._id":$scope.transShopId},$group:{count:{$sum:1},_id:null}},ShopTransactionService.getTransactions(tempopts,function(data){if(200===data.code){$scope.requestSending=!1;var count=0;0!==data.response.result.length&&void 0!==data.response.result&&(count=data.response.result[0].count),$scope.totalItems=Math.ceil(parseInt(count)/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}else"error"===data.status&&($scope.step=1,$scope.errorMsg=$scope.i18n.shop_transaction.txn_server_error,$scope.isLoadMore=!1,$scope.notFound=!0,$scope.requestSending=!1)}),$scope.transactionObjectList=data.response.result,$scope.isLoadTransaction=!1}$scope.hasNext=data.response.dataInfo.hasNext,$scope.myRes=1}else"error"===data.status&&($scope.step=1,$scope.errorMsg=$scope.i18n.shop_transaction.txn_server_error,$scope.isLoadMore=!1,$scope.notFound=!0,$scope.requestSending=!1)}))},$scope.getTransactions($scope.itemsPerPage),$scope.back=function(){$scope.errorMsg="",$scope.errorCls="",$scope.inValidMsg="",$scope.step--},$scope.loadMoreTransaction=function(){$scope.isLoadTransaction=!0,$scope.isLoadMore=!0,$scope.getTransactions($scope.itemsPerPage)},$scope.searchTransaction=function(){$scope.hasNext=!0,$scope.currentPage=1,$scope.transactionObjectList=[],$scope.getTransactions($scope.itemsPerPage)},$scope.getTransactionList=function(){$scope.hasNext=!0,$scope.currentPage=1,$scope.transactionlist.searchKey="",$scope.transactionObjectList=[],$scope.getTransactions($scope.itemsPerPage)},$scope.getTransactionDetail=function(){if($scope.notFound=!1,$scope.errorMsg="",$scope.errorCls="",$scope.transactionObject=[],""===$scope.transactionSelect.id||void 0===$scope.transactionSelect.id)return $scope.step=1,$scope.errorMsg=$scope.i18n.shop_transaction.transaction_not_select,!1;$scope.requestSending=!0;var opts={};opts={$collection:APP.applaneTables.transaction,$parameters:{},$filter:{_id:$scope.transactionSelect.id}},ShopTransactionService.getTransactionDetail(opts,function(data){200===data.code?($scope.transactionObject=data.response.result[0],"Pending"===$scope.transactionObject.status?$scope.step=3:"Approved"===$scope.transactionObject.status||"Rejected"===$scope.transactionObject.status?$scope.step=6:$scope.step=2,$scope.requestSending=!1):300===data.code?($scope.requestSending=!1,$scope.transactionObject={},$scope.errorMsg=$scope.i18n.shop_transaction.missed_parameter):"error"===data.status&&($scope.step=1,$scope.transactionObject={},$scope.errorMsg=$scope.i18n.shop_transaction.txn_server_error,$scope.isLoadMore=!1,$scope.notFound=!0,$scope.requestSending=!1)})},$scope.paymentFormSubmitted=!1,$scope.payAmount=function(){if($scope.paymentFormSubmitted=!0,$scope.payRequest=!0,$scope.errorMsg="",$scope.errorCls="",$scope.inValidMsg="",""===$scope.creditAmount.amount||void 0===$scope.creditAmount.amount){$scope.errorMsg="",$scope.errorCls="",$scope.inValidMsg="";var regex=new RegExp(/^([0-9\.]+)$/),tempReg=new RegExp(/^\d{0,4}(\d\.\d?|\.\d)?\d?$/);if(""==$scope.creditAmount.amount||void 0==$scope.creditAmount.amount)return $scope.step=2,$scope.errorCls="has-error",$scope.inValidMsg=$scope.i18n.shop_transaction.enter_amount,$scope.payRequest=!1,focus("payamount"),!1;if(!regex.test($scope.creditAmount.amount))return $scope.step=2,$scope.errorCls="has-error",$scope.payRequest=!1,focus("payamount"),$scope.inValidMsg=$scope.i18n.shop_transaction.decimal_digit_only,!1;if(!tempReg.test($scope.creditAmount.amount))return $scope.step=2,$scope.errorCls="has-error",$scope.payRequest=!1,focus("payamount"),$scope.inValidMsg=$scope.i18n.shop_transaction.decimal_number_only,!1}else $scope.requestSending=!1,"With Point"===$scope.transactionObject.do_transaction?opts=[{$update:[{_id:$scope.transactionSelect.id,$set:{transaction_value:$scope.creditAmount.amount,status:"Pending"}}],$collection:APP.applaneTables.transaction,$fields:{discount_details:1,payble_value:1,shot_value:1,coupon_value:1,dp_value:1,upto_50_value:1,new_upto_50_value:1,upto_100_value:1}}]:"Without Point"===$scope.transactionObject.do_transaction&&(opts=[{$update:[{_id:$scope.transactionSelect.id,$set:{transaction_value:$scope.creditAmount.amount,status:"Pending"}}],$collection:APP.applaneTables.transaction}]),ShopTransactionService.updateTransactionObject(opts,function(data){if($scope.creditAmount.amount=void 0,200===data.code){$scope.payRequest=!1;var tempopts={};tempopts={$collection:APP.applaneTables.transaction,$parameters:{},$filter:{_id:$scope.transactionSelect.id}},$scope.getTransactionDetail()}else"error"===data.status&&($scope.step=2,$scope.transactionCreditObject={},$scope.errorMsg=$scope.i18n.shop_transaction.txn_server_error,$scope.notFound=!0,$scope.requestSending=!1,$scope.payRequest=!1)})};var txnObj=ShopTransactionService.getTransactionTab();txnObj.hasOwnProperty("tab")&&txnObj.hasOwnProperty("txnId")?($scope.step=txnObj.tab,$scope.transactionSelect.id=txnObj.txnId,ShopTransactionService.setTransactionTab({}),$scope.getTransactionDetail()):($scope.step=1,$scope.transTransactionId="");$scope.approveCredit=function(userResponse){if($scope.transactionApproveObject={},$scope.approveReq=!0,userResponse=userResponse,""===userResponse||void 0===userResponse)return $scope.step=3,$scope.errorMsg=$scope.i18n.shop_transaction.no_response,!1;$scope.requestSending=!0,$scope.step=3;var opts={};"With Point"===$scope.transactionObject.do_transaction?opts=[{$update:[{_id:$scope.transactionObject._id,$set:{status:$scope.TransResponse}}],$collection:APP.applaneTables.transaction,$fields:{_id:1,discount_details:1,payble_value:1,shot_value:1,coupon_value:1,dp_value:1,upto_50_value:1,new_upto_50_value:1,upto_100_value:1}}]:"Without Point"===$scope.transactionObject.do_transaction&&(opts=[{$update:[{_id:$scope.transactionObject._id,$set:{status:$scope.TransResponse}}],$collection:APP.applaneTables.transaction,$fields:{_id:1,payble_value:1}}]),ShopTransactionService.updateTransactionObject(opts,function(data){if($scope.approveReq=!1,200==data.code){var tempopts={};tempopts={$collection:APP.applaneTables.transaction,$parameters:{},$filter:{_id:data.response.sixc_transactions.$update[0]._id}},ShopTransactionService.getTransactionDetail(tempopts,function(data){200==data.code?($scope.transactionApproveObject=data.response.result[0],1===userResponse?($scope.requestSending=!1,$scope.step=4):2===userResponse&&($scope.requestSending=!1,$scope.step=5)):"error"==data.status&&($scope.step=1,$scope.transactionObject={},$scope.errorMsg=$scope.i18n.shop_transaction.txn_server_error,$scope.notFound=!0,$scope.requestSending=!1)})}else"error"===data.status&&($scope.step=3,$scope.transactionApproveObject={},$scope.errorMsg=$scope.i18n.shop_transaction.txn_server_error,$scope.notFound=!0,$scope.requestSending=!1)})},$scope.cancelTransaction=function(){$scope.errorMsg="",$scope.errorCls="",$scope.TransResponse="Rejected",$scope.approveCredit(2)},$scope.confirmTransaction=function(){$scope.errorMsg="",$scope.errorCls="",$scope.TransResponse="Approved",$scope.approveCredit(1)},$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.loadMoreTransaction()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMoreTransaction()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.loadMoreTransaction()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.loadMoreTransaction($scope.itemsPerPage)}}]),app.controller("ShopTransactionHistoryController",["$timeout","$scope","$http","ShopTransactionService","StoreService","$routeParams",function($timeout,$scope,$http,ShopTransactionService,StoreService,$routeParams){$scope.step=1,$scope.shopListLoader=!0,$scope.isLoadTransaction=!1,$scope.transactionHistoryObjectList=[],$scope.transShopId=$routeParams.shopId,$routeParams.id=$routeParams.shopId,$scope.storeMainId=$routeParams.id,$scope.transUserId="",$scope.errorMsg="",$scope.totalSize=0,$scope.myRes=1,$scope.setStoreId=function(storeId){$scope.transShopId=storeId},$scope.loadMoreFunc="loadMoreTransaction()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMoreTransaction()")},!0),$scope.transactionlist={},$scope.getHistoryList=function(){$scope.step=1,$scope.notFound=!1,$scope.errorMsg="";var limit_start=100;if(limit_start+=5,""==$scope.transShopId)return $scope.errorMsg=$scope.i18n.shop_transaction.shop_not_selected,!1;$scope.requestSending=!0;var opts={};opts.shop_id=$scope.transShopId,$scope.transShopId="551e6792236f510813100730",void 0!=$scope.transactionlist.searchKey&&""!=$scope.transactionlist.searchKey?($scope.totalSize=0,opts={$collection:"sixc_transactions",$parameters:{},$filter:{$and:[{"shop_id._id":$scope.transShopId,status:"Initiated"},{$or:[{"citizen_id.name":$scope.transactionlist.searchKey},{"citizen_id._id":$scope.transactionlist.searchKey}]}]},$limit:limit_start,$skip:0}):opts={$collection:"sixc_transactions",$parameters:{},$filter:{"shop_id._id":$scope.transShopId,status:"Initiated"},$limit:limit_start,$skip:0},($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes&&ShopTransactionService.getTransactionObjects(opts,function(data){$scope.requestSending=!1,$scope.myRes=0,200==data.code?($scope.requestSending=!1,$scope.isLoadMore=!1,(void 0!=data.response.result||0!=data.response.result.length)&&($scope.transactionHistoryObjectList=data.response.result,$timeout(function(){$("#scroll-pane").perfectScrollbar("update")},100)),$scope.totalSize=data.response.result.length,$scope.myRes=1,0==$scope.isLoadTransaction&&$timeout(function(){$("#scroll-pane").perfectScrollbar()},100)):171==data.code?($scope.transactionHistoryObjectList,$scope.errorMsg=$scope.i18n.shop_transaction.missed_parameter,$scope.notFound=!0,$scope.requestSending=!1,$scope.isLoadMore=!1):172==data.code?($scope.transactionHistoryObjectList,$scope.errorMsg=$scope.i18n.shop_transaction.shop_status_not_valid,$scope.notFound=!0,$scope.requestSending=!1,$scope.isLoadMore=!1):173==data.code?($scope.transactionHistoryObjectList,$scope.errorMsg=$scope.i18n.shop_transaction.citizen_status_not_valid,$scope.notFound=!0,$scope.requestSending=!1,$scope.isLoadMore=!1):100==data.code&&($scope.transactionHistoryObjectList,$scope.errorMsg=$scope.i18n.shop_transaction.no_store_found,$scope.notFound=!0,$scope.requestSending=!1,$scope.isLoadMore=!1)})},$scope.getHistoryList(),$scope.back=function(){$scope.step--},$scope.loadMoreTransaction=function(){0!=$scope.totalSize&&($scope.isLoadTransaction=!0,$scope.isLoadMore=!1,$scope.getHistoryList())},$scope.transactionSelect={},$scope.getTransactionDetail=function(){if($scope.notFound=!1,$scope.errorMsg="",$scope.transactionObject=[],""==$scope.transactionSelect.id||void 0==$scope.transactionSelect.id)return $scope.step=1,$scope.errorMsg=$scope.i18n.shop_transaction.transaction_not_select,!1;$scope.requestSending=!1,$scope.step=2;var opts={};opts={$collection:"sixc_transactions",$parameters:{},$filter:{_id:$scope.transactionSelect.id}},ShopTransactionService.getTransactionDetail(opts,function(data){$scope.requestSending=!1,200==data.code?($scope.requestSending=!1,$scope.transactionObject=data.response.result[0],$scope.myRes=1):300==data.code&&($scope.requestSending=!1,$scope.transactionObject={},$scope.errorMsg=$scope.i18n.shop_transaction.missed_parameter,$scope.myRes=1)})}}]),app.controller("shopWalletController",["$rootScope","$scope","$http","StoreWalletService","$location","$timeout","$interval","$routeParams","$sce","StoreCreditCard","$route","StoreService","$filter","StorePaymentService","DateToMongoDate","storeShopHistorySelection",function($rootScope,$scope,$http,StoreWalletService,$location,$timeout,$interval,$routeParams,$sce,StoreCreditCard,$route,StoreService,$filter,StorePaymentService,DateToMongoDate,storeShopHistorySelection){$scope.oneAtATime=!0,isLoadingWallet=!0,$scope.storeId=$routeParams.id,$scope.status={isFirstOpen:!0,isFirstDisabled:!1},$scope.walletDetails={},$scope.pcardRes=1,$scope.shotsRes=1,$scope.mcardRes=1,$scope.pcardTotal=0,$scope.shotTotal=0,$scope.mcardTotal=0,$scope.userId=APP.currentUser.id,$scope.pendingPayBtn=!0,$scope.payRecurring=!1,$scope.isShowForm=!1,$scope.firstPage=APP.sale_history.end,$scope.itemsSaleHistoryPerPage=APP.sale_history.end,$scope.itemsPaypalPerPage=APP.sale_history.end,$scope.itemsCardsPerPage=APP.sale_history.end,$scope.getmastercardurl=function(){var opts={};opts.profile_id=$scope.storeId,opts.user_id=$scope.userId,opts.cancel_url=APP.payment.siteDomain+"#/shop/paycancel",opts.return_url=APP.payment.siteDomain+"#/shop/paysuccess",opts.payment_type=APP.card.add_type,StorePaymentService.getOneClickPaymentUrls(opts,function(data){101==data.code&&""!=data.data.url?$scope.storePaymentUrl=data.data.url:$scope.storePaymentUrl=""})},$scope.getmastercardurl(),$scope.tabs=[{id:1},{id:2},{id:3},{id:4},{id:5},{id:6}],$scope.currentTab,$scope.subtabs=[{id:1},{id:2}],$scope.currentSubTab,$scope.paypalAccountList=[],$scope.isInProgress=!1,$scope.selectedAccount=[],$scope.selectedAccountIndex=0,$scope.getPaypalAccounts=function(itemsPaypalPerPage){$scope.storeData=StoreService.getStoreData(),$scope.isInProgress=!0,$scope.isBlockReq=0,$scope.pagination=!1;var limit_start=($scope.currentPaypalPage-1)*itemsPaypalPerPage,opts={};opts.shop_id=$scope.storeData.id,opts.session_id=APP.currentUser.id,opts.limit_size=itemsPaypalPerPage,opts.limit_start=limit_start,(0==$scope.isBlockReq||0==$scope.firstLoad)&&($scope.isBlockReq=1,1==$scope.firstLoad,StoreCreditCard.getPaypalAccounts(opts,function(data){if($scope.isBlockReq=0,101==data.code){if($scope.isInProgress=!1,$scope.paypalAccountList=data.data.paypal_accounts,$scope.total=data.data.paypal_count,$scope.totalPaypalItems=Math.ceil(data.data.paypal_count/itemsPaypalPerPage),data.data.paypal_count>$scope.itemsPaypalPerPage){$scope.range=[];for(var i=1;i<=$scope.totalPaypalItems;i++)$scope.range.push(i);$scope.pagination=!0}else $scope.pagination=!1;0==$scope.paypalAccountList.length&&($scope.noContent=!0),angular.forEach($scope.paypalAccountList,function(value,index){1==value.default_status?($scope.selectedAccount[index]=!0,$scope.selectedAccountIndex=index):$scope.selectedAccount[index]=!1})}100==data.code&&($scope.msgClass="text-red",$scope.isInProgress=!1,$scope.message=$scope.i18n.store_wallet.paypal.param_missed,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)),1054==data.code?($scope.msgClass="text-red",$scope.isInProgress=!1,$scope.message=$scope.i18n.store_wallet.paypal.access_voilation,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):($scope.isInProgress=!1,$scope.paypalAccountList=$scope.paypalAccountList)}))},$scope.currentPaypalPage=1,$scope.loadMoreAccounts=function(){$scope.getPaypalAccounts($scope.itemsPaypalPerPage)},$scope.changePaypalPageMore=function(pageNo){$scope.currentPaypalPage=pageNo,$scope.loadMoreAccounts()},$scope.prevPaypalPage=function(){$scope.currentPaypalPage>1&&$scope.currentPaypalPage--,$scope.loadMoreAccounts()},$scope.prevPaypalPageDisabled=function(){return 1===$scope.currentPaypalPage?"disabled":""},$scope.nextPaypalPage=function(){$scope.currentPaypalPage<$scope.totalPaypalItems&&$scope.currentPaypalPage++,$scope.loadMoreAccounts()},$scope.nextPaypalPageDisabled=function(){return $scope.currentPaypalPage===$scope.totalPaypalItems?"disabled":""},$scope.setPaypalPage=function(number){$scope.currentPaypalPage=number,$scope.loadMoreAccounts()},$scope.isActiveSubTab=function(subTabId){return $scope.currentSubTab==subTabId?!0:!1},$scope.getSubTabData=function(tabId){switch($scope.pagination=!1,$scope.currentPage=0,tabId){case 2:$scope.currentSubTab=tabId,$scope.msgClass="",$scope.message="",$scope.getPaypalAccounts($scope.itemsPaypalPerPage),$scope.pendingPayment();break;default:$scope.msgClass="",$scope.message="",$scope.getCreditCard($scope.itemsCardsPerPage),$scope.pendingPayment(),$scope.currentSubTab=1}},$scope.paymentDetail=[];var paymentHistory=function(){var reqObj={user_id:APP.currentUser.id,shop_id:$scope.storeId,limit_start:APP.store_payment_pagination.start,limit_size:APP.store_payment_pagination.end};StoreWalletService.getPaymentHistory(reqObj,function(data){$scope.paymentDetail=data.data})};paymentHistory(),$scope.sideshow=function(){$(".pay-pending-detail").slideToggle(500),$("a.slidemore").hide()},$(".slidehide").click(function(){$(".pay-pending-detail").slideUp(500),$("a.slidemore").show("slow")}),$scope.loadmoreHistory=!1,$scope.loadMorePaymentHistory=function(){if($scope.paymentDetail.previous_payment_success.length<$scope.paymentDetail.count){$scope.loadmoreHistory=!0;var reqObj={user_id:APP.currentUser.id,shop_id:$scope.storeId,limit_start:$scope.paymentDetail.previous_payment_success.length,limit_size:APP.store_payment_pagination.end};StoreWalletService.getPaymentHistory(reqObj,function(data){$scope.loadmoreHistory=!1,angular.forEach(data.data.previous_payment_success,function(index){$scope.paymentDetail.previous_payment_success.push(index)})})}},$scope.discountBalance=0,$scope.discountCredit=0,$scope.turnOver=0,$scope.loadShopWallet=!1,$scope.getShopWallet=function(){var opts={shopOpen:{$collection:APP.applaneTables.sixc_shopdp,$filter:{balance:{$gt:0},shop_id:$scope.storeId},$group:{credit:{$sum:"$credit"},_id:null,$fields:!1}},shopbalance:{$collection:APP.applaneTables.sixc_shopdp,$filter:{balance:{$gt:0},shop_id:$scope.storeId},$group:{balance:{$sum:"$balance"},_id:null,$fields:!1}},shopRevenue:{$collection:APP.applaneTables.sixc_transactions,$filter:{shop_id:$scope.storeId},$group:{_id:null,total_income:{$sum:"$total_income"},payble_value:{$sum:"$payble_value"},new_upto_50_value:{$sum:"$new_upto_50_value"},checkout_value:{$sum:"$checkout_value"},$fields:!1}}};$scope.loadShopWallet=!0,StoreWalletService.getStoreWalletApplane(opts,function(data){200==data.code&&"ok"==data.status?($scope.loadShopWallet=!1,$scope.walletDetails=data.response,$scope.walletDetails.shopOpen.result.length>0?$scope.discountCredit=$scope.walletDetails.shopOpen.result[0].credit:$scope.discountCredit=0,$scope.walletDetails.shopbalance.result.length>0?$scope.discountBalance=$scope.walletDetails.shopbalance.result[0].balance:$scope.discountBalance=0,$scope.walletDetails.shopRevenue.result.length>0?null!=$scope.walletDetails.shopRevenue.result[0].total_income&&($scope.turnOver=$scope.walletDetails.shopRevenue.result[0].total_income):$scope.turnOver=0):$scope.loadShopWallet=!1})},$scope.positionHistory=[],$scope.loadShopPrenium=!1,$scope.shopPreniumHistory=function(){var opts={$collection:APP.applaneTables.sixc_shopdp,$fields:{value:1,start_date:1,end_date:1,credit:1,debit:1,balance:1,transactions_count:1,transaction_ids:1},$filter:{shop_id:$scope.storeId},$sort:{"__history.__createdOn":-1},$skip:0};$scope.loadShopPrenium=!0,StoreWalletService.getShopPreniumHistoryApplane(opts,function(data){if(200==data.code&&"ok"==data.status){if($scope.loadShopPrenium=!1,$scope.positionHistory=$scope.positionHistory.concat(data.response.result),$scope.positionHistory.length>$scope.itemsPerPage){$scope.list=0,$scope.list=$scope.positionHistory.length,$scope.pagination=!0,$scope.range=[];for(var i=0;i<$scope.list/$scope.itemsPerPage;i++)$scope.range.push(i)}}else $scope.loadShopPrenium=!1})},$scope.payRecurringPayment=function(){$scope.message=void 0;var opts={};opts.store_id=$scope.store_id,StoreCreditCard.getOnClickRecurringPayments(opts,function(data){251==data.code?($scope.msgClass="alert-info",$scope.message=$scope.i18n.store.payment.less_amount):252==data.code?($scope.msgClass="alert-warning",$scope.message=$scope.i18n.store.payment.no_card):253==data.code?($scope.msgClass="alert-warning",$scope.message=$scope.i18n.store.payment.payment_fail):101==data.code&&($scope.msgClass="alert-info",$scope.message=$scope.i18n.store.payment.payment_success),$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)})},$scope.getOneClickPaymentUrls=function(){var opts={};opts.profile_id=$scope.storeId,opts.user_id=$scope.userId,opts.payment_type=APP.card.add_type,opts.cancel_url=APP.payment.siteDomain+"/#/shop/payment/cancel",opts.return_url=APP.payment.siteDomain+"/#/shop/payment/success",StoreCreditCard.getOneClickPaymentUrls(opts,function(data){251!=data.code&&300!=data.code?""!=data.data.url?($scope.pendingPayBtn=!1,$scope.payRecurring=!0,$scope.storePendingPaymentUrl=data.data.url):($scope.pendingPayBtn=!0,$scope.payRecurring=!1,$scope.storePendingPaymentUrl=""):($scope.pendingPayBtn=!0,$scope.payRecurring=!1,$scope.storePendingPaymentUrl="/#/shop/payment/success")})},$scope.getOneClickPaymentUrls(),$scope.cardList=[],$scope.getCardList=!1,$scope.selectedCard=[],$scope.selectedCardIndex=0,$scope.getCreditCard=function(itemsCardsPerPage){$scope.getCardList=!0,$scope.isBlockReq=0,$scope.pagination=!1;var limit_start=($scope.currentCardPage-1)*itemsCardsPerPage,opts={};opts.store_id=$scope.storeId,opts.session_id=APP.currentUser.id,opts.limit_size=itemsCardsPerPage,opts.limit_start=limit_start,(0==$scope.isBlockReq||0==$scope.firstLoad)&&($scope.isBlockReq=1,1==$scope.firstLoad,StoreCreditCard.getCreditCardLists(opts,function(data){if($scope.isBlockReq=0,101==data.code&&"SUCCESS"==data.message){if($scope.getCardList=!1,$scope.cardList=data.data,$scope.total=data.data.count,$scope.totalCardItems=Math.ceil(data.data.count/itemsCardsPerPage),$scope.total>$scope.itemsCardsPerPage){$scope.pagination=!0,$scope.range=[];for(var i=1;i<=$scope.itemsCardsPerPage;i++)$scope.range.push(i)}else $scope.pagination=!1;0==$scope.cardList.length&&($scope.noContent=!0),angular.forEach($scope.cardList,function(value,index){1==value.defaultflag?($scope.selectedCard[index]=!0,$scope.selectedCardIndex=index):$scope.selectedCard[index]=!1})}else 0==$scope.cardList.length,$scope.getCardList=!1,$scope.msgClass="text-red",$scope.cardList=$scope.cardList}))},$scope.currentCardPage=1,$scope.loadMoreCards=function(){$scope.getCreditCard($scope.itemsCardsPerPage)},$scope.changeCardPageMore=function(pageNo){$scope.currentCardPage=pageNo,$scope.loadMoreCards()},$scope.prevCardPage=function(){$scope.currentCardPage>1&&$scope.currentCardPage--,$scope.loadMoreCards()},$scope.prevCardPageDisabled=function(){return 1===$scope.currentCardPage?"disabled":""},$scope.nextCardPage=function(){$scope.currentCardPage<$scope.totalCardItems&&$scope.currentCardPage++,$scope.loadMoreCards()},$scope.nextCardPageDisabled=function(){return $scope.currentCardPage===$scope.totalCardItems?"disabled":""},$scope.setCardPage=function(number){$scope.currentCardPage=number,$scope.loadMoreCards()},$scope.inDelete=[],$scope.deleteCard=function(indx){$scope.inDelete[indx]=!0,$scope.message="";var card=$scope.cardList[indx],opts={};opts.contract_id=card.contract_id,opts.session_id=APP.currentUser.id,StoreCreditCard.deleteCard(opts,function(data){101==data.code?($scope.msgClass="text-success",$scope.inDelete[indx]=!1,$scope.cardList.splice(indx,1),0===$scope.cardList.length?$route.reload():($scope.message=$scope.i18n.store.card.delete_success,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4))):($scope.msgClass="text-red",$scope.inDelete[indx]=!1,$scope.message=data.message,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4))})},$scope.selectThisCard=function(index){$scope.setDefaultCard(index,$scope.selectedCardIndex)},$scope.inProcess=[],$scope.setDefaultCard=function(newCardIndex,oldCardIndex){var opts={};opts.store_id=$scope.storeId,opts.session_id=APP.currentUser.id,opts.contract_id=$scope.cardList[newCardIndex].contract_id;var oldIndx=($scope.cardList[newCardIndex].contract_id,$scope.cardList[oldCardIndex].contract_id);$scope.inProcess[newCardIndex]=!0,$scope.inProcess[oldCardIndex]=!1,StoreCreditCard.setDefaultCard(opts,function(data){101==data.code?($scope.inProcess[newCardIndex]=!1,$scope.selectedCardIndex=newCardIndex,$scope.cardList[newCardIndex].defaultflag=1,-1!=oldIndx&&($scope.cardList[oldCardIndex].defaultflag=0),$scope.msgClass="text-success",$scope.message=$scope.i18n.store.card.success,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):($scope.msgClass="text-red",$scope.inProcess[newCardIndex]=!1,
$scope.message=data.message,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4))})},$scope.pendingPayment=function(){({$collection:APP.applaneTables.sixc_shop_income,$filter:{date:{$gte:"2015-04-15T00:00:00.000Z",$lt:"2015-04-16T00:00:00.000Z"},shop_id:$scope.storeId}})},$scope.isActiveTab=function(tabId){return $scope.currentTab==tabId?!0:!1},$scope.loadCoupon=!1,$scope.couponRecord=[],$scope.firstLoad=!0,$scope.skip=0,$scope.getCoupon=function(startingDate,endingDate){$scope.couponLimit=$scope.itemsPerPage,$scope.filter={shop_id:$scope.storeId,type:"551ce49e2aa8f00f20d9328f",inactive:{$in:[!1,null]},used_on:{$exists:!0},balance:{$gt:0}},$scope.firstLoad===!1&&$scope.dateApply===!0?($scope.filter.to_date={},null!==startingDate&&($scope.filter.to_date.$gte=DateToMongoDate.dateToIso(startingDate)),null!==endingDate&&($scope.filter.to_date.$lte=DateToMongoDate.dateToIso(endingDate)),$scope.dateApply=!1):$scope.firstLoad=!1;var couponReq={shop_wallet_upto100:{$collection:APP.applaneTables.sixc_citizens_cards,$fields:{credit:1,discount:1,unique_id:1,citizen_id:1,from_date:1,to_date:1,balance:1},$filter:$scope.filter,$sort:{to_date:-1},$limit:$scope.couponLimit,$skip:$scope.skip},shop_wallet_upto100_count:{$collection:APP.applaneTables.sixc_citizens_cards,$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filter}};$scope.nameFilter===!0&&($scope.filter.$or=[{"citizen_id.name":{$regex:$scope.citizensName,$options:"i"}},{"citizen_id._id":{$regex:$scope.citizensName,$options:"i"}}]),0==$scope.loadMoreCoupons&&($scope.loadCoupon=!0),StoreWalletService.getStoreWalletCouponApplane(couponReq,function(data){if("ok"===data.status&&200===data.code){if($scope.loadCoupon=!1,$scope.loadMoreCoupons=!1,$scope.couponRecord=data.response.shop_wallet_upto100.result,$scope.couponCount=0,data.response.shop_wallet_upto100_count.result.length>0&&($scope.couponCount=data.response.shop_wallet_upto100_count.result[0].count,data.response.shop_wallet_upto100_count.result[0].count>$scope.itemsPerPage)){$scope.pagination=!0,$scope.list=0,$scope.range=[],$scope.list=$scope.couponCount-1;for(var i=0;i<$scope.list/$scope.itemsPerPage;i++)$scope.range.push(i)}$scope.dateApply=!1}else $scope.loadCoupon=!1,$scope.loadMoreCoupons=!1,$scope.dateApply=!1})},$scope.loadMoreCoupons=!1,$scope.loadMoreCoupon=function(index){sDate=[],eDate=[],0!==index?$scope.skip=(index-1)*$scope.itemsPerPage:$scope.skip=0,$scope.couponLimit=$scope.itemsPerPage,null!=$scope.sArray|null!=$scope.eArray&&($scope.dateApply=!0),$scope.loadMoreCoupons=!0,$scope.getCoupon($scope.sArray,$scope.eArray)};var sDate=[],eDate=[];$scope.sArray=null,$scope.eArray=null,$scope.dateApply=!1,$scope.applyFilter=function(dateObj,callFuntion,name){if(sDate=[],eDate=[],$scope.filter={},$scope.skip=0,null!==dateObj.startDate&&void 0!==dateObj.startDate&&""!=dateObj.startDate?($scope.sArray=dateObj.startDate,$scope.dateApply=!0):$scope.sArray=null,null!==dateObj.endDate&&void 0!==dateObj.endDate&&""!=dateObj.endDate?($scope.eArray=dateObj.endDate,$scope.dateApply=!0):$scope.eArray=null,$scope.citizensName="",$scope.citizenName="",void 0!==name||""!==name?($scope.citizensName=name,$scope.nameFilter=!0):($scope.citizensName="",$scope.nameFilter=!1),$scope.pagination=!1,$scope.list=0,$scope.range=[],$scope.currentPage=0,"getCoupon"===callFuntion){if(null===$scope.sArray&&null===$scope.eArray&&(void 0==name||""==name))return $scope.clearFilter(),!1;$scope.couponRecord=[],$scope.firstLoad=!1,$scope.getCoupon($scope.sArray,$scope.eArray)}else if("getSaleHistory"===callFuntion){if(null===$scope.sArray&&null===$scope.eArray&&(void 0==name||""==name))return $scope.clearFilter(),!1;$scope.transactionHistoryObjectList=[],$scope.firstLoad=!1,$scope.getSaleHistory($scope.sArray,$scope.eArray)}},$scope.clearFilter=function(){$scope.date.startDate=null,$scope.date.endDate=null,$scope.couponName="",$scope.currentPage=0,$scope.range=[],$scope.list=0,$scope.pagination=!1,$scope.dateApply=!1,$scope.firstLoad=!0,$scope.citizensName="",$scope.nameFilter=!1,$scope.filter={},$scope.sArray=null,$scope.eArray=null,angular.element("#cName").val(""),$("#cName").val(""),$("#cName").trigger("change"),$scope.getCoupon(null,null),5===$scope.currentTab&&$scope.getSaleHistory(null,null)},DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null,$scope.waitShop=function(name){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.searchShop(name.shopNameSearch)},DELAY_TIME_BEFORE_POSTING)},$scope.shopNameSearch,$scope.searchShop=function(shopName){console.log(shopName)},$scope.downloadCsvFile=function(data){$scope.JSONToCSVConvertor(data,"SaleHistory",!0)},$scope.downloaShopdHistorySaleCsvFile=function(JSONData){var finalArray=[];JSONData.forEach(function(data){var JSONobc={};if(void 0!=data.date?JSONobc.Date=$filter("date")(data.date,"dd-MM-yyyy"):JSONobc.Date="",void 0!=data.transaction_value?JSONobc["Total Transaction"]=data.transaction_value:JSONobc["Total Transaction"]="0",void 0!=data.total_cardvalue_used?JSONobc["Shopping Card used"]=data.total_cardvalue_used:JSONobc["Shopping Card used"]="",void 0!=data.total_discountvalue_used?JSONobc.Discount=data.total_discountvalue_used:JSONobc.Discount="0",void 0!=data.payble_value?JSONobc["Cash Amount"]=data.payble_value:JSONobc["Cash Amount"]="0",void 0!=data.discount_details){var id="";data.discount_details.forEach(function(details){id+=details.card_no+" , "}),JSONobc["Card Id"]=id}else JSONobc["Card Id"]="";void 0!=data.citizen_id?JSONobc["Citizen Id"]=data.citizen_id._id:JSONobc["Citizen Id"]="",finalArray.push(JSONobc)}),$scope.JSONToCSVConvertor(JSON.stringify(finalArray),"Shop_Wallet_Sales_History_Report",!0)},$scope.downloadHistoryCsvFile=function(JSONData){for(var finalArray=[],i=0;i<JSONData.length;i++){finalArray1={},finalArray1.SN=i+1;try{finalArray1.Citizen_ID=JSONData[i].citizen_id._id,finalArray1.Citizen_Name=JSONData[i].citizen_id.name}catch(err){finalArray1.Citizen_ID=" - ",finalArray1.Citizen_Name=" - "}try{finalArray1.Transaction_Date=$filter("date")(JSONData[i].date,"dd-MM-yyyy")}catch(err){finalArray1.Transaction_Date=" - "}try{finalArray1.Type=JSONData[i].discount_details.type.name}catch(err){finalArray1.Type=" - "}try{finalArray1.Amount=JSONData[i].discount_details.amount}catch(err){finalArray1.Amount=" - "}try{finalArray1.Card_No=JSONData[i].discount_details.card_id.card_no}catch(err){finalArray1.Card_No=" - "}finalArray.push(finalArray1)}$scope.JSONToCSVConvertor(JSON.stringify(finalArray),"Shop_Wallet_History_Report",!0)},$scope.JSONToCSVConvertor=function(JSONData,ReportTitle,ShowLabel){var arrData="object"!=typeof JSONData?JSON.parse(JSONData):JSONData,CSV="";CSV+=ReportTitle+"\r\n\n";var row,index;if(ShowLabel){row="";for(index in arrData[0])row+=index+",";row=row.slice(0,-1),CSV+=row+"\r\n"}for(var i=0;i<arrData.length;i++){row="";for(index in arrData[i])row+='"'+arrData[i][index]+'",';row.slice(0,row.length-1),CSV+=row+"\r\n"}if(""===CSV)return void alert("Invalid data");var fileName="";fileName+=ReportTitle.replace(/ /g,"_");var uri="data:text/csv;charset=utf-8,"+escape(CSV),link=document.createElement("a");link.href=uri,link.setAttribute("href",uri),link.setAttribute("download",fileName+".csv"),document.body.appendChild(link),link.click(),document.body.removeChild(link)},$scope.itemsPerPage=10,$scope.currentPage=0,$scope.pagination=!1,$scope.list=0,$scope.range=[],$scope.prevPage=function(page){$scope.currentPage>0&&($scope.currentPage--,"coupon"===page?$scope.loadMoreCoupon($scope.currentPage):"salehistory"===page&&$scope.loadMoreSaleHistory($scope.currentPage))},$scope.prevPageDisabled=function(){return 0===$scope.currentPage?"disabled":""},$scope.pageCount=function(){return void 0!==$scope.list?Math.ceil($scope.list/$scope.itemsPerPage)-1:void 0},$scope.nextPage=function(page){$scope.currentPage<$scope.pageCount()&&($scope.currentPage++,"coupon"===page?$scope.loadMoreCoupon($scope.currentPage+1):"salehistory"===page&&$scope.loadMoreSaleHistory($scope.currentPage+1))},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.pageCount()?"disabled":""},$scope.setPage=function(n){$scope.currentPage=n},$scope.rangeCardHundred=[],$scope.currentPageCardHundred=1,$scope.firstPageCardHundred=APP.store_list_pagination.end,$scope.itemsPerPageCardHundred=6,$scope.totalItemsCardHundred=0,$scope.rangeCardFifty=[],$scope.currentPageCardFifty=1,$scope.firstPageCardFifty=APP.store_list_pagination.end,$scope.itemsPerPageCardFifty=6,$scope.totalItemsCardFifty=0,$scope.pageloader100=!1,$scope.pageloader50=!1,$scope.changePageMoreCardHundred=function(pageNo){$scope.pageloader100=!0,$scope.currentPageCardHundred=pageNo,$scope.getShopWalletShoppingCard()},$scope.prevPageCardHundred=function(){$scope.pageloader100=!0,$scope.currentPageCardHundred>1&&$scope.currentPageCardHundred--,$scope.getShopWalletShoppingCard()},$scope.prevPageDisabledCardHundred=function(){return 1===$scope.currentPageCardHundred?"disabled":""},$scope.nextPageCardHundred=function(){$scope.pageloader100=!0,$scope.currentPageCardHundred<$scope.totalItemsCardHundred&&$scope.currentPageCardHundred++,$scope.getShopWalletShoppingCard()},$scope.nextPageDisabledCardHundred=function(){return $scope.currentPageCardFifty===$scope.totalItemsCardFifty?"disabled":""},$scope.changePageMoreCardFifty=function(pageNo){$scope.pageloader50=!0,$scope.currentPageCardFifty=pageNo,$scope.getShopWalletShoppingCard()},$scope.prevPageCardFifty=function(){$scope.pageloader50=!0,$scope.currentPageCardFifty>1&&$scope.currentPageCardFifty--,$scope.getShopWalletShoppingCard()},$scope.prevPageDisabledCardFifty=function(){return 1===$scope.currentPageCardFifty?"disabled":""},$scope.nextPageCardFifty=function(){$scope.pageloader50=!0,$scope.currentPageCardFifty<$scope.totalItemsCardFifty&&$scope.currentPageCardFifty++,$scope.getShopWalletShoppingCard()},$scope.nextPageDisabledCardFifty=function(){return $scope.currentPageCardFifty===$scope.totalItemsCardFifty?"disabled":""},$scope.shopwalletupto100count=0,$scope.shopwalletupto50count=0,$scope.walletloader=!0,$scope.walletcontainer=!1,$scope.noresult=!1,$scope.filterObject={},$scope.filterObject50={},$scope.filterObject.shop_id=String($scope.storeId),$scope.filterObject.type="551ce49e2aa8f00f20d93295",$scope.filterObject.inactive={$in:[!1,null]},$scope.filterObject.used_on={$exists:!0},$scope.filterObject.balance={$gt:0},$scope.filterObject50.shop_id=String($scope.storeId),$scope.filterObject50.type="551ce49e2aa8f00f20d93293",$scope.filterObject50.inactive={$in:[!1,null]},$scope.filterObject50.used_on={$exists:!0},$scope.filterObject50.balance={$gt:0},$scope.getShopWalletShoppingCard=function(){var limit_start=($scope.currentPageCardHundred-1)*$scope.itemsPerPageCardHundred,limit_start_fifty=($scope.currentPageCardFifty-1)*$scope.itemsPerPageCardFifty,opts={shop_wallet_upto100:{$collection:"sixc_citizens_cards",$fields:{credit:1,card_no:1,card_code:1,citizen_id:1,from_date:1,to_date:1,balance:1},$filter:$scope.filterObject,$sort:{used_on:-1},$limit:$scope.itemsPerPageCardHundred,$skip:limit_start},shop_wallet_upto100_count:{$collection:"sixc_citizens_cards",$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filterObject},shop_wallet_upto50:{$collection:"sixc_citizens_cards",$fields:{credit:1,card_no:1,card_code:1,citizen_id:1,from_date:1,to_date:1,balance:1},$filter:$scope.filterObject50,$sort:{used_on:-1},$limit:$scope.itemsPerPageCardFifty,$skip:limit_start_fifty},shop_wallet_upto50_count:{$collection:"sixc_citizens_cards",$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filterObject50}};StoreWalletService.getStoreWalletShoppingCard(opts,function(data){if($scope.walletloader=!1,$scope.pageloader100=!1,$scope.pageloader50=!1,"ok"===data.status&&200===data.code){$scope.shopwalletupto100=data.response.shop_wallet_upto100.result,data.response.shop_wallet_upto100_count.result.length>0?$scope.shopwalletupto100count=data.response.shop_wallet_upto100_count.result[0].count:$scope.shopwalletupto100count=0,$scope.shopwalletupto50=data.response.shop_wallet_upto50.result,data.response.shop_wallet_upto50_count.result.length>0?$scope.shopwalletupto50count=data.response.shop_wallet_upto50_count.result[0].count:$scope.shopwalletupto50count=0,$scope.totalItemsCardHundred=Math.ceil($scope.shopwalletupto100count/$scope.itemsPerPageCardHundred),$scope.totalItemsCardFifty=Math.ceil($scope.shopwalletupto50count/$scope.itemsPerPageCardFifty),$scope.rangeCardHundred=[],$scope.rangeCardFifty=[];for(var i=1;i<=$scope.totalItemsCardHundred;i++)$scope.rangeCardHundred.push(i);for(var j=1;j<=$scope.totalItemsCardFifty;j++)$scope.rangeCardFifty.push(j);$scope.pageloader100=!1,$scope.pageloader50=!1,$scope.walletcontainer=!0}else $scope.rangeCardHundred=[],$scope.rangeCardFifty=[],$scope.shopwalletupto50count=0,$scope.shopwalletupto100count=0,$scope.walletcontainer=!0})},$scope.clearSearch=function(){$scope.currentPageCardHundred=1,$scope.currentPageCardFifty=1,$scope.walletloader=!0,$(".from input").val(""),$(".to input").val(""),$("#searchtext").val(""),$scope.filterObject={},$scope.filterObject50={},$scope.filterObject.shop_id=String($scope.storeId),$scope.filterObject.type="551ce49e2aa8f00f20d93295",$scope.filterObject.inactive={$in:[!1,null]},$scope.filterObject.used_on={$exists:!0},$scope.filterObject.balance={$gt:0},$scope.filterObject50.shop_id=String($scope.storeId),$scope.filterObject50.type="551ce49e2aa8f00f20d93293",$scope.filterObject50.inactive={$in:[!1,null]},$scope.filterObject50.used_on={$exists:!0},$scope.filterObject50.balance={$gt:0},$scope.getShopWalletShoppingCard()},$scope.searchCardByCti=function(){$scope.currentPageCardHundred=1,$scope.currentPageCardFifty=1,$scope.walletloader=!0,$scope.filterObject={},$scope.filterObject50={};var fromInput=$(".from input").val(),toinput=$(".to input").val(),frInp=fromInput.split("-"),toInp=toinput.split("-"),newfromdate=DateToMongoDate.dateToIso(fromInput),newtodate=DateToMongoDate.dateToIso(toinput),searchdata=$("#searchtext").val();(void 0!==fromInput&&""!==fromInput||void 0!==toinput&&""!==toinput)&&""===searchdata?(void 0!==frInp[0]&&""!==frInp[0]&&($scope.filterObject.to_date?($scope.filterObject.to_date.$gte=newfromdate,$scope.filterObject50.to_date.$gte=newfromdate):($scope.filterObject.to_date={$gte:newfromdate},$scope.filterObject50.to_date={$gte:newfromdate})),void 0!==toInp[0]&&""!==toInp[0]&&($scope.filterObject.to_date?($scope.filterObject.to_date.$lte=newtodate,$scope.filterObject50.to_date.$lte=newtodate):($scope.filterObject.to_date={$lte:newtodate},$scope.filterObject50.to_date={$lte:newtodate})),$scope.filterObject.shop_id=String($scope.storeId),$scope.filterObject.type="551ce49e2aa8f00f20d93295",$scope.filterObject.balance={$gt:0},$scope.filterObject50.shop_id=String($scope.storeId),$scope.filterObject50.type="551ce49e2aa8f00f20d93293",$scope.filterObject50.balance={$gt:0},$scope.getShopWalletShoppingCard()):(void 0!==fromInput&&""!==fromInput||void 0!==toinput&&""!==toinput)&&""!==searchdata&&void 0!==searchdata?($scope.filterObject.$or=[{"citizen_id.name":{$regex:".*"+searchdata+".*",$options:"i"}},{"citizen_id._id":{$regex:".*"+searchdata+".*",$options:"i"}}],$scope.filterObject.shop_id=String($scope.storeId),$scope.filterObject.type="551ce49e2aa8f00f20d93295",$scope.filterObject.inactive={$in:[!1,null]},$scope.filterObject.used_on={$exists:!0},$scope.filterObject.balance={$gt:0},$scope.filterObject50.$or=[{"citizen_id.name":{$regex:".*"+searchdata+".*",$options:"i"}},{"citizen_id._id":{$regex:".*"+searchdata+".*",$options:"i"}}],$scope.filterObject50.shop_id=String($scope.storeId),$scope.filterObject50.type="551ce49e2aa8f00f20d93293",$scope.filterObject50.inactive={$in:[!1,null]},$scope.filterObject50.used_on={$exists:!0},$scope.filterObject50.balance={$gt:0},void 0!==frInp[0]&&""!==frInp[0]&&($scope.filterObject.to_date?($scope.filterObject.to_date.$gte=newfromdate,$scope.filterObject50.to_date.$gte=newfromdate):($scope.filterObject.to_date={$gte:newfromdate},$scope.filterObject50.to_date={$gte:newfromdate})),void 0!==toInp[0]&&""!==toInp[0]&&($scope.filterObject.to_date?($scope.filterObject.to_date.$lte=newtodate,$scope.filterObject50.to_date.$lte=newtodate):($scope.filterObject.to_date={$lte:newtodate},$scope.filterObject50.to_date={$lte:newtodate})),$scope.getShopWalletShoppingCard()):""!==fromInput&&""!==toinput||""===searchdata||void 0===searchdata?$scope.clearSearch():($scope.filterObject.$or=[{"citizen_id.name":{$regex:".*"+searchdata+".*",$options:"i"}},{"citizen_id._id":{$regex:".*"+searchdata+".*",$options:"i"}}],$scope.filterObject.shop_id=String($scope.storeId),$scope.filterObject.type="551ce49e2aa8f00f20d93295",$scope.filterObject.inactive={$in:[!1,null]},$scope.filterObject.used_on={$exists:!0},$scope.filterObject.balance={$gt:0},$scope.filterObject50.$or=[{"citizen_id.name":{$regex:".*"+searchdata+".*",$options:"i"}},{"citizen_id._id":{$regex:".*"+searchdata+".*",$options:"i"}}],$scope.filterObject50.shop_id=String($scope.storeId),$scope.filterObject50.type="551ce49e2aa8f00f20d93293",$scope.filterObject50.inactive={$in:[!1,null]},$scope.filterObject50.used_on={$exists:!0},$scope.filterObject50.balance={$gt:0},$scope.getShopWalletShoppingCard())},$scope.date={startDate:null,endDate:null},$scope.openPaypalForm=function(){$scope.paypalErrCls="",$scope.paypalErrMsg="",$scope.isShowForm=!0},$scope.selectThisAccount=function(index){$scope.setDefaultAccount(index,$scope.selectedAccountIndex)},$scope.inProcess=[],$scope.setDefaultAccount=function(newAccountIndx,oldAccountIndx){$scope.storeData=StoreService.getStoreData();var opts={};opts.shop_id=$scope.storeData.id,opts.session_id=APP.currentUser.id,opts.id=$scope.paypalAccountList[newAccountIndx].id;var oldIndx=($scope.paypalAccountList[newAccountIndx].id,$scope.paypalAccountList[oldAccountIndx].id);$scope.inProcess[newAccountIndx]=!0,$scope.inProcess[oldAccountIndx]=!1,StoreCreditCard.setDefaultPaypalAccounts(opts,function(data){101==data.code?($scope.inProcess[newAccountIndx]=!1,$scope.selectedAccountIndex=newAccountIndx,$scope.paypalAccountList[newAccountIndx].defaultflag=1,-1!=oldIndx&&($scope.paypalAccountList[oldAccountIndx].defaultflag=0),$scope.msgClass="text-success",$scope.message=$scope.i18n.store_wallet.paypal.set_default_success,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):($scope.msgClass="text-red",$scope.inProcess[newAccountIndx]=!1,$scope.message=$scope.i18n.store_wallet.paypal.failure,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4))})},$scope.inDelete=[],$scope.deleteAccount=function(indx){$scope.storeData=StoreService.getStoreData(),$scope.inDelete[indx]=!0,$scope.message="";var account=$scope.paypalAccountList[indx],opts={};opts.id=account.id,opts.shop_id=$scope.storeData.id,opts.session_id=APP.currentUser.id,StoreCreditCard.deletePaypalAccounts(opts,function(data){101==data.code?($scope.msgClass="text-success",$scope.inDelete[indx]=!1,$scope.paypalAccountList.splice(indx,1),$scope.message=$scope.i18n.store_wallet.paypal.delete_success,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):100==data.code?($scope.msgClass="text-red",$scope.inDelete[indx]=!1,$scope.message=$scope.i18n.store_wallet.paypal.param_missed,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):1054==data.code?($scope.msgClass="text-red",$scope.inDelete[indx]=!1,$scope.message=$scope.i18n.store_wallet.paypal.access_voilation,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):1029==data.code?($scope.msgClass="text-red",$scope.inDelete[indx]=!1,$scope.message=$scope.i18n.store_wallet.paypal.failure,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):($scope.msgClass="text-red",$scope.inDelete[indx]=!1,$scope.message=$scope.i18n.store_wallet.paypal.failure,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4))})},$scope.itemsSaleHistoryPerPage=APP.sale_history.end,$scope.transactionlist={},$scope.transactionHistoryObjectList=[],$scope.hasNext=!0,$scope.myRes=1,$scope.historyLimit=0,$scope.isLoadMore=!1,$scope.getSaleHistory=function(startingDate,endingDate){0==$scope.isLoadMore&&($scope.requestSending=!0),$scope.filter={"shop_id._id":$scope.storeId,status:"Approved",transaction_type_id:{$in:["553209267dfd81072b176bba","553209267dfd81072b176bbc"]}},$scope.firstLoad===!1&&$scope.dateApply===!0?($scope.filter.date={},null!==startingDate&&($scope.filter.date.$gte=DateToMongoDate.dateToIso(startingDate)),null!==endingDate&&($scope.filter.date.$lt=DateToMongoDate.dateToIso(endingDate)),$scope.dateApply=!1):$scope.firstLoad=!1;var saleHistoryReq={sale_history:{$collection:APP.applaneTables.transaction,$fields:{date:1,total_discountvalue_used:1,total_cardvalue_used:1,transaction_value:1,payble_value:1,citizen_id:1,discount_details:1},$filter:$scope.filter,$sort:{date:-1},$limit:$scope.historyLimit,$skip:$scope.skip},sale_history_count:{$collection:APP.applaneTables.transaction,$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filter}};$scope.nameFilter===!0&&($scope.filter.$or=[{"citizen_id.name":{$regex:".*"+$scope.citizensName+".*",$options:"i"}},{"citizen_id._id":{$regex:".*"+$scope.citizensName+".*",$options:"i"}}]),StoreWalletService.getStoreWalletHistoryApplane(saleHistoryReq,function(data){if($scope.requestSending=!1,$scope.isLoadMore=!1,200==data.code){if((void 0!==data.response.sale_history.result||0!==data.response.sale_history.result.length)&&(0==$scope.isLoadSaleHistory&&($scope.transactionHistoryObjectList=[]),$scope.transactionHistoryObjectList=data.response.sale_history.result,$scope.totalSaleHistoryItems=!1),data.response.sale_history_count.result.length>0&&($scope.saleHistroyCount=data.response.sale_history_count.result[0].count,data.response.sale_history_count.result[0].count>$scope.itemsPerPage)){$scope.pagination=!0,$scope.list=0,$scope.list=$scope.saleHistroyCount,$scope.range=[],$scope.totalHistoryItems=Math.ceil($scope.list/$scope.itemsPerPage);for(var i=0;i<$scope.totalHistoryItems;i++)$scope.range.push(i)}$scope.dateApply=!1}else"error"===data.status&&($scope.step=1,$scope.errorMsg=$scope.i18n.shop_transaction.txn_server_error,$scope.isLoadMore=!1,$scope.notFound=!0,$scope.requestSending=!1)})},$scope.isLoadSaleHistory=!1,$scope.historyLimit=APP.sale_history.end,$scope.loadMoreSaleHistory=function(index){sDate=[],eDate=[],0!==index?$scope.skip=(index-1)*APP.sale_history.end:$scope.skip=0,$scope.historyLimit=APP.sale_history.end,null!=$scope.sArray|null!=$scope.eArray&&($scope.dateApply=!0),$scope.isLoadMore=!0,$scope.getSaleHistory($scope.sArray,$scope.eArray)},$scope.closeForm=function(){$scope.isLoadMore=!1,$scope.loadMoreAccounts(),$scope.paypal={},$scope.isShowForm=!1},$scope.getData=function(tabId){switch($scope.pagination=!1,$scope.currentPage=0,$scope.range=[],$scope.list=0,tabId){case 1:$scope.positionHistory=[],$scope.getShopWallet(),$scope.shopPreniumHistory(),$scope.currentTab=tabId,$scope.date={startDate:null,endDate:null};break;case 2:$scope.getShopWalletShoppingCard(),$scope.currentTab=tabId,$scope.date={startDate:null,endDate:null};break;case 3:$scope.currentTab=tabId,$scope.couponRecord=[],$scope.list=[],$scope.firstLoad=!0,$scope.date.startDate=null,$scope.date.endDate=null,$scope.couponName="",$scope.dateApply=!1,$scope.firstLoad=!0,$scope.citizensName="",$scope.citizenName="",$scope.nameFilter=!1,$scope.filter={},$scope.sArray=null,$scope.eArray=null,$scope.skip=0,$scope.date={startDate:null,endDate:null},$scope.getCoupon(null,null);break;case 4:$scope.currentTab=tabId,$scope.date={startDate:null,endDate:null};break;case 5:$scope.currentTab=tabId,$scope.nameFilter=!1,$scope.citizensName="",$scope.citizenName="",$scope.date.startDate=null,$scope.date.endDate=null,$scope.itemsPerPage=APP.sale_history.end,$scope.filter={},$scope.range=[],$scope.sArray=null,$scope.eArray=null,$scope.getSaleHistory(null,null),$scope.date={startDate:null,endDate:null};break;case 6:$scope.currentTab=tabId,$scope.getSubTabData(1),$scope.pendingPayment(),$scope.date={startDate:null,endDate:null};break;default:$scope.getShopWallet(),$scope.shopPreniumHistory(),$scope.currentTab=1}},1==storeShopHistorySelection.getStorage()?($scope.currentTab=5,storeShopHistorySelection.clearStorage(),$scope.getData(5)):$scope.getData(1)}]),app.controller("StoreController",["$scope","$http","$cookieStore","StoreService","ProfileService","$timeout",function($scope,$http,$cookieStore,StoreService,ProfileService,$timeout){$scope.storeListObject=[],$scope.storeMyList=[],$scope.storeAllList=[],$scope.totalSize=0,$scope.myTotalSize=0,$scope.storeLoading=!0,$scope.viewAllActive="current",$scope.myStoreActive="",$scope.tab="viewAll",$scope.notFound=!1,$scope.allRes=1,$scope.myRes=1,$scope.firstPage=APP.store_list_pagination.end,$scope.itemsPerPage=APP.store_list_pagination.end,$scope.currentPage=1,$scope.range=[],$scope.pagevalue="",$scope.orderValue=1,$scope.filterApply=0;$scope.affilationOn=!1;var shopCategoryVal="",votestructure="",favoriteIcon="";$scope.filterresult=!1,$scope.friendtransaction=0,$scope.currentLanguage=$cookieStore.get("activeLanguage"),$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.loadMore()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMore()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.loadMore()},$scope.paginate=function(){$scope.currentPage=1},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.loadMore()},$scope.showStoreList=function(tab,itemsPerPage){$scope.filterApply=0,$scope.pagevalue="storeAll",$scope.searchText="",$scope.storeMyList=[],$scope.tab=tab,$scope.viewAllActive="current",$scope.myStoreActive="";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,opts.store_type=1,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,opts.lang_code=$scope.currentLanguage,opts.filter_type=$scope.orderValue,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.storeLoading=!0,$scope.allRes=0,StoreService.getStore(opts,function(data){if($scope.filterresult=!1,101==data.code){$scope.allRes=1,$scope.totalSize=data.data.size,$scope.storeListObject=data.data.stores,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1,$scope.notFound=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1)}))},$scope.myStId=[],$scope.locIndex=[],$scope.myStoreList=function(tab,itemsPerPage){$scope.filterresult=!0,$scope.locIndex=[],$scope.myStId=[],$scope.filterApply=0,$scope.pagevalue="storeMy",$scope.searchText="",$scope.storeAllList=[],$scope.tab=tab,$scope.viewAllActive="",$scope.myStoreActive="current";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start=limit_start,opts.limit_size=itemsPerPage,opts.lang_code=$scope.currentLanguage,opts.filter_type=$scope.orderValue,($scope.myTotalSize>limit_start||0==$scope.myTotalSize)&&1==$scope.myRes&&($scope.storeLoading=!0,$scope.myRes=0,StoreService.getStore(opts,function(data){if($scope.filterresult=!1,$scope.range=[],101==data.code){$scope.myTotalSize=data.data.size,$scope.myRes=1,$scope.storeListObject=$scope.storeMyList=data.data.stores;for(var j=0;j<data.data.stores.length;j++)$scope.myStId.push(data.data.stores[j].id);for(var k=0;k<$scope.myStId.length;k++)for(var n=0;n<locations.length;n++)locations[n][8]==$scope.myStId[k]&&$scope.locIndex.push(n);$scope.fireMyshopMarker($scope.locIndex),$scope.totalItems=Math.ceil(data.data.size/itemsPerPage);for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.notFound=!1,$scope.storeLoading=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1,$scope.fireMyshopMarker($scope.locIndex)):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.myRes=1,$scope.fireMyshopMarker($scope.locIndex));$scope.affilationOn=!0}))},$scope.orderBy=function(){$scope.filterApply=1,$scope.loadMore()},$scope.addressFilter="",$scope.loadMore=function(){$scope.searchText,$scope.addressFilter;""==$scope.pagevalue?$scope.showStoreList($scope.tab,$scope.itemsPerPage):"storeAll"==$scope.pagevalue?$scope.showStoreList($scope.tab,$scope.itemsPerPage):"storeMy"==$scope.pagevalue?$scope.myStoreList($scope.tab,$scope.itemsPerPage):"storeNameSearch"==$scope.pagevalue?$scope.searchStore("viewAll",$scope.itemsPerPage):"storeAddSearch"==$scope.pagevalue&&$scope.searchAddressShop($scope.storeIdArray)},$scope.getstorecredit=function(storeId){var today=new Date,dd=today.getDate(),mm=today.getMonth(),yr=today.getFullYear(),date=new Date(yr,mm,dd);$scope.stId=storeId;var opts={};opts={"function":"UtilityService.shopWiseCitizenIncome",parameters:[{shop_id:[$scope.stId],citizen_id:String(APP.currentUser.id),date:String(date.toISOString())}]},StoreService.getstorecredit(opts,function(data){for(i=0;i<locations.length;i++)if(locations[i][8]==storeId){$scope.storeIndex=i;break}void 0===data.response||""===data.response||0===data.response.length?(locations[$scope.storeIndex][9]=0,$(".ca span").html($scope.format1(0,"€"))):(locations[$scope.storeIndex][9]=data.response[0].total_credit,$(".ca span").html($scope.format1(data.response[0].total_credit,"€")))})},$scope.frindBoughtCount=function(storeId){var opts={};opts={"function":"UtilityService.friendsShoppingCount",parameters:[{asArray:!0,shop_id:[storeId],citizen_id:String(APP.currentUser.id)}]},StoreService.frindboughtcount(opts,function(data){for(i=0;i<locations.length;i++)if(locations[i][8]==storeId){$scope.storeIndex=i;break}void 0===data.response||""===data.response?(locations[$scope.storeIndex][20]=0,$(".fr-num").html(0),$scope.frcount=0):(locations[$scope.storeIndex][20]=data.response[0].count,$(".fr-num").html(data.response[0].count))})},$scope.shopIndex="",$scope.favouritestores=function(id,element){for($scope.storeLoading=!0,$scope.shopIndex="",i=0;i<locations.length;i++)if(locations[i][8]==id){$scope.shopIndex=i;break}if($(element.target).hasClass("active")){var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,StoreService.unfavouritestores(opts,function(data){101==data.code?($(element.target).removeClass("active"),locations[$scope.shopIndex][19]=0,1==$scope.favAvailable?$scope.enableFilter():$scope.storeLoading=!1):$scope.storeLoading=!1})}else{var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,StoreService.favouritestores(opts,function(data){101==data.code?($(element.target).addClass("active"),locations[$scope.shopIndex][19]=1,1==$scope.favAvailable?$scope.enableFilter():$scope.storeLoading=!1):$scope.storeLoading=!1})}},$scope.listActive="active",$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$scope.searchText="";var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$("#shopserchbox").keypress(function(){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){0==$scope.searchText.length&&$scope.searchStore()},DELAY_TIME_BEFORE_POSTING)}),$scope.searchRes=0,$scope.searchTotalSize=0,$scope.searchStore=function(tab,itemsPerPage){$scope.pagevalue="storeNameSearch",$scope.searchRes=0,$scope.storeLoading=!0,$scope.viewAllActive="current",$scope.myStoreActive="";var opts={},limit_start=($scope.currentPage-1)*itemsPerPage;opts.user_id=APP.currentUser.id,$scope.tab="viewAll",$scope.searchText.length>=3&&(void 0!==$scope.searchText&&""!==$scope.searchText||1!=$scope.searchRes||($scope.allRes=1,
$scope.storeMyList=[],$scope.storeAllList=[],$scope.showStoreList($scope.tab)),opts.business_name=void 0===$scope.searchText?"":$scope.searchText,opts.limit_start=limit_start,opts.lang_code=$scope.currentLanguage,opts.limit_size=itemsPerPage,($scope.searchTotalSize>limit_start||0==$scope.searchTotalSize)&&StoreService.searchStore(opts,function(data){if($scope.filterresult=!1,$scope.catebg="",$scope.subCateBg="",$scope.searchRes=1,101==data.code){$scope.storeListObject=data.data,$scope.searchTotalSize=data.size,$scope.totalItems=Math.ceil(data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.storeLoading=!1,$scope.notFound=!1}else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1)}))},$scope.deleteStore=function(id,parentId){$("#store"+id).hide(),$("#storedelete"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,opts.store_type=1,StoreService.deleteStore(opts,function(data){101==data.code?$(".storecoverid"+id).hide():($("#store"+id).show(),$("#storedelete"+id).hide())})},$scope.deleteStoreGrid=function(id,parentId){$("#store"+id).hide(),$("#storedelete"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,opts.store_type=1,StoreService.deleteStore(opts,function(data){101==data.code?$(".storecoverid"+id).hide():($("#store"+id).show(),$("#storedelete"+id).hide())})},$scope.format1=function(n,currency){return n=Number(n),currency+""+n.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")};var locations=[];$scope.maploader=!1;var i,n=[],shopIdArr=[];$scope.getmapstores=function(){$scope.maploader=!0;var opts={user_id:APP.currentUser.id,lang_code:$scope.currentLanguage};StoreService.getmapstores(opts,function(data){if(101==data.code){$scope.detail=data.data;for(var mapArray=data.data,i=0;i<mapArray.length;i++){n.push(mapArray[i].name),shopIdArr.push(mapArray[i].id);var mi=new Array(mapArray[i].mapplace,mapArray[i].latitude,mapArray[i].longitude,mapArray[i].thumb_path,mapArray[i].name,mapArray[i].credit_status,mapArray[i].shot_status,mapArray[i].dp_status,mapArray[i].id,mapArray[i].credit_available,mapArray[i].catogory_id,mapArray[i].sub_category_id,mapArray[i].momosy_status,mapArray[i].card_status,mapArray[i].shop_rating,mapArray[i].shop_category,mapArray[i].shop_sub_category,mapArray[i].shop_keyword,mapArray[i].businessname,mapArray[i].is_fav,$scope.friendtransaction);locations.push(mi)}$(".shop-map").show(),$scope.toggleFilterFalse(),$scope.initialize(),$scope.maploader=!1}else $scope.maploader=!1})},$scope.getmapstores();var res=1;$scope.searchTot=0,$scope.searchshoponmaps=function(arrCollection,req,itemSize){var opts=req;1==res&&StoreService.searchshoponmaps(opts,function(data){if($scope.filterresult=!1,res=0,101==data.code){$scope.storeLoading=!1,$scope.storeListObject=data.data.stores,$scope.storeListObject.length<1?$scope.notFound=!0:$scope.notFound=!1,res=1,$scope.searchTot=itemSize,$scope.totalItems=Math.ceil(itemSize/$scope.itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}else $scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1})};var limit_starts=0,limit_end=12,idCollection=[],sortArrayCollection=[],sorttedId=[];$scope.filterArrayChange="",$scope.searchAddressShop=function(arrCollection){$scope.pagevalue="storeAddSearch",$scope.arrCollection=arrCollection,sortArrayCollection=[],sorttedId=[],1==$scope.filterApply?$scope.arrCollection=$scope.filterArrayChange:($scope.filterArrayChange="",$scope.filterArrayChange=$scope.arrCollection);for(var i=0;i<$scope.arrCollection.length;i++)for(var j=0;j<locations.length;j++)locations[j][8]==$scope.arrCollection[i]&&sortArrayCollection.push({id:locations[j][8],credit:locations[j][9],rating:locations[j][14]});sortArrayCollection.sort(function(a,b){return 1==$scope.orderValue?b.credit-a.credit:b.rating-a.rating});for(var k=0;k<sortArrayCollection.length;k++)sorttedId.push(sortArrayCollection[k].id);if($scope.arrCollection="",$scope.arrCollection=sorttedId,limit_starts=($scope.currentPage-1)*$scope.itemsPerPage,limit_end=limit_starts+$scope.itemsPerPage,$scope.searchTot>limit_starts||0==$scope.searchTot){$scope.storeLoading=!0,idCollection=$scope.arrCollection;var tempArray=idCollection.slice(limit_starts,limit_end),req={user_id:APP.currentUser.id,shops:tempArray,lang_code:$scope.currentLanguage};$scope.searchshoponmaps(arrCollection,req,$scope.arrCollection.length)}$scope.filterApply=0},$scope.idArrays=[],$scope.allArrayIndex=[];var containsText=function(search){var gotText=!1;for(var i in locations){var re=new RegExp(search,"ig"),nameS=re.test(locations[i][4]),cateS=re.test(locations[i][15]),subCateS=re.test(locations[i][16]),busS=re.test(locations[i][18]),keyS=re.test(locations[i][17]);(nameS||cateS||subCateS||busS||keyS)&&(-1==$scope.itemsArr.indexOf(locations[i][4])&&($scope.allArrayIndex.push(i),$scope.itemsArr.push(locations[i][4]),$scope.idArrays.push(shopIdArr[i])),gotText=!0)}return gotText};$scope.searchText="",$scope.itemsSelectedArr=[],$scope.itemsArr=[],$scope.itemsDisplaPanel=!1,$scope.searchMe=function(search){if($scope.itemsArr=[],$scope.idArrays=[],$scope.allArrayIndex=[],$scope.itemsDisplaPanel=!1,search.length>2){var foundText=containsText(search);$scope.itemsDisplaPanel=foundText?!0:!1,$scope.itemsDisplaPanelNone=foundText?!1:!0}},$("#pac-input").focus(function(){$scope.itemsDisplaPanel=!1}),$("body").click(function(){$scope.itemsDisplaPanel=!1,$scope.itemsDisplaPanelNone=!1}),$scope.searchKey="",$scope.itemsDisplaPanelNone=!1,$scope.shopNameMarker=[],$scope.shopNameOnKey=function(){jQuery("#mapstoresearch").keydown(function(e){if($scope.currentPage=1,38==e.keyCode){var selected=jQuery(".selected");jQuery(".mainshop").removeClass("selected"),0==selected.prev().length?(selected.siblings().last().addClass("selected"),jQuery(".autocompletepanel").scrollTo(".selected")):(selected.prev().addClass("selected"),jQuery(".autocompletepanel").scrollTo(".selected")),$scope.searchKey=jQuery(".selected").children().html(),jQuery("#mapstoresearch").val($scope.searchKey)}if(40==e.keyCode){var selected=jQuery(".selected");jQuery(".mainshop").removeClass("selected"),0==selected.next().length?(jQuery(".mainshop:first-child").addClass("selected"),jQuery(".autocompletepanel").scrollTo(".selected")):(selected.next().addClass("selected"),jQuery(".autocompletepanel").scrollTo(".selected")),$scope.searchKey=jQuery(".selected").children().html(),jQuery("#mapstoresearch").val($scope.searchKey)}if(13==e.keyCode){$scope.itemsDisplaPanel=!1;var selected=jQuery(".selected");if(0!=selected.length)$scope.itemSelectedData($scope.searchKey);else{$scope.setShopNameMarker(null),$scope.shopNameMarker=[],$scope.storeIdArray=$scope.idArrays,$scope.searchAddressShop($scope.idArrays),$scope.subcategories="",$scope.catebg="",$scope.subCateBg="",$scope.viewAllActive="",$scope.myStoreActive="",markerClusterer.setMap(null),document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,$scope.addressFilter="",$scope.setMyshop(null),$scope.setFilterMarker(null),$scope.setAllMap(null),$scope.setRemoveAllMap(null),$scope.setDpMarker(null),$scope.setDpShotMarker(null),$scope.filterfalse=0===$scope.filterfalse?1:0,void 0!=$scope.store&&($scope.store.storecategory="",$scope.store.subcategory=""),$scope.cardAvailable=0,$scope.favAvailable=0,$scope.cateval="blank",$scope.subCateVal="blank",$("#results").html(0==$scope.allArrayIndex.length?"<span>"+$scope.i18n.store.result_not_found+"</span>":"<span>"+$scope.allArrayIndex.length+" "+$scope.i18n.store.result_found+"</span>");for(var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"},i=0;i<$scope.allArrayIndex.length;i++){var stIndex=$scope.allArrayIndex[i];marker=new google.maps.Marker(1==locations[stIndex][5]?{position:new google.maps.LatLng(locations[stIndex][1],locations[stIndex][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[stIndex][1],locations[stIndex][2]),map:map,icon:pin}),marker.set("shopId",locations[stIndex][8]),shopCategoryVal=null==locations[stIndex][15]||""==locations[stIndex][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[stIndex][15]+"</div>",votestructure="";for(var num=parseFloat(locations[stIndex][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";if(favoriteIcon=1==locations[stIndex][19]?"<span class='active'></span>":"<span></span>",""==locations[stIndex][3]||void 0==locations[stIndex][3])var content="<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[stIndex][8]+"'>"+locations[stIndex][4]+"</a></div><div>"+locations[stIndex][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[stIndex][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[stIndex][9],"€")+"</span></div></div></div></div>";else var content="<div class='mappopup'><div class='pic-container'><img src='"+locations[stIndex][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[stIndex][8]+"'>"+locations[stIndex][4]+"</a></div><div>"+locations[stIndex][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[stIndex][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[stIndex][9],"€")+"</span></div></div></div></div>";$scope.firecreditshop=function(shopId){$scope.getstorecredit(shopId),$scope.frindBoughtCount(shopId)},google.maps.event.addListener(marker,"click",function(marker,content){return function(){var shopmapid=this.get("shopId");$scope.firecreditshop(shopmapid),infowindow.setContent(content),infowindow.open(map,marker)}}(marker,content)),$scope.shopNameMarker.push(marker)}}}0==$scope.itemsDisplaPanel&&($scope.itemsDisplaPanelNone=!1)})},$scope.shopNameOnKey(),$scope.itemSelectedData=function(str){jQuery(".mainshop").removeClass("selected"),$scope.itemsDisplaPanel=!1,$scope.searchText=str,$("#results").html("");var a=n.indexOf(str);$scope.markerpopup(a),$scope.searchText;$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.searchStore("viewAll",$scope.itemsPerPage)},DELAY_TIME_BEFORE_POSTING)},$scope.itemSelectedDelet=function(sel){var idx=$scope.itemsSelectedArr.indexOf(sel);-1!==idx&&$scope.itemsSelectedArr.splice(idx,1),$scope.itemsDisplaPanel=!1},$scope.searchCategory=function(currentLanguage){var opts={};opts.lang_code=currentLanguage,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,opts.session_id=APP.currentUser.id,ProfileService.searchCatagory(opts,function(data){101===data.code&&"SUCCESS"===data.message&&data.data.length>0&&($scope.categories=data.data)})},$scope.cateval="blank",$scope.subCateVal="blank",$scope.catebg="",$scope.getSubCategory=function(){if($scope.subCateBg="",$scope.subCateVal="blank",null==$scope.store.storecategory)$scope.catebg="",$scope.enableKeyword=!0,$scope.enableSubcategory=!0,$scope.cateval="blank",$scope.subCateBg="",$scope.subCateVal="blank",$scope.store.subcategory="",$scope.enableFilter();else if(""!=$scope.store.storecategory.id&&0!=$scope.store.storecategory.id){$scope.catebg="active",$scope.enableKeyword=!1,$scope.enableSubcategory=!1;var opts={};opts.session_id=APP.currentUser.id,opts.lang_code=$scope.currentLanguage,opts.cat_id=$scope.store.storecategory.id,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,StoreService.getSubCategoryList(opts,function(data){101===data.code&&"SUCCESS"===data.message&&($scope.subcategories=data.data)}),$scope.cateval=$scope.store.storecategory.id,$scope.enableFilter($scope.store.storecategory.id)}else $scope.enableKeyword=!0,$scope.enableSubcategory=!0},$scope.searchCategory($scope.currentLanguage),$scope.shopSubCatogory=function(){$scope.subCateBg="",null==$scope.store.subcategory?($scope.subCateBg="",$scope.subCateVal="blank",$scope.enableFilter("main")):""!=$scope.store.subcategory.id&&0!=$scope.store.subcategory.id&&($scope.subCateBg="active",$scope.subCateVal=$scope.store.subcategory.id,$scope.enableFilter("main"))};var map,arrMarker=[],geocoder=new google.maps.Geocoder,circle=null,gmarkers=[],arrMapresult=[],arrShotMarker=[],arrDpMarker=[],arrDpnShotMarker=[],arrSearchStore=[],markerClusterer=null;$scope.storeIdArray="";var filtermarker=[],filterAllData=[],filterArray=[];$scope.initialize=function(){document.getElementById("pac-input").value="";var centerLatLng=new google.maps.LatLng(41.9,12.4833);map=new google.maps.Map(document.getElementById("map-canvas"),{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:6,center:centerLatLng});var input=document.getElementById("pac-input"),searchBox=new google.maps.places.SearchBox(input);google.maps.event.addListener(searchBox,"places_changed",function(){$scope.currentPage=1,$scope.catebg="",$scope.subCateBg="",$scope.storeListObject=[],$scope.viewAllActive="current",$scope.myStoreActive="",$scope.searchText="",markerClusterer.setMap(null),$scope.rmFilters(),filterAllData=[],document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1;var address=document.getElementById("pac-input").value;document.getElementById("pac-input").value=address,$scope.addressFilter=address;var radius=1e3*parseInt(50,10);geocoder.geocode({address:address},function(results,status){if(status==google.maps.GeocoderStatus.OK){var latitude=results[0].geometry.location.lat(),longitude=results[0].geometry.location.lng(),marker=(new google.maps.LatLng(latitude,longitude),new google.maps.Marker({map:map,position:results[0].geometry.location}));marker.setMap(null),circle&&circle.setMap(null),circle=new google.maps.Circle({center:marker.getPosition(),strokeWeight:0,map:map});var bounds=new google.maps.LatLngBounds;$("#results").html(""),arrMapresult.length=0;for(var arrId=[],i=0;i<gmarkers.length;i++)if(google.maps.geometry.spherical.computeDistanceBetween(gmarkers[i].getPosition(),marker.getPosition())<radius){arrId.push(locations[i][8]),bounds.extend(gmarkers[i].getPosition()),gmarkers[i].setMap(map),arrMapresult.push(gmarkers[i].getPosition());var marker,i,infowindow=new google.maps.InfoWindow;gmarkers[i].getPosition(),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i))}else gmarkers[i].setMap(null);limit_starts=0,limit_end=12,$scope.storeIdArray=arrId,$scope.searchAddressShop(arrId),0==arrMapresult.length?(bounds.extend(results[0].geometry.location),$("#results").html("<span>"+$scope.i18n.store.result_not_found+"</span>")):$("#results").html("<span>"+arrMapresult.length+" "+$scope.i18n.store.result_found+"</span>"),map.fitBounds(bounds),map.setZoom(9)}else alert("Geocode was not successful for the following reason: "+status)})}),google.maps.event.addListener(map,"bounds_changed",function(){var bounds=map.getBounds();searchBox.setBounds(bounds)}),markerClusterer&&markerClusterer.clearMarkers();var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)marker=new google.maps.Marker(0==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrMarker.push(marker),gmarkers.push(marker);markerClusterer=new MarkerClusterer(map,arrMarker,{maxZoom:12}),google.maps.event.addListener(map,"zoom_changed",function(){var zoomLevel=map.getZoom();5>zoomLevel&&null!=circle&&circle.setMap(null)})},$scope.markerpopup=function(index){$scope.viewAllActive="current",$scope.myStoreActive="",document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,$scope.setShopNameMarker(null),markerClusterer.setMap(null),$scope.setMyshop(null),$scope.setAllShotMap(null),$scope.setAllMap(null),$scope.setFilterMarker(null),$scope.setAllMap(map),$scope.setDpMarker(null),$scope.setDpShotMarker(null),null!=circle&&circle.setMap(null),$scope.cardAvailable=0,$scope.favAvailable=0,$scope.cateval="blank",$scope.subCateVal="blank",$scope.addressFilter="",google.maps.event.trigger(arrMarker[index],"click"),map.setZoom(10)},$scope.setAllMap=function(map){for(var i=0;i<arrMarker.length;i++)arrMarker[i].setMap(map),gmarkers[i].setMap(map)},$scope.setRemoveAllMap=function(map){for(var i=0;i<arrSearchStore.length;i++)arrSearchStore[i].setMap(map)},$scope.setMyshop=function(map){for(var i=0;i<$scope.myShopMarker.length;i++)$scope.myShopMarker[i].setMap(map)},$scope.setShopNameMarker=function(map){for(var i=0;i<$scope.shopNameMarker.length;i++)$scope.shopNameMarker[i].setMap(map)},$scope.setAllShotMap=function(map){for(var i=0;i<arrShotMarker.length;i++)arrShotMarker[i].setMap(map)},$scope.setDpMarker=function(map){for(var i=0;i<arrDpMarker.length;i++)arrDpMarker[i].setMap(map)},$scope.setDpShotMarker=function(map){for(var i=0;i<arrDpnShotMarker.length;i++)arrDpnShotMarker[i].setMap(map)},$scope.setFilterMarker=function(map){for(var i=0;i<filtermarker.length;i++)filtermarker[i].setMap(map)},$scope.cardAvailable=0,$scope.toggleCardAvailable=function(){$scope.cardAvailable=0===$scope.cardAvailable?1:0,$scope.enableFilter()},$scope.favAvailable=0,$scope.favArray=[],$scope.toggleShopFav=function(){$scope.favAvailable=0===$scope.favAvailable?1:0,$scope.enableFilter()},$scope.rmFilters=function(){void 0!=$scope.myShopMarker&&$scope.setMyshop(null),$scope.addressFilter="",$scope.searchText="",document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,void 0!=$scope.store&&($scope.store.storecategory="",$scope.store.subcategory=""),$scope.setShopNameMarker(null),$scope.cardAvailable=0,$scope.favAvailable=0,$scope.cateval="blank",$scope.subCateVal="blank",$scope.setFilterMarker(null),$scope.setAllMap(null),$scope.setRemoveAllMap(null),$scope.setDpMarker(null),$scope.setDpShotMarker(null)},$scope.toggleFilterFalse=function(){$scope.subcategories="",$scope.catebg="",$scope.subCateBg="",void 0!=$scope.myShopMarker&&$scope.setMyshop(null),$scope.addressFilter="",$scope.searchText="",document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,$scope.filterfalse=0===$scope.filterfalse?1:0,void 0!=$scope.store&&($scope.store.storecategory="",$scope.store.subcategory=""),$scope.cardAvailable=0,$scope.favAvailable=0,$scope.cateval="blank",$scope.subCateVal="blank",$scope.enableFilter()},$scope.stopFilters=function(){$scope.showStoreList($scope.tab,$scope.itemsPerPage),$scope.pagevalue="",$scope.setAllMap(map)},$scope.myShopMarker=[],$scope.fireMyshopMarker=function(indexArray){$scope.setShopNameMarker(null),$scope.subcategories="",$scope.catebg="",$scope.subCateBg="",markerClusterer.setMap(null),document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,$scope.addressFilter="",$scope.searchText="",$scope.setMyshop(null),$scope.setFilterMarker(null),$scope.setAllMap(null),$scope.setRemoveAllMap(null),$scope.setDpMarker(null),$scope.setDpShotMarker(null),$scope.filterfalse=0===$scope.filterfalse?1:0,void 0!=$scope.store&&($scope.store.storecategory="",$scope.store.subcategory=""),$scope.cardAvailable=0,$scope.favAvailable=0,$scope.cateval="blank",$scope.subCateVal="blank",$("#results").html(0==indexArray.length?"<span>"+$scope.i18n.store.result_not_found+"</span>":"<span>"+indexArray.length+" "+$scope.i18n.store.result_found+"</span>");for(var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"},i=0;i<indexArray.length;i++){var stIndex=indexArray[i];marker=new google.maps.Marker(1==locations[stIndex][5]?{position:new google.maps.LatLng(locations[stIndex][1],locations[stIndex][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[stIndex][1],locations[stIndex][2]),map:map,icon:pin}),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[stIndex][8]),$scope.frindBoughtCount(locations[stindex][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[stIndex][15]||""==locations[stIndex][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[stIndex][15]+"</div>",votestructure="";for(var num=parseFloat(locations[stIndex][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[stIndex][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[stIndex][3]||void 0==locations[stIndex][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[stIndex][8]+"'>"+locations[stIndex][4]+"</a></div><div>"+locations[stIndex][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[stIndex][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[stIndex][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[stIndex][8]+"'>"+locations[stIndex][4]+"</a></div><div>"+locations[stIndex][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[stIndex][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),$scope.myShopMarker.push(marker)}},$scope.cateval="blank",$scope.subCateVal="blank",$scope.searchAddStop=!1,$scope.enableFilter=function(){$scope.filterresult=!0,markerClusterer&&markerClusterer.setMap(null),$scope.viewAllActive="",$scope.myStoreActive="",document.getElementById("shotfilter").checked=!1,document.getElementById("dpfilter").checked=!1,$scope.addressFilter="",$scope.searchText="",$scope.setMyshop(null),$scope.setShopNameMarker(null),$scope.setAllMap(null),$scope.setFilterMarker(null),$scope.setAllShotMap(null),$scope.setDpMarker(null),$scope.setDpShotMarker(null);var infowindow=new google.maps.InfoWindow;filterArray=[],filterAllData=[];var marker,i,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};for(i=0;i<locations.length;i++)if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&"blank"==$scope.subCateVal&&0==$scope.cardAvailable&&0==$scope.favAvailable){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&locations[i][11]==$scope.subCateVal&&"blank"!=$scope.subCateVal&&0==$scope.cardAvailable&&0==$scope.favAvailable){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);

var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if("blank"==$scope.cateval&&"blank"==$scope.subCateVal&&1==$scope.cardAvailable&&1==locations[i][12]&&0==$scope.favAvailable){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&"blank"==$scope.subCateVal&&1==$scope.cardAvailable&&1==locations[i][12]&&0==$scope.favAvailable){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&locations[i][11]!=$scope.subCateVal&&"blank"!=$scope.subCateVal&&0==$scope.cardAvailable&&0==$scope.favAvailable)$scope.searchAddStop=!1;else if(locations[i][10]!=$scope.cateval&&"blank"!=$scope.cateval&&"blank"==$scope.subCateVal&&0==$scope.cardAvailable&&0==$scope.favAvailable)$scope.searchAddStop=!1;else if("blank"==$scope.cateval&&"blank"==$scope.subCateVal&&1==$scope.cardAvailable&&0==locations[i][12]&&0==$scope.favAvailable)$scope.searchAddStop=!1;else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&"blank"==$scope.subCateVal&&1==$scope.cardAvailable&&0==locations[i][12]&&0==$scope.favAvailable)$scope.searchAddStop=!1;else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&locations[i][11]==$scope.subCateVal&&"blank"!=$scope.subCateVal&&1==$scope.cardAvailable&&0==locations[i][12]&&0==$scope.favAvailable)$scope.searchAddStop=!1;else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&"blank"==$scope.subCateVal&&1==$scope.cardAvailable&&0==locations[i][12]&&1==$scope.favAvailable)$scope.searchAddStop=!1;else if("blank"==$scope.cateval&&"blank"==$scope.subCateVal&&0==$scope.cardAvailable&&1==$scope.favAvailable&&0==locations[i][19])$scope.searchAddStop=!1;else if("blank"==$scope.cateval&&"blank"==$scope.subCateVal&&1==$scope.cardAvailable&&0==locations[i][12]&&1==$scope.favAvailable&&1==locations[i][19])$scope.searchAddStop=!1;else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&locations[i][11]==$scope.subCateVal&&"blank"!=$scope.subCateVal&&1==$scope.cardAvailable&&1==locations[i][12]&&0==$scope.favAvailable){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&locations[i][11]==$scope.subCateVal&&"blank"!=$scope.subCateVal&&1==$scope.cardAvailable&&1==locations[i][12]&&1==$scope.favAvailable&&1==locations[i][19]){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&locations[i][11]==$scope.subCateVal&&"blank"!=$scope.subCateVal&&0==$scope.cardAvailable&&1==$scope.favAvailable&&1==locations[i][19]){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&"blank"==$scope.subCateVal&&0==$scope.cardAvailable&&1==$scope.favAvailable&&1==locations[i][19]){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if(locations[i][10]==$scope.cateval&&"blank"!=$scope.cateval&&"blank"==$scope.subCateVal&&1==$scope.cardAvailable&&0==locations[i][12]&&1==$scope.favAvailable&&1==locations[i][19]){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if("blank"==$scope.cateval&&1==$scope.favAvailable&&1==locations[i][19]){marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]);var arrData=new Array(locations[i][0],locations[i][1],locations[i][2],locations[i][3],locations[i][4],locations[i][5],locations[i][6],locations[i][7],locations[i][8],locations[i][9],locations[i][10],locations[i][11],locations[i][12]);filterAllData.push(arrData),$scope.searchAddStop=!1,google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),filtermarker.push(marker)}else if("blank"==$scope.cateval&&0==$scope.cardAvailable&&0==$scope.favAvailable){$scope.catebg="",$scope.subCateBg="",markerClusterer=new MarkerClusterer(map,arrMarker,{}),$scope.searchAddStop=!0,$scope.stopFilters();break}0==$scope.searchAddStop?($("#results").html(0==filterArray.length?"<span>"+$scope.i18n.store.result_not_found+"</span>":"<span>"+filterArray.length+" "+$scope.i18n.store.result_found+"</span>"),$scope.storeIdArray=filterArray,$scope.searchAddressShop(filterArray)):$("#results").html("")},$scope.mapfilter=function(){markerClusterer&&markerClusterer.setMap(null),$scope.addressFilter="",$scope.searchText="",$scope.viewAllActive="",$scope.myStoreActive="",$scope.storeListObject=[],filterArray=[];var chk=document.getElementById("shotfilter").checked,dpchk=document.getElementById("dpfilter").checked;if($scope.setFilterMarker(null),1==chk&&0==dpchk){$scope.searchText="",$scope.setShopNameMarker(null),$scope.setMyshop(null),$scope.setRemoveAllMap(null),$scope.setDpMarker(null),$scope.setAllMap(null),$scope.setDpShotMarker(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};if(0!=filterAllData.length||1==$scope.cardAvailable||"blank"!=$scope.cateval)for(i=0;i<filterAllData.length;i++)1==filterAllData[i][6]&&(marker=new google.maps.Marker(1==filterAllData[i][5]?{position:new google.maps.LatLng(filterAllData[i][1],filterAllData[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(filterAllData[i][1],filterAllData[i][2]),map:map,icon:pin}),filterArray.push(filterAllData[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),
infowindow.open(map,marker)}}(marker,i)),arrShotMarker.push(marker));else for(i=0;i<locations.length;i++)1==locations[i][6]&&(marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrShotMarker.push(marker));limit_starts=0,limit_end=12,$scope.storeIdArray=filterArray,$scope.searchAddressShop(filterArray),$("#results").html(0==filterArray.length?"<span>"+$scope.i18n.store.result_not_found+"</span>":"<span>"+filterArray.length+" "+$scope.i18n.store.result_found+"</span>")}else if(1==dpchk&&0==chk){$scope.setShopNameMarker(null),$scope.setRemoveAllMap(null),$scope.setDpShotMarker(null),$scope.setAllMap(null),$scope.setAllShotMap(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/green-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};if(0!=filterAllData.length||1==$scope.cardAvailable||"blank"!=$scope.cateval)for(i=0;i<filterAllData.length;i++)1==filterAllData[i][7]&&(marker=new google.maps.Marker(1==filterAllData[i][5]?{position:new google.maps.LatLng(filterAllData[i][1],filterAllData[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(filterAllData[i][1],filterAllData[i][2]),map:map,icon:pin}),filterArray.push(filterAllData[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpMarker.push(marker));else for(i=0;i<locations.length;i++)1==locations[i][7]&&(marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}),filterArray.push(locations[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpMarker.push(marker));limit_starts=0,limit_end=12,$scope.storeIdArray=filterArray,$scope.searchAddressShop(filterArray),$("#results").html(0==filterArray.length?"<span>"+$scope.i18n.store.result_not_found+"</span>":"<span>"+filterArray.length+" "+$scope.i18n.store.result_found+"</span>")}else if(1==chk&&1==dpchk){$scope.searchText="",$scope.setShopNameMarker(null),$scope.setDpShotMarker(null),$scope.setAllMap(null),$scope.setAllShotMap(null);var marker,i,infowindow=new google.maps.InfoWindow,pin={url:"app/assets/images/silver-pin.png"},pin2={url:"app/assets/images/silver-pin.png"};if(0!=filterAllData.length||1==$scope.cardAvailable||"blank"!=$scope.cateval)for(i=0;i<filterAllData.length;i++)(1==filterAllData[i][7]||1==filterAllData[i][6])&&(marker=new google.maps.Marker(1==filterAllData[i][5]?{position:new google.maps.LatLng(filterAllData[i][1],filterAllData[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(filterAllData[i][1],filterAllData[i][2]),map:map,icon:pin2}),filterArray.push(filterAllData[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpnShotMarker.push(marker));else for(i=0;i<locations.length;i++)(1==locations[i][7]||1==locations[i][6])&&(marker=new google.maps.Marker(1==locations[i][5]?{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin}:{position:new google.maps.LatLng(locations[i][1],locations[i][2]),map:map,icon:pin2}),filterArray.push(locations[i][8]),google.maps.event.addListener(marker,"click",function(marker,i){return function(){$scope.getstorecredit(locations[i][8]),$scope.frindBoughtCount(locations[i][8]),shopCategoryVal="",favoriteIcon="",shopCategoryVal=null==locations[i][15]||""==locations[i][15]?"<div class='category-dec blank'></div>":"<div class='category-dec'><strong>Category</strong> : "+locations[i][15]+"</div>",votestructure="";for(var num=parseFloat(locations[i][14]).toFixed(1),k=0;5>k;k++)votestructure+=k+.5>=num&&num>k+0?"<li class='half'><img src='app/assets/images/star-blank.png'></li>":num>=k+.6?"<li class='active'><img src='app/assets/images/star-blank.png'></li>":"<li><img src='app/assets/images/star-blank.png'></li>";favoriteIcon=1==locations[i][19]?"<span class='active'></span>":"<span></span>",infowindow.setContent(""==locations[i][3]||void 0==locations[i][3]?"<div class='mappopup'><div class='pic-container'><img src='app/assets/images/store-prod.jpg'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>":"<div class='mappopup'><div class='pic-container'><img src='"+locations[i][3]+"'></div></div><div class='description'><div><a href='#/shop/view/"+locations[i][8]+"'>"+locations[i][4]+"</a></div><div>"+locations[i][0]+"</div>"+shopCategoryVal+"<div class='lower-cont'><div class='icon-section clearfix'><div class='favicon'>"+favoriteIcon+"</div><div class='fr-tr'><span class='img-fr'></span><span class='fr-num'>"+locations[i][20]+"</span></div></div><div class='vote-count'><ul>"+votestructure+"</ul><div class='vote-number ng-binding'>0 VOTES</div></div><div class='ca'>"+$scope.i18n.store.credit_available+" : <span>"+$scope.format1(locations[i][9],"€")+"</span></div></div></div></div>"),infowindow.open(map,marker)}}(marker,i)),arrDpnShotMarker.push(marker));limit_starts=0,limit_end=12,$scope.storeIdArray=filterArray,$scope.searchAddressShop(filterArray),$("#results").html(0==filterArray.length?"<span>"+$scope.i18n.store.result_not_found+"</span>":"<span>"+filterArray.length+" "+$scope.i18n.store.result_found+"</span>")}else null!=circle&&circle.setMap(null),$("#results").html(""),$scope.addressFilter="",$scope.searchText="",$scope.setDpMarker(null),$scope.setDpShotMarker(null),$scope.setRemoveAllMap(null),$scope.setAllShotMap(null),$scope.enableFilter()}}]),app.controller("CreateStoreController",["$scope","$http","$location","$timeout","StoreService","$rootScope","$cookieStore",function($scope,$http,$location,$timeout,StoreService,$rootScope,$cookieStore){$scope.createStoreLoader=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.store={};var opts1={};StoreService.getCountryList(opts1,function(data){101==data.code&&($scope.countryList=data.data)}),$scope.createStore=function(){$scope.createStoreLoader=!0;var opts={};return opts.user_id=APP.currentUser.id,void 0==$scope.store.name||""==$scope.store.name?($scope.createStoreErrorMgs=$scope.i18n.store.enter_name,alert($scope.createStoreErrorMgs),$timeout(function(){$scope.createStoreErrorMgs=""},15e3),$scope.createStoreError=!0,$scope.createStoreLoader=!1,!1):void 0==$scope.store.business_name||""==$scope.store.business_name?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storename,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.legal_status||""==$scope.store.legal_status?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storestatus,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_type||""==$scope.store.business_type?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storetype,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone)?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storenumber,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.email||""==$scope.store.email?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeemail,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_country||""==$scope.store.business_country?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storecountry,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_region||""==$scope.store.business_region?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeregion,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_city||""==$scope.store.business_city?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storecity,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.business_address||""==$scope.store.business_address?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeaddress,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):""==$scope.store.zip||void 0==$scope.store.zip?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storezip,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):""==$scope.store.province||void 0==$scope.store.province?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeprovince,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):$scope.store.province.length<2||$scope.store.province.length>2?($scope.createStoreErrorMgs=$scope.i18n.validation.province_length,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.vat_number||""==$scope.store.vat_number?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storevat,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.iban||""==$scope.store.iban?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storeiban,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==$scope.store.description||""==$scope.store.description?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storedesc,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storelat,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storelog,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value?($scope.createStoreErrorMgs=$scope.i18n.store.enter_storemap,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):""!=$scope.store.referral_id&&void 0!=$scope.store.referral_id&&isNaN($scope.store.referral_id)?($scope.createStoreErrorMgs=$scope.i18n.store.valid_ref_id,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1):(opts.name=$scope.store.name,opts.business_name=$scope.store.business_name,opts.legal_status=$scope.store.legal_status,opts.business_type=$scope.store.business_type,opts.phone=$scope.store.phone,opts.email=$scope.store.email,opts.business_country=$scope.store.business_country,opts.business_region=$scope.store.business_region,opts.business_city=$scope.store.business_city,opts.business_address=$scope.store.business_address,opts.zip=$scope.store.zip,opts.province=$scope.store.province,opts.vat_number=$scope.store.vat_number,opts.iban=$scope.store.iban,opts.description=$scope.store.description,opts.terms=$scope.store.terms,opts.referral_id=$scope.store.referral_id,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.broker_id=$scope.store.broker_id,$scope.createStoreErrorMgs="",void StoreService.createStore(opts,function(data){101==data.code?($scope.createStoreLoader=!0,$rootScope.tempStoreId=data.data.store_id,$cookieStore.put("tempStoreId",data.data.store_id),$location.path("/shop/payment/2")):154==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.citizen_not_exists,$scope.createStoreError=!0):100==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.missed_param,$scope.createStoreError=!0):116==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.enter_businessname,$scope.createStoreError=!0):138==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.vat_exists,$scope.createStoreError=!0):85==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.account_inactive,$scope.createStoreError=!0):165==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.vat_valid,$scope.createStoreError=!0):166==data.code?($scope.createStoreLoader=!1,$scope.createStoreErrorMgs=$scope.i18n.validation.iban_valid,$scope.createStoreError=!0):($scope.createStoreLoader=!1,$scope.createStoreError=!0),$timeout(function(){$scope.createStoreErrorMgs=""},15e3)}))},$scope.resetStoreObject=function(){document.getElementById("mapplace").value="",document.getElementById("latitude").value="",document.getElementById("longitude").value="",$scope.store={}},$scope.loadMap=function(){$scope.map={center:{latitude:40.1451,longitude:-99.668},zoom:4},$scope.options={scrollwheel:!1},$scope.marker={id:0,coords:{latitude:40.1451,longitude:-99.668},options:{draggable:!0},events:{dragend:function(marker,eventName,args){document.getElementById("latitude").value=marker.getPosition().lat(),document.getElementById("longitude").value=marker.getPosition().lng(),$scope.mapLocation(marker.getPosition().lat(),marker.getPosition().lng())}}}},$scope.mapLocation=function(mapLatitude,mapLogitude){var geocoder;geocoder=new google.maps.Geocoder;var latlng=new google.maps.LatLng(parseFloat(mapLatitude),parseFloat(mapLogitude));geocoder.geocode({latLng:latlng},function(results,status){status==google.maps.GeocoderStatus.OK?results[1]?$("#mapplace").val(results[1].formatted_address):alert($scope.i18n.storealbum.album_alert_msg):alert($scope.i18n.storealbum.album_alert_failed+status)})},$scope.loadMap(),$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:13},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.k,document.getElementById("longitude").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$timeout(function(){$scope.initialize()},1e3)}]),app.controller("DeatilStoreController",["$rootScope","$route","$scope","$http","$sce","$routeParams","$location","$timeout","StoreService","fileReader","ProfileService","focus","CommerialService",function($rootScope,$route,$scope,$http,$sce,$routeParams,$location,$timeout,StoreService,fileReader,ProfileService,focus,CommerialService){function Leap(Year){Year%4==0?Year%100==0?$scope.Result=Year%400==0:$scope.Result=1:$scope.Result=0,$scope.monthChange()}$scope.$route=$route,$scope.storeMainId=$routeParams.id;var latitudeMap=0,longitudeMap=0;$scope.keywordList=[],$scope.mobileAppUrl="<li> Fits true to size. Take your normal size\r</li>";var tempcat="";if($scope.store={},$scope.store.storecategory="",$scope.store.sale_subcatid="",$scope.legalForms=APP.legalForms,$scope.countries=APP.countries,$scope.isMyShop=APP.currentUser.store_profile,$scope.regions=APP.regions,$scope.loadDetails=function(){$scope.storeLoading=!0,$scope.updateStart=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.showEditForm=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.id,StoreService.getStoreDetail(opts,function(data){if(101==data.code)if(data.data.owner_id==APP.currentUser.id&&0===data.data.new_contract_status)$location.path("/edit/shop/"+data.data.id);else if(data.data.owner_id==APP.currentUser.id&&(1==data.data.credit_card_status&&0==data.data.shop_status||0==data.data.credit_card_status&&1==data.data.shop_status||0==data.data.credit_card_status&&0==data.data.shop_status))$location.path("shop/"+data.data.id+"/contract");else{$scope.storeDetail=data.data,$scope.store=$scope.storeDetail;var tempopts={};tempopts.id=data.data.id,tempopts.store_name=data.data.name,tempopts.is_paypal_added=data.data.is_paypal_added,tempopts.is_subscribed=data.data.is_subscribed,StoreService.SetStoreData(tempopts),$scope.store.confirmemail=$scope.storeDetail.email,1==$rootScope.mobileView&&(img=null,img=new Image,img.src=$scope.storeDetail.cover_image_path,$scope.windowWidth<="480"?img.onload=function(){img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/3:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/4,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/4:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/6,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0))}:$scope.windowWidth>"480"&&$scope.windowWidth<="768"&&(img.onload=function(){img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/1.8:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/2,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.2,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.8:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/3,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0))})),""!=$scope.storeDetail.shop_keyword&&void 0!=$scope.storeDetail.shop_keyword&&null!=$scope.storeDetail.shop_keyword&&($scope.keywordList=$scope.storeDetail.shop_keyword.split(","));{$scope.storeDetail.sale_catid}if($scope.store.storecategory={id:parseInt($scope.storeDetail.sale_catid)},$scope.getSubCategory(),$scope.store.subcategory={id:parseInt($scope.storeDetail.sale_subcatid)},$scope.store.legal_status={id:$scope.storeDetail.legal_status},$scope.store.regOfficeCountry={id:$scope.storeDetail.business_country},$scope.store.sale_country={id:$scope.storeDetail.sale_country},$scope.store.regOfficeCountry={id:$scope.storeDetail.business_country},$scope.store.business_region={id:$scope.checkRegionExist(APP.regions,$scope.storeDetail.business_region)},$scope.store.sale_region={id:$scope.checkRegionExist(APP.regions,$scope.storeDetail.sale_region)},""!=$scope.store.repres_dob&&void 0!=$scope.store.repres_dob&&null!=$scope.store.repres_dob){var DOB=$scope.store.repres_dob.substring(0,10),dtArray=DOB.split("-"),dtDay=parseInt(dtArray[2]),dtMonth=parseInt(dtArray[1]),dtYear=parseInt(dtArray[0]);$scope.store.dobMonth=$scope.months[dtMonth-1],$scope.store.dobYear={id:dtYear},Leap(dtYear),$scope.store.dobDay=dtDay}document.getElementById("latitude").value=$scope.storeDetail.latitude,document.getElementById("longitude").value=$scope.storeDetail.longitude,document.getElementById("mapplace").value=$scope.storeDetail.map_place,$scope.aboutStore(),$scope.storeLoading=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,angular.element("#pac-input").val(data.data.map_place),-1!=$location.path().indexOf("/shop/edit")||-1!=$location.path().indexOf("/shop/view")?$timeout(function(){$scope.initialize()},1e3):$timeout(function(){},1e3);var storeData={};storeData.storeId=$scope.storeDetail.owner_id;var mopts={};mopts.store_id=$scope.storeDetail.id,mopts.session_id=APP.currentUser.id,StoreService.getMobileAppUrl(mopts,function(data){
101==data.code?$scope.store.mobileAppUrl=data.data.url:$scope.store.mobileAppUrl=""}),StoreService.setStoreOwnerId(storeData,function(data){})}else $scope.storeLoading=!1,$scope.createStoreError=!0})},$scope.checkRegionExist=function(p,k){for(var i=0;i<p.length;i++){var obj=p[i];if(obj.id===k)return k}return void 0},$scope.$watch("currentLanguage",function(newValue,oldValue){$timeout(function(){$scope.months=$scope.i18n.profile.months},400)}),$scope.loadDetails(),$scope.editStore=function(){$scope.createStoreLoader=!1,$scope.store=$scope.storeDetail,$scope.timelineActive=!1,$scope.timelineActive1=!1;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.aboutStore=function(){$scope.store=$scope.storeDetail;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.vatNumberInvalid=!1,$scope.ibanNumberInvalid=!1,$scope.updateEditStore=function(){$scope.updateStart=!0,$scope.formSubmitted=!0;var opts={};if(opts.user_id=APP.currentUser.id,opts.store_id=$scope.store.id,void 0==$scope.store.name||""==$scope.store.name)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.storename.$dirty=!0,$scope.shopEditForm.storename.$invalid=!0,$scope.shopEditForm.storename.$error.required=!0,focus("storename"),!1;if(void 0==$scope.store.business_name||""==$scope.store.business_name)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.business_name.$dirty=!0,$scope.shopEditForm.business_name.$invalid=!0,$scope.shopEditForm.business_name.$error.required=!0,focus("business_name"),!1;if(void 0==$scope.store.legal_status||""==$scope.store.legal_status)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.legal_status.$dirty=!0,$scope.shopEditForm.legal_status.$invalid=!0,$scope.shopEditForm.legal_status.$error.required=!0,focus("legal_status"),!1;if(void 0==$scope.store.vat_number||""==$scope.store.vat_number)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.vatNumber.$dirty=!0,$scope.shopEditForm.vatNumber.$invalid=!0,$scope.shopEditForm.vatNumber.$error.required=!0,focus("vatNumber"),!1;if(void 0==$scope.store.fiscal_code||""==$scope.store.fiscal_code)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.fiscalcode.$dirty=!0,$scope.shopEditForm.fiscalcode.$invalid=!0,$scope.shopEditForm.fiscalcode.$error.required=!0,focus("fiscalcode"),!1;if(void 0==$scope.store.email||""==$scope.store.email)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.shopemail.$dirty=!0,$scope.shopEditForm.shopemail.$invalid=!0,$scope.shopEditForm.shopemail.$error.required=!0,focus("shopemail"),!1;if(void 0==$scope.store.confirmemail||""==$scope.store.confirmemail||$scope.store.email!==$scope.store.confirmemail)return $scope.inputname="confirmemail",$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.confirmemail.$dirty=!0,$scope.shopEditForm.confirmemail.$invalid=!0,$scope.shopEditForm.confirmemail.$error.required=!0,focus("confirmemail"),!1;if(void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone))return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.shopphone.$dirty=!0,$scope.shopEditForm.shopphone.$invalid=!0,$scope.shopEditForm.shopphone.$error.required=!0,focus("shopphone"),!1;if(void 0==$scope.store.iban||""==$scope.store.iban)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.iban.$dirty=!0,$scope.shopEditForm.iban.$invalid=!0,$scope.shopEditForm.iban.$error.required=!0,focus("iban"),!1;if(void 0==$scope.store.storecategory||""==$scope.store.storecategory)return $scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.storecategory.$dirty=!0,$scope.shopEditForm.storecategory.$invalid=!0,$scope.shopEditForm.storecategory.$error.required=!0,focus("storecategory"),!1;if(void 0==$scope.store.description||""==$scope.store.description)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.description.$dirty=!0,$scope.shopEditForm.description.$invalid=!0,$scope.shopEditForm.description.$error.required=!0,focus("description"),!1;if(void 0==$scope.store.regOfficeCountry||""==$scope.store.regOfficeCountry)return $scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.regofficecountry.$dirty=!0,$scope.shopEditForm.regofficecountry.$invalid=!0,$scope.shopEditForm.regofficecountry.$error.required=!0,focus("regofficecountry"),!1;if(void 0==$scope.store.business_region.id||""==$scope.store.business_region.id)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.businessregion.$dirty=!0,$scope.shopEditForm.businessregion.$invalid=!0,$scope.shopEditForm.businessregion.$error.required=!0,focus("businessregion"),!1;if(void 0==$scope.store.business_city||""==$scope.store.business_city)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.businesscity.$dirty=!0,$scope.shopEditForm.businesscity.$invalid=!0,$scope.shopEditForm.businesscity.$error.required=!0,focus("businesscity"),!1;if(void 0==$scope.store.province||""==$scope.store.province)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.province.$dirty=!0,$scope.shopEditForm.province.$invalid=!0,$scope.shopEditForm.province.$error.required=!0,focus("province"),!1;if($scope.store.province.length<2||$scope.store.province.length>2)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.province.$dirty=!0,$scope.shopEditForm.province.$invalid=!0,$scope.shopEditForm.province.$error.required=!0,focus("province"),!1;if(void 0==$scope.store.zip||""==$scope.store.zip||$scope.store.zip.length<5||$scope.store.zip.length>5)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.regofficezip.$dirty=!0,$scope.shopEditForm.regofficezip.$invalid=!0,$scope.shopEditForm.regofficezip.$error.required=!0,focus("regofficezip"),!1;if(void 0==$scope.store.business_address||""==$scope.store.business_address)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.businessaddress.$dirty=!0,$scope.shopEditForm.businessaddress.$invalid=!0,$scope.shopEditForm.businessaddress.$error.required=!0,focus("businessaddress"),!1;if(void 0==$scope.store.sale_country||""==$scope.store.sale_country)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salecountry.$dirty=!0,$scope.shopEditForm.salecountry.$invalid=!0,$scope.shopEditForm.salecountry.$error.required=!0,focus("salecountry"),!1;if(void 0==$scope.store.sale_region.id||""==$scope.store.sale_region.id)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleregion.$dirty=!0,$scope.shopEditForm.saleregion.$invalid=!0,$scope.shopEditForm.saleregion.$error.required=!0,focus("saleregion"),!1;if(void 0==$scope.store.sale_city||""==$scope.store.sale_city)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salecity.$dirty=!0,$scope.shopEditForm.salecity.$invalid=!0,$scope.shopEditForm.salecity.$error.required=!0,focus("salecity"),!1;if(void 0==$scope.store.sale_province||""==$scope.store.sale_province)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleprovince.$dirty=!0,$scope.shopEditForm.saleprovince.$invalid=!0,$scope.shopEditForm.saleprovince.$error.required=!0,focus("saleprovince"),!1;if($scope.store.sale_province.length<2||$scope.store.sale_province.length>2)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleprovince.$dirty=!0,$scope.shopEditForm.saleprovince.$invalid=!0,$scope.shopEditForm.saleprovince.$error.required=!0,focus("saleprovince"),!1;if(void 0==$scope.store.sale_zip||""==$scope.store.sale_zip)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salezip.$dirty=!0,$scope.shopEditForm.salezip.$invalid=!0,$scope.shopEditForm.salezip.$error.required=!0,focus("salezip"),!1;if($scope.store.sale_zip.length<5||$scope.store.sale_zip.length>5)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salezip.$dirty=!0,$scope.shopEditForm.salezip.$invalid=!0,$scope.shopEditForm.salezip.$error.required=!0,focus("salezip"),!1;if(void 0==$scope.store.sale_address||""==$scope.store.sale_address)return $scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleaddress.$dirty=!0,$scope.shopEditForm.saleaddress.$invalid=!0,$scope.shopEditForm.saleaddress.$error.required=!0,focus("saleaddress"),!1;if(void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storelat,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1;if(void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storelog,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1;if(void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_storemap,$scope.createGroupError=!0,$scope.updateStart=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3),!1;if(void 0==$scope.store.sale_email||""==$scope.store.sale_email)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstoreemail,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.saleemail.$dirty=!0,$scope.shopEditForm.saleemail.$invalid=!0,$scope.shopEditForm.saleemail.$error.required=!0,focus("saleemail"),!1;if(void 0==$scope.store.sale_phone_number||""==$scope.store.sale_phone_number||1==isNaN($scope.store.sale_phone_number))return $scope.createStoreErrorMgs=$scope.i18n.store.enter_hqstorephone,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.salephonenumber.$dirty=!0,$scope.shopEditForm.salephonenumber.$invalid=!0,$scope.shopEditForm.salephonenumber.$error.required=!0,focus("salephonenumber"),!1;if(void 0==$scope.store.repres_fiscal_code||""==$scope.store.repres_fiscal_code)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalTaxCode,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represfiscalcode.$dirty=!0,$scope.shopEditForm.represfiscalcode.$invalid=!0,$scope.shopEditForm.represfiscalcode.$error.required=!0,focus("represfiscalcode"),!1;if(void 0==$scope.store.repres_first_name||""==$scope.store.repres_first_name)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_firstName,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represfname.$dirty=!0,$scope.shopEditForm.represfname.$invalid=!0,$scope.shopEditForm.represfname.$error.required=!0,focus("represfname"),!1;if(void 0==$scope.store.repres_last_name||""==$scope.store.repres_last_name)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_lastName,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represlname.$dirty=!0,$scope.shopEditForm.represlname.$invalid=!0,$scope.shopEditForm.represlname.$error.required=!0,focus("represlname"),!1;if(void 0==$scope.store.repres_place_of_birth||""==$scope.store.repres_place_of_birth)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalBirthPlace,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represdobplace.$dirty=!0,$scope.shopEditForm.represdobplace.$invalid=!0,$scope.shopEditForm.represdobplace.$error.required=!0,focus("represdobplace"),!1;if(void 0==$scope.store.dobDay||""==$scope.store.dobDay)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntDd,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.dobday.$dirty=!0,$scope.shopEditForm.dobday.$invalid=!0,$scope.shopEditForm.dobday.$error.required=!0,focus("dobday"),!1;if(void 0==$scope.store.dobMonth||""==$scope.store.dobMonth)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntMonth,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.dobmonth.$dirty=!0,$scope.shopEditForm.dobmonth.$invalid=!0,$scope.shopEditForm.dobmonth.$error.required=!0,focus("dobmonth"),!1;if(void 0==$scope.store.dobYear||""==$scope.store.dobYear)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntYear,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.dobyear.$dirty=!0,$scope.shopEditForm.dobyear.$invalid=!0,$scope.shopEditForm.dobyear.$error.required=!0,focus("dobyear"),!1;if(void 0==$scope.store.repres_email||""==$scope.store.repres_email)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalEmail,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represemail.$dirty=!0,$scope.shopEditForm.represemail.$invalid=!0,$scope.shopEditForm.represemail.$error.required=!0,focus("represemail"),!1;if(void 0==$scope.store.repres_phone_number||""==$scope.store.repres_phone_number)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_legalPhone,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represphonenumber.$dirty=!0,$scope.shopEditForm.represphonenumber.$invalid=!0,$scope.shopEditForm.represphonenumber.$error.required=!0,focus("represphonenumber"),!1;if(void 0==$scope.store.repres_address||""==$scope.store.repres_address)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntAddress,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.shopEditForm.represaddress.$dirty=!0,$scope.shopEditForm.represaddress.$invalid=!0,$scope.shopEditForm.represaddress.$error.required=!0,focus("represaddress"),!1;if(void 0==$scope.store.repres_province||""==$scope.store.repres_province)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntProvince,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopEditForm.represprovince.$dirty=!0,$scope.shopEditForm.represprovince.$invalid=!0,$scope.shopEditForm.represprovince.$error.required=!0,focus("represprovince"),!1;if($scope.store.repres_province.length<2||$scope.store.repres_province.length>2)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntProvince,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.shopEditForm.represprovince.$dirty=!0,$scope.shopEditForm.represprovince.$invalid=!0,$scope.shopEditForm.represprovince.$error.required=!0,focus("represprovince"),!1;if(void 0==$scope.store.repres_city||""==$scope.store.repres_city)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntCity,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.represcity.$dirty=!0,$scope.shopEditForm.represcity.$invalid=!0,$scope.shopEditForm.represcity.$error.required=!0,focus("represcity"),!1;if(void 0==$scope.store.repres_zip||""==$scope.store.repres_zip)return $scope.createStoreErrorMgs=$scope.i18n.store.enter_permntZip,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.represzip.$dirty=!0,$scope.shopEditForm.represzip.$invalid=!0,$scope.shopEditForm.represzip.$error.required=!0,focus("represzip"),!1;if(void 0!=$scope.store.dobYear||""!=$scope.store.dobYear){if($scope.store.dobDay.id>=29&&2==$scope.store.dobMonth.id)return $scope.createStoreErrorMgs=$scope.i18n.shop_affiliation.detail.enter_correct_dob,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.dobmonth.$dirty=!0,$scope.shopEditForm.dobmonth.$invalid=!0,$scope.shopEditForm.dobmonth.$error.required=!0,focus("dobmonth"),!1}else if(void 0!=$scope.store.dobYear||""!=$scope.store.dobYear){var isLeap=1==new Date($scope.store.dobYear.id,1,29).getMonth();if(0==isLeap&&$scope.store.dobDay.id>=29&&2==$scope.store.dobMonth.id)return $scope.createStoreErrorMgs=$scope.i18n.shop_affiliation.detail.enter_correct_dob,$scope.createStoreError=!0,$scope.createStoreLoader=!1,$scope.updateStart=!1,$scope.shopEditForm.dobyear.$dirty=!0,$scope.shopEditForm.dobyear.$invalid=!0,$scope.shopEditForm.dobyear.$error.required=!0,focus("dobyear"),!1}var dd=$scope.store.dobDay,month=$scope.store.dobMonth.value+"-",year=$scope.store.dobYear.id+"-";$scope.store.dob=year.concat(month,dd),opts.name=$scope.store.name,opts.business_name=$scope.store.business_name,opts.legal_status=$scope.store.legal_status.id,opts.vat_number=$scope.store.vat_number,opts.fiscal_code=$scope.store.fiscal_code,opts.email=angular.lowercase($scope.store.email),opts.phone=$scope.store.phone,opts.iban=$scope.store.iban,opts.sale_catid=$scope.store.storecategory.id,void 0!=$scope.store.subcategory||"0"!=$scope.store.subcategory.id?opts.sale_subcatid=$scope.store.subcategory.id:opts.sale_subcatid=null,void 0!=$scope.keywordList||"0"!=$scope.keywordList.length?opts.shop_keyword=$scope.keywordList.join():opts.shop_keyword=[],opts.description=$scope.store.description,opts.business_country=$scope.store.regOfficeCountry.id,opts.business_region=$scope.store.business_region.id,opts.business_city=$scope.store.business_city,opts.province=$scope.store.province,opts.zip=$scope.store.zip,opts.business_address=$scope.store.business_address,opts.sale_country=$scope.store.sale_country.id,opts.sale_region=$scope.store.sale_region.id,opts.sale_city=$scope.store.sale_city,opts.sale_province=$scope.store.sale_province,opts.sale_zip=$scope.store.sale_zip,opts.sale_address=$scope.store.sale_address,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.sale_map=document.getElementById("mapplace").value,opts.sale_email=angular.lowercase($scope.store.sale_email),opts.sale_phone_number=$scope.store.sale_phone_number,opts.repres_fiscal_code=$scope.store.repres_fiscal_code,opts.repres_first_name=$scope.store.repres_first_name,opts.repres_last_name=$scope.store.repres_last_name,opts.repres_place_of_birth=$scope.store.repres_place_of_birth,opts.repres_dob=$scope.store.dob,opts.repres_email=angular.lowercase($scope.store.repres_email),opts.repres_phone_number=$scope.store.repres_phone_number,opts.repres_address=$scope.store.repres_address,opts.repres_province=$scope.store.repres_province,opts.repres_city=$scope.store.repres_city,opts.repres_zip=$scope.store.repres_zip,opts.referral_id=$scope.store.referral_info.id,opts.call_type=3,opts.business_type="not in current use",opts.sale_description="not in current use",opts.allow_access=$scope.store.is_allowed,$scope.createStoreErrorMgs="",StoreService.updateStore(opts,function(data){101==data.code?($scope.updateStart=!1,$scope.showEditForm=!1,$scope.createStoreLoader=!1,$scope.createGroupSuccess=!0,$scope.createStoreSuccessMgs=$scope.i18n.albums.update_sucess,$timeout(function(){$scope.createStoreSuccessMgs=""},15e3),$location.path("/shop/edit/"+$scope.store.id)):137==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.broker_not_exists,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):100==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.missed_param,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):90==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.account_inactive,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):91==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_exists,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.vatNumberInvalid=!0,$timeout(function(){$scope.vatNumberInvalid=!1},3e3),focus("vatNumber")):126==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.invalid_store_forum_type,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):500==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.permission_denied,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):89==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.error_occured,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3)):165==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_valid,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.vatNumberInvalid=!0,$timeout(function(){$scope.vatNumberInvalid=!1},3e3),focus("vatNumber")):166==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.iban_valid,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.ibanNumberInvalid=!0,$timeout(function(){$scope.ibanNumberInvalid=!1},3e3),focus("iban")):($scope.createStoreErrorMgs=data.message,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1,$timeout(function(){$scope.createStoreErrorMgs=""},15e3))})},$location.search().txn_id){$scope.tranId=$location.search().txn_id;var formData={};formData.user_id=APP.currentUser.id,formData.txn_id=$scope.tranId,formData.status="CANCEL",CommerialService.returnPaymentCancel(formData,function(data){101==data.code&&$location.search({})})}$scope.initializeMaps=function(){{var mapOptions=(new google.maps.LatLng(latitudeMap,longitudeMap),{center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:6}),map=new google.maps.Map(document.getElementById("map-canvas-second"),mapOptions);new google.maps.Marker({position:new google.maps.LatLng(latitudeMap,longitudeMap),map:map,title:$scope.store.map_place})}},$(".member-store").click(function(){$(this).addClass("active"),$(".store-invitations li").removeClass("active")}),$scope.cancelEditStore=function(){$scope.showEditForm=!1,$location.path("/shop/about/"+$scope.store.id)},$scope.loadEditMap=function(){$scope.map={center:{latitude:40.1451,longitude:-99.668},zoom:4},$scope.options={scrollwheel:!1},$scope.marker={id:0,coords:{latitude:40.1451,longitude:-99.668},options:{draggable:!0},events:{dragend:function(marker,eventName,args){document.getElementById("latitude").value=marker.getPosition().lat(),document.getElementById("longitude").value=marker.getPosition().lng(),$scope.mapLocation(marker.getPosition().lat(),marker.getPosition().lng())}}}},$scope.loadEditMap(),$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var myLatlng=new google.maps.LatLng(latitudeMap,longitudeMap),mapOptions={center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:8},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,position:myLatlng,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.k,document.getElementById("longitude").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$scope.initializeWait=function(){$timeout(function(){},1e3)},$scope.showInvite=!1,$scope.timelineActive=!1,$scope.toggleInvite=function(){$scope.timelineActive=!$scope.timelineActive,$scope.uploadProfileImage=!1,$scope.showInvite=!$scope.showInvite,$scope.timelineActive1=!1,$scope.showEditForm=!1},$scope.uploadProfileImage=!1,$scope.toggleUploadImage=function(){$scope.showInvite=!1,$scope.uploadProfileImage=!$scope.uploadProfileImage},$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.uploadStoreProfileImage=function(){$scope.uploadStoreProfile=!0;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);if("gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType)$scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0;else{var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeDetail.id,StoreService.uploadStoreProfileimage(opts,$scope.myFile,function(data){101==data.code?($scope.uploadProfileImage=!1,$scope.uploadStoreProfile=!1,$scope.storeDetail.cover_image_path=data.data.cover_image_path,$scope.storeDetail.profile_image_original=data.data.original_image_path):$scope.uploadStoreProfile=!1})}},$scope.myFile="",$scope.imageSrc="",$scope.invalidCoverImage=!1,void 0==$scope.i18n.storealbum?$scope.invalidCoverImageMgs="Please choose an image that is at least 910 pixels wide and at least 400 pixels tall":$scope.invalidCoverImageMgs=$scope.i18n.storealbum.album_invalidCoverImageMgs,$scope.getFile=function(){$scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.imageSrc=result;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0):($scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.readImage($scope.myFile,function(data){0!=data.length&&data.width>=910&&data.height>=400?$scope.uploadStoreProfileImage():($("#invalidCoverImage").show(),$timeout(function(){$("#invalidCoverImage").hide()},4e3))}))})},$scope.readImage=function(file,callback){var reader=new FileReader,image=new Image;reader.readAsDataURL(file),reader.onload=function(_file){var filedata={};image.src=_file.target.result,image.onload=function(){{var w=this.width,h=this.height;file.type,file.name,~~(file.size/1024)+"KB"}filedata.width=w,filedata.height=h,callback(filedata)},image.onerror=function(){callback(filedata)}}},$scope.timelineActive1=!1,$scope.showAllStoreMember=!1,$scope.showAllMembers=function(){$scope.showAllStoreMember=!$scope.showAllStoreMember,$scope.timelineActive1=!$scope.timelineActive1,$scope.timelineActive=!1,$scope.showEditForm=!1},$scope.$watch("currentLanguage",function(newValue,oldValue){$scope.searchCategory(newValue),""!=tempcat&&0!=tempcat&&$scope.getSubCategory()}),$scope.searchCategory=function(currentLanguage){var opts={};opts.lang_code=currentLanguage,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,opts.session_id=APP.currentUser.id,ProfileService.searchCatagory(opts,function(data){101===data.code&&"SUCCESS"===data.message&&data.data.length>0&&($scope.categories=data.data)})},$scope.subcategoryLoader=!1,$scope.getSubCategory=function(){if($scope.subcategoryLoader=!0,""!=$scope.store.storecategory.id&&0!=$scope.store.storecategory.id){$scope.enableKeyword=!1,$scope.enableSubcategory=!1;var opts={};opts.lang_code=$scope.currentLanguage,opts.cat_id=$scope.store.storecategory.id,opts.session_id=APP.currentUser.id,$scope.cancelCategoryRequest=!1,StoreService.getSubCategoryList(opts,function(data){$scope.subcategoryLoader=!1,101===data.code&&"SUCCESS"===data.message&&($scope.subcategories=data.data)})}else $scope.enableKeyword=!0,$scope.enableSubcategory=!0},$scope.searchCategory($scope.currentLanguage),$scope.clearKeywordList=function(){$timeout(function(){$scope.keywords=[]},500)},$scope.removeKeyword=function(index){$scope.keywordList.splice(index,1)},$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],$scope.Result=0,$scope.$watch("store.dobYear",function(val){void 0!=$scope.store.dobYear&&Leap(val.value)}),$scope.monthChange=function(){if(void 0===$scope.store.dobMonth||""===$scope.store.dobMonth||null===$scope.store.dobMonth);else{var normalValue=$scope.store.dobMonth.value-1;6>=normalValue?normalValue%2==0?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.store.dobMonth.value-1==1?$scope.Result?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:normalValue%2!=0?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]}},$scope.getyears=function(){var currentYear=(new Date).getFullYear();$scope.years=[];for(var i=1914;currentYear>=i;i++)$scope.years.push({id:i,value:i})},$scope.getyears();var currentTimeout=null,DELAY_TIME_BEFORE_POSTING=300;$("#categoryKeyword").keypress(function(event){currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchKeyword()},DELAY_TIME_BEFORE_POSTING)}),$scope.keywords=[],$scope.searchKeyword=function(){var opts={};opts.category_id=$scope.store.storecategory.id.toString(),opts.keyword=$scope.store.keywords,$scope.cancelKeywordRequest=!1,$scope.showCatKeyLoading=!0,opts.session_id=APP.currentUser.id,ProfileService.searchCatagoryKeyword(opts,function(data){$scope.showCatKeyLoading=!1,101===data.code&&"SUCCESS"===data.message&&$scope.cancelKeywordRequest===!1&&($scope.keywords=data.data.keyword)})},$scope.keywordIndex=-1,$scope.keywordKeyDown=function(event){if(40===event.keyCode)event.preventDefault(),$scope.keywordIndex+1!==$scope.keywords.length&&$scope.keywordIndex++;else if(38===event.keyCode)event.preventDefault(),$scope.keywordIndex-1!==-1&&$scope.keywordIndex--;else if(13===event.keyCode)if(void 0===$scope.keywords[$scope.keywordIndex]){if(""!==$scope.store.keywords.trim()){var opts={};opts.user_id=APP.currentUser.id,opts.keyword=$scope.store.keywords,ProfileService.addKeywords(opts,function(data){})}$scope.storeKeyword($scope.store.keywords)}else $scope.storeKeyword($scope.keywords[$scope.keywordIndex])},$scope.cancelKeywordRequest=!1,$scope.clearKeyList=function(){$scope.cancelKeywordRequest=!0,$timeout(function(){$scope.keywords=[]},500)},$scope.store.keywords="",$scope.keywordList=[],$scope.storeKeyword=function(index){if($scope.keywords=[],$scope.keywordIndex=-1,$scope.store.keywords="","object"==typeof index)-1===$scope.keywordList.indexOf(index.name)&&$scope.keywordList.push(index.name);else{if(""===index||void 0===index)return!1;-1===$scope.keywordList.indexOf(index)&&$scope.keywordList.push(index)}},$scope.clearKeywordList=function(){$timeout(function(){$scope.keywords=[]},500)},$scope.removeKeyword=function(index){$scope.keywordList.indexOf(index);

$scope.keywordList.splice(index,1)}}]).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("CreateChildStore",["$scope","$http","$routeParams","$location","$timeout","StoreService",function($scope,$http,$routeParams,$location,$timeout,StoreService){$scope.createStoreLoader=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.store={};var opts1={};StoreService.getCountryList(opts1,function(data){101==data.code&&($scope.countryList=data.data)}),$scope.createChildStore=function(){var storeParentId=$routeParams.id;if(void 0==$scope.store.phone||""==$scope.store.phone)return $scope.createStoreError=!0,$scope.createStoreErrorMgs=$scope.i18n.storealbum.album_ErrorMgsphone,!1;if(void 0==$scope.store.zip||""==$scope.store.zip)return $scope.createStoreError=!0,$scope.createStoreErrorMgs=$scope.i18n.storealbum.album_ErrorMgszip,!1;$scope.createStoreLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.business_name=$scope.store.business_name,opts.parent_store_id=storeParentId,opts.legal_status=$scope.store.legal_status,opts.business_type=$scope.store.business_type,opts.phone=$scope.store.phone,opts.email=$scope.store.email,opts.business_country=$scope.store.business_country,opts.business_region=$scope.store.business_region,opts.business_city=$scope.store.business_city,opts.business_address=$scope.store.business_address,opts.zip=$scope.store.zip,opts.province=$scope.store.province,opts.vat_number=$scope.store.vat_number,opts.iban=$scope.store.iban,opts.description=$scope.store.description,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,StoreService.createChildStore(opts,function(data){101==data.code?($scope.createStoreLoader=!0,$location.path("/shop/view/"+storeParentId)):($scope.createStoreLoader=!1,$scope.createStoreError=!0,$scope.createStoreErrorMgs=$scope.i18n.storealbum.album_ErrorMgs)})},$scope.resetStoreObject=function(){document.getElementById("mapplace").value="",document.getElementById("latitude").value="",document.getElementById("longitude").value="",$scope.store={}},$scope.updateChildStore=function(){},$scope.cancelChildStore=function(){$scope.showEditForm=!1,$scope.editStoreObject={}},$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:8},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("latitude").value=countryPlace.geometry.location.k,document.getElementById("longitude").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},"{}"!=JSON.stringify(APP.currentUser)&&$timeout(function(){$scope.initialize()},1e3)}]),app.controller("StoreLeftController",["$scope","$http","StoreService",function($scope,$http,StoreService){$scope.showLeftPanel=!1,$scope.storeNotFound=!1;var opts={};opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start="",opts.limit_size="",StoreService.getAllStoreWithChild(opts,function(data){101==data.code?0!=data.data.stores.length?($scope.storeLeftList=data.data.stores,$scope.storeNotFound=!1):($scope.storeNotFound=!0,$scope.storeLeftList=data.data.stores):100==data.code?$scope.storeNotFound=!0:$scope.storeNotFound=!0,$scope.showLeftPanel=!0})}]),app.controller("StoreNotificationController",["$scope","$http","StoreService",function($scope,$http,StoreService){$scope.getStoreNotification=function(){$scope.NotificationFound=!1,$scope.NotificationNotFound=!1,opts={},opts.user_id=APP.currentUser.id,StoreService.getStoreNotifications(opts,function(data){101==data.code&&0!=data.data.length?($scope.storeNotification=data.data,$scope.NotificationFound=!0):$scope.NotificationNotFound=!0})},$scope.getStoreNotification(),$scope.AcceptRequest=function(storeId,requestId,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.store_id=storeId,opts.response=1,StoreService.acceptDenyToStoreNotification(opts,function(data){101==data.code&&$scope.getStoreNotification()})},$scope.rejectRequest=function(storeId,requestId,id){$("#noti-"+id).fadeOut(1e3),opts={},opts.user_id=APP.currentUser.id,opts.request_id=requestId,opts.store_id=storeId,opts.response=2,StoreService.acceptDenyToStoreNotification(opts,function(data){101==data.code&&$scope.getStoreNotification()})}}]),app.controller("AutocompleteController",["$scope","$http","$timeout","StoreService",function($scope,$http,$timeout,StoreService){$scope.searchLoading=!1,$scope.msgAfterInvite="",$scope.searchedUsers=[],$scope.searchUsers=function(){if($scope.msgAfterInvite="",$scope.searchLoading=!0,""!==$scope.selectedCountries){var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=void 0===$scope.selectedCountries?"":$scope.selectedCountries,opts.limit_start=APP.user_list_pagination.start,opts.limit_size=APP.user_list_pagination.end,StoreService.searchUser(opts,function(data){if($scope.searchLoading=!1,$scope.searchedUsers=[],101==data.code)for(var response=data.data.users,i=0;i<data.data.users.length;i++){var user={};user.capital=response[i].user_id,user.country=response[i].user_name,$scope.searchedUsers.push(user)}else $scope.searchedUsers=[]})}},$scope.InviteSendButton=!1,$scope.onSelectPart=function(){$scope.InviteSendButton=!0},$scope.onSelectPartCancel=function(){$scope.InviteSendButton=!1,$scope.selectedCountries=""},$scope.SentInviteFromStore=function(){$scope.searchLoading=!0;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeDetail.id,opts.friend_id=$scope.selectedCountries.capital,StoreService.inviteUserOnStore(opts,function(data){$scope.searchLoading=!1,$scope.InviteSendButton=!1,$scope.selectedCountries="",(data.code=101)?($scope.msgAfterInvite=$scope.i18n.storealbum.album_msgAfterInvite,$timeout(function(){$scope.msgAfterInvite=""},2e3)):118==data.code?($scope.msgAfterInvite=data.message,$timeout(function(){$scope.msgAfterInvite=""},2e3)):($scope.msgAfterInvite=data.message,$timeout(function(){$scope.msgAfterInvite=""},2e3))})}}]),app.controller("MyShopController",["$scope","$http","$timeout","StoreService","$location","$routeParams",function($scope,$http,$timeout,StoreService,$location,$routeParams){$scope.storeListObject=[],$scope.storeMyList=[],$scope.storeAllList=[],$scope.totalSize=0,$scope.myTotalSize=0,$scope.storeLoading=!0,$scope.notFound=!1,$scope.Res=1,$scope.listActive="active",$scope.gridActive="",$scope.firstPage=APP.store_list_pagination.end,$scope.itemsPerPage=APP.store_list_pagination.end,$scope.currentPage=1,$scope.range=[],$scope.affilateShop=!1,$scope.searchText="","1"==$routeParams.type?($scope.viewAllActive="",$scope.myStoreActive="current",$scope.favShopActive="",$scope.tab="myStore"):($scope.viewAllActive="",$scope.myStoreActive="",$scope.favShopActive="current",$scope.tab="favStore");var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.getShop($scope.tab,$scope.itemsPerPage)},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.getShop($scope.tab,$scope.itemsPerPage)},$scope.paginate=function(){$scope.currentPage=1},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$("ul.pagination li.active:gt(3)").hide(),$scope.getShop($scope.tab,$scope.itemsPerPage)},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.getShop($scope.tab,$scope.itemsPerPage)},$scope.changeView=function(layout){"grid"==layout?($scope.gridActive="active",$scope.listActive=""):"list"==layout&&($scope.listActive="active",$scope.gridActive="")},$("#shopserchbox").keypress(function(){$scope.currentPage=1;$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){$scope.getShop($scope.tab,$scope.itemsPerPage)},DELAY_TIME_BEFORE_POSTING)}),$scope.getShop=function(activeTab,itemsPerPage){$scope.viewAllActive="",$scope.myStoreActive="",$scope.favShopActive="",$scope.tab=activeTab;var limit_start=($scope.currentPage-1)*itemsPerPage,opts={};opts.user_id=APP.currentUser.id,opts.search_text=$scope.searchText,opts.lang_code=$scope.activeLanguage,"myStore"===activeTab?opts.store_type=2:opts.store_type=1,"favStore"===activeTab?opts.only_in_favorite=1:opts.only_in_favorite=0,opts.limits={},opts.limits.limit_start=limit_start,opts.limits.limit_size=itemsPerPage,"myStore"===activeTab?$scope.myStoreActive="current":"favStore"===activeTab?$scope.favShopActive="current":$scope.viewAllActive="current",($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.Res&&($scope.storeLoading=!0,StoreService.getShops(opts,function(data){if($scope.affilateShop=!0,$scope.storeLoading=!1,101==data.code)if($scope.Res=1,data.data.length>0||void 0!=data.data.stores){$scope.totalSize=data.data.size,$scope.storeListObject=$scope.storeAllList=data.data.stores,$scope.totalItems=Math.ceil(data.data.size/itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i);$scope.notFound=!1}else $scope.notFound=!0,$scope.range=[],$scope.storeListObject=[];else 121==data.code?($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.Res=1):($scope.storeListObject=[],$scope.notFound=!0,$scope.storeLoading=!1,$scope.Res=1)}))},$scope.deleteStore=function(id,parentId){$("#store"+id).hide(),$("#storedelete"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,opts.store_type=1,StoreService.deleteStore(opts,function(data){101==data.code?$(".storecoverid"+id).hide():($("#store"+id).show(),$("#storedelete"+id).hide())})},$scope.FavouriteStores=function(activeTab,storeId,element){var opts={};opts.user_id=APP.currentUser.id,opts.store_id=storeId,$(element.target).hasClass("active")?StoreService.unfavouritestores(opts,function(data){101==data.code&&($(element.target).removeClass("active"),"favStore"==activeTab&&($scope.tab="favStore",$scope.getShop($scope.tab,$scope.itemsPerPage)))}):StoreService.favouritestores(opts,function(data){101==data.code&&($(element.target).addClass("active"),"favStore"==activeTab&&($scope.tab="favStore",$scope.getShop($scope.tab,$scope.itemsPerPage)))})},$scope.getShop($scope.tab,$scope.itemsPerPage)}]),app.controller("DetailStoreCoverController",["$rootScope","$route","$scope","$http","$sce","$routeParams","$location","$timeout","StoreService","fileReader","ProfileService","storeShopHistorySelection",function($rootScope,$route,$scope,$http,$sce,$routeParams,$location,$timeout,StoreService,fileReader,ProfileService,storeShopHistorySelection){$scope.$route=$route,$scope.storeMainId=$routeParams.id;var latitudeMap=0,longitudeMap=0;$scope.isMyShop=APP.currentUser.store_profile,$scope.mobileAppUrl="<li> Fits true to size. Take your normal size\r</li>",$scope.$on("updateShopProfileCover",function(event,imgData){$scope.storeDetail.cover_image_path=imgData.cover_image_path,$scope.storeDetail.profile_image_original=imgData.original_image_path,$scope.storeDetail.media_id=imgData.media_id,$scope.coverLoadHide=!1,$scope.fileUrl="",$timeout(function(){$scope.repositionImage()},50)}),$scope.loadalbumimages=function(){var opts={};opts.store_id=$routeParams.id,opts.session_id=APP.currentUser.id,opts.limit_start=APP.store_latest_images.start,opts.limit_size=APP.store_latest_images.end,StoreService.getLatestAlbumList(opts,function(data){101==data.code?$scope.storelatest=data.data.media:$scope.storelatest=""})},$scope.displayLoader=!1,$scope.followshops=function(){$scope.displayLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.shop_id=$scope.storeMainId,StoreService.followshops(opts,function(data){$scope.displayLoader=!1,101==data.code&&($scope.followDisplay=1)})},$scope.unfollowshops=function(){$scope.displayLoader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.shop_id=$scope.storeMainId,StoreService.unfollowshops(opts,function(data){$scope.displayLoader=!1,101==data.code&&($scope.followDisplay=0)})},$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="780"?$rootScope.mobileView=!0:$rootScope.mobileView=!1},!0);var img=new Image;$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0,$scope.loadDetails=function(){$scope.storeLoading=!0,$scope.updateStart=!1,$scope.createStoreError=!1,$scope.createStoreErrorMgs="",$scope.showEditForm=!1,$scope.countryList=APP.countries;var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$routeParams.id,StoreService.getStoreDetail(opts,function(data){if(101==data.code)if(data.data.owner_id==APP.currentUser.id&&0===data.data.new_contract_status)$location.path("/edit/shop/"+data.data.id);else if(data.data.owner_id==APP.currentUser.id&&(1==data.data.credit_card_status&&0==data.data.shop_status||0==data.data.credit_card_status&&1==data.data.shop_status||0==data.data.credit_card_status&&0==data.data.shop_status))$location.path("shop/"+data.data.id+"/contract");else{$scope.storeDetail=data.data,$scope.$broadcast("update_parent",$scope.storeDetail),$scope.store=$scope.storeDetail;var tempopts={};tempopts.id=data.data.id,tempopts.store_name=data.data.name,tempopts.is_subscribed=data.data.is_subscribed,tempopts.is_paypal_added=data.data.is_paypal_added,StoreService.SetStoreData(tempopts),1==$scope.storeDetail.is_following?$scope.followDisplay=1:$scope.followDisplay=0,1==$rootScope.mobileView&&(img=null,img=new Image,img.src=$scope.storeDetail.cover_image_path,img.onload=function(){$scope.windowWidth<="480"?img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/3:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/4,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/4:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/6,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0)):$scope.windowWidth>"480"&&$scope.windowWidth<="768"&&(img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/1.8:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/2,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.2,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.8:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/3,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0)))}),$scope.aboutStore(),$scope.storeLoading=!1,latitudeMap=data.data.latitude,longitudeMap=data.data.longitude,-1!=$location.path().indexOf("/shop/edit")||-1!=$location.path().indexOf("/shop/view")?$timeout(function(){},1e3):$timeout(function(){$scope.initializeMaps()},1e3),$scope.store.business_country=$scope.getCountryName(APP.countries,data.data.business_country),$scope.store.legal_status=$scope.getLegalForm(APP.legalForms,data.data.legal_status),$scope.store.sale_country=$scope.getCountryName(APP.countries,data.data.sale_country),$scope.store.business_region=$scope.getRegionName(APP.regions,data.data.business_region),$scope.store.sale_region=$scope.getRegionName(APP.regions,data.data.sale_region),$scope.getShopCategory(),$scope.getShopSubCategory();var storeData={};storeData.storeId=$scope.storeDetail.owner_id;var mopts={};mopts.store_id=$scope.storeDetail.id,mopts.session_id=APP.currentUser.id,StoreService.getMobileAppUrl(mopts,function(data){101==data.code?$scope.store.mobileAppUrl=data.data.url:$scope.store.mobileAppUrl=""})}else $scope.storeLoading=!1,$scope.createStoreError=!0})},$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?(1==$rootScope.mobileView&&$timeout(function(){$scope.resizeMediaCoordinate()},1e3),$rootScope.mobileView=!0):$rootScope.mobileView=!1},!0);var img=new Image;$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0,$scope.resizeMediaCoordinate=function(){void 0!=$scope.storeDetail&&(img=null,img=new Image,img.src=$scope.storeDetail.cover_image_path,$scope.windowWidth<="480"?img.onload=function(){img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/3:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/4,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/4:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/6,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0))}:$scope.windowWidth>"480"&&$scope.windowWidth<="768"&&(img.onload=function(){img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/1.8:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/2,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.2,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.8:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/3,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0))}))},$scope.favouritestores=function(id,element){if($(element.target).hasClass("active")){var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,StoreService.unfavouritestores(opts,function(data){101==data.code&&$(element.target).removeClass("active")})}else{var opts={};opts.user_id=APP.currentUser.id,opts.store_id=id,StoreService.favouritestores(opts,function(data){101==data.code?$(element.target).addClass("active"):$scope.storeLoading=!1})}},$scope.loadDetails(),$scope.loadalbumimages(),$scope.getCountryName=function(p,k){for(var i=0;i<p.length;i++){var obj=p[i];for(var key in obj)if(obj.id==k)return obj.country}},$scope.getRegionName=function(p,k){for(var i=0;i<p.length;i++){var obj=p[i];for(var key in obj)if(obj.id==k)return obj.region}return k},$scope.getLegalForm=function(p,k){for(var i=0;i<p.length;i++){var obj=p[i];for(var key in obj)if(obj.id==k)return obj.value}},$scope.getShopCategory=function(){if($scope.store.sale_catid=$scope.store.sale_catid,""!=$scope.store.sale_catid&&void 0!=$scope.store.sale_catid){var catopts={};catopts.lang_code=$scope.currentLanguage,catopts.cat_id=$scope.store.sale_catid,catopts.session_id=APP.currentUser.id,catopts.type="show",catopts.session_id=APP.currentUser.id,ProfileService.getCategories(catopts,function(data){101==data.code?$scope.store.categoryName=data.data.category_name:$scope.store.categoryName=""})}else $scope.store.categoryName=""},$scope.getShopSubCategory=function(){if($scope.store.sale_subcatid=$scope.store.sale_subcatid,""!=$scope.store.sale_subcatid&&void 0!=$scope.store.sale_subcatid){var subopts={};subopts.lang_code=$scope.currentLanguage,subopts.cat_id=$scope.store.sale_subcatid,subopts.session_id=APP.currentUser.id,subopts.type="show",subopts.session_id=APP.currentUser.id,ProfileService.getCategories(subopts,function(data){101==data.code?$scope.store.categorySubName=data.data.category_name:$scope.store.categorySubName=""})}else $scope.store.categorySubName=""},$scope.editStore=function(){$scope.createStoreLoader=!1,$scope.store=$scope.storeDetail,$scope.showEditForm=!0,$scope.timelineActive=!1,$scope.timelineActive1=!1;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.aboutStore=function(){$scope.store=$scope.storeDetail;var opts={};StoreService.getCountryList(opts,function(data){101==data.code&&($scope.countryList=data.data)})},$scope.updateStore=function(){$scope.updateStart=!0;var opts={};return opts.user_id=APP.currentUser.id,opts.store_id=$scope.store.id,void 0==$scope.store.name||""==$scope.store.name?($scope.createStoreErrorMgs=$scope.i18n.register.enter_storename,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_name||""==$scope.store.business_name?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessname,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_type||""==$scope.store.business_type?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesstype,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.legal_status||""==$scope.store.legal_status?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesstatus,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.phone||""==$scope.store.phone||1==isNaN($scope.store.phone)?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessnumber,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.email||""==$scope.store.email?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessemail,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_country||void 0==$scope.store.business_country.id||""==$scope.store.business_country.id?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesscountry,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_region||""==$scope.store.business_region?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessregion,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_city||""==$scope.store.business_city?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesscity,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.business_address||""==$scope.store.business_address?($scope.createStoreErrorMgs=$scope.i18n.validation.enter_businessaddress,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.zip||""==$scope.store.zip||$scope.store.zip.length<2||$scope.store.zip.length>2?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesszip,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.province||""==$scope.store.province?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessprovince,$scope.createGroupError=!0,$scope.updateStart=!1,!1):$scope.store.province.length<2||$scope.store.province.length>2?($scope.createStoreErrorMgs=$scope.i18n.validation.province_length,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.vat_number||""==$scope.store.vat_number?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessvat,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.iban||""==$scope.store.iban?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessiban,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==$scope.store.description||""==$scope.store.description?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessdesc,$scope.createGroupError=!0,$scope.updateStart=!1,!1):""==$scope.store.referral_info||void 0==$scope.store.referral_info||void 0==$scope.store.referral_info.id||""==$scope.store.referral_info.id?($scope.createStoreErrorMgs=$scope.i18n.store.enter_broker_id,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==document.getElementById("latitude").value||""==document.getElementById("latitude").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesslat,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==document.getElementById("longitude").value||""==document.getElementById("longitude").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businesslog,$scope.createGroupError=!0,$scope.updateStart=!1,!1):void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value?($scope.createStoreErrorMgs=$scope.i18n.register.enter_businessmap,$scope.createGroupError=!0,$scope.updateStart=!1,!1):(opts.name=$scope.store.name,opts.business_name=$scope.store.business_name,opts.parent_store_id=$scope.store.parent_store_id,opts.legal_status=$scope.store.legal_status,opts.business_type=$scope.store.business_type,opts.phone=$scope.store.phone,opts.email=$scope.store.email,opts.business_country=$scope.store.business_country,opts.business_region=$scope.store.business_region,opts.business_city=$scope.store.business_city,opts.business_address=$scope.store.business_address,opts.zip=$scope.store.zip,opts.province=$scope.store.province,opts.vat_number=$scope.store.vat_number,opts.iban=$scope.store.iban,opts.description=$scope.store.description,opts.referral_id=$scope.store.referral_info.id,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("latitude").value,opts.longitude=document.getElementById("longitude").value,opts.allow_access=$scope.store.is_allowed,void StoreService.updateStore(opts,function(data){101==data.code?($scope.updateStart=!1,$scope.showEditForm=!1,$scope.createStoreLoader=!1,$location.path("/shop/edit/"+$scope.store.id)):137==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.broker_not_exists,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1):100==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.missed_param,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):90==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.account_inactive,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):91==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.vat_exists,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):126==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.invalid_store_forum_type,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):500==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.permission_denied,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):89==data.code?($scope.createStoreErrorMgs=$scope.i18n.validation.error_occured,$scope.createGroupError=!0,$scope.updateStart=!1,$scope.createStoreLoader=!1):($scope.createStoreErrorMgs=data.message,$scope.updateStart=!1,$scope.createStoreLoader=!1,$scope.createStoreError=!1)}))},$scope.initializeMaps=function(){if(angular.element("#map-canvas-second").length){var mapOptions=(new google.maps.LatLng(latitudeMap,longitudeMap),{center:new google.maps.LatLng(latitudeMap,longitudeMap),zoom:6}),map=new google.maps.Map(document.getElementById("map-canvas-second"),mapOptions);new google.maps.Marker({position:new google.maps.LatLng(latitudeMap,longitudeMap),map:map,title:$scope.store.map_place})}},$(".member-store").click(function(){$(this).addClass("active"),$(".store-invitations li").removeClass("active")}),$scope.cancelEdit=function(){$scope.showEditForm=!1,$scope.store={}},$scope.loadEditMap=function(){$scope.map={center:{latitude:40.1451,longitude:-99.668},zoom:4},$scope.options={scrollwheel:!1},$scope.marker={id:0,coords:{latitude:40.1451,longitude:-99.668},options:{draggable:!0},events:{dragend:function(marker,eventName,args){document.getElementById("latitude").value=marker.getPosition().lat(),document.getElementById("longitude").value=marker.getPosition().lng(),$scope.mapLocation(marker.getPosition().lat(),marker.getPosition().lng())}}}},$scope.loadEditMap(),$scope.showInvite=!1,$scope.timelineActive=!1,$scope.toggleInvite=function(){$scope.timelineActive=!$scope.timelineActive,$scope.uploadProfileImage=!1,$scope.showInvite=!$scope.showInvite,$scope.timelineActive1=!1,$scope.showEditForm=!1},$scope.uploadProfileImage=!1,$scope.toggleUploadImage=function(){$scope.showInvite=!1,$scope.uploadProfileImage=!$scope.uploadProfileImage},$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.newImage=!1,$scope.uploadStoreProfileImage=function(){$scope.uploadStoreProfile=!0;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);if("gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType)$scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0;else{var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeDetail.id,StoreService.uploadStoreProfileimage(opts,$scope.myFile,function(data){101==data.code?($scope.newImage=!0,$scope.uploadProfileImage=!1,
$scope.uploadStoreProfile=!1,$scope.storeDetail.cover_image_path=data.data.cover_image_thumb_path,$scope.storeDetail.profile_image_original=data.data.original_image_path,$scope.fileUrl=data.data.cover_image_thumb_path,$scope.storeDetail.media_id=data.data.media_id,$scope.showCanves=!0,$scope.coverLoadHide=!0):$scope.uploadStoreProfile=!1})}},$scope.imageCropResult=null,$scope.imageCropResult2=null,$scope.imageWidth=null,$scope.imageHeight=null,$scope.showImageCropper=!1,$scope.showImageCropper2=!1,$scope.imageString="",$scope.file={},$scope.coverLoadHide=!1,$scope.$watch("imageCropResult2",function(newVal){newVal&&console.log("imageCropResult2",newVal)}),$scope.imageXPosition=0,$scope.imageYPosition=0,$scope.setImageCordinate=function(){$scope.storeDetail.x_cord=-1*$rootScope.shop.x_cord,$scope.storeDetail.y_cord=-1*$rootScope.shop.y_cord,$scope.saveCordinate()},$rootScope.shop={},$scope.showCanves=!1,$scope.repositionImage=function(){$scope.showCanves=!0,$scope.fileUrl=$scope.storeDetail.cover_image_path,"NaN"==$scope.storeDetail.x_cord?($scope.imageXPosition=0,$scope.imageYPosition=0,$scope.coverLoadHide=!0):($scope.imageXPosition=-1*$scope.storeDetail.x_cord,$scope.imageYPosition=-1*$scope.storeDetail.y_cord,$scope.coverLoadHide=!0)},$scope.saveCordinate=function(){$scope.hideUpdateCoverButton=!0,$scope.showCanves=!1;var opts={};opts.session_id=APP.currentUser.id,opts.media_id=$scope.storeDetail.media_id,opts.x=""+$scope.storeDetail.x_cord,opts.y=""+$scope.storeDetail.y_cord,StoreService.setStoreMediaCoordinate(opts,function(data){101==data.code&&"SUCCESS"==data.message&&($scope.storeDetail.x_cord=data.data.x_cord,$scope.storeDetail.y_cord=data.data.y_cord,$scope.coverLoadHide=!1,$scope.file=null,$scope.fileUrl=null,$scope.hideUpdateCoverButton=!1,$scope.showCanves=!1,1==$rootScope.mobileView&&(img=null,img=new Image,img.src=$scope.storeDetail.cover_image_path,$scope.windowWidth<="480"?img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/3:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/4,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/4:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/5:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/6,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0)):$scope.windowWidth>"480"&&$scope.windowWidth<="768"&&(img.width<=910?""!=$scope.storeDetail.y_cord?($scope.storeDetail.y_cord>100?$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/1.8:$scope.mobileShopY_Cord=$scope.storeDetail.y_cord/2,$scope.mobileShopX_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>910&&img.width<=1300?""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.2,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0):img.width>1300&&(""!=$scope.storeDetail.x_cord?($scope.storeDetail.x_cord>100?$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/2.8:$scope.mobileShopX_Cord=$scope.storeDetail.x_cord/3,$scope.mobileShopY_Cord=0):($scope.storeDetail.x_cord=0,$scope.storeDetail.y_cord=0,$scope.mobileShopX_Cord=0,$scope.mobileShopY_Cord=0)))))})},$scope.showcrossactive=!0,$scope.showcrossactive1=function(){$scope.showcrossactive=!1},$scope.showCoverOption=!1,$scope.showCoverDropDown=function($event){$scope.showCoverOption=!$scope.showCoverOption,$event.stopPropagation()},window.onclick=function(){$scope.showCoverOption&&($scope.showCoverOption=!1,$scope.$apply())},$scope.myFile="",$scope.imageSrc="",$scope.invalidCoverImage=!1,void 0===$scope.i18n.storealbum?$scope.invalidCoverImageMgs="Please choose an image that is at least 400 pixels wide and at least 200 pixels tall":$scope.invalidCoverImageMgs=$scope.i18n.storealbum.album_invalidCoverImageMgs,$scope.getFile=function(){$scope.progress=0,fileReader.readAsDataUrl($scope.file,$scope).then(function(result){$scope.myFile=$scope.file,$scope.imageSrc=result;var imageType=$scope.myFile.name.substring($scope.myFile.name.lastIndexOf(".")+1);"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?($scope.uploadProfileErrorMsg=$scope.i18n.storealbum.album_uploadProfileErrorMsg,$scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!0):($scope.uploadStoreProfile=!1,$scope.uploadProfileerror=!1,$scope.readImage($scope.myFile,function(data){0!=data.length&&data.width>=400&&data.height>=200?$scope.uploadStoreProfileImage():($("#invalidCoverImage").show(),$timeout(function(){$("#invalidCoverImage").hide()},4e3))}))})},$scope.readImage=function(file,callback){var reader=new FileReader,image=new Image;reader.readAsDataURL(file),reader.onload=function(_file){var filedata={};image.src=_file.target.result,image.onload=function(){{var w=this.width,h=this.height;file.type,file.name,~~(file.size/1024)+"KB"}filedata.width=w,filedata.height=h,callback(filedata)},image.onerror=function(){callback(filedata)}}},$scope.timelineActive1=!1,$scope.showAllStoreMember=!1,$scope.showAllMembers=function(){$scope.showAllStoreMember=!$scope.showAllStoreMember,$scope.timelineActive1=!$scope.timelineActive1,$scope.timelineActive=!1,$scope.showEditForm=!1},$scope.storeSelection=function(){storeShopHistorySelection.storeHistoryTab($scope.storeMainId)}}]).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("HistoryStoreController",["$scope","$http","$routeParams","$location","$timeout","StoreService",function($scope,$http,$routeParams,$location,$timeout,StoreService){$scope.storeAllList=[],$scope.storeHistoryDetail=[],$scope.totalSize=0,$scope.notFound=!1,$scope.allRes=1,$scope.noHistory=!1,$scope.storeMainId=$routeParams.id,$scope.storeLoading=!0,$scope.showHistory=function(){var opts={},limit_start=$scope.storeAllList.length;opts.limit_start=limit_start,opts.limit_size=APP.store_list_pagination.end,opts.user_id=APP.currentUser.id,opts.shop_id=$scope.storeMainId,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.storeLoading=!0,$scope.allRes=0,StoreService.getStoreHistory(opts,function(data){101==data.code?($scope.allRes=1,$scope.totalSize=data.data.total,$scope.storeLoading=!1,$scope.storeHistoryDetail=$scope.storeAllList=$scope.storeAllList.concat(data.data.transactions),$scope.notFound=!1,$scope.noHistory=!0):($scope.storeHistoryDetail=[],$scope.storeLoading=!1,$scope.notFound=!0)}))},$scope.showHistory(),$scope.loadMore=function(){$scope.showHistory()}}]),app.controller("StoreCreditCard",["$scope","$http","StoreCreditCard","$rootScope","$location","$routeParams","$timeout",function($scope,$http,StoreCreditCard,$rootScope,$location,$routeParams,$timeout){$scope.storeId=$routeParams.id,$scope.userId=APP.currentUser.id,$rootScope.tempStoreId=$scope.storeId,$scope.cardList=[],$scope.isLoadingCard=!1,$scope.messsage="",$scope.inProcess=[],$scope.inDelete=[],$scope.noContent=!1,$scope.total=0,$scope.firstLoad=0,$scope.pendingPayBtn=!0,$scope.payRecurring=!1,$scope.getCreditCard=function(){$scope.isLoadingCard=!0,$scope.isBlockReq=0;var opts={};opts.store_id=$scope.storeId,opts.session_id=APP.currentUser.id,opts.limit_size=APP.store_credit_card_pagination.end,opts.limit_start=$scope.cardList.length,(0==$scope.isBlockReq&&$scope.total!=$scope.cardList.length||0==$scope.firstLoad)&&($scope.isBlockReq=1,1==$scope.firstLoad,StoreCreditCard.getCreditCardLists(opts,function(data){$scope.isBlockReq=0,101==data.code?($scope.isLoadingCard=!1,$scope.cardList=$scope.cardList.concat(data.data),$scope.total=data.data.count,0==$scope.cardList.length&&($scope.noContent=!0)):(0==$scope.cardList.length&&($scope.noContent=!0),$scope.isLoadingCard=!1,$scope.msgClass="alert-warning",$scope.cardList=$scope.cardList)}))},$scope.getCreditCard(),$scope.setDefault=function(card){1==card.defaultflag&&($scope.cardid=card.contract_id)},$scope.$watch(function(){return $scope.cardid},function(newValue,oldValue){$scope.message="",newValue!=oldValue&&void 0!=oldValue&&$scope.setDefaultCard(newValue,oldValue)},!0),$scope.setDefaultCard=function(newCard,oldCard){var opts={};opts.store_id=$scope.storeId,opts.session_id=APP.currentUser.id,opts.contract_id=parseInt(newCard);var newIndx=$scope.cardList.map(function(d){return d.contract_id}).indexOf(parseInt(newCard)),oldIndx=$scope.cardList.map(function(d){return d.contract_id}).indexOf(parseInt(oldCard));$scope.inProcess[newIndx]=!0,StoreCreditCard.setDefaultCard(opts,function(data){101==data.code?($scope.inProcess[newIndx]=!1,$scope.cardList[newIndx].defaultflag=1,-1!=oldIndx&&($scope.cardList[oldIndx].defaultflag=0),$scope.msgClass="alert-info",$scope.message=$scope.i18n.store.card.success,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):($scope.msgClass="alert-warning",$scope.inProcess[newIndx]=!1,$scope.message=data.message,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4))})},$scope.deleteCard=function(indx){$scope.inDelete[indx]=!0,$scope.message="";var card=$scope.cardList[indx],opts={};opts.contract_id=card.contract_id,opts.session_id=APP.currentUser.id,StoreCreditCard.deleteCard(opts,function(data){101==data.code?($scope.msgClass="alert-info",$scope.inDelete[indx]=!1,$scope.cardList.splice(indx,1),$scope.message=$scope.i18n.store.card.delete_success,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4)):($scope.msgClass="alert-warning",$scope.inDelete[indx]=!1,$scope.message=data.message,$timeout(function(){$scope.msgClass="",$scope.message=""},1e4))})},$scope.loadMore=function(){$scope.isLoadingCard=!0,$scope.getCreditCard()}}]),app.controller("StorePaymentController",["$scope","$http","StorePaymentService","$rootScope","$location","$routeParams","$cookieStore",function($scope,$http,StorePaymentService,$rootScope,$location,$routeParams,$cookieStore){$scope.agree="not_agreement",$scope.loadTerms=!0,$scope.cardType=$routeParams.type,""==$rootScope.tempStoreId||void 0==$rootScope.tempStoreId?$scope.profileId=$routeParams.id:($scope.profileId=$rootScope.tempStoreId,$cookieStore.put("tempStoreId",$rootScope.tempStoreId)),$scope.userId=APP.currentUser.id,2==$scope.cardType?$scope.paymentType=APP.card.add_type:1==$scope.cardType?$scope.paymentType=APP.card.add_type:$scope.paymentType=APP.card.add_type;var opts={};opts.profile_id=$scope.profileId,opts.user_id=$scope.userId,opts.cancel_url=APP.payment.siteDomain+"#/shop/paycancel",opts.return_url=APP.payment.siteDomain+"#/shop/paysuccess",opts.payment_type=$scope.paymentType,StorePaymentService.getOneClickPaymentUrls(opts,function(data){101==data.code&&""!=data.data.url?($scope.loadTerms=!1,$scope.storePaymentUrl=data.data.url):($scope.loadTerms=!1,$scope.storePaymentUrl="")})}]),app.controller("StorePaymentReturnController",["$scope","$http","StorePaymentService","$rootScope","$location","$routeParams",function($scope,$http,StorePaymentService,$rootScope,$location,$routeParams){$scope.codTrans=$location.search().codTrans,$scope.amount=$location.search().importo,$scope.uniform=$location.search().divisa,$scope.outcome=$location.search().esito,$scope.descrizione=$location.search().descrizione,$scope.pan=$location.search().pan,$scope.profileId=$rootScope.tempStoreId,"OK"==$scope.outcome?($scope.backurl=APP.payment.siteDomain+"#/shop/view/"+$scope.profileId,$scope.success=!0):($scope.backurl=APP.payment.siteDomain+"#/",$scope.success=!1)}]),app.controller("StorePaymentCancelController",["$scope","$http","StorePaymentService","$rootScope","$location","$routeParams",function($scope,$http,StorePaymentService,$rootScope,$location,$routeParams){$scope.codTrans=$location.search().codTrans,$scope.amount=$location.search().importo,$scope.uniform=$location.search().divisa,$scope.outcome=$location.search().esito,$scope.profileId=$rootScope.tempStoreId,$scope.backurl=APP.payment.siteDomain+"#/profiles"}]),app.controller("StoreRegistrationPaymentController",["$scope","$http","StorePaymentService","UserService","saveUserPass","$rootScope","$location","StoreService","$routeParams",function($scope,$http,StorePaymentService,UserService,saveUserPass,$rootScope,$location,StoreService,$routeParams){$scope.agree="not_agreement",$scope.user.userName=saveUserPass.getUsername(),$scope.user.password=saveUserPass.getPassword(),$scope.loadTerms=!0,$scope.profileId=$rootScope.tempStoreId,$scope.userId=$rootScope.tempUserId,$scope.paymentType=APP.card.add_type;var postData={profile_id:$scope.profileId,user_id:$scope.userId,payment_type:$scope.paymentType,cancel_url:APP.payment.siteDomain+"#/shop/paycancel",return_url:APP.payment.siteDomain+"#/shop/paysuccess"};StorePaymentService.getOneClickPaymentUrls(postData,function(data){101==data.code&&""!=data.data.url?($scope.loadTerms=!1,$scope.storePaymentUrl=data.data.url):($scope.loadTerms=!1,$scope.storePaymentUrl="")})}]),app.controller("StorePostController",["$scope","StorePostService","$location","$timeout","$routeParams","StoreService","StoreCommentService","FileUploader","ProfileService","TranslationService","$modal","$log","focus",function($scope,StorePostService,$location,$timeout,$routeParams,StoreService,StoreCommentService,FileUploader,ProfileService,TranslationService,$modal,$log,focus){$scope.i18n.storealbum?$scope.postFileErrorMsg=$scope.i18n.storealbum.album_this_no:TranslationService.getTranslationWithCallback($scope,$scope.activeLanguage,function(data){$scope.i18n=data,$scope.postFileErrorMsg=$scope.i18n.storealbum.album_this_no}),$scope.storeId=$routeParams.id,$scope.currentUserObj=APP.currentUser,$scope.storeOwnerId=StoreService.getStoreOwnerId(),$scope.noComment=!1,$scope.postErrMsg="",$scope.myRes=1,$scope.postContentStart=!1,$scope.commentsShowLimit=[],$scope.totalSize=0,$scope.textLimit=APP.post_charecter_limit,$scope.isSinglePostView=!1,$scope.noContent=!1,$scope.storeData="",$scope.posts=[],void 0!=$routeParams.postId&&""!=$routeParams.postId&&($scope.isSinglePostView=!0),$scope.createPost=function(){var link_type;$scope.postContentStart=!0,$scope.postContentLoader=!0;var description="",src="";$scope.postErrMsg="";var filescount=$scope.imageSrc.length,descval=$("#preview_lp1").html(),href=$("#previewUrl_lp1").html(),textarea=$("#text_lp1").val();description=textarea;var regex=/src="([^"]+)"/,src=description.split(regex)[1];if(void 0!=src&&""!=src&&(description=src),description=escapeHtmlEntities(description),""==href?link_type="0":(description="<p>"+description+"</p>",description+=descval,link_type="1"),(void 0==description||""==description)&&0==filescount)return $scope.postInProcess=!1,$scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.attach_link,$scope.postContentStart=!1,$scope.postContentLoader=!1,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),!1;var opts={};opts.store_id=$scope.storeId,opts.post_title=$scope.i18n.storealbum.store_post_title,opts.post_desc=description,opts.user_id=$scope.currentUser.id,opts.post_id=$scope.tempPostId,opts.post_type="1",opts.youtube="",opts.media_id=[],opts.link_type=link_type;var friendId=[];if($scope.storedFriend.length>0){for(var i=0;i<$scope.storedFriend.length;i++)friendId.push($scope.storedFriend[i].user_info.id);opts.tagged_friends=friendId.join()}else opts.tagged_friends="";angular.forEach($scope.imageSrc,function(file){opts.media_id.push(file.media_id)}),StorePostService.createPost(opts,function(data){if(101==data.code){var newpost={};for($scope.storedFriend=[],$scope.showTagForm=!1,newpost=data.data,newpost.comments=[],$scope.posts.unshift(newpost),$scope.noContent=!1,$scope.postInProcess=!1,$scope.postErrMsg="",$scope.postErrCls="",uploader.data.post_id={};uploader.queue.length;)uploader.queue[0].remove();$scope.isImage=!1,$scope.imgUpload=!1,$scope.imageSrc=[],$scope.postFiles=[],$scope.uploadBox=!1,$scope.postContentStart=!1,$scope.postContentLoader=!1,$scope.tempPostId="",$("#text_lp1").val(""),$("#text_lp1").attr("style",""),$timeout(function(){$("#closePreview_lp1").trigger("click")},100)}else $scope.postInProcess=!1,$scope.postErrMsg=$scope.i18n.editprofile.post_unable,$scope.postErrCls="text-red",$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.imageSrc=[],$scope.postFiles=[],$scope.isImage=!1,$scope.imgUpload=!1,$scope.isUpload=!1,$scope.uploadBox=!1,$scope.postContentStart=!1,$scope.postContentLoader=!1})},$scope.showTagForm=!1,$scope.showTagCloumn=function(){$scope.showTagForm===!1?($scope.showTagForm=!0,focus("shopTagFriend")):$scope.showTagForm=!1},$scope.focusOnShopTag=function(){focus("shopTagFriend")};var currentTimeout=null;$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.tagFriendSuggestion=function(friendName){$scope.cancelFriendSearch=!1,$scope.showFriendList=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$("#shopTagFriend").val(),opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&($scope.friends=data.data.users)})},$scope.storedFriend=[],$scope.dublicate=!1,$scope.selectFriend=function(friendInfo){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.storedFriend,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.storedFriend.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#shopTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#shopTagFriend").val(""),$scope.showFriendList=!1))},$scope.lostFormFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#shopTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.removeTagFriend=function(friendIndex){$scope.storedFriend.splice(friendIndex,1)},$scope.friendTaggIndex=-1,$scope.keyUpDownControl=function(event,friendName){if(40===event.keyCode)$scope.friendTaggIndex+1!==$scope.friends.length&&$scope.friendTaggIndex++;else if(38===event.keyCode)$scope.friendTaggIndex-1!==-1&&$scope.friendTaggIndex--;else if(13===event.keyCode)$scope.selectFriend($scope.friends[$scope.friendTaggIndex]);else{if(!(event.keyCode>=65&&event.keyCode<=95))return;$scope.tagFriendSuggestion(friendName)}},$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,$scope.creater=creater_info;var modalInstance=$modal.open({template:'<div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a href ng-click="viewFriendProile(friend.id)">{{friend.first_name}} {{friend.last_name}}</a></span><span data-ng-if="creater.id === currentUser.id || currentUser.id === friend.id" ng-click="RemoveTagFriend(friend, creater.id)" class="rmv-tag"><a href>{{i18n.profile_post.remove_tagged_friend}}</a></span></li></ul></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)},$scope.RemoveTagFriend=function(friend,createrId){var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=friend.id,opts.post_id=$scope.post_id,StoreService.removeShopTagg(opts,function(data){if(101===data.code){var index=$scope.allTagFriends.indexOf(friend);$scope.allTagFriends.splice(index,1),createrId!=APP.currentUser.id&&modalInstance.close(),0===$scope.allTagFriends.length&&modalInstance.close()}})}},$scope.getPosts=function(){var limit_start=$scope.posts.length,opts={};opts.store_id=$scope.storeId,opts.user_id=$scope.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.dashbord_pagination.end,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes&&($scope.myRes=0,$scope.isLoading=!0,StorePostService.listPost(opts,function(data){if($scope.isLoading=!1,101==data.code){$scope.isLoading=!1;var items=data.data;$scope.storeData=StoreService.getStoreData(),void 0!=items&&($scope.posts=$scope.posts.concat(items)),$scope.totalSize=data.count}0==$scope.posts.length&&($scope.noContent=!0),$scope.myRes=1}))},$scope.loadMore=function(){$scope.totalSize>$scope.posts.length&&$scope.getPosts()},$scope.showAllComment=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.showLimitedComment(opts,postIndx)},$scope.commentLoading=[],$scope.showLimitedComment=function(postIndx){$scope.commentLoading[postIndx]=!0,$scope.showComments[postIndx]=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)},$scope.deleteErrMsg=[],$scope.isDeletePost=[],$scope.deleteErrCls=[],$scope.deletePost=function(indx){$scope.isDeletePost[indx]=!0;var postData={};postData=$scope.posts[indx];var formData={};formData.user_id=$scope.currentUser.id,formData.post_id=postData.post_id,StorePostService.deletePost(formData,function(data){101==data.code?($scope.posts.splice(indx,1),0==$scope.posts.length&&($scope.noContent=!0),$scope.isDeletePost[indx]=!1):($scope.deleteErrCls[indx]="text-red",$scope.deleteErrMsg[indx]=$scope.i18n.dashboard.postcomment.delete_post_fail,$scope.isDeletePost[indx]=!1),$timeout(function(){$scope.deleteErrCls[indx]="",$scope.deleteErrMsg[indx]="",$scope.isDeletePost[indx]=!1},15e3)})},$scope.isImage=!1,$scope.isUpload=!1,$scope.uploadBox=!1,$scope.addImage=function(){var href=$("#previewUrl_lp1").html();""!=href&&$timeout(function(){$("#closePreview_lp1").click()},100),$scope.isImage=!0,$scope.imageSrc=[],$scope.postFiles=[],$scope.uploadBox=!0,uploader.queue=[],$scope.isUpload=!1},$scope.addPost=function(){$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.isPost=!0,$scope.imageSrc=[],$scope.postFiles=[]},$scope.deleteMediaPost=function(postIndx,mediaIndx){$scope.deletePostIndx=postIndx;var post=$scope.posts[postIndx],opts={};opts.user_id=$scope.currentUser.id,opts.session_id=APP.currentUser.id,opts.post_id=post.post_id,opts.media_id=post.media_info[mediaIndx].id,StorePostService.deleteMediaPost(opts,function(data){101==data.code?($scope.deletePostIndx=-1,$scope.posts[postIndx].media_info.splice(mediaIndx,1)):($scope.deletePostIndx=-1,$scope.posts)})},$scope.editPostErrorMsg=[],$scope.updatePostInProcess=[],$scope.editPostErrorCls=[],$scope.saveUpdatePost=function(postIndx){var opts={};$scope.updatePostInProcess[postIndx]=!0;var editPostText=escapeHtmlEntities($scope.updateBody[postIndx]),post=$scope.posts[postIndx];if(void 0==editPostText||""==editPostText)return $scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_status,$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3),!1;var regex=/src="([^"]+)"/,src=editPostText.split(regex)[1];void 0!=src&&""!=src&&(editPostText=src),opts.user_id=$scope.currentUser.id,opts.store_id=$scope.storeId,opts.post_id=post.post_id,opts.post_title=post.store_post_title,opts.post_desc=editPostText,opts.youtube="";var myFile="",friendIdList=[];$scope.postTaggedFriend[postIndx]&&$scope.postTaggedFriend[postIndx].length>0?(angular.forEach($scope.postTaggedFriend[postIndx],function(index){friendIdList.push(index.id)}),opts.tagged_friends=friendIdList.join()):opts.tagged_friends="",StorePostService.updatePost(opts,myFile,function(data){101==data.code?($scope.postTaggedFriend[postIndx].length>0?post.tagged_friends_info=$scope.postTaggedFriend[postIndx]:post.tagged_friends_info="",$scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]="",$scope.posts[postIndx].store_post_desc=editPostText,$scope.editPostText="",$scope.activeEdit[postIndx]=!1):($scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.post_unsaved),$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3)})},$scope.updateBody=[],$scope.activeEdit=[],$scope.updatePostInProcess=[],$scope.editPostErrorMsg=[],$scope.showTagLoading=[],$scope.postTaggedFriend=[],$scope.updatePost=function(postIndx){$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]="";var post=$scope.posts[postIndx];autosize(document.querySelectorAll(".editpostbox"));var str=$.trim(post.store_post_desc.replace(/\n\n\n+/g,"\n\n")),htmlstr=str.replace(/\n/g,"<br />"),height=$('<div style="display:block;" id="postedit-hidden-div"></div>').html(htmlstr).appendTo("#post_"+post.post_id).height();$("#editpost_"+post.post_id).css("height",height+"px"),str=$("#postedit-hidden-div").html(str).text(),$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]=str,$scope.activeEdit[postIndx]=!0,$scope.postTaggedFriend[postIndx]=[],angular.forEach(post.tagged_friends_info,function(val,indx){$scope.postTaggedFriend[postIndx].push(val)}),$scope.showTagLoading[postIndx]=!0,$timeout(function(){$("#editpost_"+post.post_id).putCursorAtStart()},200)},$scope.postListFocusShop=function(indx){focus("shopPostList"+indx)},$scope.cancelPost=function(postIndx){$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]="",$scope.showTagLoading[postIndx]=!1,$scope.postTaggedFriend=[]},$scope.removePostTagFriend=function(index,postIndex){$scope.postTaggedFriend[postIndex].splice(index,1)};var currentTimeout=null;$scope.addMoreFriend=function(event,index){var DELAY_TIME_BEFORE_POSTING=300;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchMoreFriend(index)},DELAY_TIME_BEFORE_POSTING)},$scope.friends=[],$scope.showSearchFriendLoader=[],$scope.cancelFriendSearch=!1,$scope.showSearchFriendList=[],$scope.searchMoreFriend=function(postIndx){$scope.searchFriend=$(".addMoreTagFriend"+postIndx).val(),$scope.cancelFriendSearch=!1,$scope.showSearchFriendList[postIndx]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.searchFriend,opts.limit_start=0,$scope.friendTagIndex[postIndx]=-1,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchFriendLoader[postIndx]=!0,$scope.showTagLoading[postIndx]=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchFriendLoader[postIndx]=!1,$scope.cancelFriendSearch===!1&&data.data.users.length>0&&($scope.friends[postIndx]=data.data.users)})},$scope.postTaggedFriend=[],$scope.dublicate=!1,$scope.taggedSelectFriend=function(friendInfo,postIndex){void 0==$scope.postTaggedFriend[postIndex]&&($scope.postTaggedFriend[postIndex]=[]),void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.postTaggedFriend[postIndex],function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.postTaggedFriend[postIndex].push({id:friendInfo.user_id,first_name:friendInfo.user_info.first_name,last_name:friendInfo.user_info.last_name,profile_image:friendInfo.user_info.profile_image,profile_image_thumb:friendInfo.user_info.profile_image_thumb}),$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1):($scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1))},$scope.lostFocus=function(postIndex){$timeout(function(){$scope.showFriendList=!1,$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1},300)},$scope.friendTagIndex=[],$scope.searchNevigateControl=function(event,index){40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]+1!==$scope.friends[index].length&&$scope.friendTagIndex[index]++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]-1!==-1&&$scope.friendTagIndex[index]--):13===event.keyCode&&$scope.taggedSelectFriend($scope.friends[index][$scope.friendTagIndex[index]],index)},$scope.getUserPostDetail=function(id){var opts={};opts.user_id=APP.currentUser.id,opts.post_id=id,0==$scope.totalSize&&1==$scope.myRes?($scope.myRes=0,ProfileService.getDashboardPostDetail(opts,function(data){if(101==data.code){$scope.isLoadPost=!1;var items=data.data.post;void 0!=items&&($scope.userPostList=$scope.userPostList.concat(items),$scope.noPostList=!1),0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.totalSize=data.data.count}else $scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList;$scope.myRes=1})):($scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList)},$scope.showUserPostList=function(){$scope.isLoadPost=!0,$scope.totalSize=0,$scope.myRes=1,($routeParams.postId?$routeParams.postId:"")?$scope.getUserPostDetail($routeParams.postId):$scope.getPosts()},$scope.showUserPostList(),$scope.imageSrc=[],$scope.postFiles=[],$scope.postImgLoader=[],$scope.tempPostId="";var uploader=$scope.uploader=new FileUploader({url:APP.service.createStorePost+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:$scope.currentUser.id,store_id:$scope.storeId,post_title:"Not in use on frontend",post_desc:"",youtube:"",to_id:$scope.currentUser.id,link_type:"0",post_type:"0",post_id:$scope.tempPostId},dataObjName:"reqObj",formDataName:"store_media[]"});uploader.filters.push({name:"store_media[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0,uploader.data.post_id=$scope.tempPostId;var queueLen=uploader.queue.length-1;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.postImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imageSrc[index]=response.data,$scope.postImgLoader[index]=!1,$scope.tempPostId=response.data.post_id,uploader.data.post_id=response.data.post_id)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){
$scope.postErrMsg=$scope.i18n.storepost.incorrect_upload,$scope.postErrCls="text-red",$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3)},$scope.removeImage=function(index){var tempImg=$scope.imageSrc[index];$scope.imageSrc.splice(index,1);var item=$scope.uploader.queue[index];item.remove();var opts={};opts.user_id=$scope.currentUser.id,opts.session_id=APP.currentUser.id,opts.media_id=tempImg.media_id,opts.post_id=$scope.tempPostId,StorePostService.deleteMediaPost(opts,function(data){101==data.code||($scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.dashboard.postcomment.remove_img_fail,$scope.imageSrc[index]=tempImg),$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3)})},$scope.loadMoreFunc="loadMore()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMore()")},!0),$(".fancybox").fancybox()}]).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.controller("StoreAlbumController",["$scope","StoreAlbumService","AlbumService","$location","$routeParams","StoreService","$timeout","FileUploader","focus",function($scope,StoreAlbumService,AlbumService,$location,$routeParams,StoreService,$timeout,FileUploader,focus){$scope.myValue=!1,$scope.albloader=!1,$scope.noAlbums=!1,$scope.noPhotos=!1,$scope.albumResponse="",$scope.storeId=$routeParams.id,$scope.albumId=$routeParams.album_id,$scope.listload=!1,$scope.listAlbum=[],$scope.totalSize=0,$scope.allRes=1,$scope.viewalbum=[],$scope.totalSizeImg=0,$scope.allResImg=1,$scope.noResult=!1,$scope.shopAlbumSubmitted=!1,$scope.storeOwnerId=StoreService.getStoreOwnerId(),$scope.uploadloader=!1,$scope.createstorealbums=function(){if($scope.shopAlbumSubmitted=!0,void 0===$scope.user.albumname||""===$scope.user.albumname)return $scope.storeAlbumForm.albumname.$dirty=!0,$scope.storeAlbumForm.albumname.$invalid=!0,$scope.storeAlbumForm.albumname.$error.required=!0,focus("albumname"),!1;if(void 0===$scope.user.albumdesc||""===$scope.user.albumdesc)return $scope.storeAlbumForm.albumdesc.$dirty=!0,$scope.storeAlbumForm.albumdesc.$invalid=!0,$scope.storeAlbumForm.albumdesc.$error.required=!0,focus("albumdesc"),!1;$scope.albumErrorResponse="",$scope.albumErrResponse=!1,$scope.createAlbumLoader=!0;var opts={};opts.session_id=APP.currentUser.id,opts.store_id=$scope.storeId,opts.album_name=$scope.user.albumname,opts.album_desc=$scope.user.albumdesc,StoreAlbumService.createstorealbums(opts,function(data){$scope.createAlbumLoader=!1,101==data.code?($scope.shopAlbumSubmitted=!1,$scope.albumResponse=$scope.i18n.albums.album_created,$timeout(function(){$scope.albumResponse=""},15e3),$scope.albloader=!0,$scope.listAlbum.length=0,$scope.storealbumlists("listing"),$scope.user=null,$scope.myValue=!1):($scope.albumResponse=$scope.i18n.storealbum.album_wrong,$timeout(function(){$scope.albumErrorResponse=""},15e3))})},$scope.editAlbumForm=!1,$scope.updateUserAlbum=!1,$scope.editAlbumData={},$scope.editAlbum=function(albumName,albumDescription,albId){$scope.editAlbumData.album_name=albumName,$scope.editAlbumData.album_description=albumDescription,$scope.editAlbumData.id=albId,$scope.editAlbumForm=!$scope.editAlbumForm},$scope.closeEditForm=function(){$scope.editAlbumForm=!$scope.editAlbumForm,$scope.editAlbumData={}},$scope.updateAlbum=function(){if(void 0===$scope.editAlbumData.album_name||""===$scope.editAlbumData.album_name)return $scope.shopEditAlbumForm.editalbumname.$dirty=!0,$scope.shopEditAlbumForm.editalbumname.$invalid=!0,$scope.shopEditAlbumForm.editalbumname.$error.required=!0,focus("editalbumname"),!1;if(void 0===$scope.editAlbumData.album_description||""===$scope.editAlbumData.album_description)return $scope.shopEditAlbumForm.editalbumdesc.$dirty=!0,$scope.shopEditAlbumForm.editalbumdesc.$invalid=!0,$scope.shopEditAlbumForm.editalbumdesc.$error.required=!0,focus("editalbumdesc"),!1;$scope.updateUserAlbum=!0;var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.editAlbumData.id,opts.album_name=$scope.editAlbumData.album_name,opts.album_desc=$scope.editAlbumData.album_description,opts.type="shop",AlbumService.updateAlbum(opts,function(data){$scope.updateUserAlbum=!1,101==data.code?($scope.editAlbumForm=!$scope.editAlbumForm,$scope.listAlbum.length=0,$scope.storealbumlists("listing"),$scope.user=null,$scope.albumResponse=$scope.i18n.albums.album_updated,$timeout(function(){$scope.albumResponse=""},5e3)):($scope.editAlbumForm=!$scope.editAlbumForm,$scope.albumErrorResponse=$scope.i18n.albums.gone_wrong,$timeout(function(){$scope.albumErrorResponse=""},5e3))})},$scope.uploadstoremediaalbums=function(){if(void 0==$scope.imagePrvSrc||0==$scope.imagePrvSrc.length)return $scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.storealbum.image_first,$timeout(function(){$scope.fileNotValidMsg="",$scope.fileNotValid=!1},15e3),!1;$scope.uploadloader=!0,$("#addbutton").hide();var albumId=$routeParams.album_id,opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeId,opts.album_id=albumId,opts.post_type=1;$scope.imagePrvSrc.length;opts.media_id=[],angular.forEach($scope.imagePrvSrc,function(file){opts.media_id.push(file.media_id)}),$scope.fileNotValidMsg="",$scope.fileNotValid=!1,StoreAlbumService.uploadstoremediaalbumsfinal(opts,function(data){101==data.code?($scope.uploadloader=!1,$("#addbutton").show(),$scope.postFiles=[],$scope.imagePrvSrc=[],$timeout(function(){$scope.albumResponse=""},15e3),$scope.viewalbum.length=0,$scope.totalSizeImg=0,$scope.allResImg=1,$scope.viewstorealbums("upload"),$("input[type='file']").val(""),$scope.imgUpload=!1,uploader.queue=[]):($scope.uploadloader=!1,$("#addbutton").show(),$scope.fileNotValidMsg=data.message,$timeout(function(){$scope.fileNotValidMsg=""},15e3))})},$scope.fileNotValid=!1,$scope.fileNotValidMsg="",$scope.tempAlbumId="",$scope.albumImgLoader=[],$scope.imagePrvSrc=[];var uploader=$scope.uploader=new FileUploader({url:APP.service.uploadstoremediaalbums+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id,album_id:$scope.albumId,store_id:$scope.storeId,post_type:"0"},dataObjName:"reqObj",formDataName:"store_media[]"});uploader.filters.push({name:"store_media[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0;var queueLen=uploader.queue.length;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.albumImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imagePrvSrc[index]=response.data,$scope.albumImgLoader[index]=!1)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.fileNotValid=!0,$scope.fileNotValidMsg=$scope.i18n.albums.upload_media_invalid,$timeout(function(){$scope.fileNotValidMsg=""},4e3)},$scope.removeImage=function(index){var tempImg=$scope.imagePrvSrc[index];$scope.imagePrvSrc.splice(index,1);var item=$scope.uploader.queue[index];item.remove();var opts={};opts.session_id=APP.currentUser.id,opts.store_id=$scope.storeId,opts.album_id=albumId,opts.media_id=tempImg.media_id,StoreAlbumService.deletealbummedias(opts,function(data){101==data.code||($scope.imagePrvSrc[index]=tempImg,$timeout(function(){$scope.albumErrMsg=data.message},4e3))})},$scope.storealbumlists=function(type){$scope.noResult=!1;var limit_start=$scope.listAlbum.length;"delete"==type?$scope.albloader=!1:"listing"===type?$scope.albloader=!1:$scope.albloader=!0;var opts={};opts.store_id=$scope.storeId,opts.session_id=APP.currentUser.id,opts.limit_start=limit_start,opts.user_id=APP.currentUser.id,opts.limit_size=12,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.allRes&&($scope.listload=!0,$scope.allRes=0,StoreAlbumService.storealbumlists(opts,function(data){$scope.noResult=!0,101==data.code?($scope.totalSize=data.data.size,$scope.allRes=1,$scope.listAlbum=$scope.listAlbum.concat(data.data.album),$scope.listload=!1,$scope.albloader=!1,"create"==type?$scope.albumResponse=$scope.i18n.storealbum.album_response:"delete"==type&&($scope.albumResponse=$scope.i18n.storealbum.album_del_response),$timeout(function(){$scope.albumResponse=""},15e3),$(".album-option").removeClass("album-blank"),0==$scope.totalSize||document.getElementById("albumname")&&($scope.user={})):($scope.albloader=!1,$scope.listload=!1)}))},$scope.loadMore=function(){$scope.storealbumlists("listing")},$scope.storepagealbumlists=function(){$scope.albloader=!0;var opts={};opts.store_id=$scope.storeId,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=20,StoreAlbumService.storealbumlists(opts,function(data){101==data.code?($scope.listPageAlbum=data.data.album,$scope.noAlbums=!0,$scope.albloader=!1):$scope.albloader=!1})},$scope.deletestorealbums=function(id){$scope.albumResponse="";var opts={};opts.session_id=APP.currentUser.id,opts.store_id=$scope.storeId,opts.album_id=id,StoreAlbumService.deletestorealbums(opts,function(data){101==data.code&&($scope.listAlbum.length=0,$scope.totalSize=0,$scope.allRes=1,$scope.storealbumlists("delete"),$timeout(function(){$scope.albumResponse=""},15e3))})},$scope.albumDescription="",$scope.viewstorealbums=function(type){var limit_start=$scope.viewalbum.length;"delete"==type?$scope.albloader=!1:"listing"===type?$scope.albloader=!1:"upload"===type?$scope.albloader=!1:$scope.albloader=!0;var albumId=$routeParams.album_id;$scope.albumname=$routeParams.album_name;var opts={};opts.store_id=$scope.storeId,opts.album_id=albumId,opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=12,($scope.totalSizeImg>limit_start||0==$scope.totalSizeImg)&&1==$scope.allResImg&&($scope.listload=!0,$scope.allResImg=0,StoreAlbumService.viewstorealbums(opts,function(data){101==data.code?($scope.albloader=!1,$scope.totalSizeImg=data.data.size,$scope.allResImg=1,$scope.viewalbum=$scope.viewalbum.concat(data.data.media),$scope.albumDescription=data.data.album.description,$scope.albumDetails=data.data.album,$scope.listload=!1,$scope.noPhotos=!0,"upload"==type?$scope.albumResponse=$scope.i18n.storealbum.album_upload:"delete"==type?$scope.albumResponse=$scope.i18n.storealbum.album_del_success:$scope.albumResponse="",$(".album-option").removeClass("album-blank")):($scope.albloader=!1,$scope.noPhotos=!0,$scope.listload=!1)}))},$scope.loadMoreImage=function(){0!=$scope.totalSizeImg&&$scope.viewstorealbums("listing")},$scope.deletealbummedias=function(m_id,index){var albumId=$routeParams.album_id,opts={};opts.session_id=APP.currentUser.id,opts.store_id=$scope.storeId,opts.album_id=albumId,opts.media_id=m_id,StoreAlbumService.deletealbummedias(opts,function(data){101==data.code&&($timeout(function(){$scope.albumResponse=""},2e3),$scope.viewalbum.splice(index,1))})},$scope.showAlbumForm=function(){$scope.myValue=!0},$scope.closeForm=function(){$scope.myValue=!1},$scope.storealbumlists(),$scope.storepagealbumlists(),$scope.viewstorealbums("listing"),$(".fancybox").fancybox(),$scope.redirectUrl=function(album_id,album_name){""==album_name?(album_name="Untitled",$location.path("/album/shop/image/"+album_id+"/"+album_name+"/"+$scope.storeId)):$location.path("/album/shop/image/"+album_id+"/"+album_name+"/"+$scope.storeId)},$scope.setStoreProfileimage=function(id,imageId){$("#setStoreImageSubmit-"+id).hide(),$("#setStoreImageloader-"+id).show();var opts={};opts.user_id=APP.currentUser.id,opts.store_id=$scope.storeId,opts.media_id=imageId,StoreService.setStoreProfileImage(opts,function(data){if(101==data.code){$("#setStoreImageSubmit-"+id).show(),$("#setStoreImageloader-"+id).hide(),$scope.albumResponse=$scope.i18n.storealbum.album_updated;var imageData=data.data;$scope.$broadcast("updateShopProfileCover",imageData)}else $("#setStoreImageSubmit-"+id).show(),$("#setStoreImageloader-"+id).hide()})}}]),app.controller("TopPublicShopController",["$scope","$http","TopLinkService",function($scope,$http,TopLinkService){$scope.storeLoading=!0,$scope.listActive="active",$scope.gridActive="",$scope.getTopShopPerRevenue=function(){var opts={};opts.limit_size=50,TopLinkService.getTopShopPerRevenue(opts,function(data){101==data.code?($scope.topShopPerRevenue=data.data,$scope.storeLoading=!1):($scope.topShopPerRevenue={},$scope.storeLoading=!1)})},$scope.changeView=function(type){"list"===type?($scope.listActive="active",$scope.gridActive=""):($scope.listActive="",$scope.gridActive="active")},$scope.getTopShopPerRevenue()}]),app.controller("TopLinkedCitizenController",["$scope","$http","TopLinkService",function($scope,$http,TopLinkService){$scope.citizenTopLinkLoader=!0,$scope.listActive="active",$scope.gridActive="",$scope.getTopCitizenTopLink=function(){var opts={};opts.limit_start=0,opts.limit_size=50,TopLinkService.getTopLinkedCitizen(opts,function(data){101==data.code?($scope.topLinkedCitizen=data.data.data,$scope.citizenTopLinkLoader=!1):($scope.topLinkedCitizen={},$scope.citizenTopLinkLoader=!1)})},$scope.changeView=function(type){"list"===type?($scope.listActive="active",$scope.gridActive=""):($scope.listActive="",$scope.gridActive="active")},$scope.getTopCitizenTopLink()}]),app.controller("TopCitizenIncomeController",["$scope","$http","TopLinkService",function($scope,$http,TopLinkService){$scope.topCitizenPerincomeLoader=!0,$scope.listActive="active",$scope.gridActive="",$scope.getTopCitizenPerIncome=function(){var opts={};opts.limit_size=50,TopLinkService.getTopCitizenPerIncome(opts,function(data){101==data.code?($scope.topCitizenPerIncome=data.data,$scope.topCitizenPerincomeLoader=!1):($scope.topCitizenPerIncome={},$scope.topCitizenPerincomeLoader=!1)})},$scope.changeView=function(type){"list"===type?($scope.listActive="active",$scope.gridActive=""):($scope.listActive="",$scope.gridActive="active")},$scope.getTopCitizenPerIncome()}]),app.controller("TopCitizenAllController",["$scope","$http","TopLinkService","fileReader",function($scope,$http,TopLinkService,fileReader){$scope.citizenTopLinkLoader=!0,$scope.getTopCitizenTopLink=function(){var opts={};opts.limit_start=0,opts.limit_size=50,TopLinkService.getTopLinkedCitizen(opts,function(data){101==data.code?($scope.topLinkedCitizen=data.data.data,$scope.citizenTopLinkLoader=!1):($scope.topLinkedCitizen={},$scope.citizenTopLinkLoader=!1)})},$scope.getTopCitizenTopLink()}]),app.controller("TopCitizenPerIncomeController",["$scope","$http","TopLinkService","fileReader",function($scope,$http,TopLinkService,fileReader){$scope.topCitizenPerincomeLoader=!0,$scope.getTopCitizenPerIncome=function(){var opts={};opts.limit_size=50,TopLinkService.getTopCitizenPerIncome(opts,function(data){101==data.code?($scope.topCitizenPerIncome=data.data,$scope.topCitizenPerincomeLoader=!1):($scope.topCitizenPerIncome={},$scope.topCitizenPerincomeLoader=!1)})},$scope.getTopCitizenPerIncome()}]),app.controller("TopShopPerRevenueController",["$scope","$http","TopLinkService","fileReader",function($scope,$http,TopLinkService,fileReader){$scope.topShopPerRevenueLoader=!0,$scope.getTopShopPerRevenue=function(){var opts={};opts.limit_size=50,TopLinkService.getTopShopPerRevenue(opts,function(data){101==data.code?($scope.topShopPerRevenue=data.data,$scope.topShopPerRevenueLoader=!1):($scope.topShopPerRevenue={},$scope.topShopPerRevenueLoader=!1)})},$scope.getTopShopPerRevenue()}]),app.controller("InviteAffiliationController",["$scope","$http","TopLinkService","$timeout","$log","TranslationService",function($scope,$http,TopLinkService,$timeout,$log,TranslationService){$scope.i18n.invite_affiliate?($scope.invitemessage=$scope.i18n.invite_affiliate.invited,$scope.errorMsg=$scope.i18n.invite_affiliate.invite_error,$scope.needEmail=$scope.i18n.invite_affiliate.email_need):TranslationService.getTranslationWithCallback($scope,$scope.activeLanguage,function(data){$scope.i18n=data,$scope.invitemessage=$scope.i18n.invite_affiliate.invited,$scope.errorMsg=$scope.i18n.invite_affiliate.invite_error,$scope.needEmail=$scope.i18n.invite_affiliate.email_need}),$scope.active={basicProfile:!1,citizen_tutorial:!1,shop_tutorial:!1,invite_citizen:!1,invite_shop:!1},$scope.toggleshoplist=!1,$scope.activeThem=function(key){"basicProfile"===key?$scope.toggleshoplist=!$scope.toggleshoplist:$scope.toggleshoplist=!1,angular.forEach($scope.active,function(val,currKey){currKey===key?$scope.active[currKey]=!0:$scope.active[currKey]=!1})},$scope.openFancyBox=function(type){1==type?$scope.inviteUrl=APP.base_url+"citizen_affiliation/"+APP.currentUser.id+"/"+type:2==type?$scope.inviteUrl=APP.base_url+"broker_affiliation/"+APP.currentUser.id+"/"+type:3==type&&($scope.inviteUrl=APP.base_url+"shop_affiliation/"+APP.currentUser.id+"/"+type);var t='<div id="citizeninvitepopup" class="modal-container">';t+='<div class="form-container"><div id="inviteduser" style="display:none;" class="success">'+$scope.invitemessage+"</div>",t+='<div id="notinviteduser" style="display:none;" class="inviteerror">'+$scope.errorMsg+"</div>",t+='<div id="needEmail" style="display:none;" class="inviteerror">'+$scope.needEmail+"</div><form >",t+='<ul><li><textarea elastic class="form-control bg-gray" name="to_emails" id="to_emails" type="text" placeholder="'+$scope.i18n.invite_affiliate.emails_with_commas+'" onkeypress="checkEmailField()"></textarea> </li>',t+='<li><input class="form-control bg-gray" name="inviteUrl" id="inviteUrl" value="'+$scope.inviteUrl+'" type="text" placeholder="'+$scope.inviteUrl+'" readonly/></li>',t+='<li><button id="requestSending" class="btn btn-primary" type="button" onclick="return inviteCAffiliationUser()" id="Submit">'+$scope.i18n.invite_affiliate.send_buttom+"</button>",t+='<div id="sendingloader" style="text-align: center; display:none;"><img alt="processing..." src="app/assets/images/proceed.gif"></div></li>',t+="</ul></form></div></div>",$.fancybox.open({content:t,type:"html"})},$scope.InviteAffiliationUser=function(emails,url){$scope.requestSending=!0;var opts={};opts.user_id=APP.currentUser.id,opts.to_emails=emails.split(","),opts.affiliation_type=url.slice(-1),opts.url=url,TopLinkService.inviteAffiliation(opts,function(data){$("#requestSending").show(),$("#sendingloader").hide(),$scope.to_emails="",$scope.requestSending=!1,101==data.code?($("#inviteduser").show(),$timeout(function(){$("#inviteduser").hide()},4e3)):($("#notinviteduser").show(),$timeout(function(){$("#notinviteduser").hide()},4e3))})}}]),app.controller("ImportContactController",["$scope","$http","$rootScope","$route","TopLinkService","$timeout","$routeParams","$location","$modal","TranslationService",function($scope,$http,$rootScope,$route,TopLinkService,$timeout,$routeParams,$location,$modal,TranslationService){$scope.inviteType=$routeParams.id,$scope.i18n.invite_affiliate?($scope.invitemessage=$scope.i18n.invite_affiliate.invited,$scope.errorMsg=$scope.i18n.invite_affiliate.invite_error,$scope.needEmail=$scope.i18n.invite_affiliate.email_need):TranslationService.getTranslationWithCallback($scope,$scope.activeLanguage,function(data){$scope.i18n=data,$scope.invitemessage=$scope.i18n.invite_affiliate.invited,$scope.errorMsg=$scope.i18n.invite_affiliate.invite_error,$scope.needEmail=$scope.i18n.invite_affiliate.email_need}),$scope.requestSending=!1,$scope.invitedScuccess=!1,$scope.notinviteduser=!1,$scope.needinviteduser=!1;var type=$routeParams.id;1==type?$scope.inviteUrl=APP.base_url+"citizen_affiliation/"+APP.currentUser.id+"/"+type:2==type?$scope.inviteUrl=APP.base_url+"broker_affiliation/"+APP.currentUser.id+"/"+type:3==type&&($scope.inviteUrl=APP.base_url+"shop_affiliation/"+APP.currentUser.id+"/"+type),$("#inviteUrl").val($scope.inviteUrl),$scope.validateEmail=function(field){var regex=/\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b/i;return regex.test(field)?!0:!1},$scope.validateMultipleEmailsCommaSeparated=function(value){for(var result=value.split(","),i=0;i<result.length;i++)if(!$scope.validateEmail(result[i]))return!1;return!0},$scope.cancelBack=function(){$location.path("/")},$scope.inviteBulkAffiliationUser=function(){$scope.requestSending=!0;var emails=$("#to_emails").val(),url=$("#inviteUrl").val(),isValid=$scope.validateMultipleEmailsCommaSeparated(emails);if(""==emails&&($scope.needinviteduser=!0,$scope.requestSending=!1,$timeout(function(){$scope.needinviteduser=!1},4e3)),isValid){var opts={};opts.user_id=APP.currentUser.id,opts.to_emails=emails.split(","),opts.affiliation_type=url.slice(-1),opts.url=url,TopLinkService.inviteAffiliation(opts,function(data){$scope.requestSending=!1,$("#to_emails").val(""),101==data.code?($scope.invitedScuccess=!0,$scope.requestSending=!1,$timeout(function(){$scope.invitedScuccess=!1},4e3)):($scope.notinviteduser=!0,$timeout(function(){$scope.notinviteduser=!1},4e3))})}else $scope.needinviteduser=!0,$scope.requestSending=!1,$timeout(function(){$scope.needinviteduser=!1},4e3)},$scope.checkFBforCloudSponge=function(){$scope.clodSpongeFB=!1,$scope.FBGraphAPI=!1;var currentDate=new Date,expiryDate=new Date(2015,4,30);expiryDate>currentDate?$scope.clodSpongeFB=!0:$scope.FBGraphAPI=!0},$scope.InviteFbFriends=function(){checkLoginForInvite(function(data){null!==data&&getImageOfFriends(function(frndImg){if(null!==frndImg)for(var index=0,i=0;i<frndImg.data.length;i++){var taggFrnd=frndImg.data[i];if(angular.forEach(data.data,function(appFrnd){taggFrnd.name==appFrnd.name&&(console.log(taggFrnd),appFrnd.imageURL=taggFrnd.picture.data.url,index++)}),index==data.data.length)break}$scope.allFriends=data.data,$scope.checkSlec=[];var modalInstance=$modal.open({template:'<div id="friendModal" class="modal-header"><h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div></div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" src="{{friend.imageURL}}"></span><span class="tag-frnd-name"><a href>{{friend.name}}</a></span><span class="rmv-tag"><input type="checkbox" class="fbCheckbox" ng-init="friend.status = false" ng-click="friend.status = !friend.status"></span></li></ul><button class="btn btn-primary" ng-click="getSelectedFrnd()">OK</button></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){}),$scope.getSelectedFrnd=function(){angular.forEach($scope.allFriends,function(frnd){if(frnd.status){var win=window.open(frnd.link);window.location.repalce=frnd.link,setTimeout(function(){console.log(win.location.href)},5e3)}})}})})}}]),app.controller("UserController",["$cookieStore","$rootScope","ipCookie","$scope","$http","$location","$timeout","$routeParams","UserService","saveUserPass","TopLinkService","$remember","AffiliatedkService","AlbumService","verifyUser","EMAILPATTERN","focus",function($cookieStore,$rootScope,ipCookie,$scope,$http,$location,$timeout,$routeParams,UserService,saveUserPass,TopLinkService,$remember,AffiliatedkService,AlbumService,verifyUser,EMAILPATTERN,focus){function Leap(Year){Year%4==0?Year%100==0?$scope.Result=Year%400==0:$scope.Result=1:$scope.Result=0,$scope.monthChange()}$scope.emailPattern=EMAILPATTERN.emailPattern,$scope.fb_expire=!1,$scope.loginStart=!1,$scope.loginError=!1,$scope.loginErrorMsg="",$scope.signupStart=!1,$scope.sucessMessage=!1,$scope.signUpSuccessMsg="sucess",$scope["class"]="sucess",$scope.isLoading=!1,$scope.message="",$scope.brokerloader=!1,$scope.brokerMsg="",$scope.brokerMsgerror="",$scope.isreferralId="",$scope.user={},$scope.user.month="",$scope.user.remember=!1,$scope.months=$scope.i18n.Register_months,$scope.$watch("currentLanguage",function(newValue,oldValue){$timeout(function(){$scope.months=$scope.i18n.Register_months},400)});var fbdata;if($scope.profileType=$routeParams.profileType,$scope.filtertypeId=$routeParams.typeId,$scope.brokerProfile=APP.profileType.brokerProfile,$scope.citizenProfile=APP.profileType.citizenProfile,TopLinkService.getAffiliationObject().hasOwnProperty("user_id")){var affiliate=TopLinkService.getAffiliationObject();$scope.isreferralId=affiliate.user_id,$scope.referralId=affiliate.user_id,$scope.filtertypeId=affiliate.type,-1!=$location.path().indexOf("registration")&&TopLinkService.setAffiliationObject({})}if($scope.getProfile=$location.path(),-1!==$scope.getProfile.indexOf("/profiles")){$scope.citizenProfileLoader=!0;var citizenOpts={};citizenOpts.user_id=APP.currentUser.id,citizenOpts.profile_type=APP.profileType.citizenProfile,UserService.getBasicProfile(citizenOpts,function(data){if(101==data.code){data.data.facebook_profile.expires<=0&&($scope.fb_expire=!0),$scope.citizenProfileLoader=!1,$scope.currentFullDate=(new Date).getFullYear(),$scope.fullCitizenProfile=data.data,$scope.showPersonalJobs=data.data.baisc_profile_info.jobDetails;var monthNum=parseInt($scope.fullCitizenProfile.baisc_profile_info.date_of_birth.date.substring(5,7));$scope.birthmonth=$scope.months[monthNum-1].name,$scope.emptyPersonalJobs=!1,angular.forEach($scope.showPersonalJobs,function(index){(1===index.visibility_type||3===index.visibility_type)&&($scope.emptyPersonalJobs=!0)}),$scope.showPersonalEducation=data.data.baisc_profile_info.educationDetail,$scope.emptyPersonalEducation=!1,angular.forEach($scope.showPersonalEducation,function(index){(1===index.visibility_type||3===index.visibility_type)&&($scope.emptyPersonalEducation=!0)}),1==$scope.profileType&&($scope.emptyProfessionalJobs=!1,angular.forEach($scope.showPersonalJobs,function(index){(2===index.visibility_type||3===index.visibility_type)&&($scope.emptyProfessionalJobs=!0)}),$scope.emptyProfessionalEducation=!1,angular.forEach($scope.showPersonalEducation,function(index){(2===index.visibility_type||3===index.visibility_type)&&($scope.emptyProfessionalEducation=!0)}))}else $scope.citizenProfileLoader=!1}),$scope.getAffiliateCounts=function(){var opts={};opts.user_id=APP.currentUser.id,opts.session_id=APP.currentUser.id,AffiliatedkService.getAllcounts(opts,function(data){101==data.code&&($scope.totalCounts=data.data)})},$scope.loaduseralbumimages=function(){$scope.noalbumimages=!1;var opts={};opts.user_id=APP.currentUser.id,opts.friend_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=4,AlbumService.albumListing(opts,function(data){101==data.code?($scope.userlatestalbum=data.data.albums,0==$scope.userlatestalbum.length&&($scope.noalbumimages=!0)):$scope.userlatestalbum=""})},$scope.loaduseralbumimages(),$scope.getAffiliateCounts()}$(".video-fancybox").fancybox(),$scope.facebookReg=function(){$(".button-section").hide(),$(".fbmsg").hide(),document.getElementById("emailReg").value="",document.getElementById("fname").value="",document.getElementById("lname").value="",document.getElementById("fbId").value="",$scope.user.fbId="",$scope.user.firstName="",$scope.user.lastName="",$scope.user.userEmail=""},$scope.convertString=function(stringAyyar){return stringAyyar.length>0?stringAyyar.split(","):[]},$scope.fbyes=function(){var postData=$scope.facebookdata,opts={facebook_id:postData.facebook_id,user_id:postData.user_id,facebook_accesstoken:postData.facebook_accesstoken};console.log("opts-",opts),UserService.mapfacebookuser(opts,function(data){if(101==data.code){var fbId=data.data.facebook_id,email=data.data.email,fname=data.data.first_name,lname=data.data.last_name;$scope.facebookLoginChk(fbId,email,fname,lname)}else $scope.signUpSuccessMsg=data.message})},$scope.fbno=function(){$(".fbmsg").hide(),$scope.fbloginmessage="",$scope.signUpSuccessMsg="",$(".button-section").hide()},$scope.facebookLoginChk=function(fbId,email,fname,lname,fb_access_token){$scope.fbloader=!0;var postData={reqObj:{facebook_id:fbId,email:email,firstname:fname,lastname:lname}};$http({method:"POST",url:APP.service.getFacebookLogin,data:postData,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(data,header){99==data.code?($scope.fbloader=!1,document.getElementById("emailReg").value=data.data.email,document.getElementById("fname").value=data.data.firstname,document.getElementById("lname").value=data.data.lastname,document.getElementById("fbId").value="fb",document.getElementById("fbUserId").value=data.data.facebook_id,$scope.user.fbId="fb",$scope.user.firstName=data.data.firstname,$scope.user.lastName=data.data.lastname,$scope.user.userEmail=data.data.email,$scope.user.fbUserId=data.data.facebook_id,$scope.user.access_token=fb_access_token,$scope.fbloginmessage=$scope.i18n.home.fbregistration_msg,$(".fbmsg").show()):101==data.code&&($scope.user.userName=data.data.username,$scope.user.password="123456",fbdata=data.data,$scope.getFacebookLogin(fb_access_token))}).error(function(data,status,header){})},$scope.getFacebookLogin=function(fb_access_token){if(void 0==$scope.user.userName||""==$scope.user.userName)return $scope.loginError=!0,$scope.loginErrorMsg=$scope.i18n.home.enter_your_email,!1;if(void 0==$scope.user.password||""==$scope.user.password)return $scope.loginError=!0,$scope.loginErrorMsg=$scope.i18n.home.six_digit_password,!1;$scope.loginStart=!0,$scope.loginError=!1;var opts={};opts={reqObj:{client_id:APP.keys.client_id,client_secret:APP.keys.client_secret,grant_type:APP.keys.grant_type,username:$scope.user.userName,fb_login:"true",password:$scope.user.password}},UserService.getAccessToken(opts).then(function(data){APP.accessToken=data.data.access_token,APP.currentUser=fbdata,ipCookie("loggedInUser",fbdata,{expires:365}),ipCookie("access_token",APP.accessToken,{expires:3e3}),$rootScope.currentUser=fbdata,$scope.selectlanguage(APP.currentUser.current_language),$rootScope.isLoggedIn=!0;var opts3={};opts3.user_id=APP.currentUser.id,opts3.profile_type=4,UserService.getBasicProfile(opts3,function(data){if(101==data.code&&($rootScope.currentUser.basicProfile=data.data),fb_access_token&&data.data.facebook_profile.expires<=0){$scope.fb_expire=!0;var opts={};opts.user_id=APP.currentUser.id,opts.facebook_id=data.data.facebook_profile.id,opts.facebook_accesstoken=fb_access_token,UserService.updateFbAccessToken(opts,function(data){101==data.code&&($scope.fb_expire=!1)})}var opts4={};opts4.idcard=$rootScope.currentUser.basicProfile.user_id,UserService.getCreditAndIncome(opts4,function(data){var currentCredit={};101==data.code?(currentCredit.totalCredit=data.data.saldoc/1e6,currentCredit.totCreditMicro=data.data.saldorm+data.data.saldorc,currentCredit.totalIncome=data.data.tot_income,currentCredit.totalIncomeShow=data.data.tot_income,$rootScope.currentUser.creditAndIncome=currentCredit):$rootScope.currentUser.creditAndIncome=data.data}),$rootScope.allFriendTotal=0,$rootScope.getCountOfAllTypeNotificaton(),$scope.$parent.loggedIn=!0;var currentHitUrl=UserService.getHitUrl();if(TopLinkService.getIsAlreadyUserLogin().yes){var alreadyUserType=TopLinkService.getIsAlreadyUserLogin().profileType;TopLinkService.setIsAlreadyUserLogin({}),$location.path("/shop/register/"+alreadyUserType)}else 0===$rootScope.currentUser.basicProfile.new_conract_status?$location.path("/edit/shop/"+$rootScope.currentUser.basicProfile.shop_id):currentHitUrl.length>2?(UserService.setHitUrl(""),$location.path(currentHitUrl)):$location.path("/profile")}),$scope.fbloader=!1},function(error){"invalid_grant"===error.error?($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username):($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.server_not_responding)})},$scope.loginFormSubmitted=!1,$scope.getLogin=function(){if($scope.loginFormSubmitted=!0,void 0==$scope.user.userName||""==$scope.user.userName)return $scope.loginError=!0,$scope.user.email.$dirty=!0,$scope.user.email.$invalid=!0,
$scope.user.email.$error.required=!0,focus("loginEmail"),!1;if(void 0==$scope.user.password||""==$scope.user.password)return $scope.loginError=!0,$scope.user.loginPassword.$dirty=!0,$scope.user.loginPassword.$invalid=!0,$scope.user.loginPassword.$error.required=!0,focus("loginPassword"),!1;$scope.user.remember?($remember("username",$scope.user.userName),$remember("password",$scope.user.password)):($remember("username",""),$remember("password",""),$scope.user.remember=!1),$scope.loginStart=!0,$scope.loginError=!1;var opts={};opts={reqObj:{client_id:APP.keys.client_id,client_secret:APP.keys.client_secret,grant_type:APP.keys.grant_type,username:$scope.user.userName,password:$.base64.encode($scope.user.password)}},UserService.getAccessToken(opts).then(function(data){APP.accessToken=data.data.access_token;var postData={reqObj:{username:$scope.user.userName,password:$.base64.encode($scope.user.password)}};$http({method:"POST",url:APP.service.logins+"?access_token="+data.data.access_token,data:postData,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(data,header){if(data.data&&100!=data.code){APP.currentUser=data.data,ipCookie("loggedInUser",data.data,{expires:365}),ipCookie("access_token",APP.accessToken,{expires:3e3}),$rootScope.currentUser=data.data,$rootScope.isLoggedIn=!0,$scope.selectlanguage(APP.currentUser.current_language);var opts3={};opts3.user_id=APP.currentUser.id,opts3.profile_type=4,UserService.getBasicProfile(opts3,function(data){101==data.code&&($rootScope.currentUser.basicProfile=data.data),data.data.facebook_profile.expires<=0&&($scope.fb_expire=!0);var opts4={};opts4.idcard=$rootScope.currentUser.basicProfile.user_id,UserService.getCreditAndIncome(opts4,function(data){var currentCredit={};101==data.code?(currentCredit.totalCredit=data.data.saldoc/1e6,currentCredit.totCreditMicro=data.data.saldorm+data.data.saldorc,currentCredit.totalIncome=data.data.tot_income,currentCredit.totalIncomeShow=data.data.tot_income,$rootScope.currentUser.creditAndIncome=currentCredit):$rootScope.currentUser.creditAndIncome=data.data}),$rootScope.allFriendTotal=0,$rootScope.getCountOfAllTypeNotificaton(),$scope.$parent.loggedIn=!0;var currentHitUrl=UserService.getHitUrl();if(TopLinkService.getIsAlreadyUserLogin().yes){var alreadyUserType=TopLinkService.getIsAlreadyUserLogin().profileType;TopLinkService.setIsAlreadyUserLogin({}),$location.path("/shop/register/"+alreadyUserType)}else 0===$rootScope.currentUser.basicProfile.new_conract_status?$location.path("/edit/shop/"+$rootScope.currentUser.basicProfile.shop_id):currentHitUrl.length>2?(UserService.setHitUrl(""),$location.path(currentHitUrl)):$location.path("/profile")})}else $scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.loginErrorMsg=""},15e3)}).error(function(data,status,header){403==status?1045==data.code&&"TRIAL_EXPIRED"==data.message&&(verifyUser.check(),$scope.loginStart=!1):($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.loginErrorMsg=""},15e3))})},function(error){"invalid_grant"===error.error?($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username,$timeout(function(){$scope.loginErrorMsg=""},15e3)):($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.server_not_responding,$timeout(function(){$scope.loginErrorMsg=""},15e3))})},$scope.go=function(path){$location.path(path)},$scope.months=$scope.i18n.Register_months,$scope.$watch("currentLanguage",function(newValue,oldValue){$timeout(function(){$scope.months=$scope.i18n.Register_months,$scope.user.month=""},400)}),$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],$scope.Result=0,$scope.$watch("user.year",function(val){Leap(val)}),$scope.monthChange=function(){if(void 0===$scope.user.month||""===$scope.user.month||null===$scope.user.month);else{var normalValue=$scope.user.month.value-1;6>=normalValue?normalValue%2==0?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:1==normalValue?$scope.Result?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]:normalValue%2!=0?$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31]:$scope.days=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30]}},$scope.getyears=function(){var currentYear=(new Date).getFullYear();$scope.years=[];for(var i=1914;currentYear>=i;i++)$scope.years.push(i)},$scope.getyears(),$scope.countries=APP.countries,$scope.signUpSuccessMsg="",$scope.showLoading=!0,$scope.genderShow=!1,$scope.clear=function(){$scope.user.dob=null},$scope.disabled=function(date,mode){return"day"===mode&&(0===date.getDay()||6===date.getDay())},$scope.toggleMin=function(){$scope.minDate=$scope.minDate?null:new Date},$scope.toggleMin(),$scope.formats=["dd-MM-yyyy","dd-MM-yyyy","dd-MM-yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.user.gender=0,$scope.formSubmitted=!1,$scope.invalidSelectedDob=!1,$scope.registration=function(type){var currentDOB=new Date;$scope.formSubmitted=!0;var opts={};if(void 0===$scope.user.userEmail||""===$scope.user.userEmail)return $scope.user.emailReg.$dirty=!0,$scope.user.emailReg.$invalid=!0,$scope.user.emailReg.$error.required=!0,focus("emailReg"),!1;if(void 0===$scope.user.userPassword||""===$scope.user.userPassword)return $scope.user.pwdReg.$dirty=!0,$scope.user.pwdReg.$invalid=!0,$scope.user.pwdReg.$error.required=!0,focus("pwdReg"),!1;if(void 0===$scope.user.firstName||""===$scope.user.firstName)return $scope.user.fname.$dirty=!0,$scope.user.fname.$invalid=!0,$scope.user.fname.$error.required=!0,focus("fname"),!1;if(void 0===$scope.user.lastName||""===$scope.user.lastName)return $scope.user.lname.$dirty=!0,$scope.user.lname.$invalid=!0,$scope.user.lname.$error.required=!0,focus("lname"),!1;if(void 0===$scope.user.month||""===$scope.user.month)return $scope.user.dobmonth.$dirty=!0,$scope.user.dobmonth.$invalid=!0,$scope.user.dobmonth.$error.required=!0,focus("dobmonth"),!1;if(void 0===$scope.user.day||""===$scope.user.day)return $scope.user.dobday.$dirty=!0,$scope.user.dobday.$invalid=!0,$scope.user.dobday.$error.required=!0,focus("dobday"),!1;if(void 0===$scope.user.year||""===$scope.user.year)return $scope.user.dobyear.$dirty=!0,$scope.user.dobyear.$invalid=!0,$scope.user.dobyear.$error.required=!0,focus("dobyear"),!1;if($scope.user.year===currentDOB.getFullYear()&&$scope.user.month.value>=currentDOB.getMonth()+1&&$scope.user.day>currentDOB.getDate())$scope.invalidSelectedDob=!0,focus("dobday"),$timeout(function(){$scope.invalidSelectedDob=!1},2e3);else{if(void 0===$scope.user.gender||0===$scope.user.gender)return $scope.user.genreg.$dirty=!0,$scope.user.genreg.$invalid=!0,$scope.user.genreg.$error.required=!0,focus("genreg"),!1;if(void 0===$scope.user.country||void 0===$scope.user.country.id||""===$scope.user.country.id)return $scope.user.countryReg.$dirty=!0,$scope.user.countryReg.$invalid=!0,$scope.user.countryReg.$error.required=!0,focus("countryReg"),!1;if(1==type&&("false"===$scope.user.terms||void 0===$scope.user.terms||$scope.user.terms===!1||""===$scope.user.terms))return $scope.user.termReg.$dirty=!0,$scope.user.termReg.$invalid=!0,$scope.user.termReg.$error.required=!0,focus("termReg"),!1}"fb"==$scope.user.fbId?(localStorage.getItem("CitizenAffiliatedObject")&&(opts.referral_id=JSON.parse(localStorage.getItem("CitizenAffiliatedObject")).affiliator_id),opts.facebook_id=$scope.user.fbUserId,opts.firstname=$scope.user.firstName,opts.email=$scope.user.userEmail,opts.password=$.base64.encode($scope.user.userPassword),opts.lastname=$scope.user.lastName,opts.birthday=$scope.user.day+"-"+$scope.user.month.value+"-"+$scope.user.year,opts.gender=$scope.user.gender,opts.country=$scope.user.country.id,opts.facebook_accesstoken=$scope.user.access_token,""!=type?opts.type=type:opts.type=$routeParams.typeId,$scope.signupStart=!0,$scope.showLoading=!1,$scope.signUpSuccessMsg="",UserService.getFacebookRegister(opts,function(data){101==data.code?(localStorage.removeItem("CitizenAffiliatedObject"),fbdata=data.data,$scope.sucessMessage=!0,$scope.signupStart=!1,$scope.user.userName=$scope.user.userEmail,$scope.user.password="123456",$scope.getFacebookLogin()):98==data.code?(console.log(data.data),$scope.facebookdata=data.data,$scope.signUpSuccessMsg=$scope.i18n.validation.user_exits,$(".button-section").show(),$scope.showLoading=!0):154==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.citizen_not_exists,$scope.showLoading=!0):($scope.signUpSuccessMsg=data.message,$scope.showLoading=!0),$timeout(function(){$scope.signUpSuccessMsg=""},15e3)})):(localStorage.getItem("CitizenAffiliatedObject")&&(opts.referral_id=JSON.parse(localStorage.getItem("CitizenAffiliatedObject")).affiliator_id),opts.firstname=$scope.user.firstName,opts.email=$scope.user.userEmail,opts.password=$.base64.encode($scope.user.userPassword),opts.lastname=$scope.user.lastName,opts.birthday=$scope.user.day+"-"+$scope.user.month.value+"-"+$scope.user.year,opts.gender=$scope.user.gender,opts.country=$scope.user.country.id,""!=type?opts.type=type:opts.type=$routeParams.typeId,$scope.signupStart=!0,$scope.showLoading=!1,$scope.signUpSuccessMsg="",UserService.registration(opts,function(data){if(101==data.code){if(localStorage.removeItem("CitizenAffiliatedObject"),1==data.data.profile_type)$scope.sucessMessage=!0,$scope.signupStart=!1,$scope.user.userName=$scope.user.userEmail,$scope.user.password=$scope.user.userPassword,$scope.getLogin();else if(3==data.data.profile_type){var userId=data.data.user_id;saveUserPass.saveUserPassword($scope.user.userEmail,$scope.user.userPassword),$scope.showLoading=!0,$rootScope.referral_id=$scope.referralId,$location.path("/storeProfilestep/"+userId+"/3")}else if(2==data.data.profile_type){var userId=data.data.user_id;saveUserPass.saveUserPassword($scope.user.userEmail,$scope.user.userPassword),$scope.showLoading=!0,$rootScope.referral_id=$scope.referralId,$location.path("/brokerprofilestep/"+userId+"/2")}}else 136==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.user_exists,$scope.showLoading=!0):154==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.citizen_not_exists,$scope.showLoading=!0):137==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.broker_not_exists,$scope.showLoading=!0):131==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.date_format_incorrect,$scope.showLoading=!0):100==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.missed_param,$scope.showLoading=!0):129==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.invalid_country_code,$scope.showLoading=!0):130==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.invalid_gender_type,$scope.showLoading=!0):133==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.invalid_profile_setting,$scope.showLoading=!0):143==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.referral_id_needed,$scope.showLoading=!0):135==data.code?($scope.signUpSuccessMsg=$scope.i18n.validation.email_invalid,$scope.showLoading=!0):($scope.signUpSuccessMsg=data.message,$scope.showLoading=!0);$timeout(function(){$scope.signUpSuccessMsg=""},15e3)}))},$scope.msgcls="",$scope.forgotPassword=function(){var formData={};return""==$scope.email||void 0==$scope.email?($scope.message=$scope.i18n.home.invalid_mail,$timeout(function(){$scope.message=""},15e3),$scope.msgcls="text-red text-center",!1):($scope.isLoading=!0,$scope.message="",formData.username=$scope.email,UserService.forgotPassword(formData,function(data){105==data.code?($scope.msgcls="text-success text-center",$scope.message=$scope.i18n.validation.email_sent,$scope.isLoading=!1):107==data.code?($scope.message=$scope.i18n.validation.password_requested,$scope.isLoading=!1,$scope.msgcls="text-success text-center"):($scope.isLoading=!1,$scope.message=$scope.i18n.home.invalid_mail,$scope.msgcls="text-red text-center")}),void $timeout(function(){$scope.message="",$scope.msgcls="",""==$scope.email},15e3))},$scope.reset={},$scope.reset.token=$rootScope.resetToken,$scope.requestPwdMessage="",$scope.resetPassword=function(){$rootScope.requestPwdMessage="";var formData={};return $scope.isLoading=!0,$scope.reseterror=!1,$scope.message={},""==$scope.reset.token||void 0==$scope.reset.token?($scope.message=$scope.i18n.passchange.enter_token,$scope.reseterror=!0,$scope.isLoading=!1,$timeout(function(){$scope.message=""},15e3),!1):""==$scope.reset.password||void 0==$scope.reset.password||$scope.reset.password.length<6?($scope.message=$scope.i18n.validation.reset_password_invalid,$scope.reseterror=!0,$scope.isLoading=!1,$timeout(function(){$scope.message=""},15e3),!1):""==$scope.reset.repassword||void 0==$scope.reset.repassword||$scope.reset.repassword.length<6?($scope.message=$scope.i18n.validation.password_match,$scope.reseterror=!0,$scope.isLoading=!1,$timeout(function(){$scope.message=""},15e3),!1):$scope.reset.repassword!=$scope.reset.password?($scope.message=$scope.i18n.validation.password_match,$scope.reseterror=!0,$scope.isLoading=!1,$timeout(function(){$scope.message=""},15e3),!1):(formData.token=$scope.reset.token,formData.password=$scope.reset.password,$scope.message="",void UserService.resetPassword(formData,function(data){$rootScope.requestPwdMessage="",101==data.code?($scope.requestPwdMessage=$scope.i18n.home.reset_password_sucess,$scope.reset={},$scope.isLoading=!1):113==data.code?($scope.isLoading=!1,$scope.reseterror=!0,$scope.reset={},$scope.message=$scope.i18n.validation.invalid_password):112==data.code?($scope.message=$scope.i18n.validation.invalid_token,$scope.reseterror=!0,$scope.isLoading=!1,$scope.reset={}):100==data.code?($scope.isLoading=!1,$scope.reset={},$scope.message=$scope.i18n.validation.account_inactive,$scope.reseterror=!0):108==data.code?($scope.isLoading=!1,$scope.reset={},$scope.reseterror=!0,$scope.message=$scope.i18n.validation.not_reset_password):($scope.isLoading=!1,$scope.reset={},$scope.reseterror=!0,$scope.message=$scope.i18n.home.not_reset_password),$timeout(function(){$scope.message="",$scope.requestPwdMessage="",$scope.reseterror=!1},15e3)}))},$scope.getShopPaymentLogin=function(){if(void 0==$scope.user.userName||""==$scope.user.userName)return $scope.loginError=!0,$scope.loginErrorMsg=$scope.i18n.home.enter_your_email,!1;if(void 0==$scope.user.password||""==$scope.user.password)return $scope.loginError=!0,$scope.loginErrorMsg=$scope.i18n.home.six_digit_password,!1;$scope.loginStart=!0,$scope.loginError=!1;var opts={};opts={reqObj:{client_id:APP.keys.client_id,client_secret:APP.keys.client_secret,grant_type:APP.keys.grant_type,username:$scope.user.userName,password:$scope.user.password}},UserService.getAccessToken(opts).then(function(data){APP.accessToken=data.data.access_token;var postData={reqObj:{username:$scope.user.userName,password:$scope.user.password}};$http({method:"POST",url:APP.service.logins+"?access_token="+data.data.access_token,data:postData,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(data,header){if(data.data&&100!=data.code){APP.currentUser=data.data,ipCookie("loggedInUser",data.data,{expires:365}),ipCookie("access_token",APP.accessToken,{expires:3e3}),$rootScope.currentUser=data.data,$rootScope.isLoggedIn=!0,$scope.selectlanguage(APP.currentUser.current_language);var opts3={};opts3.user_id=APP.currentUser.id,opts3.profile_type=4,UserService.getBasicProfile(opts3,function(data){101==data.code&&($rootScope.currentUser.basicProfile=data.data);var opts4={};opts4.idcard=$rootScope.currentUser.basicProfile.user_id,UserService.getCreditAndIncome(opts4,function(data){if(101==data.code){var currentCredit={};currentCredit.totalCredit=data.data.saldoc/1e6,currentCredit.totCreditMicro=data.data.saldorm+data.data.saldorc,currentCredit.totalIncome=data.data.tot_income,currentCredit.totalIncomeShow=data.data.saldorm+data.data.saldorc,$rootScope.currentUser.creditAndIncome=currentCredit}})}),$scope.$parent.loggedIn=!0,$location.path("/shop/register/payment")}else $scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username}).error(function(data,status,header){$scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username})},function(error){"invalid_grant"===error.error?($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.invalid_username):($scope.loginError=!0,$scope.loginStart=!1,$scope.loginErrorMsg=$scope.i18n.home.server_not_responding)})},$scope.brokerloader=!1,$scope.regisMessageClass="",$scope.registerMultiProfile=function(){var opts={};if(opts.user_id=$routeParams.userId,opts.phone=$scope.user.phone,opts.iban=$scope.user.iban,opts.type=$routeParams.typeId,opts.referral_id=$rootScope.referral_id,3==opts.type){if(void 0==$scope.user.name||""==$scope.user.name)return $scope.brokerMsg=$scope.i18n.register.enter_storename,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.business_name||""==$scope.user.business_name)return $scope.brokerMsg=$scope.i18n.register.enter_businessname,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.business_type||""==$scope.user.business_type)return $scope.brokerMsg=$scope.i18n.register.enter_businesstype,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.legal_status||""==$scope.user.legal_status)return $scope.brokerMsg=$scope.i18n.register.enter_businesstatus,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.phone||""==$scope.user.phone||1==isNaN($scope.user.phone))return $scope.brokerMsg=$scope.i18n.register.enter_businessnumber,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.email||""==$scope.user.email)return $scope.brokerMsg=$scope.i18n.register.enter_businessemail,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.country||void 0==$scope.user.country.id||""==$scope.user.country.id)return $scope.brokerMsg=$scope.i18n.register.enter_businesscountry,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.business_region||""==$scope.user.business_region)return $scope.brokerMsg=$scope.i18n.register.enter_businessregion,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.business_city||""==$scope.user.business_city)return $scope.brokerMsg=$scope.i18n.register.enter_businesscity,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.business_address||""==$scope.user.business_address)return $scope.brokerMsg=$scope.i18n.validation.enter_businessaddress,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.zip||""==$scope.user.zip||$scope.user.zip.length<5||$scope.user.zip.length>5)return $scope.brokerMsg=$scope.i18n.register.enter_businesszip,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.province||""==$scope.user.province)return $scope.brokerMsg=$scope.i18n.register.enter_businessprovince,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if($scope.user.province.length<2||$scope.user.province.length>2)return $scope.brokerMsg=$scope.i18n.validation.province_length,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.vat_number||""==$scope.user.vat_number)return $scope.brokerMsg=$scope.i18n.register.enter_businessvat,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.iban||""==$scope.user.iban)return $scope.brokerMsg=$scope.i18n.register.enter_businessiban,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.description||""==$scope.user.description)return $scope.brokerMsg=$scope.i18n.register.enter_businessdesc,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==document.getElementById("lat").value||""==document.getElementById("lat").value)return $scope.brokerMsg=$scope.i18n.register.enter_businesslat,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==document.getElementById("lon").value||""==document.getElementById("lon").value)return $scope.brokerMsg=$scope.i18n.register.enter_businesslog,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value)return $scope.brokerMsg=$scope.i18n.register.enter_businessmap,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;opts.email=$scope.user.email,opts.description=$scope.user.description,opts.name=$scope.user.name,opts.business_name=$scope.user.business_name,opts.legal_status=$scope.user.legal_status,opts.business_type=$scope.user.business_type,opts.business_country=$scope.user.country.id,opts.business_region=$scope.user.business_region,opts.business_city=$scope.user.business_city,opts.business_address=$scope.user.business_address,opts.zip=$scope.user.zip,opts.province=$scope.user.province,opts.vat_number=$scope.user.vat_number,opts.call_type=1}else{if(void 0==$scope.user.phone||""==$scope.user.phone||1==isNaN($scope.user.phone))return $scope.brokerMsg=$scope.i18n.broker.enter_brokernumber,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.fiscal||""==$scope.user.fiscal)return $scope.brokerMsg=$scope.i18n.broker.enter_brokerfiscal,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==$scope.user.iban||""==$scope.user.iban)return $scope.brokerMsg=$scope.i18n.broker.enter_brokeriban,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==document.getElementById("lat").value||""==document.getElementById("lat").value)return $scope.brokerMsg=$scope.i18n.register.enter_businesslat,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==document.getElementById("lon").value||""==document.getElementById("lon").value)return $scope.brokerMsg=$scope.i18n.register.enter_businesslog,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value)return $scope.brokerMsg=$scope.i18n.register.enter_businessmap,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;if(""==$scope.user.terms||void 0==$scope.user.terms||0==$scope.user.terms||""==$scope.user.terms)return $scope.brokerMsg=$scope.i18n.register.terms_condition_agree,$scope.regisMessageClass="text-red fl",$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3),!1;opts.vat_number=$scope.user.vat,opts.fiscal_code=$scope.user.fiscal,opts.call_type=1}opts.latitude=document.getElementById("lat").value,opts.longitude=document.getElementById("lon").value,opts.map_place=document.getElementById("mapplace").value,$scope.brokerloader=!0,$scope.brokerMsg="",UserService.registerMultiProfile(opts,function(data){101==data.code?($scope.brokerMsg=data.message,$scope.regisMessageClass="text-success fl",$rootScope.tempStoreId=data.data.store_id,$rootScope.tempUserId=$routeParams.userId,$cookieStore.put("tempStoreId",data.data.store_id),$cookieStore.put("tempUserId",$routeParams.userId),$scope.user.userName=saveUserPass.getUsername(),$scope.user.password=saveUserPass.getPassword(),saveUserPass.clearUserPass(),3==opts.type?$scope.getShopPaymentLogin():$scope.getLogin()):137==data.code?($scope.brokerMsg=$scope.i18n.validation.broker_not_exists,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):111==data.code?($scope.brokerMsg=$scope.i18n.validation.user_id_required,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):132==data.code?($scope.brokerMsg=$scope.i18n.validation.invalid_profile_type,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):133==data.code?($scope.brokerMsg=$scope.i18n.validation.user_not_exists,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):143==data.code?($scope.brokerMsg=$scope.i18n.validation.referral_id_needed,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):165==data.code?($scope.brokerMsg=$scope.i18n.validation.vat_valid,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):166==data.code?($scope.brokerMsg=$scope.i18n.validation.iban_valid,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):138==data.code?($scope.brokerMsg=$scope.i18n.validation.vat_exists,$scope.brokerloader=!1,$scope.regisMessageClass="text-red fl"):($scope.brokerloader=!1,$scope.brokerMsg=data.message,$scope.regisMessageClass="text-red fl"),$timeout(function(){$scope.brokerMsg="",$scope.regisMessageClass=""},15e3)})},$scope.cancelForgotPassword=function(){$location.path("/")},$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:13},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("lat").value=countryPlace.geometry.location.k,document.getElementById("lon").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},angular.element("#map-canvas").ready(function(){-1!=$location.path().indexOf("/storeProfilestep")&&$timeout(function(){$scope.initialize()},2e3)}),$scope.rememberMe=function(){null!==$remember("username")&&null!==$remember("password")&&""!==$remember("username")&&""!==$remember("password")&&($scope.user.remember=!0,$scope.user.userName=$remember("username"),$scope.user.password=$remember("password"))}}]),app.controller("CreateBrokerController",["$scope","$location","$timeout","CreateBrokerService","ProfileImageService",function($scope,$location,$timeout,CreateBrokerService,ProfileImageService){$scope.createBroker=function(){if(void 0==$scope.user.phone||""==$scope.user.phone)return $scope.brokerMsg=$scope.i18n.broker.enter_brokernumber,$timeout(function(){$scope.brokerMsg=""},4e3),!1;if(void 0==$scope.user.vat||""==$scope.user.vat)return $scope.brokerMsg=$scope.i18n.broker.enter_brokervat,$timeout(function(){$scope.brokerMsg=""},4e3),!1;if(void 0==$scope.user.fiscal||""==$scope.user.fiscal)return $scope.brokerMsg=$scope.i18n.broker.enter_brokerfiscal,$timeout(function(){$scope.brokerMsg=""},4e3),!1;if(void 0==$scope.user.iban||""==$scope.user.iban)return $scope.brokerMsg=$scope.i18n.broker.enter_brokeriban,$timeout(function(){$scope.brokerMsg=""},4e3),!1;if(void 0==$scope.user.referral_id||""==$scope.user.referral_id)return $scope.brokerMsg=$scope.i18n.broker.enter_brokerrefferal,$timeout(function(){$scope.brokerMsg=""},4e3),!1;if(void 0==document.getElementById("mapplace").value||""==document.getElementById("mapplace").value)return $scope.brokerMsg=$scope.i18n.broker.enter_brokermapplace,$timeout(function(){$scope.brokerMsg=""},4e3),!1;if(void 0==document.getElementById("lon").value||""==document.getElementById("lon").value)return $scope.brokerMsg=$scope.i18n.broker.enter_brokerlog,$timeout(function(){$scope.brokerMsg=""},4e3),!1;if(void 0==document.getElementById("lat").value||""==document.getElementById("lat").value)return $scope.brokerMsg=$scope.i18n.broker.enter_brokerlat,$timeout(function(){$scope.brokerMsg=""},4e3),!1;$scope.brokerloader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.phone=$scope.user.phone,opts.vat_number=$scope.user.vat,opts.fiscal_code=$scope.user.fiscal,opts.iban=$scope.user.iban,opts.referral_id=$scope.user.referral_id,opts.map_place=document.getElementById("mapplace").value,opts.latitude=document.getElementById("lat").value,opts.longitude=document.getElementById("lon").value,opts.type=2,opts.call_type=2,CreateBrokerService.createBroker(opts,function(data){101==data.code?($scope.brokerloader=!1,$scope.brokerMsg=$scope.i18n.broker.broker_success,$scope.viewmultiprofiles(),$timeout(function(){$scope.brokerMsg="",$location.path("/profile")},2e3)):137==data.code?($scope.brokerloader=!1,$scope.brokerMsgerror=$scope.i18n.validation.broker_not_exists,$timeout(function(){$scope.brokerMsgerror=""},4e3)):($scope.brokerloader=!1,$scope.brokerMsgerror=data.message,$timeout(function(){$scope.brokerMsgerror=""},4e3))})},$scope.viewmultiprofiles=function(){$scope.albloader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.profile_type=4,ProfileImageService.viewmultiprofiles(opts,function(data){101==data.code?($scope.albloader=!1,$scope.picloader=!1,$scope.propic=!0,$rootScope.currentUser.basicProfile=data.data):($scope.propic=!0,$scope.picloader=!1)})},$scope.initialize=function(){function setupClickListener(id,types){document.getElementById(id)}var mapOptions={center:new google.maps.LatLng(-33.8688,151.2195),zoom:13},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),input=document.getElementById("pac-input"),types=document.getElementById("type-selector");

map.controls[google.maps.ControlPosition.TOP_LEFT].push(input),map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo("bounds",map);var infowindow=new google.maps.InfoWindow,marker=new google.maps.Marker({map:map,anchorPoint:new google.maps.Point(0,-29)});google.maps.event.addListener(autocomplete,"place_changed",function(){infowindow.close(),marker.setVisible(!1);var place=autocomplete.getPlace();if(place.geometry){var countryPlace=autocomplete.getPlace();document.getElementById("lat").value=countryPlace.geometry.location.k,document.getElementById("lon").value=countryPlace.geometry.location.D,document.getElementById("mapplace").value=countryPlace.formatted_address,place.geometry.viewport?map.fitBounds(place.geometry.viewport):(map.setCenter(place.geometry.location),map.setZoom(17)),marker.setIcon({url:place.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)}),marker.setPosition(place.geometry.location),marker.setVisible(!0);var address="";place.address_components&&(address=[place.address_components[0]&&place.address_components[0].short_name||"",place.address_components[1]&&place.address_components[1].short_name||"",place.address_components[2]&&place.address_components[2].short_name||""].join(" ")),infowindow.setContent("<div><strong>"+place.name+"</strong><br>"+address),infowindow.open(map,marker)}}),setupClickListener("changetype-all",[]),setupClickListener("changetype-establishment",["establishment"]),setupClickListener("changetype-geocode",["geocode"])},$timeout(function(){$scope.initialize()},1e3)}]),app.controller("MessageNotifiController",["$cookieStore","$rootScope","$scope","$http","$location","$timeout","$interval","ProfileService","UserService","threadAndPass",function($cookieStore,$rootScope,$scope,$http,$location,$timeout,$interval,ProfileService,UserService,threadAndPass){$rootScope.showNewMessageList=!1,$scope.newMessageShow=!1,$scope.messageNoti=[],$scope.cancelUnreadRequest=0,$scope.loadingUnreadMssage=!1,$scope.count=0,$scope.noMesasge=!0,$scope.scopeVar1=!1,$rootScope.listUnReadMessages=function(){$scope.newMessageShow=!1,$scope.loadingUnreadMssage=!0;var opts={};opts.user_id=APP.currentUser.id,opts.is_view="1",opts.limit_start="0",opts.limit_size="10",ProfileService.listUnReadMessages(opts,function(data){if(101==data.code){$scope.cancelUnreadRequest=1,$scope.messageNoti=data.data,$scope.newMessageShow=!0,$scope.loadingUnreadMssage=!1;var count=$scope.messageNoti.length;count>0?$scope.count=count:$scope.noMesasge=!1}else $scope.newMessageShow=!0,$scope.loadingUnreadMssage=!1;$rootScope.getCountOfAllTypeNotificaton()})},$scope.blockUiClick=function(even){if("IMG"!==even.target.nodeName){var temp=$rootScope.toggleSearch;$rootScope.toggleSearch=null,setTimeout(function(){$rootScope.toggleSearch=temp},100)}},$scope.showAllMessage=function($event){void 0!=$event&&$event.stopPropagation();var temp=$rootScope.toggleSearch;$rootScope.toggleSearch=null,setTimeout(function(){$rootScope.toggleSearch=temp},100),$rootScope.groupNotificationList=!1,$rootScope.showNotificationList=!1,$rootScope.showFriendNotificationList=!1,$rootScope.loadGroupNotification=!1,$rootScope.showNewMessageList=!$rootScope.showNewMessageList,$scope.scopeVar1=!$scope.scopeVar1,$scope.scopeVar2=!1,$scope.scopeVar=!1,$scope.scopeVar3=!1,$scope.scopeVar1?$rootScope.listUnReadMessages():$rootScope.getCountOfAllTypeNotificaton()},$scope.NotificationMessageOut=function(){$rootScope.showNewMessageList=!1,$scope.scopeVar1=!1},$scope.closeDrop=function(){$rootScope.showNewMessageList=!$rootScope.showNewMessageList},$scope.markReadAllMessages=function(){var opts={};opts.user_id=APP.currentUser.id,MessageService.markReadAllMessages(opts,function(data){100==data.code&&($scope.newMessageShow=!1)})},$scope.readMessage=function(threadId){var opts={};opts.session_id=APP.currentUser.id,opts.thread_id=threadId,ProfileService.readMessage(opts,function(data){101==data.code})},$scope.storeThreadAndFriendId=function(threadId,friendId){threadAndPass.saveThreadAndFriend(threadId,friendId)}}]),app.controller("SkillController",["$cookieStore","$rootScope","ipCookie","$scope","ProfileService",function($cookieStore,$rootScope,ipCookie,$scope,ProfileService){$scope.loadSkill=!0,$scope.getSkills=function(){var opts={};opts.user_id=APP.currentUser.id,ProfileService.getUserSkills(opts,function(data){$scope.loadSkill=!1,101===data.code&&"SUCCESS"===data.message&&data.data.skills.skills.length>0&&($scope.storeSkills=data.data.skills.skills.split(","))})},$scope.getSkills()}]),app.controller("userWalletController",["$rootScope","$scope","$http","UserWalletService","$location","$timeout","$interval","$routeParams","storeHistorySelection",function($rootScope,$scope,$http,UserWalletService,$location,$timeout,$interval,$routeParams,storeHistorySelection){$scope.oneAtATime=!0,$scope.isLoadingWallet=!0,$scope.isLoadPcard=!1,$scope.isLoadMcard=!1,$scope.isLoadShot=!1,$scope.noPcard=!1,$scope.noMcard=!1,$scope.noShot=!1,$scope.userId=APP.currentUser.id,$scope.status={isFirstOpen:!1,isFirstDisabled:!1},1==storeHistorySelection.getStoreage()?($scope.tabChoose="history",storeHistorySelection.clearStorage()):$scope.tabChoose="credits",$scope.walletDetails={},$scope.pcardRes=1,$scope.shotsRes=1,$scope.mcardRes=1,$scope.pcardTotal=0,$scope.shotTotal=0,$scope.mcardTotal=0,$scope.getCitizenWallet=function(){var opts={};opts.user_id=$scope.userId,opts.shots_needed=APP.citizenWallet.shots_needed,opts.purchase_card_needed=APP.citizenWallet.purchase_card_needed,opts.momosy_card_needed=APP.citizenWallet.momosy_card_needed,opts.total_credit_available_needed=APP.citizenWallet.total_credit_available_needed,opts.total_citizen_income_needed=APP.citizenWallet.total_citizen_income_needed,opts.discount_position_needed=APP.citizenWallet.discount_position_needed,opts.purchase_card_limit_start=APP.citizenWallet.purchase_card_limit_start,opts.purchase_card_limit_size=APP.citizenWallet.purchase_card_limit_size,opts.shots_card_limit_start=APP.citizenWallet.shots_card_limit_start,opts.shots_card_limit_size=APP.citizenWallet.shots_card_limit_size,opts.momosy_card_limit_start=APP.citizenWallet.momosy_card_limit_start,opts.momosy_card_limit_size=APP.citizenWallet.momosy_card_limit_size,UserWalletService.getCitizenWallet(opts,function(data){$scope.isLoadingWallet=!1,101==data.code?($scope.walletDetails=data.data,$scope.pcardTotal=data.data.purchase_cards.total,$scope.shotTotal=data.data.shots.total,$scope.mcardTotal=data.data.momosy_cards.total,0==$scope.walletDetails.purchase_cards.purchase_card.length&&($scope.noPcard=!0),0==$scope.walletDetails.shots.shot.length&&($scope.noShot=!0),0==$scope.walletDetails.momosy_cards.momosy_card.length&&($scope.noMcard=!0)):$scope.walletDetails=[]})},$scope.getCitizenWallet(),$scope.loadMorePurchaseCard=function(){var opts={};opts.user_id=$scope.userId,opts.shots_needed=0,opts.purchase_card_needed=APP.citizenWallet.purchase_card_needed,opts.momosy_card_needed=0,opts.total_credit_available_needed=0,opts.total_citizen_income_needed=0,opts.discount_position_needed=0,opts.purchase_card_limit_start=$scope.walletDetails.purchase_cards.purchase_card.length,opts.purchase_card_limit_size=APP.citizenWallet.purchase_card_limit_size,opts.shots_card_limit_start=APP.citizenWallet.shots_card_limit_start,opts.shots_card_limit_size=APP.citizenWallet.shots_card_limit_size,opts.momosy_card_limit_start=APP.citizenWallet.momosy_card_limit_start,opts.momosy_card_limit_size=APP.citizenWallet.momosy_card_limit_size,1==$scope.pcardRes&&$scope.pcardTotal>$scope.walletDetails.purchase_cards.purchase_card.length&&($scope.pcardRes=0,$scope.isLoadPcard=!0,UserWalletService.getCitizenWallet(opts,function(data){$scope.pcardRes=1,$scope.isLoadPcard=!1,101==data.code&&($scope.walletDetails.purchase_cards.purchase_card=$scope.walletDetails.purchase_cards.purchase_card.concat(data.data.purchase_cards.purchase_card),$scope.pcardTotal=data.data.purchase_cards.total)}))},$scope.loadMoreShots=function(){var opts={};opts.user_id=$scope.userId,opts.shots_needed=APP.citizenWallet.shots_needed,opts.purchase_card_needed=0,opts.momosy_card_needed=0,opts.total_credit_available_needed=0,opts.total_citizen_income_needed=0,opts.discount_position_needed=0,opts.purchase_card_limit_start=APP.citizenWallet.purchase_card_limit_start,opts.purchase_card_limit_size=APP.citizenWallet.purchase_card_limit_size,opts.shots_card_limit_start=$scope.walletDetails.shots.shot.length,opts.shots_card_limit_size=APP.citizenWallet.shots_card_limit_size,opts.momosy_card_limit_start=APP.citizenWallet.momosy_card_limit_start,opts.momosy_card_limit_size=APP.citizenWallet.momosy_card_limit_size,1==$scope.shotsRes&&$scope.shotTotal>$scope.walletDetails.shots.shot.length&&($scope.shotsRes=0,$scope.isLoadShot=!0,UserWalletService.getCitizenWallet(opts,function(data){$scope.shotsRes=1,$scope.isLoadShot=!1,101==data.code&&($scope.walletDetails.shots.shot=$scope.walletDetails.shots.shot.concat(data.data.shots.shot),$scope.shotTotal=data.data.shots.total)}))},$scope.loadMoreMomosyCard=function(){var opts={};opts.user_id=$scope.userId,opts.shots_needed=0,opts.purchase_card_needed=0,opts.momosy_card_needed=APP.citizenWallet.momosy_card_needed,opts.total_credit_available_needed=0,opts.total_citizen_income_needed=0,opts.discount_position_needed=0,opts.purchase_card_limit_start=APP.citizenWallet.purchase_card_limit_start,opts.purchase_card_limit_size=APP.citizenWallet.purchase_card_limit_size,opts.shots_card_limit_start=APP.citizenWallet.shots_card_limit_start,opts.shots_card_limit_size=APP.citizenWallet.shots_card_limit_size,opts.momosy_card_limit_start=$scope.walletDetails.momosy_cards.momosy_card.length,opts.momosy_card_limit_size=APP.citizenWallet.momosy_card_limit_size,1==$scope.mcardRes&&$scope.mcardTotal>$scope.walletDetails.momosy_cards.momosy_card.length&&($scope.mcardRes=0,$scope.isLoadMcard=!0,UserWalletService.getCitizenWallet(opts,function(data){$scope.mcardRes=1,$scope.isLoadMcard=!1,101==data.code&&($scope.walletDetails.momosy_cards.momosy_card=$scope.walletDetails.momosy_cards.momosy_card.concat(data.data.momosy_cards.momosy_card),$scope.mcardTotal=data.data.momosy_cards.total)}))},$scope.firstPage=APP.citizenWallet.limit_start,$scope.itemsPerPage=APP.citizenWallet.limit_size,$scope.currentPage=1,$scope.range=[],$scope.pagevalue="",$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.citizenIncome()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.citizenIncome()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.citizenIncome()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.setPage=function(number){$scope.itemsPerPage=number,$scope.currentPage=1,$scope.citizenIncome()},$scope.citizenIncome=function(){var limit_start=($scope.currentPage-1)*$scope.itemsPerPage,opts={};opts.user_id=$scope.userId,opts.limit_start=limit_start,opts.limit_size=$scope.itemsPerPage,UserWalletService.getCitizenIncomes(opts,function(data){if($scope.isLoadingWallet=!1,101==data.code){$scope.incomeDetails=data.data.citizen_income,$scope.totalItems=Math.ceil(data.data.total/$scope.itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}else $scope.incomeDetails=[]})},$scope.citizenIncome()}]),app.controller("VerifyController",["$location","$scope","UserService","$modalStack",function($location,$scope,UserService,$modalStack){TrailExpiredModal=!1,$scope.verfiyLoader=!0,$scope.error=!1,$scope.message="",$scope.resend=!1,$scope.verify=function(){var queryParam=$location.search(),opts=new Object;opts.verify_token=void 0===queryParam.token?"":queryParam.token,opts.user_email=void 0===queryParam.email?"":queryParam.email,UserService.verifyAccount(opts,function(data){$scope.verfiyLoader=!1,$scope.error=!0,101===data.code?($scope.error=!1,$scope.message=$scope.i18n.verify_user.success1):1003===data.code?$scope.message=$scope.i18n.verify_user.error2:1035===data.code?$scope.message=$scope.i18n.verify_user.error1:1047===data.code||1001==data.code?$scope.message=$scope.i18n.verify_user.error3:1048===data.code?($scope.message=$scope.i18n.verify_user.error4,$scope.resend=!0):($scope.message=$scope.i18n.verify_user.success,$scope.error=!1)})},$scope.verify()}]),app.controller("VerifyModal",["$scope","$modalInstance",function($scope,$modalInstance){$scope.closeModal=function(){TrailExpiredModal=!0,$modalInstance.dismiss("cancel")}}]),app.controller("ResendLink",["$scope","UserService","$timeout",function($scope,UserService,$timeout){$scope.Resendlink=function(){var formData={};return""===$scope.email||void 0===$scope.email?($scope.emailmessage=$scope.i18n.store.enter_storeemail,$scope.hasemailerror=!0,$timeout(function(){$scope.emailmessage=""},1e4),!1):($scope.isLoading=!0,$scope.message="",$scope.emailmessage="",$scope.hasemailerror=!1,formData.email=$scope.email,UserService.resendverificationmail(formData,function(data){$scope.isLoading=!1,$scope.hasemailerror=!1,101==data.code?($scope.msgcls="text-success text-center",$scope.message=$scope.i18n.validation.email_sent):1021==data.code?($scope.message=$scope.i18n.validation.user_not_exists,$scope.msgcls="text-red text-center"):1035==data.code?($scope.message=$scope.i18n.validation.error_occured,$scope.msgcls="text-red text-center"):1046==data.code?($scope.message=$scope.i18n.verify_user.success,$scope.msgcls="text-success text-center"):1047==data.code?($scope.message=$scope.i18n.verify_user.error4,$scope.msgcls="text-red text-center"):($scope.message=$scope.i18n.verify_user.error1,$scope.msgcls="text-red text-center")}),void $timeout(function(){$scope.message="",$scope.msgcls="",$scope.email=""},1e4))}}]),app.directive("allImgModal",["$timeout","$location",function($timeout,$location){return{restrict:"A",scope:!0,controller:function($scope,$modal,$log,ProfileService,AlbumService,$routeParams){$scope.createModal=function(index,viewalbum,leng,mainId,type,userdetails){$scope.parent_id=mainId,$scope.parent_type=type,$scope.media_index=index,$scope.leng=leng,$scope.pre_visible=!0,$scope.next_visible=!0,$scope.modal_loader=!1,$scope.friendTagIndex=0,$scope.tagged_Friends=[],$scope.UpdateTag=!1,$scope.TagLoader=!1,$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.dublicate=!1,$scope.toBelong=!1,$scope.tagged_collection=[],$scope.untagg_friend={},$scope.choose=!1,$scope.viewalbum&&0==$scope.viewalbum.length&&($scope.viewalbum=viewalbum),$scope.viewalbum||($scope.viewalbum=viewalbum),0===index&&($scope.pre_visible=!1),leng-1===index&&($scope.next_visible=!1),$scope.tagged_friends_arry=function(index){$scope.tagged_Friends=[],void 0===$scope.tagged_collection[index]?(angular.forEach($scope.viewalbum[index].tagged_friends_info,function(obj){obj.user_id=obj.id,obj.user_info={},obj.user_info.first_name=obj.first_name,obj.user_info.last_name=obj.last_name,$scope.tagged_Friends.push(obj)}),$scope.tagged_collection[index]=$scope.tagged_Friends):$scope.tagged_Friends=$scope.tagged_collection[index],$scope.untagg_friend=JSON.parse(JSON.stringify($scope.tagged_Friends))},$scope.putFocus=function(){document.getElementById("searchTagFriend").focus()},"dashboard_post"===$scope.parent_type?($scope.media_id=viewalbum[index].id,$scope.img_src=$scope.viewalbum[index].media_link,$scope.img_date=$scope.viewalbum[index].create_date.date,$scope.user_id=userdetails.id,$scope.user_profile_image_thumb=userdetails.profile_image_thumb,$scope.user_name=userdetails.first_name+" "+userdetails.last_name):("user_profile_album_photo"===$scope.parent_type||"club_album_photo"===$scope.parent_type||"store_media"===$scope.parent_type||"friend_album"===$scope.parent_type||"friend_tagged_photos"===$scope.parent_type||"user_tagged_photos"===$scope.parent_type||"shop_post"===$scope.parent_type||"club_post"===$scope.parent_type)&&($scope.media_id=$scope.viewalbum[index].id,$scope.img_src=$scope.viewalbum[index].media_path,$scope.user_id=APP.currentUser.id,$scope.user_profile_image_thumb=APP.currentUser.profile_img_thumb,$scope.user_name=APP.currentUser.firstname+" "+APP.currentUser.lastname,"club_album_photo"===$scope.parent_type?($scope.img_date="",$scope.is_member=userdetails.is_member):"user_profile_album_photo"===$scope.parent_type?($scope.tagged_friends_arry(index),$scope.img_date=userdetails[0].created_at.date):"store_media"===$scope.parent_type?$scope.img_date=$scope.viewalbum[index].create_on.date:$scope.img_date="",("friend_tagged_photos"===$scope.parent_type||"user_tagged_photos"===$scope.parent_type)&&($scope.index=index,$scope.toBelong=!0,$routeParams.id&&$scope.viewalbum[index].creater_id?$scope.toBelong=void 0:$scope.toBelong=!0,$scope.viewalbum[index].creater_id===APP.currentUser.id&&($scope.toBelong=!0)));var modalInstance=$modal.open({templateUrl:"app/views/img_modal.html",controller:"ModalController",backdrop:"static","static":!0,size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date),$scope.tagged_Friends=[],$scope.UpdateTag=!1}),$scope.untagg=function(type){$scope.modal_loader=!0;var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=$routeParams.id?$routeParams.id:APP.currentUser.id,opts.media_id=$scope.viewalbum[$scope.index].id,AlbumService.removeTaggedPhoto(opts,function(data){if(101===data.code){modalInstance.close();var tempIndex=$scope.tagged_photo.indexOf($scope.viewalbum[$scope.index]);$scope.tagged_photo.splice(tempIndex,1),0==$scope.tagged_photo.length&&($scope.album=!0,$scope.photo_of_you=!1,$("#taggedPhoto").addClass("ng-hide"),$("#albumColl").removeClass("ng-hide"))}else $scope.modal_loader=!1})},$scope.change_image=function(index,viewablum,leng,id,type,changetype){$scope.pre_visible=!0,$scope.modal_loader=!0,$scope.next_visible=!0,$scope.img_src="",$scope.media_index="pre"==changetype?index-1:index+1,0===$scope.media_index&&($scope.pre_visible=!1),leng-1===$scope.media_index&&($scope.next_visible=!1),"dashboard_post"===$scope.parent_type?($scope.media_id=$scope.viewalbum[$scope.media_index].id,$scope.img_src=$scope.viewalbum[$scope.media_index].media_link,$scope.img_date=$scope.viewalbum[$scope.media_index].create_date.date):("user_profile_album_photo"===$scope.parent_type||"club_album_photo"===$scope.parent_type||"store_media"===$scope.parent_type||"friend_album"===$scope.parent_type||"friend_tagged_photos"===$scope.parent_type||"user_tagged_photos"===$scope.parent_type||"shop_post"===$scope.parent_type||"club_post"===$scope.parent_type)&&($scope.media_id=$scope.viewalbum[$scope.media_index].id,$scope.img_src=$scope.viewalbum[$scope.media_index].media_path,$scope.user_id=APP.currentUser.id,$scope.user_profile_image_thumb=APP.currentUser.profile_img_thumb,$scope.user_name=APP.currentUser.firstname+" "+APP.currentUser.lastname,"user_profile_album_photo"===$scope.parent_type&&($scope.img_date=userdetails[0].created_at.date,$scope.tagged_friends_arry($scope.media_index)),("friend_tagged_photos"===$scope.parent_type||"user_tagged_photos"===$scope.parent_type)&&($scope.toBelong=!0,$routeParams.id&&$scope.viewalbum[$scope.media_index].creater_id?$scope.toBelong=void 0:$scope.toBelong=!0,$scope.viewalbum[$scope.media_index].creater_id===APP.currentUser.id&&($scope.toBelong=!0))),$timeout(function(){$scope.modal_loader=!1},1e3)},$scope.tagFriendSuggestion=function(event,friendname){if(40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex+1!==$scope.friends.length&&$scope.friendTagIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex-1!==-1&&$scope.friendTagIndex--):13===event.keyCode&&$scope.friends.length>0&&-1!==$scope.friendTagIndex&&$scope.selectFriend($scope.friends[$scope.friendTagIndex]),""===$("#searchTagFriend").val().trim()&&($scope.showFriendList=!1),event.keyCode>=65&&event.keyCode<=95){$scope.cancelFriendSearch=!1;var opts={};opts.user_id=APP.currentUser.id,friendname?opts.friend_name=friendname:opts.friend_name="",opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&(data.data.users.length>0?$scope.showFriendList=!0:$scope.showFriendList=!1,$scope.friends=data.data.users)})}},$scope.Tagtoggle=function(){$scope.UpdateTag=!$scope.UpdateTag},$scope.taggService=function(){var pre_visible_status=$scope.pre_visible,next_visible_status=$scope.next_visible;$scope.pre_visible=!1,$scope.next_visible=!1;var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.parent_id,opts.post_type=1,opts.media_id=[$scope.media_id];var frnd_array=[];if(angular.forEach($scope.tagged_Friends,function(index){frnd_array.push(index.user_id)}),opts.tagged_friends=frnd_array.join(","),$scope.UpdateTag=!1,$scope.TagLoader=!0,$scope.tagged_Friends.length>0)AlbumService.photoTaging(opts,function(data){101===data.code&&($scope.choose=!0,$scope.TagLoader=!1,angular.forEach($scope.tagged_Friends,function(obj){obj.first_name||(obj.first_name=obj.user_info.first_name),obj.last_name||(obj.last_name=obj.user_info.last_name)}),$scope.untagg_friend=JSON.parse(JSON.stringify($scope.tagged_Friends))),$scope.pre_visible=pre_visible_status,$scope.next_visible=next_visible_status,$scope.viewalbum[$scope.media_index].tagged_friends_info=$scope.untagg_friend});else if($scope.untagg_friend.length>0){var friend_id=[];angular.forEach($scope.untagg_friend,function(friend){id_on=friend.id?friend.id:friend.user_info.id,friend_id.push(id_on)});var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=friend_id.join(","),opts.media_id=$scope.media_id,AlbumService.removeTaggedPhoto(opts,function(data){101===data.code&&($scope.viewalbum[$scope.media_index].tagged_friends_info=$scope.untagg_friend)}),$scope.untagg_friend=[],$scope.TagLoader=!1,$scope.pre_visible=pre_visible_status,$scope.next_visible=next_visible_status}else $scope.TagLoader=!1,$scope.pre_visible=pre_visible_status,$scope.next_visible=next_visible_status},$scope.selectFriend=function(friendInfo){$scope.dublicate=!1,$scope.choose=!1,angular.forEach($scope.tagged_Friends,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.tagged_Friends.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1)},$scope.lostFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.removeTagFriend=function(friendIndex){$scope.tagged_Friends.splice(friendIndex,1),0===$scope.tagged_Friends.length&&($scope.choose=!0)},$scope.getFile=function(){},$scope.removeImage=function(index){},$scope.addComment=function(){},$scope.rateThisAlbum=function(rating,album_id,type){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="club_album",opts.type_id=album_id,opts.rate=rating,update=$scope.albumDetails.is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.albumDetails.avg_rate=data.data.avg_rate,$scope.albumDetails.no_of_votes=data.data.no_of_votes,$scope.albumDetails.is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.albumDetails.current_user_rate=0,$scope.albumDetails.is_rated=!0),$scope.waitRateResponse=!1})},$scope.waitRateResponse=!1,$scope.ratePicture=function(rating,picture_id,mediaIndex){var update="",opts={};opts.user_id=APP.currentUser.id,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,opts.type_id=picture_id,opts.rate=rating,update=$scope.viewalbum[mediaIndex].is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.viewalbum[mediaIndex].avg_rate=data.data.avg_rate,$scope.viewalbum[mediaIndex].no_of_votes=data.data.no_of_votes,$scope.viewalbum[mediaIndex].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.viewalbum[mediaIndex].current_user_rate=0,$scope.viewalbum[mediaIndex].is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeRating=function(pictureIndex,mediaIndex){var opts={};opts.user_id=APP.currentUser.id,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,opts.type_id=pictureIndex,$scope.waitRateResponse===!1&&($scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.viewalbum[mediaIndex].current_user_rate=0,$scope.viewalbum[mediaIndex].avg_rate=data.data.avg_rate,$scope.viewalbum[mediaIndex].no_of_votes=data.data.no_of_votes,$scope.viewalbum[mediaIndex].is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.viewalbum[mediaIndex].current_user_rate=0,$scope.viewalbum[mediaIndex].is_rated=!1),$scope.waitRateResponse=!1}))},$scope.findPeopleRate=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.viewUserProfile=function(friendId){friendId==APP.currentUser.id?(modalInstance.dismiss("cancel"),$location.path("profiles")):(modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId))},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]}}}}]),app.directive("rateMe",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/rating_star_comment.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hovering=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.findPeopleRate=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.rateComment=function(rating,comment_id,postIndex,commentIndex){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post_comment",opts.type_id=comment_id,opts.rate=rating,update=$scope.userPostList[postIndex].comments[commentIndex].is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.userPostList[postIndex].comments[commentIndex].avg_rate=data.data.avg_rate,$scope.userPostList[postIndex].comments[commentIndex].no_of_votes=data.data.no_of_votes,$scope.userPostList[postIndex].comments[commentIndex].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[postIndex].comments[commentIndex].current_user_rate=0,$scope.userPostList[postIndex].comments[commentIndex].is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeCommentRating=function(comment_id,postIndx,indx){var opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post_comment",opts.type_id=comment_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.userPostList[postIndx].comments[indx].current_user_rate=0,$scope.userPostList[postIndx].comments[indx].avg_rate=data.data.avg_rate,$scope.userPostList[postIndx].comments[indx].no_of_votes=data.data.no_of_votes,$scope.userPostList[postIndx].comments[indx].is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[postIndx].comments[indx].current_user_rate=0,$scope.userPostList[postIndx].comments[indx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]),app.directive("rateAlbumDir",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/rating_star_album.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hovering=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.findPeopleRate=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.rateThisAlbum=function(rating,album_id,type){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type=type,opts.type_id=album_id,opts.rate=rating,update=$scope.albumDetails.is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.albumDetails.avg_rate=data.data.avg_rate,$scope.albumDetails.no_of_votes=data.data.no_of_votes,$scope.albumDetails.is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.albumDetails.current_user_rate=0,$scope.albumDetails.is_rated=!0),$scope.waitRateResponse=!1;

})},$scope.removeAlbumRating=function(albumIndex){var opts={};opts.user_id=APP.currentUser.id,opts.type="user_profile_album",opts.type_id=albumIndex,$scope.waitRateResponse===!1&&($scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.albumDetails.current_user_rate=0,$scope.albumDetails.avg_rate=data.data.avg_rate,$scope.albumDetails.no_of_votes=data.data.no_of_votes,$scope.albumDetails.is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.albumDetails.current_user_rate=0,$scope.albumDetails.is_rated=!1),$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]),app.directive("rateMeClub",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/ratingStarClub.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hovering=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.avg_rate=!0,$scope.vote_count=0,$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.findPeopleRate=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,opts.type="club_post_comment",opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.rateComment=function(rating,comment_id,postIndex,commentIndex){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="club_post_comment",opts.type_id=comment_id,opts.rate=rating,update=$scope.posts[postIndex].comments[commentIndex].is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.posts[postIndex].comments[commentIndex].avg_rate=data.data.avg_rate,$scope.posts[postIndex].comments[commentIndex].no_of_votes=data.data.no_of_votes,$scope.posts[postIndex].comments[commentIndex].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[postIndex].comments[commentIndex].current_user_rate=0,$scope.posts[postIndex].comments[commentIndex].is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeCommentRating=function(comment_id,postIndx,indx){var opts={};opts.user_id=APP.currentUser.id,opts.type="club_post_comment",opts.type_id=comment_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.posts[postIndx].comments[indx].current_user_rate=0,$scope.posts[postIndx].comments[indx].avg_rate=data.data.avg_rate,$scope.posts[postIndx].comments[indx].no_of_votes=data.data.no_of_votes,$scope.posts[postIndx].comments[indx].is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[postIndx].comments[indx].current_user_rate=0,$scope.posts[postIndx].comments[indx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]),app.directive("rateShopComment",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/ratingStarClub.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hovering=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.avg_rate=!0,$scope.vote_count=0,$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.WaitDeleteResponse=!1,$scope.findPeopleRate=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,opts.type="store_post_comment",opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.rateComment=function(rating,comment_id,postIndex,commentIndex){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="store_post_comment",opts.type_id=comment_id,opts.rate=rating,update=$scope.posts[postIndex].comments[commentIndex].is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.posts[postIndex].comments[commentIndex].avg_rate=data.data.avg_rate,$scope.posts[postIndex].comments[commentIndex].no_of_votes=data.data.no_of_votes,$scope.posts[postIndex].comments[commentIndex].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[postIndex].comments[commentIndex].current_user_rate=0,$scope.posts[postIndex].comments[commentIndex].is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeCommentRating=function(comment_id,postIndx,indx){var opts={};opts.user_id=APP.currentUser.id,opts.type="store_post_comment",opts.type_id=comment_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.posts[postIndx].comments[indx].current_user_rate=0,$scope.posts[postIndx].comments[indx].avg_rate=data.data.avg_rate,$scope.posts[postIndx].comments[indx].no_of_votes=data.data.no_of_votes,$scope.posts[postIndx].comments[indx].is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.posts[postIndx].comments[indx].current_user_rate=0,$scope.posts[postIndx].comments[indx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]),app.controller("rateAlbum",["$scope","$modal","$log","$location","ProfileService",function($scope,$modal,$log,$location,ProfileService){$scope.hovering=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.findPeopleRate=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]}]),app.directive("rateAlbumDirClub",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/rating_star_album_club.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hovering=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.findPeopleRate=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,opts.type="club_album",opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.rateThisAlbum=function(rating,album_id,type){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="club_album",opts.type_id=album_id,opts.rate=rating,update=$scope.albumDetails.is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.albumDetails.avg_rate=data.data.avg_rate,$scope.albumDetails.no_of_votes=data.data.no_of_votes,$scope.albumDetails.is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.albumDetails.current_user_rate=0,$scope.albumDetails.is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeAlbumRating=function(albumIndex){var opts={};opts.user_id=APP.currentUser.id,opts.type="club_album",opts.type_id=albumIndex,$scope.waitRateResponse===!1&&($scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.albumDetails.current_user_rate=0,$scope.albumDetails.avg_rate=data.data.avg_rate,$scope.albumDetails.no_of_votes=data.data.no_of_votes,$scope.albumDetails.is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.albumDetails.current_user_rate=0,$scope.albumDetails.is_rated=!1),$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]),app.directive("rateAlbumDirShop",["$modal","$log","$location","ProfileService",function($modal,$log,$location,ProfileService){return{templateUrl:"app/views/rating_star_album_club.html",restrict:"E",scope:!0,controller:function($scope,$modal,$log,ProfileService){$scope.hovering=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.findPeopleRate=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={};var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});$scope.showPeopleLoader=!0,opts.type="store_album",opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}},$scope.rateThisAlbum=function(rating,album_id,type){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="store_album",opts.type_id=album_id,opts.rate=rating,update=$scope.albumDetails.is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.albumDetails.avg_rate=data.data.avg_rate,$scope.albumDetails.no_of_votes=data.data.no_of_votes,$scope.albumDetails.is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.albumDetails.current_user_rate=0,$scope.albumDetails.is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeAlbumRating=function(albumIndex){var opts={};opts.user_id=APP.currentUser.id,opts.type="store_album",opts.type_id=albumIndex,$scope.waitRateResponse===!1&&($scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.albumDetails.current_user_rate=0,$scope.albumDetails.avg_rate=data.data.avg_rate,$scope.albumDetails.no_of_votes=data.data.no_of_votes,$scope.albumDetails.is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.albumDetails.current_user_rate=0,$scope.albumDetails.is_rated=!1),$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}]},link:function(scope,element,attrs){}}}]);var linkDirectives=angular.module("linkDirectives",[]);linkDirectives.directive("header",function(){return{templateUrl:"app/views/header.html",restrict:"E"}}),linkDirectives.directive("publicHeader",function(){return{templateUrl:"app/views/public_header.html",restrict:"E"}}),linkDirectives.directive("confirmClick",function(){return{link:function(scope,element,attrs){scope.confirmClick=function(msg){return msg=msg||attrs.confirmClick||scope.i18n.msg_directive.delete_item,confirm(msg)}}}}),linkDirectives.directive("elastic",["$timeout",function($timeout){return{restrict:"A",link:function($scope,element){var resize=function(){return element[0].style.height=""+element[0].scrollHeight+"px"};element.on("blur keyup change",resize),$timeout(resize,0)}}}]),linkDirectives.directive("headerLogout",function(){return{controller:"UserController",templateUrl:"app/views/headerLogout.html",restrict:"E"}}),linkDirectives.directive("footerLogout",function(){return{templateUrl:"app/views/logout_footer.html",restrict:"E"}}),linkDirectives.directive("topLink",function(){return{templateUrl:"app/views/toplinks.html",restrict:"E"}}),linkDirectives.directive("homeTopLink",function(){return{templateUrl:"app/views/home_toplink.html",restrict:"E"}}),linkDirectives.directive("publicRightPanel",function(){return{templateUrl:"app/views/public_right_panel.html",restrict:"E"}}),linkDirectives.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),linkDirectives.directive("groupView",function(){return{templateUrl:"app/views/group_detail.html",controller:"GroupDetailController",restrict:"E"}}),linkDirectives.directive("groupViewAlbum",function(){return{templateUrl:"app/views/club_cover.html",controller:"GroupDetailController",restrict:"E"}}),linkDirectives.directive("allNotificationPanel",function(){return{templateUrl:"app/views/all_notification.html",controller:"AllNotiController",restrict:"E"}}),linkDirectives.directive("groupNotificationPanel",function(){return{templateUrl:"app/views/all_group_notification.html",controller:"AllGroupNotiController",restrict:"E"}}),linkDirectives.directive("allNotificationFriendPanel",function(){return{templateUrl:"app/views/all_notification_friend.html",controller:"AllNotiFriendController",restrict:"E"}}),linkDirectives.directive("userCoverProfilePanel",function(){return{templateUrl:"app/views/user_cover_profile.html",controller:"UserCoverProfileController",restrict:"E"}}),linkDirectives.directive("groupCoverProfilePanel",function(){return{templateUrl:"app/views/group_cover.html",controller:"GroupDetailController",restrict:"E"}}),linkDirectives.directive("rightLink",function(){return{templateUrl:"app/views/right_links.html",restrict:"E"}}),linkDirectives.directive("friendCoverProfilePanel",function(){return{templateUrl:"app/views/friend_cover_page.html",controller:"FriendCoverProfileController",restrict:"E"}}),linkDirectives.directive("friendList",function(){return{templateUrl:"app/views/friend_list.html",controller:"FriendController",restrict:"E"}}),linkDirectives.directive("myRefresh",["$location","$route",function($location,$route){return function(scope,element,attrs){element.bind("click",function(){element[0]&&element[0].href&&element[0].href===$location.absUrl()&&window.location.reload(!0)})}}]),linkDirectives.directive("myshopList",function(){return{templateUrl:"app/views/myshop_list.html",restrict:"E"}}),linkDirectives.directive("storeList",function(){return{templateUrl:"app/views/store_list.html",restrict:"E"}}),linkDirectives.directive("storeListHome",function(){return{templateUrl:"app/views/store_list_home.html",restrict:"E"}}),linkDirectives.directive("storeGridHome",function(){return{templateUrl:"app/views/store_grid_home.html",restrict:"E"}}),linkDirectives.directive("storeprofile",function(){return{controller:"DetailStoreCoverController",templateUrl:"app/views/store_cover_profile.html",restrict:"E"}}),linkDirectives.directive("storeprofilehome",function(){return{controller:"BLDetailCoverController",templateUrl:"app/views/store_cover_home_profile.html",restrict:"E"}}),linkDirectives.directive("myshopGrid",function(){return{templateUrl:"app/views/myshop_grid.html",restrict:"E"}}),linkDirectives.directive("allconsumer",function(){return{templateUrl:"app/views/consumer_post_list.html",restrict:"E"}}),linkDirectives.directive("storeGrid",function(){return{templateUrl:"app/views/store_grid.html",restrict:"E"}}),linkDirectives.directive("pshopListHome",function(){return{templateUrl:"app/views/public_shop_list.html",restrict:"E"}}),linkDirectives.directive("pshopGridHome",function(){return{templateUrl:"app/views/public_shop_grid.html",restrict:"E"}}),linkDirectives.directive("lcitizenListHome",function(){return{templateUrl:"app/views/public_linked_citizen_list.html",restrict:"E"}}),linkDirectives.directive("lcitizenGridHome",function(){return{templateUrl:"app/views/public_linked_citizen_grid.html",restrict:"E"}}),linkDirectives.directive("cincomeListHome",function(){return{templateUrl:"app/views/public_citizen_income_list.html",restrict:"E"}}),linkDirectives.directive("cincomeGridHome",function(){return{templateUrl:"app/views/public_citizen_income_grid.html",restrict:"E"}}),app.directive("profileRightPanel",function(){return{restrict:"E",templateUrl:"app/views/profile_right_panel.html"}}),app.directive("storeLeftPanel",function(){return{restrict:"E",templateUrl:"app/views/store_left_panel.html"}}),app.directive("storeNotificationPanel",function(){return{restrict:"E",templateUrl:"app/views/store_notifications.html"}}),app.directive("clubNotificationPanel",function(){return{restrict:"E",templateUrl:"app/views/club_notification.html"}}),app.directive("clubNotificationPanelDashboard",function(){return{restrict:"E",templateUrl:"app/views/club_notification_dashboard.html"}}),app.directive("clubSpecificNotificationPanel",function(){return{restrict:"E",templateUrl:"app/views/clubsnotification.html"}}),linkDirectives.directive("groupGrid",function(){return{restrict:"E",templateUrl:"app/views/group_grid.html"}}),linkDirectives.directive("groupList",function(){return{restrict:"E",templateUrl:"app/views/group_list.html"}}),linkDirectives.directive("groupListFriend",function(){return{restrict:"E",templateUrl:"app/views/group_list_friend.html"}}),linkDirectives.directive("groupGridFriend",function(){return{restrict:"E",templateUrl:"app/views/group_grid_friend.html"}}),linkDirectives.directive("submitEnter",function(){return{restrict:"A",link:function(scope,elem,attrs){elem.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.submitEnter)}),event.preventDefault())})}}}),linkDirectives.directive("cancelEsc",function(){return{restrict:"A",link:function(scope,elem,attrs){elem.bind("keydown keypress",function(event){27===event.which&&(scope.$apply(function(){scope.$eval(attrs.cancelEsc)}),event.preventDefault())})}}}),linkDirectives.directive("map",function(){return{templateUrl:"app/views/map.html",restrict:"E"}}),linkDirectives.directive("autocompleteMap",function(){return{templateUrl:"app/views/google_map.html",restrict:"E"}}),linkDirectives.directive("messageNotification",function(){return{restrict:"E",templateUrl:"app/views/message_notification.html",controller:"MessageNotifiController"}}),app.directive("storePostForm",function(){return{restrict:"E",link:function(scope,iElement,iAttrs){$($("#lp1").linkPreview()).appendTo(iElement[0])},templateUrl:"app/views/store_post_form.html"}}),app.directive("storePostList",function(){return{restrict:"E",controller:function($scope,StorePostService,$location,$timeout,$routeParams,StoreService,StoreCommentService,FileUploader,ProfileService,$modal,$log){$scope.delCommentErrMsg=[],$scope.delCommentErrCls=[],$scope.editCommentText=[],$scope.activeCommentEdit=[],$scope.isEditComment=[],$scope.commentErrorMsg=[],$scope.commentErrorCls=[],$scope.commentInProcess=[],$scope.showComments=[],$(document).click(function(){$("ul.actions-drop-action").hide()}),$scope.toggleEdit=function($event){$event.stopPropagation(),$($event.currentTarget).next("ul.actions-drop-action").is(":visible")?$($event.currentTarget).next("ul.actions-drop-action").hide():($("ul.actions-drop-action").hide(),$($event.currentTarget).next("ul.actions-drop-action").show())},$scope.deleteComment=function(postIndx,indx){var indx=indx,commentData=$scope.posts[postIndx].comments[indx];$scope.deleteCommentIndx=commentData.id;var post=$scope.posts[postIndx],formData={};formData.user_id=$scope.currentUser.id,formData.comment_id=commentData.id,StoreCommentService.deleteComment(formData,function(data){if(101==data.code){$scope.delCommentErrMsg[commentData.id]="",$scope.delCommentErrCls[commentData.id]="",$scope.deleteCommentIndx=-1;var opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.posts[postIndx].comments.splice(indx,1),$scope.posts[postIndx].comment_count--}else $scope.delCommentErrMsg[commentData.id]=$scope.i18n.dashboard.postcomment.delete_comment_fail,$scope.delCommentErrCls[commentData.id]="text-red",$scope.deleteCommentIndx=-1,$scope.posts;$timeout(function(){$scope.delCommentErrCls[commentData.id]="",$scope.delCommentErrMsg[commentData.id]=""},15e3)})},$scope.deleteMediaComment=function(comment,postIndx,mediaIndx){var commentData=comment,post=$scope.posts[postIndx];$scope.deleteCommentIndx=commentData.id;var formData={};formData.user_id=$scope.currentUser.id,formData.comment_id=commentData.id,formData.comment_media_id=commentData.comment_media_info[0].id,StoreCommentService.deleteMediaComment(formData,function(data){if(101==data.code){$scope.deleteCommentIndx=-1;var opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)}else $scope.deleteCommentIndx=-1,$scope.posts})},$scope.updateComment=function(postIndx,indx){$("#commentBoxId-"+postIndx).hide(),$scope.commentInProcess[postIndx]=!0,$scope.commentErrorMsg[postIndx]="",$scope.commentErrorCls[postIndx]="";var comment=$scope.posts[postIndx].comments[indx],indx=indx;$scope.activeCommentEdit[postIndx]=comment.id,$scope.isEditComment[postIndx]=!1,$scope.editCommentText[postIndx]=comment.comment_text},$scope.editComment=function(postIndx,indx){var opts={},post=$scope.posts[postIndx],comment=$scope.posts[postIndx].comments[indx],newText=$scope.editCommentText[postIndx],indx=indx;return $scope.isEditComment[postIndx]=!0,$scope.commentErrorMsg[postIndx]="",void 0==newText||""==newText?($scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_comment,$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3),!1):(opts.user_id=$scope.currentUser.id,opts.post_id=post.post_id,opts.comment_id=comment.id,opts.comment_author=comment.comment_user_info.id,opts.youtube_url=comment.youtube_url,opts.comment_text=newText,void StoreCommentService.updateComment(opts,function(data){101==data.code?($scope.posts[postIndx].comments[indx].comment_text=newText,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.commentInProcess[postIndx]=!1,$scope.editCommentText[postIndx]="",$("#commentBoxId-"+postIndx).show(),$scope.isEditComment[postIndx]=!1):($scope.commentInProcess[postIndx]=!1,$scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.not_posted,$("#commentBoxId-"+postIndx).show()),$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3)}))},$scope.cancelEditComment=function(postIndx,indx){$scope.commentInProcess=[],$scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]=[],$scope.activeCommentEdit[postIndx][indx]=-1,$scope.editCommentText[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$("#commentBoxId-"+postIndx).show()},$scope.allCommentLoad=[],$scope.showAllComments=function(postIndx){$scope.allCommentLoad[postIndx]=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx),$scope.showComments[postIndx]=!0},$scope.comments=[],$scope.getComments=function(opts,postIndx){$scope.comments[postIndx]=[],StoreCommentService.listComment(opts,function(data){100==data.code?($scope.posts[postIndx].comments=data.data.comment,$scope.allCommentLoad[postIndx]=!1,0!=$scope.comments[postIndx].length&&($scope.noComment=!0)):$scope.allCommentLoad[postIndx]=!0})}},templateUrl:"app/views/store_post_list.html"}}),app.directive("storeCommentForm",["StoreCommentService","fileReader","$timeout",function(StoreCommentService,fileReader,$timeout){return{restrict:"E",templateUrl:"app/views/store_comment_form.html",scope:!1,link:function(scope,elem,attrs){scope.showPreview=!1,scope.comment_id="",scope.image_id=[],scope.imgSrc=[],scope.isInProgress=[],scope.commentFiles=[],scope.selectInProgress=[],scope.commentErrMsg="",scope.commentErrCls="",scope.imgRes=1,scope.getFile=function(){var tempopts={};tempopts.comment_author=APP.currentUser.id,tempopts.post_id=attrs.postId,tempopts.session_id=APP.currentUser.id,tempopts.body=scope.i18n.editprofile.comment_image_test,tempopts.post_type="0",tempopts.comment_id="";var len=scope.commentFiles.length;StoreCommentService.createCommentWithImage(tempopts,scope.commentFiles[0],function(data){if(101==data.code)for(scope.comment_id=data.data.comment_id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),tempopts.comment_id=scope.comment_id,scope.selectInProgress.splice(0,1),j=1;j<len;j++)StoreCommentService.createCommentWithImage(tempopts,scope.commentFiles[j],function(data){101==data.code?(scope.comment_id=data.data.comment_id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),scope.selectInProgress.splice(0,1)):(scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail)});else scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail}),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)},scope.removeImage=function(index){scope.imgSrc.splice(index,1),scope.isInProgress.splice(index,1),0==scope.imgSrc.length&&(scope.commentFiles==[],scope.file=[],scope.showImgSelect=!0,scope.showPreview=!1)},scope.res=0,scope.addComment=function(){scope.postIndx=attrs.postIndx,scope.comments=attrs.loadComment,scope.finalCommentInProcess=!0,scope.commentErrMsg="",scope.commentErrMsg="",scope.commentErrCls="";var filescount=scope.imgSrc.length;if((void 0===scope.commentText||""===scope.commentText)&&0===filescount)return scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.photo_update,setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3),!1;var opts={};opts.comment_author=APP.currentUser.id,opts.post_id=attrs.postId,opts.comment_text=scope.commentText,opts.media_id=[],opts.session_id=APP.currentUser.id,opts.youtube_url="",opts.comment_id="",0!=scope.image_id.length&&(opts.media_id=scope.image_id),""!=scope.comment_id&&(opts.comment_id=scope.comment_id),opts.post_type="1",opts.tagging=scope.taggedObject,0==scope.res&&(scope.res=1,StoreCommentService.createComment(opts,function(data){scope.res=0,101==data.code?(scope.finalCommentInProcess=!1,scope.commentErrMsg="",scope.commentErrCls="",scope.commentText="",scope.post.comments.push(data.data.comment),scope.post.comment_count++,scope.commentFiles=[],scope.imgSrc=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id=""):(scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.comment_no_post,scope.commentFiles=[],scope.imgSrc=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id="")}),$timeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3))}}}}]),app.directive("clickEdit",["$compile",function($compile){return{restrict:"E",link:function(scope,elem,attrs){elem.bind("click",function(){var newtemp;newtemp=angular.element("<edit-form></edit-form>"),elem.parent().parent().find(".store-comment-profile-upload").html($compile(newtemp)(scope))})}}}]),app.directive("editForm",function($compile){return{restrict:"E",templateUrl:"app/views/store_post_editform.html"}}),app.directive("clickDelete",[function($compile){return{restrict:"A",scope:{deleteMethod:"&"},link:function(scope,elem,attrs){elem.bind("click",function(){scope.$apply(scope.deleteMethod)})}}}]),app.directive("infiniteScrolls",["$window",function($window){return{link:function(scope,element,attrs){var e=(parseInt(attrs.threshold)||0,element[0]);element.bind("scroll",function(){0==e.scrollTop&&e.scrollHeight!=e.offsetHeight&&scope.$apply(attrs.infiniteScrolls)})}}}]),app.directive("ngFileSelect",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.file=(e.srcElement||e.target).files[0],$scope.getFile()})}}}),app.directive("ngCoverSelect",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.file=(e.srcElement||e.target).files[0]})}}}),app.directive("ngIdCardFile",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.idCardFile=(e.srcElement||e.target).files[0],
$scope.getIdCardFile()})}}}),app.directive("ngSsnFileSelect",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.ssnFile=(e.srcElement||e.target).files[0],$scope.getSsnFile()})}}}),app.directive("ngMultiFileSelect",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.file=(e.srcElement||e.target).files,$scope.getFile()})}}}),app.directive("ngProfileFileSelect",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.files=(e.srcElement||e.target).files,$scope.inputEl=e.target,$scope.getProfileFile()})}}}),app.directive("ngProfileCommentMultiFileSelect",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.file=(e.srcElement||e.target).files[0],$scope.getFile()})}}}),app.directive("fileSelect",["$timeout",function($timeout){var template='<input type="file" name="files" class="search-botton" multiple />';return function(scope,elem,attrs){scope.showImgSelect=!0;var selector=$(template);elem.append(selector),selector.bind("click",function(event){scope.fileUpload=[],scope.showPreview=!1,scope.comment_id="",scope.image_id=[],scope.imgSrc=[],scope.isInProgress=[],scope.selectInProgress=[],scope.commentFiles=[],scope.commentErrMsg="",this.value=null}),selector.bind("change",function(event){scope.$apply(function(){scope[attrs.fileSelect]=event.originalEvent.target.files;var imgFileCount=scope[attrs.fileSelect].length,reject=0,correct=0;if(imgFileCount>=1)for(var i=0;imgFileCount>i;i++){var imageType=scope[attrs.fileSelect][i].name.substring(scope[attrs.fileSelect][i].name.lastIndexOf(".")+1).toLowerCase();"gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType?(scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.media_incorrect,reject++):(correct++,scope.first=!0,scope.imgRes=1,scope.showPreview=!0,scope.isInProgress.push(!0),scope.selectInProgress.push(!0),scope.commentFiles.push(scope[attrs.fileSelect][i])),reject+correct==imgFileCount&&0!=correct&&scope.getFile(scope.commentFiles)}}),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)})}}]),app.directive("focusMe",function(){return{restrict:"A",link:function(scope,element,attr){scope.$watch(attr.focusMe,function(n,o){0!=n&&n&&element[0].focus()})}}}),app.directive("eventFocus",function(focus){return function(scope,elem,attr){elem.on(attr.eventFocus,function(){console.log(attr.eventFocus),alert("a")}),scope.$on("$destroy",function(){element.off(attr.eventFocus)})}}),app.directive("storePostHomeList",function(){return{restrict:"E",templateUrl:"app/views/store_post_home.html"}}),app.directive("infiniteScrollsDown",["$window",function($window){return{link:function(scope,element,attrs){var e=(parseInt(attrs.cardshold)||0,element[0]);element.bind("scroll",function(){e.scrollTop+e.offsetHeight>=e.scrollHeight&&scope.$apply(attrs.infiniteScrollsDown)})}}}]),app.directive("ngsearchtext",function(){return function(scope,element,attrs){element.bind("keyup",function(event){13!==event.which&&(scope.$apply(function(){scope.$eval(attrs.ngsearchtext)}),event.preventDefault())})}}),app.directive("confirmPayment",function(){return{link:function(scope,element,attrs){scope.confirmPayment=function(msg){return msg=msg||attrs.confirmPayment||scope.i18n.msg_directive.confirm_payment,confirm(msg)}}}}),app.directive("styleParent",function($document,$window){return function(scope,element,attr){var container=$document.find("div.post-img"),w=angular.element($window),imgWidth="",imgHeight="",newValue={};element.on("load",function(){$(this).parent().removeClass("imgHHWL"),$(this).parent().removeClass("imgHHWH"),$(this).parent().removeClass("imgHLWH"),$(this).parent().removeClass("imgHLWL");var theImage=new Image;theImage.src=$(this).attr("src"),imgWidth=theImage.width,imgHeight=theImage.height,newValue.h=$("div.post-img").height(),newValue.w=$("div.post-img").width();var cls="";imgWidth>newValue.w&&imgHeight>newValue.h?cls="imgHHWH":imgWidth<=newValue.w&&imgHeight>=newValue.h?cls="imgHHWL":imgWidth>=newValue.w&&imgHeight<=newValue.h?cls="imgHLWH":imgWidth<=newValue.w&&imgHeight<=newValue.h&&(cls="imgHLWL"),$(this).parent().addClass(cls)}),scope.$watch(function(){return{h:container.height(),w:container.width()}},function(newValue,oldValue){if(newValue.w!=oldValue.w){var cls="";imgWidth>newValue.w&&imgHeight>newValue.h?cls="imgHHWH":imgWidth<=newValue.w&&imgHeight>=newValue.h?cls="imgHHWL":imgWidth>=newValue.w&&imgHeight<=newValue.h?cls="imgHLWH":imgWidth<=newValue.w&&imgHeight<=newValue.h&&(cls="imgHLWL"),$(this).parent().addClass(cls)}},!0),w.bind("resize",function(){scope.$apply()})}}),linkDirectives.directive("confirmClickMember",function(){return{link:function(scope,element,attrs){scope.confirmClick=function(msg){return msg=msg||attrs.confirmClick||scope.i18n.msg_directive.delete_member,confirm(msg)}}}}),linkDirectives.directive("confirmClickUnsubscribe",function(){return{link:function(scope,element,attrs){scope.confirmClick=function(msg){return msg=msg||attrs.confirmClick||scope.i18n.coupon.confirm_unsub,confirm(msg)}}}}),linkDirectives.directive("datePicker",function(){return{controller:"DateController",templateUrl:"app/views/date_picker.html",restrict:"E"}}),linkDirectives.directive("createCoupon",function(){return{controller:"CouponController",templateUrl:"app/views/create_coupon.html",restrict:"E"}}),app.directive("shopTransactionCustomer",function(){return{templateUrl:"app/views/shop_transaction_customer.html",restrict:"E"}}),app.directive("shopTransactionProgress",function(){return{templateUrl:"app/views/shop_transaction_progress.html",restrict:"E"}}),linkDirectives.directive("createAward",function(){return{controller:"AwardsController",templateUrl:"app/views/create_awards.html",restrict:"E"}}),app.directive("shopTransactionAmount",function(){return{templateUrl:"app/views/shop_transaction_amount.html",restrict:"E"}}),linkDirectives.directive("campaignWork",function(){return{controller:"WorkCampaignController",templateUrl:"app/views/campaign_work.html",restrict:"E"}}),app.directive("shopTransactionConfirm",function(){return{templateUrl:"app/views/shop_transaction_confirm.html",restrict:"E"}}),linkDirectives.directive("createCampaign",function(){return{controller:"CreateCampaignController",templateUrl:"app/views/create_campaign.html",restrict:"E"}}),linkDirectives.directive("offerList",function(){return{templateUrl:"app/views/offer-list.html",restrict:"E"}}),linkDirectives.directive("offerGrid",function(){return{templateUrl:"app/views/offer-grid.html",restrict:"E"}}),linkDirectives.directive("offerTop",function(){return{templateUrl:"app/views/offer_top.html",restrict:"E"}}),app.directive("shopTransactionCancel",function(){return{templateUrl:"app/views/shop_transaction_cancel.html",restrict:"E"}}),app.directive("shopTransactionDetail",function(){return{templateUrl:"app/views/shop_transaction_detail.html",restrict:"E"}}),app.directive("shopTransactionHistoryList",function(){return{templateUrl:"app/views/shop_transaction_history_list.html",restrict:"E"}}),app.directive("shopTransactionHistoryDetail",function(){return{templateUrl:"app/views/shop_transaction_history_detail.html",restrict:"E"}}),app.directive("whenScrolled",function(){return function(scope,elm,attr){var raw=elm[0];elm.bind("scroll",function(){raw.scrollTop+raw.offsetHeight>=raw.scrollHeight&&scope.$apply(attr.whenScrolled)})}}),linkDirectives.directive("confirmClickRemove",function(){return{link:function(scope,element,attrs){scope.confirmClick=function(msg){return msg=msg||attrs.confirmClick||scope.i18n.msg_directive.remove_club,confirm(msg)}}}}),linkDirectives.directive("couponsList",function(){return{templateUrl:"app/views/coupons-list.html",restrict:"E"}}),linkDirectives.directive("couponsGrid",function(){return{templateUrl:"app/views/coupons-grid.html",restrict:"E"}}),app.directive("dateRange",function(){return{restrict:"AE",replace:!1,link:function(scope,elem,attrs){jQuery(elem).daterangepicker({opens:"left",format:"MM/DD/YY",startDate:moment().subtract("days",364),endDate:moment(),showDropdowns:!0,ranges:{"Last 7 Days":[moment().subtract("days",6),moment()],"Last 30 Days":[moment().subtract("days",29),moment()],"Last 90 Days":[moment().subtract("days",89),moment()],"Last 12 Months":[moment().subtract("days",364),moment()]}}),jQuery(elem).on("apply.daterangepicker",function(ev,picker){jQuery(elem).find("#startDate").text(picker.startDate.format("MM/DD/YYYY")),jQuery(elem).find("#endDate").text(picker.endDate.format("MM/DD/YYYY")),scope[attrs.start]=picker.startDate,scope[attrs.end]=picker.endDate,scope.$apply()})}}}),app.directive("datePickers",function(){return{restrict:"E",transclude:!0,scope:{date:"="},link:function(scope,element,attrs){element.datepicker({dateFormat:"dd-mm-yy",onSelect:function(dateText,datepicker){scope.date=dateText,scope.$apply()}})},template:'<input type="text" class="span2" ng-model="date"/>',replace:!0}}),linkDirectives.directive("paypalForm",["CommerialService","StoreService",function(CommerialService,StoreService){return{templateUrl:"app/views/paypal_form.html",restrict:"E",controller:function($scope,$timeout){$scope.checkPno=function(pnumber){if(void 0!=pnumber){var regex=/[^a-z^A-Z]$/;return regex.test(pnumber)}},$scope.checkEmail=function(email){var regex=/^[A-Za-z0-9._-]+@[A-Za-z]+\.[A-Za-z.]{2,5}$/;return regex.test(email)},$scope.submitPaypalForm=function(paypal){$scope.inProgress=!0,$scope.is_paypal_added=0;var shop_id=StoreService.getStoreData().id;$scope.is_paypal_added=StoreService.getStoreData().is_paypal_added;var opts={};opts.session_id=APP.currentUser.id,opts.shop_id=shop_id,opts.first_name=paypal.fname,opts.last_name=paypal.lname,opts.email_address=angular.lowercase(paypal.email),opts.mobile_number=paypal.pnumber,$scope.paypalErrMsg="",$scope.paypalErrCls="",CommerialService.varifyPaypal(opts,function(data){$scope.inProgress=!1,101==data.code?($scope.is_paypal_added=1,$scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.success,$scope.paypalErrCls="text-success",void 0!==$scope.currentSubTab&&2===$scope.currentSubTab?$scope.closeForm():($scope.paypal={},$scope.paypalForm.$setPristine(),$scope.isShowForm=!1,$scope.isOpenBottomForm=!1,$scope.isOpenTopForm=!1),$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):5e5==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.system_error,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):520002==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.internal_error,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):520003==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.username_incorrect,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):550001==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.not_allowed,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):560027==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.value_unsupported,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):560029==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.header_missing,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):580001==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.invalid_request,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):580022==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.invalid_request_param,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):580023==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.determine_status,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):580029==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.param_missing,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):100==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.missed_param,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):1053==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.already_exist,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):1054==data.code?($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.access_voilation,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3)):1029==data.code&&($scope.paypalErrMsg=$scope.i18n.Campaign_work.paypal_varify.failure,$scope.paypalErrCls="text-red",$timeout(function(){$scope.paypalErrMsg="",$scope.paypalErrCls=""},15e3))})}}}}]),linkDirectives.directive("businessApp",["StoreService","$cookieStore",function(StoreService,$cookieStore){return{templateUrl:"app/views/businessApp.html",restrict:"E",controller:function($scope,StoreService,$cookieStore){$scope.currentLanguage=$cookieStore.get("activeLanguage"),$scope.businessApp=[],$scope.myStoreList=function(){var opts={};opts.user_id=APP.currentUser.id,opts.store_type=2,opts.limit_start=0,opts.limit_size=50,opts.lang_code=$scope.currentLanguage,opts.filter_type=1,StoreService.getStore(opts,function(data){101===data.code&&($scope.businessApp=data.data.stores)})},$scope.myStoreList()}}}]),app.directive("friendProfilePostList",["ProfileService","$routeParams","$location","focus",function(ProfileService,$routeParams,$location,focus){return{restrict:"E",controller:function($scope,$timeout,$modal,$log){$scope.showComments=[],$scope.getfriendId=$routeParams.friendId,$scope.commentsShowLimit=[],$scope.commentsLength=[],$scope.textLimit=APP.post_charecter_limit,$scope.loadMoreFunc="loadMore()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMore()")},!0),$(document).click(function(){$("ul.actions-drop-action").hide()}),$scope.toggleEdit=function($event){$event.stopPropagation(),$($event.currentTarget).next("ul.actions-drop-action").is(":visible")?$($event.currentTarget).next("ul.actions-drop-action").hide():($("ul.actions-drop-action").hide(),$($event.currentTarget).next("ul.actions-drop-action").show())},$scope.listFriendPost=function(){var opts={},limit_start=$scope.userPostList.length;opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.dashbord_pagination.end,opts.friend_id=$scope.getfriendId,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes?($scope.myRes=0,ProfileService.getDashboardWallFeeds(opts,function(data){if(101==data.code){for(var items=data.data.post,i=0;i<items.length;i++)$scope.userPostList.push(items[i]);$scope.totalSize=data.data.count,$scope.isLoading=!1}else $scope.isLoading=!1,$scope.userPostList;0==$scope.userPostList.length&&($scope.noContent=!0),$scope.myRes=1})):($scope.isLoading=!1,0==$scope.userPostList.length&&($scope.noContent=!0),$scope.userPostList)},$scope.loadMore=function(){$scope.totalSize>$scope.userPostList.length&&($scope.isLoading=!0,$scope.listFriendPost())},$scope.deleteErrMsg=[],$scope.isDeletePost=[],$scope.deleteErrCls=[],$scope.deletePost=function(postIndx){var postData={};postData=$scope.userPostList[postIndx],$scope.isDeletePost[postIndx]=!0,$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="";var formData={};formData.user_id=APP.currentUser.id,formData.post_id=postData.id,ProfileService.deleteDashboardPost(formData,function(data){101==data.code?($scope.userPostList.splice(postIndx,1),0==$scope.userPostList.length&&($scope.noContent=!0),$scope.isDeletePost[postIndx]=!1):($scope.deleteErrCls[postIndx]="text-red",$scope.deleteErrMsg[postIndx]=$scope.i18n.dashboard.postcomment.delete_post_fail,$scope.isDeletePost[postIndx]=!1),$timeout(function(){$scope.deleteErrCls[postIndx]="",$scope.deleteErrMsg[postIndx]=""},15e3)})},$scope.editPostErrorMsg=[],$scope.updatePostInProcess=[],$scope.editPostErrorCls=[],$scope.saveUpdatePost=function(postIndx){var opts={};$scope.updatePostInProcess[postIndx]=!0;var editPostText=escapeHtmlEntities($scope.updateBody[postIndx]),post=$scope.userPostList[postIndx];if(void 0==editPostText||""==editPostText)return $scope.updatePostInProcess=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_status,$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3),!1;var regex=/src="([^"]+)"/,src=editPostText.split(regex)[1];void 0!=src&&""!=src&&(editPostText=src),opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.title=post.title,opts.description=editPostText,opts.to_id=$routeParams.friendId,opts.youtube_url="",opts.post_type="1",opts.privacy_setting=post.privacy_setting;var friendIdList=[];$scope.postTaggedFriend[postIndx].length>0?(angular.forEach($scope.postTaggedFriend[postIndx],function(index){friendIdList.push(index.id)}),opts.tagged_friends=friendIdList.join()):opts.tagged_friends="",ProfileService.updateDashboardPost(opts,function(data){101==data.code?($scope.postTaggedFriend[postIndx].length>0?post.tagged_friends_info=$scope.postTaggedFriend[postIndx]:post.tagged_friends_info="",$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]="",$scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.userPostList[postIndx].description=editPostText,$scope.editPostText="",$scope.activeEdit[postIndx]=!1):($scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.post_unsaved),$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3)})},$scope.editPrivacyMsg=[],$scope.editPrivacyCls=[],$scope.changePrivacy=function(post,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.privacy_setting=post.privacy_setting;ProfileService.updatePostPrivacy(opts,function(data){101==data.code?($scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""):($scope.editPrivacyCls[postIndx]="text-red",$scope.editPrivacyMsg[postIndx]=$scope.i18n.editprofile.privacy_setting,$timeout(function(){$scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""},15e3))})},$scope.updateBody=[],$scope.activeEdit=[],$scope.postTaggedFriend=[],$scope.showTagLoading=[],$scope.updatePost=function(postIndx){$scope.editPostErrorMsg[postIndx]="";var post=$scope.userPostList[postIndx];autosize(document.querySelectorAll(".editpostbox"));var str=$.trim(post.description.replace(/\n\n\n+/g,"\n\n")),htmlstr=str.replace(/\n/g,"<br />"),height=$('<div style="display:block;" id="postedit-hidden-div"></div>').html(htmlstr).appendTo("#post_"+post.id).height();$("#editpost_"+post.id).css("height",height+"px"),str=$("#postedit-hidden-div").html(str).text(),$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]=str,$scope.activeEdit[postIndx]=!0,$scope.postTaggedFriend[postIndx]=[],angular.forEach(post.tagged_friends_info,function(val,indx){$scope.postTaggedFriend[postIndx].push(val)}),$scope.showTagLoading[postIndx]=!0,$timeout(function(){$("#editpost_"+post.id).putCursorAtStart()},200)},$scope.gainTextFocus=function(indx){focus("friendSearchField"+indx)},$scope.cancelPost=function(postIndx){$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},$scope.removePostTagFriend=function(index,postIndex){$scope.postTaggedFriend[postIndex].splice(index,1)};var currentTimeout=null;$scope.addMoreFriend=function(event,index){var DELAY_TIME_BEFORE_POSTING=300;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchMoreFriend(index)},DELAY_TIME_BEFORE_POSTING)},$scope.friends=[],$scope.showSearchFriendLoader=[],$scope.cancelFriendSearch=!1,$scope.showSearchFriendList=[],$scope.searchMoreFriend=function(postIndx){$scope.searchFriend=$(".addMoreTagFriend"+postIndx).val(),$scope.friendTagIndex[postIndx]=-1,$scope.cancelFriendSearch=!1,$scope.showSearchFriendList[postIndx]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.searchFriend,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchFriendLoader[postIndx]=!0,$scope.showTagLoading[postIndx]=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchFriendLoader[postIndx]=!1,$scope.cancelFriendSearch===!1&&($scope.friends[postIndx]=data.data.users)})},$scope.postTaggedFriend=[],$scope.dublicate=!1,$scope.taggedSelectFriend=function(friendInfo,postIndex){$scope.dublicate=!1,angular.forEach($scope.postTaggedFriend[postIndex],function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?(console.log(friendInfo),console.log(postIndex),$scope.postTaggedFriend[postIndex].push({id:friendInfo.user_id,first_name:friendInfo.user_info.first_name,last_name:friendInfo.user_info.last_name,profile_image:friendInfo.user_info.profile_image,profile_image_thumb:friendInfo.user_info.profile_image_thumb}),$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1):($scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1)},$scope.lostFocus=function(postIndex){$timeout(function(){$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1},300)},$scope.friendTagIndex=[],$scope.searchNevigateControl=function(event,index){40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]+1!==$scope.friends[index].length&&$scope.friendTagIndex[index]++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]-1!==-1&&$scope.friendTagIndex[index]--):13===event.keyCode&&(console.log($scope.friends[index][$scope.friendTagIndex[index]]),$scope.taggedSelectFriend($scope.friends[index][$scope.friendTagIndex[index]],index))},$scope.showFriendPostList=function(){$scope.isLoading=!0,$scope.userPostList=[],$scope.totalSize=0,$scope.myRes=1,$scope.noContent=!1,$scope.listFriendPost()},$scope.commentLoading=[],$scope.getComments=function(postIndx){var post=$scope.userPostList[postIndx];$scope.userPostList[postIndx].comments=[];var opts={};opts.post_id=post.id,opts.user_id=APP.currentUser.id,opts.limit_start=APP.dashbord_comment.start,opts.limit_size=APP.dashbord_comment.end,ProfileService.getDashboardComments(opts,function(data){100==data.code?($scope.userPostList[postIndx].comments=data.data.comment,$scope.commentLoading[postIndx]=!1,$scope.commentsLength[postIndx]=$scope.userPostList[postIndx].comments.length,0!=$scope.userPostList[postIndx].comments.length&&($scope.noComment=!0)):$scope.commentLoading[postIndx]=!1})},$scope.showLimitedComment=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)},$scope.showAllComments=function(postIndx){$scope.showComments[postIndx]=!0,$scope.commentLoading[postIndx]=!0,$scope.getComments(postIndx)},$scope.pageSize=4,$scope.delCommentErrMsg=[],$scope.delCommentErrCls=[],$scope.deleteComment=function(postIndx,comment){var indx=$scope.userPostList[postIndx].comments.indexOf(comment),commentData={};commentData=$scope.userPostList[postIndx].comments[indx],$scope.deleteCommentIndx=commentData.id;var formData={};formData.user_id=APP.currentUser.id,formData.comment_id=commentData.id,ProfileService.deleteDashboardComment(formData,function(data){101==data.code?($scope.delCommentErrMsg[commentData.id]="",$scope.delCommentErrCls[commentData.id]="",$scope.userPostList[postIndx].comments.splice(indx,1),$scope.userPostList[postIndx].comment_count--,$scope.deleteCommentIndx=""):($scope.delCommentErrMsg[commentData.id]=$scope.i18n.dashboard.postcomment.delete_comment_fail,$scope.delCommentErrCls[commentData.id]="text-red",$scope.deleteCommentIndx="",$scope.userPostList),$timeout(function(){$scope.delCommentErrCls[postIndx]="",$scope.delCommentErrMsg[postIndx]=""},15e3)})},$scope.editCommentText=[],$scope.activeCommentEdit=[],$scope.isEditComment=[],$scope.commentErrorMsg=[],$scope.commentErrorCls=[],$scope.commentInProcess=[],$scope.updateComment=function(postIndx,comment){$("#commentBoxId-"+postIndx).hide(),$scope.commentInProcess[postIndx]=!0,$scope.commentErrorMsg[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx];$scope.isEditComment[postIndx]=!1,$scope.activeCommentEdit[postIndx]=comment.id,$scope.editCommentText[postIndx]=comment.comment_text},$scope.editComment=function(postIndx,comment){var opts={};$scope.commentErrorMsg[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx],newText=$scope.editCommentText[postIndx];return $scope.isEditComment[postIndx]=!0,void 0==newText||""==newText?($scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_comment,$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3),!1):(opts.user_id=APP.currentUser.id,opts.comment_id=comment.id,opts.comment_text=newText,void ProfileService.updateDashboardComment(opts,function(data){101==data.code?($scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.editCommentText[postIndx]="",$scope.userPostList[postIndx].comments[indx].comment_text=newText,$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()):($scope.activeCommentEdit[postIndx]="",$scope.commentInProcess[postIndx]=!1,$scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.not_posted,$scope.editCommentText[postIndx]="",$("#commentBoxId-"+postIndx).show()),$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3)}))},$scope.cancelEditComment=function(postIndx,indx){$scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.editCommentText[postIndx]="",$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()},$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,$scope.creater=creater_info;var modalInstance=$modal.open({template:'<div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px"  alt="No image available"  data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a href ng-click="viewFriendProile(friend.id)">{{friend.first_name}} {{friend.last_name}}</a></span><span data-ng-if="creater.id === currentUser.id || currentUser.id === friend.id" ng-click="RemoveTagFriend(friend, creater.id)" class="rmv-tag"><a href>{{i18n.profile_post.remove_tagged_friend}}</a></span></li></ul></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)},$scope.RemoveTagFriend=function(friend,createrId){var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=friend.id,opts.post_id=$scope.post_id,ProfileService.removeTagedFriends(opts,function(data){if(101===data.code){var index=$scope.allTagFriends.indexOf(friend);$scope.allTagFriends.splice(index,1),createrId!=APP.currentUser.id&&modalInstance.close(),0===$scope.allTagFriends.length&&modalInstance.close()}})}},$scope.validate=!1,$scope.checkTagUser=function(allTaggedFriend){return $scope.tagInfo=allTaggedFriend,$scope.validate=!1,angular.forEach($scope.tagInfo,function(index){index.id===APP.currentUser.id&&($scope.validate=!0)}),$scope.validate===!0?!0:void 0},$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.ratePost=function(rating,post_id,index){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.userPostList[index].is_rated?"update":"add",ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.userPostList[index].avg_rate=data.data.avg_rate,$scope.userPostList[index].no_of_votes=data.data.no_of_votes,$scope.userPostList[index].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[index].is_rated=!1,$scope.userPostList[postIndx].current_user_rate=0),$scope.waitRateResponse=!1})},$scope.WaitDeleteResponse=!1,$scope.removeRating=function(post_id,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){console.log($scope.userPostList[postIndx]),101==data.code&&"SUCCESS"==data.message?($scope.userPostList[postIndx].current_user_rate=0,$scope.userPostList[postIndx].is_rated=!1,$scope.userPostList[postIndx].no_of_votes=data.data.no_of_votes,$scope.userPostList[postIndx].avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[postIndx].current_user_rate=0,$scope.userPostList[postIndx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}],$scope.showPeopleLoader=!1,$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,
0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}},link:function($scope){$(".fancybox").fancybox(),$scope.showFriendPostList()},templateUrl:"app/views/profile_friend_post_list.html"}}]).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.directive("friendProfilePostForm",["$timeout","ProfileService","FileUploader","$sce","$routeParams","focus",function($timeout,ProfileService,FileUploader,$sce,$routeParams,focus){return{restrict:"E",controller:function($scope){2==$scope.friendProfile.user_info.friend_type?$scope.privacySet=3:1==$scope.friendProfile.user_info.friend_type?$scope.privacySet=3:$scope.privacySet=3,$scope.updatePrivacyModel=function(pindx){$scope.privacySet=pindx},$scope.postErrMsg="",$scope.postErrCls="",$scope.postContentStart=!1,$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$scope.imgProgress=[],$scope.postImgLoader=[],$scope.progress=[],$scope.tempPostId="";var uploader=$scope.uploader=new FileUploader({url:APP.service.dashboardpost+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id,title:"Not in use on frontend",description:"",youtube_url:"",to_id:$routeParams.friendId,link_type:"0",post_type:"0",privacy_setting:$scope.privacySet},dataObjName:"reqObj",formDataName:"postfile[]"});uploader.filters.push({name:"postfile[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.addImage=function(){var href=$("#previewUrl_lp1").html();""!=href&&$timeout(function(){$("#closePreview_lp1").click()},100),$scope.isImage=!0,$scope.imgUpload=!1,$scope.uploadBox=!0,$scope.imagePrvSrc=[],$scope.postProfileFiles=[]},$scope.addPost=function(){$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.isPost=!0,$scope.imagePrvSrc=[],$scope.postProfileFiles=[]},$scope.removeImage=function(index){var tempImg=$scope.imagePrvSrc[index];$scope.imagePrvSrc.splice(index,1);var item=$scope.uploader.queue[index];item.remove();var formData={};formData.user_id=APP.currentUser.id,formData.post_media_id=tempImg.media_id,ProfileService.deletePostMedia(formData,function(data){101==data.code||($scope.imagePrvSrc[index]=tempImg,$scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.dashboard.postcomment.remove_img_fail,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.userPostList)})},uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0,uploader.data.post_id=$scope.tempPostId;var queueLen=uploader.queue.length-1;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.postImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imagePrvSrc[index]=response.data,$scope.postImgLoader[index]=!1,$scope.tempPostId=response.data.id,uploader.data.post_id=response.data.id)},uploader.onCompleteAll=function(){$scope.postContentStart=!1},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.postErrMsg=$scope.i18n.editprofile.no_media_valid,$scope.postErrCls="text-red",$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3)},$scope.createPost=function(){$scope.activeEdit.length=0,$scope.updateBody=[],$scope.activeEdit=[],$scope.editPostErrorCls=[],$scope.editPostErrorMsg=[];var link_type;$scope.postContentStart=!0,$scope.postContentLoader=!0;var opts={};$scope.postErrMsg="";var filescount=$scope.imagePrvSrc.length,descval=$("#preview_lp1").html(),href=$("#previewUrl_lp1").html(),textarea=$("#text_lp1").val(),description="";description=textarea;var regex=/src="([^"]+)"/,src=description.split(regex)[1];if(void 0!=src&&""!=src&&(description=src),description=escapeHtmlEntities(description),""==href?link_type="0":(description="<p>"+description+"</p>",description+=descval,link_type="1"),(void 0==description||""==description)&&0==filescount)return $scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.attach_link,$scope.postContentStart=!1,$scope.postContentLoader=!1,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),!1;opts.user_id=APP.currentUser.id,opts.title=$scope.i18n.editprofile.no_use,opts.description=description,opts.youtube_url="",opts.to_id=$routeParams.friendId,opts.link_type=link_type,opts.post_id=$scope.tempPostId,opts.post_type="1",opts.media_id=[],opts.privacy_setting=$scope.privacySet;var friendId=[];if($scope.storedFriend.length>0){for(var i=0;i<$scope.storedFriend.length;i++)friendId.push($scope.storedFriend[i].user_info.id);opts.tagged_friends=friendId.join()}else opts.tagged_friends="";angular.forEach($scope.imagePrvSrc,function(file){opts.media_id.push(file.media_id)}),ProfileService.dashboardPost(opts,function(data){if(101==data.code){$scope.storedFriend=[],$scope.noContent=!1;var targetObject={};for(targetObject=data.data,$scope.userPostList.unshift(targetObject),$scope.postErrMsg="",$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$scope.postErrCls="",uploader.data.post_id={};uploader.queue.length;)uploader.queue[0].remove();$scope.tempPostId="",$scope.postContentStart=!1,$scope.postContentLoader=!1,$scope.postText="",$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$("#text_lp1").val(""),$("#text_lp1").attr("style",""),$timeout(function(){$("#closePreview_lp1").click()},100)}else 0==$scope.userPostList.length&&($scope.noContent=!0),$scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.post_unable,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.imagePrvSrc=[],$scope.postContentStart=!1,$scope.postProfileFiles=[],$scope.postText=void 0,$scope.postContentLoader=!1,$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1})},$scope.showTagForm=!1,$scope.showTagCloumn=function(){$scope.showTagForm===!1?($scope.showTagForm=!0,focus("friendSearchTagFriend")):$scope.showTagForm=!1},$scope.focusOn=function(){focus("friendSearchTagFriend")};var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;angular.element("#friendSearchTagFriend").keypress(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.tagFriendSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.tagFriendSuggestion=function(){$scope.cancelFriendSearch=!1,$scope.showFriendList=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.friendName,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&($scope.friends=data.data.users)})},$scope.storedFriend=[],$scope.dublicate=!1,$scope.selectFriend=function(friendInfo){$scope.dublicate=!1,angular.forEach($scope.storedFriend,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.storedFriend.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#friendSearchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#friendSearchTagFriend").val(""),$scope.showFriendList=!1)},$scope.lostFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#friendSearchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.removeTagFriend=function(friendIndex){var index=$scope.storedFriend.indexOf(friendIndex);$scope.storedFriend.splice(index,1)},$scope.friendTagIndex=-1,$scope.keyUpDownControl=function(event){40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex+1!==$scope.friends.length&&$scope.friendTagIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex-1!==-1&&$scope.friendTagIndex--):13===event.keyCode&&$scope.selectFriend($scope.friends[$scope.friendTagIndex])}},link:function(scope,iElement,iAttrs){$($("#lp1").linkPreview()).appendTo(iElement[0])},templateUrl:"app/views/profile_friend_post_form.html"}}]),app.directive("groupGrid",function(){return{restrict:"E",templateUrl:"./app/views/group_grid.html"}}),app.directive("groupCommentForm",["CommentService",function(CommentService){return{restrict:"E",templateUrl:"app/views/group_comment_form.html",scope:{loadComment:"&loadComment"},link:function(scope,elem,attrs){scope.addComment=function(){if(scope.postIndx=attrs.postIndx,scope.commentInProcess=!0,scope.commentErrMsg="",void 0===scope.commentText&&void 0===scope.myFile)return scope.commentInProcess=!1,scope.commentErrMsg=scope.i18n.groupcontrol.write_post,!1;if(void 0!==scope.myFile&&void 0===scope.commentText)return scope.commentInProcess=!1,scope.commentErrMsg=scope.i18n.groupcontrol.write_to_post,!1;var opts={};if(opts.session_id=APP.currentUser.id,opts.post_id=attrs.postId,opts.body=scope.commentText,opts.youtube_url="",void 0!==scope.myFile){var imageType=scope.myFile.name.substring(scope.myFile.name.lastIndexOf(".")+1);if("gif"!=imageType&&"png"!=imageType&&"jpg"!=imageType&&"jpeg"!=imageType)return scope.postErrorMsg=scope.i18n.groupcontrol.upload_media,scope.commentErrMsg=!1,!1;opts.commentfile=scope.myFile}CommentService.createComment(opts,scope.myFile,function(data){101==data.code?(scope.commentInProcess=!1,scope.commentErrorMsg="",scope.commentText="",scope.loadComment(attrs.postId),scope.myFile=""):(scope.commentInProcess=!1,scope.commentErrorMsg=scope.i18n.groupcontrol.not_posted,scope.myFile="")})}}}}]),app.directive("groupCommentForm",["CommentService","fileReader","FileUploader","$timeout",function(CommentService,fileReader,FileUploader,$timeout){return{restrict:"E",templateUrl:"app/views/group_comment_form.html",scope:!0,link:function(scope,elem,attrs){scope.showPreview=!1,scope.comment_id="",scope.image_id=[],scope.imgSrc=[],scope.isInProgress=[],scope.commentFiles=[],scope.selectInProgress=[],scope.imgRes=1,scope.getFile=function(){var tempopts={};tempopts.session_id=APP.currentUser.id,tempopts.postid=attrs.postId,tempopts.body=scope.i18n.editprofile.comment_image_test,tempopts.comment_type="0",tempopts.image_id="",tempopts.comment_id="";var len=scope.commentFiles.length;CommentService.createCommentWithImage(tempopts,scope.commentFiles[0],function(data){if(101==data.code)for(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),tempopts.comment_id=scope.comment_id,scope.selectInProgress.splice(0,1),j=1;j<len;j++)CommentService.createCommentWithImage(tempopts,scope.commentFiles[j],function(data){101==data.code?(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),scope.selectInProgress.splice(0,1)):(scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail)});else scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail}),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)},scope.removeImage=function(index){scope.imgSrc.splice(index,1),scope.isInProgress.splice(index,1),scope.image_id.splice(index,1),0==scope.imgSrc.length&&(scope.selectInProgress=[],scope.commentFiles==[],scope.file=[],scope.showImgSelect=!0,scope.showPreview=!1)},scope.res=0,scope.addComment=function(){scope.commentErrCls="",scope.commentErrMsg="",scope.finalCommentInProcess=!0,scope.commentErrMsg="";var filescount=scope.imgSrc.length,postIndx=attrs.postIndx;if((void 0===scope.commentText||""===scope.commentText)&&0===filescount)return scope.finalCommentInProcess=!1,scope.commentErrMsg=scope.i18n.groupcontrol.write_post,scope.commentErrCls="text-red",$timeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3),!1;var opts={};opts.session_id=APP.currentUser.id,opts.postid=attrs.postId,opts.body=scope.commentText,opts.media_id=[],opts.youtube_url="",opts.comment_id="",0!=scope.image_id.length&&(opts.media_id=scope.image_id),""!=scope.comment_id&&(opts.comment_id=scope.comment_id),opts.comment_type="1",opts.tagging=scope.taggedObject,0==scope.res&&(scope.res=1,CommentService.createComment(opts,function(data){scope.res=0,101==data.code?(scope.finalCommentInProcess=!1,scope.commentErrorMsg="",scope.commentErrCls="",scope.commentText="",scope.posts[postIndx].comments.push(data.data),scope.posts[postIndx].comment_count++,scope.commentFiles=[],scope.imgSrc=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id=""):(scope.finalCommentInProcess=!1,scope.showImgSelect=!0,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.groupcontrol.not_posted,scope.commentFiles=[],scope.imgSrc=[],scope.file=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id=""),$timeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)}))}}}}]),app.directive("groupPostList",function(){return{restrict:"E",controller:function($scope,PostService,$location,$timeout,$routeParams,CommentService,FileUploader,ProfileService,$modal,$log){$scope.editCommentText=[],$scope.activeCommentEdit=[],$scope.isEditComment=[],$scope.commentEditErrMsg=[],$scope.commentInProcess=[],$scope.commentEditErrCls=[],$scope.isSinglePostView=!1,$scope.temp=$routeParams.postId,void 0!=$routeParams.postId&&""!=$routeParams.postId&&($scope.isSinglePostView=!0),$scope.updateComment=function(postIndx,comment){var indx=$scope.posts[postIndx].comments.indexOf(comment);$("#commentBoxId-"+postIndx).hide(),$scope.commentInProcess[postIndx]=!0,$scope.commentEditErrMsg[postIndx]="",$scope.commentEditErrCls[postIndx]="",$scope.commentInProcess=[];var comment=($scope.posts[postIndx],$scope.posts[postIndx].comments[indx]);$scope.isEditComment[postIndx]=!1,$scope.activeCommentEdit[postIndx]=comment.id,$scope.editCommentText[postIndx]=comment.comment_text},$(document).click(function(){$("ul.actions-drop-action").hide()}),$scope.toggleEdit=function($event){$event.stopPropagation(),$($event.currentTarget).next("ul.actions-drop-action").is(":visible")?$($event.currentTarget).next("ul.actions-drop-action").hide():($("ul.actions-drop-action").hide(),$($event.currentTarget).next("ul.actions-drop-action").show())},$scope.editComment=function(postIndx,indx,comment){var opts={},post=$scope.posts[postIndx],indx=$scope.posts[postIndx].comments.indexOf(comment),commentData=$scope.posts[postIndx].comments[indx],newText=$scope.editCommentText[postIndx];if($scope.isEditComment[postIndx]=!0,void 0==newText||""==newText)return $scope.isEditComment[postIndx]=!1,$scope.commentEditErrCls[postIndx]="text-red",$scope.commentEditErrMsg[postIndx]=$scope.i18n.editprofile.no_empty_comment,$timeout(function(){$scope.commentEditErrCls[postIndx]="",$scope.commentEditErrMsg[postIndx]=""},15e3),!1;opts.session_id=$scope.currentUser.id,opts.post_id=post.post_id,opts.comment_id=commentData.id,opts.comment_author=commentData.comment_user_info,opts.youtube_url=commentData.youtube_url,opts.body=newText;var myFile="";CommentService.updateComment(opts,myFile,function(data){101==data.code?($scope.isEditComment[postIndx]=!1,$scope.commentInProcess[postIndx]=!1,$scope.commentEditErrMsg[postIndx]="",$scope.activeCommentEdit[postIndx]="",$scope.commentEditErrCls[postIndx]="",$scope.posts[postIndx].comments[indx].comment_text=$scope.editCommentText[postIndx],$("#commentBoxId-"+postIndx).show()):($scope.isEditComment[postIndx]=!1,$scope.commentInProcess[postIndx]=!1,$scope.commentEditErrMsg[postIndx]=$scope.i18n.editprofile.not_posted,$scope.commentEditErrCls[postIndx]="text-red")})},$scope.cancelEditComment=function(postIndx,indx){$scope.commentInProcess=[],$scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.editCommentText[postIndx]="",$scope.commentEditErrMsg[postIndx]="",$scope.commentEditErrCls[postIndx]="",$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()},$scope.delCommentErrMsg=[],$scope.delCommentErrCls=[],$scope.deleteComment=function(postIndx,comment){var indx=$scope.posts[postIndx].comments.indexOf(comment),commentData={};commentData=$scope.posts[postIndx].comments[indx],$scope.deleteCommentIndx=commentData.id;var formData={};formData.session_id=$scope.currentUser.id,formData.comment_id=commentData.id,CommentService.deleteComment(formData,function(data){101==data.code?($scope.delCommentErrMsg[commentData.id]="",$scope.delCommentErrCls[commentData.id]="",$scope.deleteCommentIndx="",$scope.posts[postIndx].comments.splice(indx,1),$scope.posts[postIndx].comment_count--):($scope.delCommentErrMsg[commentData.id]=$scope.i18n.dashboard.postcomment.delete_comment_fail,$scope.delCommentErrCls[commentData.id]="text-red",$scope.deleteCommentIndx=""),$timeout(function(){$scope.delCommentErrCls[commentData.id]="",$scope.delCommentErrMsg[commentData.id]=""},15e3)})},$scope.deleteMediaComment=function(comment,postIndx,mediaIndx){var commentData=comment,post=$scope.posts[postIndx];$scope.deleteCommentIndx=commentData.id;var formData={};formData.user_id=$scope.currentUser.id,formData.comment_id=commentData.id,formData.comment_media_id=commentData.comment_media_info[0].id,CommentService.deleteMediaComment(formData,function(data){if(101==data.code){$scope.deleteCommentIndx=-1;var opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)}else $scope.deleteCommentIndx=-1,$scope.posts})},$scope.showAllComments=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.session_id=$scope.currentUser.id,opts.limit_size=null,opts.limit_start=0,$scope.getComments(opts,postIndx)},$scope.showComments=[],$scope.commentLoading=[],$scope.getComments=function(opts,postIndx){$scope.posts[postIndx].comments=[],$scope.showComments[postIndx]=!0,$scope.commentLoading[postIndx]=!0,CommentService.listComment(opts,function(data){100==data.code?($scope.posts[postIndx].comments=data.data.comments,$scope.commentLoading[postIndx]=!1,0!=$scope.posts[postIndx].comments.length&&($scope.noComment=!0)):$scope.commentLoading[postIndx]=!1})}},templateUrl:"app/views/group_post_list.html"}}),app.directive("groupPostForm",function(){return{restrict:"E",link:function(scope,iElement,iAttrs){$($("#lp1").linkPreview()).appendTo(iElement[0])},templateUrl:"app/views/group_post_form.html"}}),app.directive("imgModalNew",["$timeout","$location",function($timeout,$location){return{restrict:"A",scope:!0,controller:function($scope,$modal,$log,SingleMediaDetailService,ProfileService,AlbumService,$routeParams){$scope.OpenModal=function(index,viewalbum,leng,mainId,albumtype,parenttype,supportId,ClubMember){var modalInstance1;$scope.showInLimit=!0,$scope.max=5,$scope.isReadonly=!1,$scope.album_type=albumtype,$scope.parent_type=parenttype,$scope.parent_id=mainId,$scope.media_index=index,$scope.leng=leng,$scope.pre_visible=!0,$scope.next_visible=!0,$scope.modal_loader=!0,$scope.viewalbum=viewalbum,$scope.supportId=supportId,$scope.media_id=$scope.viewalbum[$scope.media_index].id,void 0!=ClubMember&&($scope.is_member=ClubMember),$scope.friendTagIndex=0,$scope.tagged_Friends=[],$scope.UpdateTag=!1,$scope.TagLoader=!1,$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.dublicate=!1,$scope.toBelong=!1,$scope.tagged_collection=[],$scope.untagg_friend={},$scope.choose=!1,0===index&&($scope.pre_visible=!1),leng-1===index&&($scope.next_visible=!1),$scope.getmediainfo=function(){$scope.data=[];var opt=new Object;opt.media_id=$scope.media_id,opt.album_type=$scope.album_type,opt.album_id=$scope.parent_id,opt.user_id=APP.currentUser.id,opt.owner_id=$scope.supportId,SingleMediaDetailService.getMediaInfo(opt,function(data){101==data.code&&($scope.data=data.data,$scope.modal_loader=!1)})},$scope.showAllTaggedFriend=function(){$scope.showInLimit=!1},$scope.putFocus=function(){document.getElementById("searchTagFriend").focus()},$scope.getmediainfo();var modalInstance=$modal.open({templateUrl:"app/views/img_modal_new.html",controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date),$scope.tagged_Friends=[],$scope.UpdateTag=!1}),$scope.change_image=function(changetype){$scope.pre_visible=!0,$scope.modal_loader=!0,$scope.next_visible=!0,$scope.media_index="pre"==changetype?$scope.media_index-1:$scope.media_index+1,0===$scope.media_index&&($scope.pre_visible=!1),$scope.leng-1===$scope.media_index&&($scope.next_visible=!1),$scope.media_id=$scope.viewalbum[$scope.media_index].id,$scope.getmediainfo()},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.viewUserProfile=function(friendId){friendId==APP.currentUser.id?(modalInstance.dismiss("cancel"),modalInstance1.dismiss("cancel"),$location.path("profiles")):(modalInstance.dismiss("cancel"),modalInstance1.dismiss("cancel"),$location.path("/viewfriend/"+friendId))},$scope.Tagtoggle=function(){$scope.UpdateTag=!$scope.UpdateTag},$scope.tagFriendSuggestion=function(event,friendname){if(40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex+1!==$scope.friends.length&&$scope.friendTagIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex-1!==-1&&$scope.friendTagIndex--):13===event.keyCode&&($scope.friends.length>0&&-1!==$scope.friendTagIndex&&$scope.selectFriend($scope.friends[$scope.friendTagIndex]),1===$scope.friends.length&&$scope.selectFriend($scope.friends[0])),""===$("#searchTagFriend").val().trim()&&($scope.showFriendList=!1),event.keyCode>=65&&event.keyCode<=95){$scope.cancelFriendSearch=!1;var opts={};opts.user_id=APP.currentUser.id,friendname?opts.friend_name=friendname:opts.friend_name="",opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&(data.data.users.length>0?$scope.showFriendList=!0:$scope.showFriendList=!1,$scope.friends=data.data.users)})}},$scope.selectFriend=function(friendInfo){$scope.dublicate=!1,$scope.choose=!1,angular.forEach($scope.data.tagged_friends_info,function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.data.tagged_friends_info.push(friendInfo.user_info),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1)},$scope.taggService=function(){var pre_visible_status=$scope.pre_visible,next_visible_status=$scope.next_visible;$scope.pre_visible=!1,$scope.next_visible=!1;var frnd_array=[];angular.forEach($scope.data.tagged_friends_info,function(index){frnd_array.push(index.id)});var opts={};opts.user_id=APP.currentUser.id,opts.album_id=$scope.parent_id,opts.post_type=1,opts.media_id=[$scope.media_id],opts.tagged_friends=frnd_array.join(","),$scope.UpdateTag=!1,$scope.TagLoader=!0,AlbumService.photoTaging(opts,function(data){101===data.code&&($scope.choose=!0,$scope.TagLoader=!1),$scope.pre_visible=pre_visible_status,$scope.next_visible=next_visible_status})},$scope.removeTagFriend=function(friendIndex){$scope.data.tagged_friends_info.splice(friendIndex,1)},$scope.lostFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.waitRateResponse=!1,$scope.ratePicture=function(rating,picture_id,mediaIndex){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type_id=picture_id,opts.rate=rating,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,update=$scope.data.is_rated?"update":"add",$scope.waitRateResponse=!0,ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.data.avg_rate=data.data.avg_rate,$scope.data.no_of_votes=data.data.no_of_votes,$scope.data.is_rated=!0,$scope.data.current_user_rate=data.data.current_user_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.data.current_user_rate=0,$scope.data.is_rated=!0),$scope.waitRateResponse=!1})},$scope.removeRating=function(pictureIndex,mediaIndex){var opts={};opts.user_id=APP.currentUser.id,opts.type_id=pictureIndex,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,$scope.waitRateResponse===!1&&($scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.data.current_user_rate=0,$scope.data.avg_rate=data.data.avg_rate,$scope.data.no_of_votes=data.data.no_of_votes,$scope.data.is_rated=!1):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.data.current_user_rate=0,$scope.data.is_rated=!1),$scope.waitRateResponse=!1}))},$scope.findPeopleRate=function(id,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},modalInstance1=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope}),$scope.showPeopleLoader=!0,"friend_album"==$scope.parent_type?opts.type="user_profile_album_photo":opts.type=$scope.parent_type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance1.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance1.dismiss("cancel"),modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}}}}}]),app.directive("leftPanel",function(){return{restrict:"E",controller:"ProfileImageController",templateUrl:"./app/views/left_panel.html"}}),app.directive("rightPanel",function(){return{restrict:"E",templateUrl:"./app/views/right_panel.html"}}),app.directive("profileCommentForm",["ProfileService","fileReader","$http","$timeout","$interval",function(ProfileService,fileReader,$http,$timeout,$interval){return{restrict:"E",templateUrl:"app/views/profile_comment_form.html",scope:!0,link:function(scope,elem,attrs){scope.showPreview=!1,scope.comment_id="",scope.image_id=[],scope.imgSrc=[],scope.isInProgress=[],scope.commentFiles=[],scope.selectInProgress=[],scope.imgRes=1,scope.commentErrMsg="",scope.commentErrCls="",scope.getFile=function(){var tempopts={};tempopts.user_id=APP.currentUser.id,tempopts.postid=attrs.postId,tempopts.body=scope.i18n.editprofile.comment_image_test,tempopts.comment_type="0",tempopts.image_id="",tempopts.comment_id="";var len=scope.commentFiles.length;ProfileService.createDashboardCommentImage(tempopts,scope.commentFiles[0],function(data){if(101==data.code)for(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),tempopts.comment_id=scope.comment_id,scope.selectInProgress.splice(0,1),j=1;j<len;j++)ProfileService.createDashboardCommentImage(tempopts,scope.commentFiles[j],function(data){101==data.code?(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),scope.selectInProgress.splice(0,1)):(scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail)});else scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail}),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)},scope.removeImage=function(index){var tempMedia=scope.image_id[index],opts={};opts.user_id=APP.currentUser.id,opts.postid=attrs.postId,opts.image_id=tempMedia,ProfileService.deleteDashboardMediaComments(opts,function(data){101==data.code?(scope.imgSrc.splice(index,1),scope.isInProgress.splice(index,1),0==scope.imgSrc.length&&(scope.commentFiles==[],scope.file=[]),scope.image_id.splice(index,1),0==scope.imgSrc.length&&(scope.selectInProgress=[],scope.showImgSelect=!0,scope.showPreview=!1)):(scope.showImgSelect=!0,scope.showPreview=!0,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.remove_img_fail),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)})},scope.res=0,scope.addComment=function(){scope.postIndx=attrs.postIndx,scope.comments=attrs.loadComment,scope.finalCommentInProcess=!0,scope.commentErrMsg="",scope.commentErrCls="";var filescount=scope.imgSrc.length;if((void 0==scope.commentText||""==scope.commentText)&&0==filescount)return scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.photo_update,setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3),!1;var opts={};opts.user_id=APP.currentUser.id,opts.postid=attrs.postId,opts.body=scope.commentText,opts.media_id=[],opts.comment_id="",0!=scope.image_id.length&&(opts.media_id=scope.image_id),""!=scope.comment_id&&(opts.comment_id=scope.comment_id),opts.comment_type="1",opts.tagging=scope.taggedObject,0==scope.res&&(scope.res=1,ProfileService.createDashboardCommentFinal(opts,function(data){scope.res=0,101==data.code?(scope.commentText="",scope.post.comments.push(data.data),scope.post.comment_count++,scope.finalCommentInProcess=!1,scope.commentErrMsg="",scope.commentErrCls="",scope.commentText="",scope.commentFiles=[],scope.imgSrc=[],scope.file=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id=""):(scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.comment_no_post,scope.commentFiles=[],scope.imgSrc=[],scope.file=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id="")}),$timeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3))}}}}]),app.directive("profilePostList",function($routeParams,$modal,$log,$location,ProfileService,focus){return{restrict:"E",controller:function($scope,$timeout,$sce,$compile){$scope.showComments=[],$scope.commentsLength=[],$scope.userPostList=[],$scope.showComments=[],$scope.commentsLength=[],$scope.noPostList=!1,$scope.isLoadPost=!0,$scope.textLimit=APP.post_charecter_limit,$scope.isSingleProfile=!1,""!==$routeParams.postId&&void 0!=$routeParams.postId&&($scope.isSingleProfile=!0),$(document).click(function(){$("ul.actions-drop-action").hide()}),$scope.toggleEdit=function($event){$event.stopPropagation(),$($event.currentTarget).next("ul.actions-drop-action").is(":visible")?$($event.currentTarget).next("ul.actions-drop-action").hide():($("ul.actions-drop-action").hide(),$($event.currentTarget).next("ul.actions-drop-action").show())},$scope.loadMoreFunc="loadMorePost()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMorePost()")},!0),$scope.listUserPost=function(){var opts={},limit_start=$scope.userPostList.length;opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.dashbord_pagination.end,opts.friend_id=APP.currentUser.id,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes?($scope.myRes=0,
ProfileService.listDashboardPost(opts,function(data){if(101==data.code){$scope.isLoadPost=!1;var items=data.data.post;void 0!=items&&($scope.userPostList=$scope.userPostList.concat(items),$scope.noPostList=!1),0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.totalSize=data.data.count}else $scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList;$scope.myRes=1})):($scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList)},$scope.deleteErrMsg=[],$scope.isDeletePost=[],$scope.deleteErrCls=[],$scope.deletePost=function(postIndx){var postData={};postData=$scope.userPostList[postIndx],$scope.isDeletePost[postIndx]=!0,$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="";var formData={};formData.user_id=APP.currentUser.id,formData.post_id=postData.id,ProfileService.deleteDashboardPost(formData,function(data){101==data.code?($scope.userPostList.splice(postIndx,1),0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.isDeletePost[postIndx]=!1):($scope.deleteErrCls[postIndx]="text-red",$scope.deleteErrMsg[postIndx]=$scope.i18n.dashboard.postcomment.delete_post_fail,$scope.isDeletePost[postIndx]=!1),$timeout(function(){$scope.deleteErrCls[postIndx]="",$scope.deleteErrMsg[postIndx]=""},15e3)})},$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,$scope.creater=creater_info;var modalInstance=$modal.open({template:'<style>.modal-open .modal.in .modal-dialog{width:620px; height:400px;}</style><div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a href ng-click="viewFriendProile(friend.id)">{{friend.first_name}} {{friend.last_name}}</a></span><span data-ng-if="creater.id === currentUser.id || currentUser.id === friend.id" ng-click="RemoveTagFriend(friend, creater.id)" class="rmv-tag"><a href>{{i18n.profile_post.remove_tagged_friend}}</a></span></li></ul></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)},$scope.RemoveTagFriend=function(friend,createrId){var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=friend.id,opts.post_id=$scope.post_id,ProfileService.removeTagedFriends(opts,function(data){if(101===data.code){var index=$scope.allTagFriends.indexOf(friend);$scope.allTagFriends.splice(index,1),createrId!=APP.currentUser.id&&modalInstance.close(),0===$scope.allTagFriends.length&&modalInstance.close()}})}},$scope.editPostErrorMsg=[],$scope.updatePostInProcess=[],$scope.editPostErrorCls=[],$scope.saveUpdatePost=function(postIndx){var opts={};$scope.updatePostInProcess[postIndx]=!0;var editPostText=escapeHtmlEntities($scope.updateBody[postIndx]),post=$scope.userPostList[postIndx];if(void 0==editPostText||""==editPostText)return $scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_status,$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3),!1;var regex=/src="([^"]+)"/,src=editPostText.split(regex)[1];void 0!=src&&""!=src&&(editPostText=src),opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.title=post.title,opts.description=editPostText,opts.to_id=post.to_id,opts.youtube_url="",opts.post_type="1",opts.privacy_setting=post.privacy_setting;var friendIdList=[];$scope.postTaggedFriend[postIndx].length>0?(angular.forEach($scope.postTaggedFriend[postIndx],function(index){friendIdList.push(index.id)}),opts.tagged_friends=friendIdList.join()):opts.tagged_friends="",ProfileService.updateDashboardPost(opts,function(data){101==data.code?($scope.postTaggedFriend[postIndx].length>0?post.tagged_friends_info=$scope.postTaggedFriend[postIndx]:post.tagged_friends_info="",$scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.userPostList[postIndx].description=editPostText,$scope.editPostText="",$scope.activeEdit[postIndx]=!1):($scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.post_unsaved),$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3)})},$scope.editPrivacyMsg=[],$scope.editPrivacyCls=[],$scope.changePrivacy=function(post,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.privacy_setting=post.privacy_setting;ProfileService.updatePostPrivacy(opts,function(data){101==data.code?($scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""):($scope.editPrivacyCls[postIndx]="text-red",$scope.editPrivacyMsg[postIndx]=$scope.i18n.editprofile.privacy_setting,$timeout(function(){$scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""},15e3))})},$scope.gainPostFocus=function(indx){focus("postListTagged"+indx)},$scope.updateBody=[],$scope.activeEdit=[],$scope.postTaggedFriend=[],$scope.showTagLoading=[],$scope.updatePost=function(postIndx){$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]="";var post=$scope.userPostList[postIndx];autosize(document.querySelectorAll(".editpostbox"));var str=$.trim(post.description.replace(/\n\n\n+/g,"\n\n")),htmlstr=str.replace(/\n/g,"<br />"),height=$('<div style="display:block;" id="postedit-hidden-div"></div>').html(htmlstr).appendTo("#post_"+post.id).height();$("#editpost_"+post.id).css("height",height+"px"),str=$("#postedit-hidden-div").html(str).text(),$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]=str,$scope.postTaggedFriend[postIndx]=[],angular.forEach(post.tagged_friends_info,function(val,indx){$scope.postTaggedFriend[postIndx].push(val)}),$scope.activeEdit[postIndx]=!0,$scope.showTagLoading[postIndx]=!0,$timeout(function(){$("#editpost_"+post.id).putCursorAtStart()},200)},$scope.cancelPost=function(postIndx){$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]="",$scope.showTagLoading[postIndx]=!1,$scope.postTaggedFriend=[]},$scope.removePostTagFriend=function(index,postIndex){$scope.postTaggedFriend[postIndex].splice(index,1)};var currentTimeout=null;$scope.addMoreFriend=function(event,index){var DELAY_TIME_BEFORE_POSTING=300;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchMoreFriend(index)},DELAY_TIME_BEFORE_POSTING)},$scope.friends=[],$scope.showSearchFriendLoader=[],$scope.cancelFriendSearch=!1,$scope.showSearchFriendList=[],$scope.searchMoreFriend=function(postIndx){$scope.searchFriend=$(".addMoreTagFriend"+postIndx).val(),$scope.cancelFriendSearch=!1,$scope.showSearchFriendList[postIndx]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.searchFriend,opts.session_id=APP.currentUser.id,opts.limit_start=0,$scope.friendTagIndex[postIndx]=-1,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchFriendLoader[postIndx]=!0,$scope.showTagLoading[postIndx]=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchFriendLoader[postIndx]=!1,$scope.cancelFriendSearch===!1&&data.data.users.length>0&&($scope.friends[postIndx]=data.data.users)})},$scope.postTaggedFriend=[],$scope.dublicate=!1,$scope.taggedSelectFriend=function(friendInfo,postIndex){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.postTaggedFriend[postIndex],function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.postTaggedFriend[postIndex].push({id:friendInfo.user_id,first_name:friendInfo.user_info.first_name,last_name:friendInfo.user_info.last_name,profile_image:friendInfo.user_info.profile_image,profile_image_thumb:friendInfo.user_info.profile_image_thumb}),$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1):($scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1))},$scope.lostFocus=function(postIndex){$timeout(function(){$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1},300)},$scope.friendTagIndex=[],$scope.searchNevigateControl=function(event,index){40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]+1!==$scope.friends[index].length&&$scope.friendTagIndex[index]++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]-1!==-1&&$scope.friendTagIndex[index]--):13===event.keyCode&&$scope.taggedSelectFriend($scope.friends[index][$scope.friendTagIndex[index]],index)},$scope.getUserPostDetail=function(id){var opts={};opts.user_id=APP.currentUser.id,opts.post_id=id,0==$scope.totalSize&&1==$scope.myRes?($scope.myRes=0,ProfileService.getDashboardPostDetail(opts,function(data){if(101==data.code){$scope.isLoadPost=!1;var items=data.data.post;void 0!=items&&($scope.userPostList=$scope.userPostList.concat(items),$scope.noPostList=!1),0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.totalSize=data.data.count}else $scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList;$scope.myRes=1})):($scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList)},$scope.showUserPostList=function(){$scope.isLoadPost=!0,$scope.totalSize=0,$scope.myRes=1,($routeParams.postId?$routeParams.postId:"")?$scope.getUserPostDetail($routeParams.postId):$scope.listUserPost()},$scope.commentLoading=[],$scope.getComments=function(postIndx){var post=$scope.userPostList[postIndx];$scope.userPostList[postIndx].comments=[];var opts={};opts.post_id=post.id,opts.user_id=APP.currentUser.id,opts.limit_start=APP.dashbord_comment.start,opts.limit_size=APP.dashbord_comment.end,ProfileService.getDashboardComments(opts,function(data){100==data.code?($scope.userPostList[postIndx].comments=data.data.comment,$scope.commentLoading[postIndx]=!1,$scope.commentsLength[postIndx]=$scope.userPostList[postIndx].comments.length,0!=$scope.userPostList[postIndx].comments.length&&($scope.noComment=!0)):$scope.commentLoading[postIndx]=!1})},$scope.showLimitedComment=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)},$scope.showAllComments=function(postIndx){$scope.commentLoading[postIndx]=!0,$scope.showComments[postIndx]=!0,$scope.getComments(postIndx)},$scope.pageSize=4,$scope.delCommentErrMsg=[],$scope.delCommentErrCls=[],$scope.deleteComment=function(postIndx,comment){var indx=$scope.userPostList[postIndx].comments.indexOf(comment),commentData={};commentData=$scope.userPostList[postIndx].comments[indx],$scope.deleteCommentIndx=commentData.id;var formData={};formData.user_id=APP.currentUser.id,formData.comment_id=commentData.id,ProfileService.deleteDashboardComment(formData,function(data){101==data.code?($scope.delCommentErrMsg[commentData.id]="",$scope.delCommentErrCls[commentData.id]="",$scope.userPostList[postIndx].comments.splice(indx,1),$scope.userPostList[postIndx].comment_count--,$scope.deleteCommentIndx=""):($scope.delCommentErrMsg[commentData.id]=$scope.i18n.dashboard.postcomment.delete_comment_fail,$scope.delCommentErrCls[commentData.id]="text-red",$scope.deleteCommentIndx="",$scope.userPostList),$timeout(function(){$scope.delCommentErrCls[commentData.id]="",$scope.delCommentErrMsg[commentData.id]=""},15e3)})},$scope.editCommentText=[],$scope.activeCommentEdit=[],$scope.isEditComment=[],$scope.commentErrorMsg=[],$scope.commentErrorCls=[],$scope.commentInProcess=[],$scope.updateComment=function(postIndx,comment){$("#commentBoxId-"+postIndx).hide(),$scope.commentInProcess[postIndx]=!0,$scope.commentErrorMsg[postIndx]="",$scope.commentErrorCls[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx];$scope.isEditComment[postIndx]=!1,$scope.activeCommentEdit[postIndx]=comment.id,$scope.editCommentText[postIndx]=comment.comment_text},$scope.editComment=function(postIndx,comment){var opts={};$scope.commentErrorMsg[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx],newText=$scope.editCommentText[postIndx];return $scope.isEditComment[postIndx]=!0,void 0==newText||""==newText?($scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_comment,$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3),!1):(opts.user_id=APP.currentUser.id,opts.comment_id=comment.id,opts.comment_text=newText,opts.tagging=$(".taggedObject"+postIndx).val(),void ProfileService.updateDashboardComment(opts,function(data){101==data.code?($scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.editCommentText[postIndx]="",$scope.userPostList[postIndx].comments[indx].comment_text=newText,$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()):($scope.commentInProcess[postIndx]=!1,$scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.not_posted,$("#commentBoxId-"+postIndx).show()),$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3)}))},$scope.cancelEditComment=function(postIndx,indx){$scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.editCommentText[postIndx]="",$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()},$scope.loadMorePost=function(){$scope.totalSize>$scope.userPostList.length&&($scope.isLoadPost=!0,$scope.listUserPost())},$scope.showUserPostList(),$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.ratePost=function(rating,post_id,index){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.userPostList[index].is_rated?"update":"add",ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.userPostList[index].avg_rate=data.data.avg_rate,$scope.userPostList[index].no_of_votes=data.data.no_of_votes,$scope.userPostList[index].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[index].is_rated=!1,$scope.userPostList[index].current_user_rate=0),$scope.waitRateResponse=!1})},$scope.WaitDeleteResponse=!1,$scope.removeRating=function(post_id,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.userPostList[postIndx].current_user_rate=0,$scope.userPostList[postIndx].is_rated=!1,$scope.userPostList[postIndx].no_of_votes=data.data.no_of_votes,$scope.userPostList[postIndx].avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[postIndx].current_user_rate=0,$scope.userPostList[postIndx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.stars=[],$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}],$scope.showPeopleLoader=!1,$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}},link:function($scope){$(".fancybox").fancybox()},templateUrl:"app/views/profile_post_list.html"}}).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.directive("profilePostForm",function($timeout,ProfileService,FileUploader,$sce,focus){return{restrict:"E",controller:function($scope,$timeout){$scope.postErrCls="",$scope.privacySet=3,$scope.postErrMsg="",$scope.postErrCls="",$scope.postContentStart=!1,$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$scope.imgProgress=[],$scope.postImgLoader=[],$scope.progress=[],$scope.tempPostId="";var uploader=$scope.uploader=new FileUploader({url:APP.service.dashboardpost+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id,title:"Not in use on frontend",description:"",youtube_url:"",to_id:APP.currentUser.id,link_type:"0",post_type:"0",privacy_setting:$scope.privacySet},dataObjName:"reqObj",formDataName:"postfile[]"});uploader.filters.push({name:"postfile[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.addImage=function(){var href=$("#previewUrl_lp1").html();""!=href&&$timeout(function(){$("#closePreview_lp1").click()},100),$scope.isImage=!0,$scope.imgUpload=!1,$scope.uploadBox=!0,$scope.imagePrvSrc=[],uploader.queue=[],$scope.postProfileFiles=[]},$scope.addPost=function(){$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.isPost=!0,$scope.imagePrvSrc=[],uploader.queue=[],$scope.postProfileFiles=[]},$scope.removeImage=function(index){var item=$scope.uploader.queue[index];item.remove();var tempImg=$scope.imagePrvSrc[index];$scope.imagePrvSrc.splice(index,1);var formData={};formData.user_id=APP.currentUser.id,formData.post_media_id=tempImg.media_id,ProfileService.deletePostMedia(formData,function(data){101==data.code||($scope.imagePrvSrc[index]=tempImg,$scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.dashboard.postcomment.remove_img_fail,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.userPostList)})},uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0,uploader.data.post_id=$scope.tempPostId;var queueLen=uploader.queue.length-1;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.postImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imagePrvSrc[index]=response.data,$scope.postImgLoader[index]=!1,$scope.tempPostId=response.data.id,uploader.data.post_id=response.data.id)},uploader.onCompleteAll=function(){$timeout(function(){$scope.postContentStart=!1},1e3)},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.postErrMsg=$scope.i18n.editprofile.no_media_valid,$scope.postErrCls="text-red",$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3)},$scope.createPost=function(){$scope.noContent=!1,$scope.updateBody=[],$scope.activeEdit=[],$scope.editPostErrorMsg=[];var link_type;$scope.postContentStart=!0,$scope.postContentLoader=!0;var opts={};$scope.postErrMsg="";var filescount=$scope.imagePrvSrc.length,description="",src="",descval=$("#preview_lp1").html(),href=$("#previewUrl_lp1").html(),textarea=$("#text_lp1").val();description=textarea;var regex=/src="([^"]+)"/;if(src=description.split(regex)[1],void 0!=src&&""!=src&&(description=src),description=escapeHtmlEntities(description),""==href?link_type="0":(description="<p>"+description+"</p>",description+=descval,link_type="1"),(void 0==description||""==description)&&0==filescount)return $scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.attach_link,$scope.postContentStart=!1,$scope.postContentLoader=!1,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),!1;opts.user_id=APP.currentUser.id,opts.title=$scope.i18n.editprofile.no_use,opts.description=description,opts.youtube_url="",opts.to_id=APP.currentUser.id,opts.link_type=link_type,opts.post_id=$scope.tempPostId,opts.post_type="1",opts.media_id=[],opts.privacy_setting=$scope.privacySet;var friendId=[];if($scope.storedFriend.length>0){for(var i=0;i<$scope.storedFriend.length;i++)friendId.push($scope.storedFriend[i].user_info.id);opts.tagged_friends=friendId.join()}else opts.tagged_friends="";angular.forEach($scope.imagePrvSrc,function(file){opts.media_id.push(file.media_id)}),ProfileService.dashboardPost(opts,function(data){if(101==data.code){$scope.storedFriend=[],$scope.showTagForm=!1;var targetObject={};for(targetObject=data.data,$scope.userPostList.unshift(targetObject),$scope.postErrMsg="",$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),uploader.data.post_id={};uploader.queue.length;)uploader.queue[0].remove();0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.noPostList=!1,$scope.tempPostId="",$scope.postContentStart=!1,$scope.postContentLoader=!1,$scope.postText="",$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$("#text_lp1").val(""),$("#text_lp1").attr("style",""),$timeout(function(){$("#closePreview_lp1").trigger("click")},100)}else $scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.post_unable,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$scope.postText=void 0,$scope.postContentLoader=!1,$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1})},$scope.showTagForm=!1,$scope.showTagCloumn=function(){$scope.showTagForm===!1?($scope.showTagForm=!0,focus("searchTagFriend")):$scope.showTagForm=!1},$scope.gainFocus=function(){focus("searchTagFriend")};var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;angular.element("#searchTagFriend").keypress(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.tagFriendSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.tagFriendSuggestion=function(){$scope.cancelFriendSearch=!1,$scope.showFriendList=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.friendName,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&($scope.friends=data.data.users)})},$scope.storedFriend=[],$scope.dublicate=!1,$scope.selectFriend=function(friendInfo){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.storedFriend,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.storedFriend.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1))},$scope.lostFormFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.removeTagFriend=function(friendIndex){$scope.storedFriend.splice(friendIndex,1)},$scope.friendTaggIndex=-1,$scope.keyUpDownControl=function(event){console.log($scope.friendTaggIndex),40===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex+1!==$scope.friends.length&&$scope.friendTaggIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex-1!==-1&&$scope.friendTaggIndex--):13===event.keyCode&&$scope.selectFriend($scope.friends[$scope.friendTaggIndex])}},link:function(scope,iElement,iAttrs){$($("#lp1").linkPreview()).appendTo(iElement[0])},templateUrl:"app/views/profile_post_form.html"}}),app.directive("showProgress",function(){return{restrict:"E",template:'<img src="app/assets/images/proceed.gif" alt="processing..." />'}}),app.directive("profileCommentForm",["ProfileService","fileReader","$http","$timeout","$interval",function(ProfileService,fileReader,$http,$timeout,$interval){return{restrict:"E",templateUrl:"app/views/profile_comment_form.html",scope:!0,link:function(scope,elem,attrs){scope.showPreview=!1,scope.comment_id="",scope.image_id=[],scope.imgSrc=[],scope.isInProgress=[],scope.commentFiles=[],scope.selectInProgress=[],scope.imgRes=1,scope.commentErrMsg="",scope.commentErrCls="",scope.getFile=function(){var tempopts={};tempopts.user_id=APP.currentUser.id,tempopts.postid=attrs.postId,tempopts.body=scope.i18n.editprofile.comment_image_test,tempopts.comment_type="0",tempopts.image_id="",tempopts.comment_id="";var len=scope.commentFiles.length;ProfileService.createDashboardCommentImage(tempopts,scope.commentFiles[0],function(data){if(101==data.code)for(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),tempopts.comment_id=scope.comment_id,scope.selectInProgress.splice(0,1),j=1;j<len;j++)ProfileService.createDashboardCommentImage(tempopts,scope.commentFiles[j],function(data){101==data.code?(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),scope.selectInProgress.splice(0,1)):(scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail)});else scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail}),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)},scope.removeImage=function(index){var tempMedia=scope.image_id[index],opts={};opts.user_id=APP.currentUser.id,opts.postid=attrs.postId,opts.image_id=tempMedia,ProfileService.deleteDashboardMediaComments(opts,function(data){101==data.code?(scope.imgSrc.splice(index,1),scope.isInProgress.splice(index,1),0==scope.imgSrc.length&&(scope.commentFiles==[],scope.file=[]),scope.image_id.splice(index,1),0==scope.imgSrc.length&&(scope.selectInProgress=[],scope.showImgSelect=!0,scope.showPreview=!1)):(scope.showImgSelect=!0,scope.showPreview=!0,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.remove_img_fail),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)})},scope.addComment=function(){scope.postIndx=attrs.postIndx,scope.comments=attrs.loadComment,scope.finalCommentInProcess=!0,scope.commentErrMsg="",scope.commentErrCls="";var filescount=scope.imgSrc.length;if((void 0==scope.commentText||""==scope.commentText)&&0==filescount)return scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.photo_update,setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3),!1;var opts={};opts.user_id=APP.currentUser.id,opts.postid=attrs.postId,opts.body=scope.commentText,opts.media_id=[],opts.comment_id="",0!=scope.image_id.length&&(opts.media_id=scope.image_id),""!=scope.comment_id&&(opts.comment_id=scope.comment_id),opts.comment_type="1",ProfileService.createDashboardCommentFinal(opts,function(data){101==data.code?(scope.commentText="",scope.post.comments.push(data.data),scope.finalCommentInProcess=!1,scope.commentErrMsg="",scope.commentErrCls="",scope.commentText="",scope.commentFiles=[],scope.imgSrc=[],scope.file=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id=""):(scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.comment_no_post,scope.commentFiles=[],scope.imgSrc=[],scope.file=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id="")}),$timeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)}}}}]),app.directive("profilePostList",function($routeParams,$modal,$log,ProfileService){return{restrict:"E",controller:function($scope,$timeout,$sce,$compile){$scope.showComments=[],$scope.commentsLength=[],$scope.userPostList=[],$scope.showComments=[],$scope.commentsLength=[],$scope.noPostList=!1,$scope.isLoadPost=!0,$scope.textLimit=APP.post_charecter_limit,$(document).on({click:function(){var that=$(this),postType=that.attr("postType");if(1==postType){var fullText=that.parent().parent().attr("fullText");that.parent().parent().html(fullText.replace(/\n/g,"<br />"))}else{var fullText=that.parent().attr("fullText");that.parent().html(fullText.replace(/\n/g,"<br />"))}return!1}},".morelink"),$scope.loadMoreFunc="loadMorePost()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMorePost()")},!0),$scope.listUserPost=function(){var opts={},limit_start=$scope.userPostList.length;opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.dashbord_pagination.end,opts.friend_id=APP.currentUser.id,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes?($scope.myRes=0,ProfileService.listDashboardPost(opts,function(data){if(100==data.code){$scope.isLoadPost=!1;var items=data.data.post;void 0!=items&&($scope.userPostList=$scope.userPostList.concat(items),$scope.noPostList=!1),0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.totalSize=data.data.count}else $scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList;$scope.myRes=1})):($scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList)},$scope.deleteErrMsg=[],$scope.isDeletePost=[],$scope.deleteErrCls=[],$scope.deletePost=function(postIndx){var postData={};postData=$scope.userPostList[postIndx],$scope.isDeletePost[postIndx]=!0,$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="";var formData={};formData.user_id=APP.currentUser.id,formData.post_id=postData.id,ProfileService.deleteDashboardPost(formData,function(data){
101==data.code?($scope.userPostList.splice(postIndx,1),0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.isDeletePost[postIndx]=!1):($scope.deleteErrCls[postIndx]="text-red",$scope.deleteErrMsg[postIndx]=$scope.i18n.dashboard.postcomment.delete_post_fail,$scope.isDeletePost[postIndx]=!1),$timeout(function(){$scope.deleteErrCls[postIndx]="",$scope.deleteErrMsg[postIndx]=""},15e3)})},$scope.editPostErrorMsg=[],$scope.updatePostInProcess=[],$scope.editPostErrorCls=[],$scope.saveUpdatePost=function(postIndx){var opts={};$scope.updatePostInProcess[postIndx]=!0;var editPostText=$scope.updateBody[postIndx],post=$scope.userPostList[postIndx];if(void 0==editPostText||""==editPostText)return $scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_status,$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3),!1;opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.title=post.title,opts.description=editPostText,opts.to_id=post.to_id,opts.youtube_url="",opts.post_type="1",opts.privacy_setting=post.privacy_setting;var friendIdList=[];$scope.postTaggedFriend[postIndx].length>0?(angular.forEach($scope.postTaggedFriend[postIndx],function(index){friendIdList.push(index.id)}),opts.tagged_friends=friendIdList.join()):opts.tagged_friends="",ProfileService.updateDashboardPost(opts,function(data){101==data.code?($scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.userPostList[postIndx].description=editPostText,$scope.editPostText="",$scope.activeEdit[postIndx]=!1):($scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.post_unsaved),$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3)})},$scope.editPrivacyMsg=[],$scope.editPrivacyCls=[],$scope.changePrivacy=function(post,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.title=post.title,opts.description=post.description,opts.to_id=post.to_id,opts.youtube_url="",opts.post_type="1",opts.privacy_setting=post.privacy_setting;ProfileService.updateDashboardPost(opts,function(data){101==data.code?($scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""):($scope.editPrivacyCls[postIndx]="text-red",$scope.editPrivacyMsg[postIndx]=$scope.i18n.editprofile.privacy_setting,$timeout(function(){$scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""},15e3))})},$scope.updateBody=[],$scope.activeEdit=[],$scope.postTaggedFriend=[],$scope.showTagLoading=[],$scope.updatePost=function(postIndx){$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]="";var post=$scope.userPostList[postIndx];$scope.updateBody[postIndx]=post.description,$scope.postTaggedFriend[postIndx]=post.tagged_friends_info,$scope.activeEdit[postIndx]=!0,$scope.showTagLoading[postIndx]=!0},$scope.cancelPost=function(postIndx){$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]="",$scope.showTagLoading[postIndx]=!1,$scope.postTaggedFriend=[]},$scope.removePostTagFriend=function(index,postIndex){$scope.postTaggedFriend[postIndex].splice(index,1)};var currentTimeout=null;$scope.addMoreFriend=function(event,index){var DELAY_TIME_BEFORE_POSTING=300;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchMoreFriend(index)},DELAY_TIME_BEFORE_POSTING)},$scope.friends=[],$scope.showSearchFriendLoader=[],$scope.cancelFriendSearch=!1,$scope.showSearchFriendList=[],$scope.searchMoreFriend=function(postIndx){$scope.searchFriend=$(".addMoreTagFriend"+postIndx).val(),$scope.cancelFriendSearch=!1,$scope.showSearchFriendList[postIndx]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.searchFriend,opts.limit_start=0,$scope.friendTagIndex[postIndx]=-1,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchFriendLoader[postIndx]=!0,$scope.showTagLoading[postIndx]=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchFriendLoader[postIndx]=!1,$scope.cancelFriendSearch===!1&&data.data.users.length>0&&($scope.friends[postIndx]=data.data.users)})},$scope.postTaggedFriend=[],$scope.dublicate=!1,$scope.taggedSelectFriend=function(friendInfo,postIndex){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.postTaggedFriend[postIndex],function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?(console.log(friendInfo),console.log(postIndex),$scope.postTaggedFriend[postIndex].push({id:friendInfo.user_id,first_name:friendInfo.user_info.first_name,last_name:friendInfo.user_info.last_name,profile_image:friendInfo.user_info.profile_image,profile_image_thumb:friendInfo.user_info.profile_image_thumb}),$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1):($scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1))},$scope.lostFocus=function(postIndex){$timeout(function(){$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1},300)},$scope.friendTagIndex=[],$scope.searchNevigateControl=function(event,index){40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]+1!==$scope.friends[index].length&&$scope.friendTagIndex[index]++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]-1!==-1&&$scope.friendTagIndex[index]--):13===event.keyCode&&$scope.taggedSelectFriend($scope.friends[index][$scope.friendTagIndex[index]],index)},$scope.getUserPostDetail=function(id){var opts={};opts.user_id=APP.currentUser.id,opts.post_id=id,0==$scope.totalSize&&1==$scope.myRes?($scope.myRes=0,ProfileService.getDashboardPostDetail(opts,function(data){if(101==data.code){$scope.isLoadPost=!1;var items=data.data.post;void 0!=items&&($scope.userPostList=$scope.userPostList.concat(items),$scope.noPostList=!1),0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.totalSize=data.data.count}else $scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList;$scope.myRes=1})):($scope.isLoadPost=!1,0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.userPostList)},$scope.showUserPostList=function(){$scope.isLoadPost=!0,$scope.totalSize=0,$scope.myRes=1,($routeParams.postId?$routeParams.postId:"")?$scope.getUserPostDetail($routeParams.postId):$scope.listUserPost()},$scope.commentLoading=[],$scope.getComments=function(postIndx){var post=$scope.userPostList[postIndx];$scope.userPostList[postIndx].comments=[];var opts={};opts.post_id=post.id,opts.limit_start=APP.dashbord_comment.start,opts.limit_size=APP.dashbord_comment.end,ProfileService.getDashboardComments(opts,function(data){100==data.code?($scope.userPostList[postIndx].comments=data.data.comment,$scope.commentLoading[postIndx]=!1,$scope.commentsLength[postIndx]=$scope.userPostList[postIndx].comments.length,0!=$scope.userPostList[postIndx].comments.length&&($scope.noComment=!0)):$scope.commentLoading[postIndx]=!1})},$scope.showLimitedComment=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)},$scope.showAllComments=function(postIndx){$scope.commentLoading[postIndx]=!0,$scope.showComments[postIndx]=!0,$scope.getComments(postIndx)},$scope.pageSize=4,$scope.delCommentErrMsg=[],$scope.delCommentErrCls=[],$scope.deleteComment=function(postIndx,comment){var indx=$scope.userPostList[postIndx].comments.indexOf(comment),commentData={};commentData=$scope.userPostList[postIndx].comments[indx],$scope.deleteCommentIndx=commentData.id;var formData={};formData.user_id=APP.currentUser.id,formData.comment_id=commentData.id,ProfileService.deleteDashboardComment(formData,function(data){101==data.code?($scope.delCommentErrMsg[commentData.id]="",$scope.delCommentErrCls[commentData.id]="",$scope.userPostList[postIndx].comments.splice(indx,1),$scope.deleteCommentIndx=""):($scope.delCommentErrMsg[commentData.id]=$scope.i18n.dashboard.postcomment.delete_comment_fail,$scope.delCommentErrCls[commentData.id]="text-red",$scope.deleteCommentIndx="",$scope.userPostList),$timeout(function(){$scope.delCommentErrCls[commentData.id]="",$scope.delCommentErrMsg[commentData.id]=""},15e3)})},$scope.editCommentText=[],$scope.activeCommentEdit=[],$scope.isEditComment=[],$scope.commentErrorMsg=[],$scope.commentErrorCls=[],$scope.commentInProcess=[],$scope.updateComment=function(postIndx,comment){$("#commentBoxId-"+postIndx).hide(),$scope.commentInProcess[postIndx]=!0,$scope.commentErrorMsg[postIndx]="",$scope.commentErrorCls[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx];$scope.isEditComment[postIndx]=!1,$scope.activeCommentEdit[postIndx]=comment.id,$scope.editCommentText[postIndx]=comment.comment_text},$scope.editComment=function(postIndx,comment){var opts={};$scope.commentErrorMsg[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx],newText=$scope.editCommentText[postIndx];return $scope.isEditComment[postIndx]=!0,void 0==newText||""==newText?($scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_comment,$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3),!1):(opts.user_id=APP.currentUser.id,opts.comment_id=comment.id,opts.comment_text=newText,void ProfileService.updateDashboardComment(opts,function(data){101==data.code?($scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.editCommentText[postIndx]="",$scope.userPostList[postIndx].comments[indx].comment_text=newText,$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()):($scope.commentInProcess[postIndx]=!1,$scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.not_posted,$("#commentBoxId-"+postIndx).show()),$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3)}))},$scope.cancelEditComment=function(postIndx,indx){$scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.editCommentText[postIndx]="",$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()},$scope.loadMorePost=function(){0!=$scope.totalSize&&($scope.isLoadPost=!0,$scope.listUserPost())},$scope.showUserPostList(),$scope.averageVoting=0,$scope.vote_count=0,$scope.waitRateResponse=!1,$scope.ratePost=function(rating,post_id,index){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,opts.rate=rating,$scope.waitRateResponse=!0,update=$scope.userPostList[index].is_rated?"update":"add",waitRequest=ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message?($scope.userPostList[index].avg_rate=data.data.avg_rate,$scope.userPostList[index].no_of_votes=data.data.no_of_votes,$scope.userPostList[index].is_rated=!0):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[index].is_rated=!1,$scope.userPostList[index].current_user_rate=0),$scope.waitRateResponse=!1})},$scope.WaitDeleteResponse=!1,$scope.removeRating=function(post_id,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.userPostList[postIndx].current_user_rate=0,$scope.userPostList[postIndx].is_rated=!1,$scope.userPostList[postIndx].no_of_votes=data.data.no_of_votes,$scope.userPostList[postIndx].avg_rate=data.data.avg_rate):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[postIndx].current_user_rate=0,$scope.userPostList[postIndx].is_rated=!1),$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1}))},$scope.rateComment=function(rating,comment_id,postIndex,commentIndex){var update="",opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post_comment",opts.type_id=comment_id,opts.rate=rating,update=$scope.userPostList[postIndex].comments[commentIndex].is_rated?"update":"add",ProfileService.rateThis(opts,update,function(data){101===data.code&&"SUCCESS"===data.message&&($scope.userPostList[postIndex].comments[commentIndex].avg_rate=data.data.avg_rate,$scope.userPostList[postIndex].comments[commentIndex].no_of_votes=data.data.no_of_votes,$scope.userPostList[postIndex].comments[commentIndex].is_rated=!0)})},$scope.removeCommentRating=function(comment_id,postIndx,indx){var opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post_comment",opts.type_id=comment_id,ProfileService.removeRating(opts,function(data){101==data.code&&"SUCCESS"==data.message&&($scope.userPostList[postIndx].current_user_rate=0,$scope.userPostList[postIndx].is_rated=!1,$scope.userPostList[postIndx].no_of_votes=data.data.no_of_votes,$scope.userPostList[postIndx].avg_rate=data.data.avg_rate)})},$scope.stars=[],$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}],$scope.showPeopleLoader=!1,$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({template:'<style>.modal-body.tag-frnd-modal ul li{padding:8px 130px 8px 0}.modal-content .modal-body ul.rmv-tag{position:absolute;right:0;top:10px}.modal-content .modal-body ul.rmv-tag li{padding:0;display:inline-block;vertical-align:middle;border:0}.modal-content .modal-body ul.rmv-tag li span.votes-avg{width:23px;height:21px;margin-left:2px;background:url(app/assets/images/rating-star.png) no-repeat;display:block}.modal-content .modal-body ul.rmv-tag li span.votes-blank{width:23px;height:21px;margin-left:2px;background:url(app/assets/images/rating-star.png) 0 -21px no-repeat;display:block}.modal.in .modal-dialog{margin:auto;top:0;bottom:0;left:0;right:0;position:absolute}.modal-body.tag-frnd-modal{height:360px;overflow-y:auto;overflow-x:hidden;padding:0 10px}.modal .modal-content{margin:auto;height:400px;top:0;bottom:0;left:0;right:0;position:absolute;overflow:visible}@media screen and (max-width:479px){.modal.in .modal-dialog{margin:auto 20px}.modal-body.tag-frnd-modal ul li{padding:8px 70px 8px 0}.modal-content .modal-body ul.rmv-tag li span.votes-avg{width:12px;height:10px;margin-left:1px;background:url(app/assets/images/rating-star.png) 0 0/12px no-repeat}.modal-content .modal-body ul.rmv-tag li span.votes-blank{width:12px;height:10px;margin-left:1px;background:url(app/assets/images/rating-star.png) 0 -11px/12px no-repeat}}</style><div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div></div><div class="modal-body tag-frnd-modal"><ul ng-hide="showPeopleLoader"><li data-ng-repeat="friend in ratedUsers"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a ng-href="#/viewfriend/{{friend.id}}">{{friend.first_name}} {{friend.last_name}}</a><span class="frnd-details"><a href>{{friend.about_me}}</a></span></span><ul class="rmv-tag"><li data-ng-repeat="avgRate in averageRating(friend.rate) track by $index"><span ng-class="friend.rate % 1 == 0 ?\'votes-avg\': ($last ? \'half-avg\':\'votes-avg\')" /></li><li ng-repeat="blank in blankStar(friend.rate) track by $index"><span class="votes-blank"/> </li></ul></li></ul> <div ng-show="showPeopleLoader"><img titile="" alt="" src="app/assets/images/proceed.gif"></div></div><div class="modal-footer"></div>',controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)})}},link:function($scope){$(".fancybox").fancybox()},templateUrl:"app/views/profile_post_list.html"}}).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.directive("profilePostForm",function($timeout,ProfileService,FileUploader,$sce){return{restrict:"E",controller:function($scope,$timeout){$scope.postErrCls="",$scope.privacySet=1,$scope.postErrMsg="",$scope.postErrCls="",$scope.postContentStart=!1,$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$scope.imgProgress=[],$scope.postImgLoader=[],$scope.progress=[],$scope.tempPostId="";var uploader=$scope.uploader=new FileUploader({url:APP.service.dashboardpost+"?access_token="+APP.accessToken,headers:{"Content-Type":"application/x-www-form-urlencoded",method:"POST"},data:{user_id:APP.currentUser.id,title:"Not in use on frontend",description:"",youtube_url:"",to_id:APP.currentUser.id,link_type:"0",post_type:"0",privacy_setting:$scope.privacySet},dataObjName:"reqObj",formDataName:"postfile[]"});uploader.filters.push({name:"postfile[]",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.addImage=function(){var href=$("#previewUrl_lp1").html();""!=href&&$timeout(function(){$("#closePreview_lp1").click()},100),$scope.isImage=!0,$scope.imgUpload=!1,$scope.uploadBox=!0,$scope.imagePrvSrc=[],uploader.queue=[],$scope.postProfileFiles=[]},$scope.addPost=function(){$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$scope.isPost=!0,$scope.imagePrvSrc=[],uploader.queue=[],$scope.postProfileFiles=[]},$scope.removeImage=function(index){var item=$scope.uploader.queue[index];item.remove();var tempImg=$scope.imagePrvSrc[index];$scope.imagePrvSrc.splice(index,1);var formData={};formData.user_id=APP.currentUser.id,formData.post_media_id=tempImg.media_id,ProfileService.deletePostMedia(formData,function(data){101==data.code||($scope.imagePrvSrc[index]=tempImg,$scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.dashboard.postcomment.remove_img_fail,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.userPostList)})},uploader.onAfterAddingFile=function(fileItem){$scope.postContentStart=!0,uploader.data.post_id=$scope.tempPostId;var queueLen=uploader.queue.length-1;0!=uploader.queue.length&&($scope.uploadBox=!1,$scope.imgUpload=!0),$scope.postImgLoader[queueLen]=!0,uploader.uploadItem(fileItem)},uploader.onSuccessItem=function(fileItem,response,status,headers){var index=uploader.getIndexOfItem(fileItem);101==response.code&&($scope.imagePrvSrc[index]=response.data,$scope.postImgLoader[index]=!1,$scope.tempPostId=response.data.id,uploader.data.post_id=response.data.id)},uploader.onCompleteAll=function(){$timeout(function(){$scope.postContentStart=!1},1e3)},uploader.onWhenAddingFileFailed=function(item,filter,options){$scope.postErrMsg=$scope.i18n.editprofile.no_media_valid,$scope.postErrCls="text-red",$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3)},$scope.createPost=function(){$scope.noContent=!1,$scope.updateBody=[],$scope.activeEdit=[],$scope.editPostErrorMsg=[];var link_type;$scope.postContentStart=!0,$scope.postContentLoader=!0;var opts={};$scope.postErrMsg="";var filescount=$scope.imagePrvSrc.length,description="",descval=$("#preview_lp1").html(),href=$("#previewUrl_lp1").html(),textarea=$("#text_lp1").val();if(replacePattern1=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,description=textarea.replace(replacePattern1,'<a class="sitelink" href="$1" target="_blank">$1</a>'),replacePattern2=/(^|[^\/f])(www\.[\S]+(\b|$))/gim,description=description.replace(replacePattern2,'$1 <a class="sitelink" href="http://$2" target="_blank">$2</a>'),""==href?link_type="0":(description="<p>"+description+"</p>",description+=descval,link_type="1"),(void 0==description||""==description)&&0==filescount)return $scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.attach_link,$scope.postContentStart=!1,$scope.postContentLoader=!1,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),!1;opts.user_id=APP.currentUser.id,opts.title=$scope.i18n.editprofile.no_use,opts.description=description,opts.youtube_url="",opts.to_id=APP.currentUser.id,opts.link_type=link_type,opts.post_id=$scope.tempPostId,opts.post_type="1",opts.media_id=[],opts.privacy_setting=$scope.privacySet;var friendId=[];if($scope.storedFriend.length>0){for(var i=0;i<$scope.storedFriend.length;i++)friendId.push($scope.storedFriend[i].user_info.id);opts.tagged_friends=friendId.join()}else opts.tagged_friends="";angular.forEach($scope.imagePrvSrc,function(file){opts.media_id.push(file.media_id)}),ProfileService.dashboardPost(opts,function(data){if(101==data.code){$scope.storedFriend=[],$scope.showTagForm=!1;var targetObject={};for(targetObject=data.data,$scope.userPostList.unshift(targetObject),$scope.postErrMsg="",$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),uploader.data.post_id={};uploader.queue.length;)uploader.queue[0].remove();0==$scope.userPostList.length&&($scope.noPostList=!0),$scope.noPostList=!1,$scope.tempPostId="",$scope.postContentStart=!1,$scope.postContentLoader=!1,$scope.postText="",$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1,$("#text_lp1").val(""),$("#text_lp1").autoResize(),$timeout(function(){$("#closePreview_lp1").trigger("click")},100)}else $scope.postErrCls="text-red",$scope.postErrMsg=$scope.i18n.editprofile.post_unable,$timeout(function(){$scope.postErrCls="",$scope.postErrMsg=""},15e3),$scope.imagePrvSrc=[],$scope.postProfileFiles=[],$scope.postText=void 0,$scope.postContentLoader=!1,$scope.isImage=!1,$scope.imgUpload=!1,$scope.uploadBox=!1})},$scope.showTagForm=!1,$scope.showTagCloumn=function(){$scope.showTagForm===!1?$scope.showTagForm=!0:$scope.showTagForm=!1};var DELAY_TIME_BEFORE_POSTING=300,currentTimeout=null;angular.element("#searchTagFriend").keypress(function(event){$scope.searchText;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.tagFriendSuggestion()},DELAY_TIME_BEFORE_POSTING)}),$scope.friends=[],$scope.cancelFriendSearch=!1,$scope.showSearchLoader=!1,$scope.tagFriendSuggestion=function(){$scope.cancelFriendSearch=!1,$scope.showFriendList=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.friendName,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchLoader=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchLoader=!1,$scope.cancelFriendSearch===!1&&($scope.friends=data.data.users)})},$scope.storedFriend=[],$scope.dublicate=!1,$scope.selectFriend=function(friendInfo){void 0!==friendInfo&&($scope.dublicate=!1,angular.forEach($scope.storedFriend,function(index){index.user_id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.storedFriend.push(friendInfo),$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1):($scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1))},$scope.lostFormFocus=function(){$timeout(function(){$scope.friends=[],$scope.cancelFriendSearch=!0,$scope.friendTaggIndex=-1,angular.element("#searchTagFriend").val(""),$scope.showFriendList=!1},300)},$scope.removeTagFriend=function(friendIndex){$scope.storedFriend.splice(friendIndex,1)},$scope.friendTaggIndex=-1,$scope.keyUpDownControl=function(event){console.log($scope.friendTaggIndex),40===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex+1!==$scope.friends.length&&$scope.friendTaggIndex++):38===event.keyCode?(event.preventDefault(),$scope.friendTaggIndex-1!==-1&&$scope.friendTaggIndex--):13===event.keyCode&&$scope.selectFriend($scope.friends[$scope.friendTaggIndex])}},link:function(scope,iElement,iAttrs){$($("#lp1").linkPreview()).appendTo(iElement[0])},templateUrl:"app/views/profile_post_form.html"}}),app.directive("showProgress",function(){return{restrict:"E",template:'<img src="app/assets/images/proceed.gif" alt="processing..." />'}}),app.directive("profileWallCommentForm",["ProfileService","fileReader","$http","$timeout","$interval",function(ProfileService,fileReader,$http,$timeout,$interval){return{restrict:"E",templateUrl:"app/views/profile_wall_comment_form.html",scope:!0,link:function(scope,elem,attrs){scope.showPreview=!1,scope.comment_id="",scope.image_id=[],scope.imgSrc=[],scope.isInProgress=[],scope.selectInProgress=[],scope.commentFiles=[],scope.imgRes=1,scope.commentErrMsg="",scope.commentErrCls="",scope.getFile=function(){var tempopts={};tempopts.user_id=APP.currentUser.id,tempopts.postid=attrs.postId,tempopts.body=scope.i18n.editprofile.comment_image_test,tempopts.comment_type="0",tempopts.image_id="",tempopts.comment_id="";var len=scope.commentFiles.length;ProfileService.createDashboardCommentImage(tempopts,scope.commentFiles[0],function(data){if(101==data.code)for(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),tempopts.comment_id=scope.comment_id,scope.selectInProgress.splice(0,1),j=1;j<len;j++)ProfileService.createDashboardCommentImage(tempopts,scope.commentFiles[j],function(data){101==data.code?(scope.comment_id=data.data.id,scope.imgSrc.push(data.data),scope.image_id.push(data.data.media_id),scope.selectInProgress.splice(0,1)):(scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail)});else scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.upload_media_fail}),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)},scope.removeImage=function(index){var tempMedia=scope.image_id[index],opts={};opts.user_id=APP.currentUser.id,opts.postid=attrs.postId,opts.image_id=tempMedia,ProfileService.deleteDashboardMediaComments(opts,function(data){101==data.code?(scope.imgSrc.splice(index,1),scope.isInProgress.splice(index,1),0==scope.imgSrc.length&&(scope.commentFiles==[],scope.file=[]),scope.image_id.splice(index,1),0==scope.imgSrc.length&&(scope.selectInProgress=[],scope.showImgSelect=!0,scope.showPreview=!1)):(scope.showImgSelect=!0,scope.showPreview=!0,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.dashboard.postcomment.remove_img_fail),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)})},scope.res=0,scope.addComment=function(){scope.postIndx=attrs.postIndx,scope.comments=attrs.loadComment,scope.finalCommentInProcess=!0,scope.commentErrMsg="",scope.commentErrCls="";var filescount=scope.imgSrc.length;if((void 0==scope.commentText||""==scope.commentText)&&0==filescount)return scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.photo_update,setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3),!1;var opts={};opts.user_id=APP.currentUser.id,opts.postid=attrs.postId,opts.body=scope.commentText,opts.media_id=[],opts.comment_id="",0!=scope.image_id.length&&(opts.media_id=scope.image_id),""!=scope.comment_id&&(opts.comment_id=scope.comment_id),opts.comment_type="1",opts.tagging=scope.taggedObject,0==scope.res&&(scope.res=1,ProfileService.createDashboardCommentFinal(opts,function(data){scope.res=0,101==data.code?(scope.commentText="",scope.post.comments.push(data.data),scope.post.comment_count++,scope.finalCommentInProcess=!1,scope.commentErrMsg="",scope.commentErrCls="",scope.commentText="",scope.commentFiles=[],scope.imgSrc=[],scope.file=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id=""):(scope.finalCommentInProcess=!1,scope.commentErrCls="text-red",scope.commentErrMsg=scope.i18n.editprofile.comment_no_post,scope.commentFiles=[],scope.imgSrc=[],scope.file=[],scope.showPreview=!1,scope.showImgSelect=!0,scope.comment_id=""),setTimeout(function(){scope.commentErrCls="",scope.commentErrMsg=""},15e3)}))}}}}]),app.directive("wallProfilePostList",function(ProfileService){return{restrict:"E",controller:function($scope,$timeout,$modal,$log,$location,focus){$scope.showComments=[],$scope.commentsLength=[],$scope.userPostList=[],$scope.myRes=1,$scope.showComments=[],$scope.commentsLength=[],$scope.textLimit=APP.post_charecter_limit,$scope.noContent=!1,$(document).click(function(){$("ul.actions-drop-action").hide()}),$scope.toggleEdit=function($event){$event.stopPropagation(),$($event.currentTarget).next("ul.actions-drop-action").is(":visible")?$($event.currentTarget).next("ul.actions-drop-action").hide():($("ul.actions-drop-action").hide(),$($event.currentTarget).next("ul.actions-drop-action").show())},$scope.loadMoreFunc="loadMore()",$scope.$watch($scope.getWindowDimensions,function(newValue,oldValue){$scope.windowHeight=newValue.h,$scope.windowWidth=newValue.w,$scope.windowWidth<="768"?($scope.isSmallScreen=!0,$scope.loadMoreFunc=""):($scope.isSmallScreen=!1,$scope.loadMoreFunc="loadMore()")},!0),$scope.listUserWallPost=function(){var opts={},limit_start=$scope.userPostList.length;opts.user_id=APP.currentUser.id,opts.limit_start=limit_start,opts.limit_size=APP.dashbord_pagination.end,opts.friend_id=APP.currentUser.id,$scope.isLoading=!0,($scope.totalSize>limit_start||0==$scope.totalSize)&&1==$scope.myRes?($scope.myRes=0,ProfileService.getDashboardWallFeeds(opts,function(data){if(101==data.code){var items=data.data.post;void 0!=items&&($scope.userPostList=$scope.userPostList.concat(items)),$scope.totalSize=data.data.count,0==$scope.userPostList.length&&($scope.noContent=!0),$timeout(function(){$scope.isLoading=!1},400),$scope.myRes=1}else $timeout(function(){$scope.isLoading=!1,$scope.userPostList,0==$scope.userPostList.length&&($scope.noContent=!0)},400)})):($timeout(function(){$scope.isLoading=!1},5e3),$scope.userPostList)},$scope.deleteErrMsg=[],$scope.isDeletePost=[],$scope.deleteErrCls=[],$scope.deletePost=function(postIndx){var postData={};postData=$scope.userPostList[postIndx],$scope.isDeletePost[postIndx]=!0,$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="";var formData={};formData.user_id=APP.currentUser.id,formData.post_id=postData.id,ProfileService.deleteDashboardPost(formData,function(data){101==data.code?($scope.userPostList.splice(postIndx,1),
0==$scope.userPostList.length&&($scope.noContent=!0),$scope.isDeletePost[postIndx]=!1):($scope.deleteErrCls[postIndx]="text-red",$scope.deleteErrMsg[postIndx]=$scope.i18n.dashboard.postcomment.delete_post_fail,$scope.isDeletePost[postIndx]=!1),$timeout(function(){$scope.deleteErrCls[postIndx]="",$scope.deleteErrMsg[postIndx]=""},15e3)})},$scope.editPostErrorMsg=[],$scope.updatePostInProcess=[],$scope.editPostErrorCls=[],$scope.saveUpdatePost=function(postIndx){var opts={};$scope.updatePostInProcess[postIndx]=!0;var editPostText=escapeHtmlEntities($scope.updateBody[postIndx]),post=$scope.userPostList[postIndx];if(void 0==editPostText||""==editPostText)return $scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_status,$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3),!1;opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.title=post.title,opts.description=editPostText,opts.to_id=post.to_id,opts.youtube_url="",opts.post_type="1",opts.privacy_setting=post.privacy_setting;var friendIdList=[];$scope.postTaggedFriend[postIndx].length>0?(angular.forEach($scope.postTaggedFriend[postIndx],function(index){friendIdList.push(index.id)}),opts.tagged_friends=friendIdList.join()):opts.tagged_friends="",ProfileService.updateDashboardPost(opts,function(data){101==data.code?($scope.postTaggedFriend[postIndx].length>0?post.tagged_friends_info=$scope.postTaggedFriend[postIndx]:post.tagged_friends_info="",$scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.userPostList[postIndx].description=editPostText,$scope.editPostText="",$scope.activeEdit[postIndx]=!1):($scope.updatePostInProcess[postIndx]=!1,$scope.editPostErrorCls[postIndx]="text-red",$scope.editPostErrorMsg[postIndx]=$scope.i18n.editprofile.post_unsaved),$timeout(function(){$scope.editPostErrorCls[postIndx]="",$scope.editPostErrorMsg[postIndx]=""},15e3)})},$scope.editPrivacyMsg=[],$scope.editPrivacyCls=[],$scope.changePrivacy=function(post,postIndx){var opts={};opts.user_id=APP.currentUser.id,opts.post_id=post.id,opts.privacy_setting=post.privacy_setting;ProfileService.updatePostPrivacy(opts,function(data){101==data.code?($scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""):($scope.editPrivacyCls[postIndx]="text-red",$scope.editPrivacyMsg[postIndx]=$scope.i18n.editprofile.privacy_setting),$timeout(function(){$scope.editPrivacyCls[postIndx]="",$scope.editPrivacyMsg[postIndx]=""},15e3)})},$scope.updateBody=[],$scope.activeEdit=[],$scope.postTaggedFriend=[],$scope.showTagLoading=[],$scope.updatePost=function(postIndx){$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]="";var post=$scope.userPostList[postIndx];autosize(document.querySelectorAll(".editpostbox"));var str=$.trim(post.description.replace(/\n\n\n+/g,"\n\n")),htmlstr=str.replace(/\n/g,"<br />"),height=$('<div style="display:block;" id="postedit-hidden-div"></div>').html(htmlstr).appendTo("#post_"+post.id).height();$("#editpost_"+post.id).css("height",height+"px"),str=$("#postedit-hidden-div").html(str).text(),$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]=str,$scope.activeEdit[postIndx]=!0,$scope.postTaggedFriend[postIndx]=[],angular.forEach(post.tagged_friends_info,function(val,indx){$scope.postTaggedFriend[postIndx].push(val)}),$scope.showTagLoading[postIndx]=!0,$timeout(function(){$("#editpost_"+post.id).putCursorAtStart()},200)},$scope.focusWallTag=function(indx){focus("wallPostListTag"+indx)},$scope.cancelPost=function(postIndx){$("#postedit-hidden-div").remove(),$scope.updateBody[postIndx]="",$scope.activeEdit[postIndx]=!1,$scope.editPostErrorMsg[postIndx]="",$scope.editPostErrorCls[postIndx]=""},$scope.removePostTagFriend=function(index,postIndex){$scope.postTaggedFriend[postIndex].splice(index,1)};var currentTimeout=null;$scope.addMoreFriend=function(event,index){var DELAY_TIME_BEFORE_POSTING=300;currentTimeout&&$timeout.cancel(currentTimeout),currentTimeout=$timeout(function(){13!=event.which&&$scope.searchMoreFriend(index)},DELAY_TIME_BEFORE_POSTING)},$scope.friends=[],$scope.showSearchFriendLoader=[],$scope.cancelFriendSearch=!1,$scope.showSearchFriendList=[],$scope.searchMoreFriend=function(postIndx){$scope.searchFriend=$(".addMoreTagFriend"+postIndx).val(),$scope.friendTagIndex[postIndx]=-1,$scope.cancelFriendSearch=!1,$scope.showSearchFriendList[postIndx]=!0;var opts={};opts.user_id=APP.currentUser.id,opts.friend_name=$scope.searchFriend,opts.session_id=APP.currentUser.id,opts.limit_start=0,opts.limit_size=APP.friend_list_pagination.end,$scope.showSearchFriendLoader[postIndx]=!0,$scope.showTagLoading[postIndx]=!0,ProfileService.searchFriends(opts,function(data){$scope.showSearchFriendLoader[postIndx]=!1,$scope.cancelFriendSearch===!1&&($scope.friends[postIndx]=data.data.users)})},$scope.postTaggedFriend=[],$scope.dublicate=!1,$scope.taggedSelectFriend=function(friendInfo,postIndex){$scope.dublicate=!1,angular.forEach($scope.postTaggedFriend[postIndex],function(index){index.id===friendInfo.user_id&&($scope.dublicate=!0)}),$scope.dublicate===!1?($scope.postTaggedFriend[postIndex].push({id:friendInfo.user_id,first_name:friendInfo.user_info.first_name,last_name:friendInfo.user_info.last_name,profile_image:friendInfo.user_info.profile_image,profile_image_thumb:friendInfo.user_info.profile_image_thumb}),$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1):($scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1)},$scope.lostFocus=function(postIndex){$timeout(function(){$scope.friends[postIndex]=[],$scope.cancelFriendSearch=!0,$scope.friendTagIndex[postIndex]=-1,angular.element(".addMoreTagFriend"+postIndex).val(""),$scope.showSearchFriendList[postIndex]=!1},300)},$scope.friendTagIndex=[],$scope.searchNevigateControl=function(event,index){40===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]+1!==$scope.friends[index].length&&$scope.friendTagIndex[index]++):38===event.keyCode?(event.preventDefault(),$scope.friendTagIndex[index]-1!==-1&&$scope.friendTagIndex[index]--):13===event.keyCode&&$scope.taggedSelectFriend($scope.friends[index][$scope.friendTagIndex[index]],index)},$scope.showUserWallPostList=function(){$scope.userPostList=[],$scope.totalSize=0,$scope.myRes=1,$scope.noContent=!1,$scope.listUserWallPost()},$scope.commentLoading=[],$scope.getComments=function(postIndx){var post=$scope.userPostList[postIndx];$scope.userPostList[postIndx].comments=[];var opts={};opts.post_id=post.id,opts.user_id=APP.currentUser.id,opts.limit_start=APP.dashbord_comment.start,opts.limit_size=APP.dashbord_comment.end,ProfileService.getDashboardComments(opts,function(data){100==data.code?($scope.userPostList[postIndx].comments=data.data.comment,$scope.commentLoading[postIndx]=!1,$scope.commentsLength[postIndx]=$scope.userPostList[postIndx].comments.length,0!=$scope.userPostList[postIndx].comments.length&&($scope.noComment=!0)):$scope.commentLoading[postIndx]=!1})},$scope.showLimitedComment=function(postIndx){$scope.commentInProcess=!0;var post=$scope.posts[postIndx],opts={};opts.post_id=post.post_id,opts.user_id=$scope.currentUser.id,$scope.getComments(opts,postIndx)},$scope.showAllComments=function(postIndx){$scope.commentLoading[postIndx]=!0,$scope.showComments[postIndx]=!0,$scope.getComments(postIndx)},$scope.pageSize=4,$scope.delCommentErrMsg=[],$scope.delCommentErrCls=[],$scope.deleteComment=function(postIndx,comment){var indx=$scope.userPostList[postIndx].comments.indexOf(comment),commentData={};commentData=$scope.userPostList[postIndx].comments[indx],$scope.deleteCommentIndx=commentData.id;var formData={};formData.user_id=APP.currentUser.id,formData.comment_id=commentData.id,ProfileService.deleteDashboardComment(formData,function(data){101==data.code?($scope.delCommentErrMsg[commentData.id]="",$scope.delCommentErrCls[commentData.id]="",$scope.userPostList[postIndx].comments.splice(indx,1),$scope.userPostList[postIndx].comment_count--,scope.post.comment_count--,$scope.deleteCommentIndx=""):($scope.delCommentErrMsg[commentData.id]=$scope.i18n.dashboard.postcomment.delete_comment_fail,$scope.delCommentErrCls[commentData.id]="text-red",$scope.deleteCommentIndx="",$scope.userPostList)})},$scope.editCommentText=[],$scope.activeCommentEdit=[],$scope.isEditComment=[],$scope.commentErrorMsg=[],$scope.commentErrorCls=[],$scope.commentInProcess=[],$scope.updateComment=function(postIndx,comment){$("#commentBoxId-"+postIndx).hide(),$scope.commentInProcess[postIndx]=!0,$scope.commentErrorMsg[postIndx]="",$scope.commentErrorCls[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx];$scope.isEditComment[postIndx]=!1,$scope.activeCommentEdit[postIndx]=comment.id,$scope.editCommentText[postIndx]=comment.comment_text},$scope.editComment=function(postIndx,comment){var opts={};$scope.commentErrorMsg[postIndx]="";var indx=$scope.userPostList[postIndx].comments.indexOf(comment),comment=$scope.userPostList[postIndx].comments[indx],newText=$scope.editCommentText[postIndx];return $scope.isEditComment[postIndx]=!0,void 0==newText||""==newText?($scope.commentErrorCls[postIndx]="text-red",$scope.isEditComment[postIndx]=!1,$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.no_empty_comment,$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3),!1):(opts.user_id=APP.currentUser.id,opts.comment_id=comment.id,opts.comment_text=newText,void ProfileService.updateDashboardComment(opts,function(data){101==data.code?($scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.editCommentText[postIndx]="",$scope.userPostList[postIndx].comments[indx].comment_text=newText,$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()):($scope.commentInProcess[postIndx]=!1,$scope.isEditComment[postIndx]=!1,$scope.commentErrorCls[postIndx]="text-red",$scope.commentErrorMsg[postIndx]=$scope.i18n.editprofile.not_posted,$("#commentBoxId-"+postIndx).show()),$timeout(function(){$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]=""},15e3)}))},$scope.cancelEditComment=function(postIndx,indx){$scope.commentInProcess[postIndx]=!1,$scope.activeCommentEdit[postIndx]="",$scope.commentErrorCls[postIndx]="",$scope.commentErrorMsg[postIndx]="",$scope.editCommentText[postIndx]="",$scope.isEditComment[postIndx]=!1,$("#commentBoxId-"+postIndx).show()},$scope.loadMore=function(){$scope.totalSize>$scope.userPostList.length&&$scope.listUserWallPost()},$scope.showAllFriend=function(post_id,creater_info,allTagFriend){$scope.allTagFriends=allTagFriend,$scope.post_id=post_id,$scope.creater=creater_info;var modalInstance=$modal.open({template:'<style>.modal-open .modal.in .modal-dialog{width:620px; height:400px;}</style><div id="friendModal" class="modal-header"> <h3 class="modal-title">People</h3><div class="modal-popup-close" ng-click="closeModal()"></div> </div><div class="modal-body tag-frnd-modal"><ul><li data-ng-repeat="friend in allTagFriends"><span class="tag-img"><img title="" style="width:30px;height:30px" alt="No image available" data-ng-src="{{friend.profile_image_thumb}}" data-ng-if="friend.profile_image_thumb != null  && friend.profile_image_thumb != \'\'"><img title="" alt="No image available" src="app/assets/images/dummy32X32.jpg" data-ng-if="friend.profile_image_thumb == null || friend.profile_image_thumb == \'\'"></span><span class="tag-frnd-name"><a href ng-click="viewFriendProile(friend.id)">{{friend.first_name}} {{friend.last_name}}</a></span><span data-ng-if="creater.id === currentUser.id || currentUser.id === friend.id" ng-click="RemoveTagFriend(friend, creater.id)" class="rmv-tag"><a href>{{i18n.profile_post.remove_tagged_friend}}</a></span></li></ul></div><div class="modal-footer"></div><style type="text/css">.modal.in .modal-dialog{height:100%;margin:0 auto}.modal.in .modal-dialog .modal-content{position:absolute;width:100%;top:0;bottom:0;left:0;right:0;max-height:80%;margin:auto}.modal-body.tag-frnd-modal{padding:0 10px;overflow:auto;height:86%}</style>',controller:"ModalController",size:"lg",scope:$scope});modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)},$scope.RemoveTagFriend=function(friend,createrId){var opts={};opts.user_id=APP.currentUser.id,opts.untag_user_id=friend.id,opts.post_id=$scope.post_id,ProfileService.removeTagedFriends(opts,function(data){if(101===data.code){var index=$scope.allTagFriends.indexOf(friend);$scope.allTagFriends.splice(index,1),createrId!=APP.currentUser.id&&modalInstance.close(),0===$scope.allTagFriends.length&&modalInstance.close()}})}},$scope.validate=!1,$scope.checkTagUser=function(allTaggedFriend){return $scope.tagInfo=allTaggedFriend,$scope.validate=!1,angular.forEach($scope.tagInfo,function(index){index.id===APP.currentUser.id&&($scope.validate=!0)}),$scope.validate===!0?!0:void 0},$scope.rateSetData=function(data,update,index){101===data.code&&"SUCCESS"===data.message?($scope.userPostList[index].avg_rate=data.data.avg_rate,$scope.userPostList[index].no_of_votes=data.data.no_of_votes,update?($scope.userPostList[index].current_user_rate=data.data.current_user_rate,$scope.userPostList[index].is_rated=!0):($scope.userPostList[index].current_user_rate=0,$scope.userPostList[index].is_rated=!1)):100===data.code&&"ERROR_OCCURED"===data.message&&($scope.userPostList[index].is_rated=!1,$scope.userPostList[index].current_user_rate=0)},$scope.waitRateResponse=!1,$scope.ratePost=function(rating,post_id,index){var opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,opts.rate=rating,$scope.waitRateResponse=!0;var update;update=$scope.userPostList[index].is_rated?"update":"add",ProfileService.rateThis(opts,update,function(data){$scope.waitRateResponse=!1,$scope.rateSetData(data,!0,index)})},$scope.WaitDeleteResponse=!1,$scope.removeRating=function(post_id,postIndex){var opts={};opts.user_id=APP.currentUser.id,opts.type="dashboard_post",opts.type_id=post_id,$scope.WaitDeleteResponse===!1&&($scope.WaitDeleteResponse=!0,$scope.waitRateResponse=!0,ProfileService.removeRating(opts,function(data){$scope.WaitDeleteResponse=!1,$scope.waitRateResponse=!1,$scope.rateSetData(data,!1,postIndex)}))},$scope.averageRating=function(rating){return new Array(Math.ceil(rating))},$scope.blankStar=function(rating){return 5-Math.ceil(rating)>0?new Array(5-Math.ceil(rating)):0},$scope.max=5,$scope.isReadonly=!1,$scope.rateThis=function(value,id,index){$scope.ratePost(value,id,index)},$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$scope.ratingStates=[{stateOn:"glyphicon-star",stateOff:"glyphicon-star-empty"}],$scope.showPeopleLoader=!1,$scope.findPeople=function(id,type,count_Vote){if(0===count_Vote)return!1;var opts={};$scope.ratedUsers={},$scope.showPeopleLoader=!0;var modalInstance=$modal.open({templateUrl:"app/views/find_people.html",controller:"ModalController",size:"lg",scope:$scope});opts.type=type,opts.type_id=id,opts.session_id=APP.currentUser.id,ProfileService.findPeople(opts,function(data){101==data.code&&"SUCCESS"==data.message?($scope.showPeopleLoader=!1,$scope.ratedUsers=data.data.users_rated,0==data.data.users_rated.length&&($scope.message=$scope.i18n.dashboard.no_vote)):$scope.showPeopleLoader=!1}),modalInstance.result.then(function(selectedItem){},function(){$log.info("Modal dismissed at: "+new Date)}),$scope.viewFriendProile=function(friendId){modalInstance.dismiss("cancel"),$location.path("/viewfriend/"+friendId)}}},link:function($scope){$(".fancybox").fancybox(),$scope.showUserWallPostList()},templateUrl:"app/views/profile_wall_post_list.html"}}).filter("unsafe",function($sce){return function(val){return $sce.trustAsHtml(val)}}),app.directive("publicPostList",function(){return{restrict:"E",templateUrl:"./app/views/public_post_list.html"}}),app.directive("publicShopPostList",function(){return{restrict:"E",templateUrl:"./app/views/public_shop_post_list.html"}}),app.directive("scroller",function(){return{restrict:"A",scope:{loadingMethod:"&"},link:function(scope,elem,attrs){rawElement=elem[0],elem.bind("scroll",function(){rawElement.scrollTop+rawElement.offsetHeight+5>=rawElement.scrollHeight&&scope.$apply(scope.loadingMethod)})}}}),app.directive("dynamic",function($compile){return{restrict:"A",replace:!0,link:function(scope,ele,attrs){scope.$watch(attrs.dynamic,function(value){ele.html(value),$compile(ele.contents())(scope)})}}}),app.directive("shopWalletTab",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_tab.html"}}),app.directive("shopWalletPayment",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_payment.html"}}),app.directive("shopWalletSale",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_sale.html"}}),app.directive("shopWalletShoppingCard",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_shopping_card.html"}}),app.directive("shopWalletCoupon",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_coupon.html"}}),app.directive("shopWalletHistory",["$http","StoreWalletService","$routeParams","DateToMongoDate",function($http,StoreWalletService,$routeParams,DateToMongoDate){return{restrict:"E",templateUrl:"app/views/shop_wallet_history.html",controller:function($scope){$(".dateInput").datepicker({dateFormat:"dd-mm-yy"}),$scope.predicate="date",$scope.shopId=$routeParams.id,$scope.reverse=!1,$scope.loadingShopHistory=!0,$scope.nothingFound=!1,$scope.searchStart=!1,$scope.firstPage=APP.walletItemPerPage.perPage,$scope.itemsPerPage=APP.walletItemPerPage.perPage,$scope.currentPage=1,$scope.range=[],$scope.totalHitory=0,$scope.totalItems=0,$scope.shopWalletHistories=[],$scope.filterObject={"discount_details.card_no":{$exists:!0},status:"Approved",transaction_type_id:{$in:["553209267dfd81072b176bba","553209267dfd81072b176bbc","553209267dfd81072b176bb6","553209267dfd81072b176bb8"]},shop_id:$scope.shopId},$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.loadMore()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMore()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.loadMore()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.loadMore=function(){$scope.searchStart=!0;var limit_start=($scope.currentPage-1)*$scope.itemsPerPage,query={shop_wallet_history:{$collection:APP.applaneTables.sixc_transactions,$fields:{date:1,"discount_details.amount":1,"discount_details.type":1,"discount_details.card_id":1,citizen_id:1},$filter:$scope.filterObject,$unwind:["discount_details"],$sort:{date:-1},$limit:$scope.itemsPerPage,$skip:limit_start},shop_wallet_history_count:{$collection:APP.applaneTables.sixc_transactions,$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filterObject,$unwind:["discount_details"]}};StoreWalletService.getShopWalletHistory(query,function(data){if($scope.loadingShopHistory=!1,$scope.searchStart=!1,"ok"===data.status&&200===data.code)if(data.response.shop_wallet_history.result.length){$scope.shopWalletHistories=data.response.shop_wallet_history.result,$scope.totalHitory=data.response.shop_wallet_history_count.result[0].count,$scope.totalItems=Math.ceil($scope.totalHitory/$scope.itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}else $scope.shopWalletHistories=[],$scope.totalHitory=0,$scope.totalItems=0,$scope.range=[];else $scope.shopWalletHistories=[],$scope.nothingFound=!0})},$scope.loadMore(),$scope.searchCitizen=function(){void 0!==$scope.searchText&&$scope.searchText.length>0?$scope.filterObject.$or=[{"citizen_id.name":{$regex:$scope.searchText,$options:"i"}},{"citizen_id._id":{$regex:$scope.searchText,$options:"i"}}]:$scope.filterObject.$or=void 0,void 0!==$scope.fromDate&&$scope.fromDate.length>0&&void 0!==$scope.toDate&&$scope.toDate.length>0?$scope.filterObject.date={$gte:DateToMongoDate.dateToIso($scope.fromDate),$lte:DateToMongoDate.dateToIso($scope.toDate)}:void 0!==$scope.fromDate&&$scope.fromDate.length>0&&(void 0===$scope.toDate||0===$scope.toDate.length)&&$scope.fromDate.length>0?$scope.filterObject.date={$gte:DateToMongoDate.dateToIso($scope.fromDate)}:void 0!==$scope.toDate&&$scope.toDate.length>0&&(void 0===$scope.fromDate||0===$scope.fromDate.length)&&$scope.toDate.length>0?$scope.filterObject.date={$lte:DateToMongoDate.dateToIso($scope.toDate)}:$scope.filterObject.date=void 0,$scope.currentPage=1,$scope.range=[],$scope.loadMore()},$scope.clearSearch=function(){$scope.filterObject={},$scope.searchText=void 0,$scope.fromDate=void 0,$scope.toDate=void 0,$scope.filterObject={"discount_details.card_no":{$exists:!0},status:"Approved",transaction_type_id:{$in:["553209267dfd81072b176bba","553209267dfd81072b176bbc","553209267dfd81072b176bb6","553209267dfd81072b176bb8"]},shop_id:$scope.shopId},$scope.currentPage=1,$scope.range=[],$scope.loadMore()}}}}]),app.directive("shopWalletSaleHistory",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_sale_history.html"}}),app.directive("shopWalletCreditCards",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_credit_cards.html"}}),app.directive("shopWalletPaypalAccounts",function(){return{restrict:"E",templateUrl:"app/views/shop_wallet_paypal_accounts.html"}}),app.directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){function read(){var html=element.html();html=html.replace("<br>",""),attrs.stripBr&&"<br>"==html&&(html=""),ngModel.$setViewValue(html)}ngModel.$render=function(){element.html(ngModel.$viewValue||"")},element.bind("keyup change",function(){scope.$apply(read)})}}}),app.directive("searchTagging",["$http",function($http){return{restrict:"EA",templateUrl:"app/views/tagg_list.html",controller:function($scope,$element,$sce,$compile,$timeout,ProfileService){$scope.commentText="",$scope.allTaggs={},$scope.taggedObject={};var user=[],club=[],shop=[];$scope.taggedObject.user=user,$scope.taggedObject.club=club,$scope.taggedObject.shop=shop;var len=0;$scope.$watch("commentText",function(){if(-1!=$scope.commentText.indexOf("@")){len++;var s1=$scope.commentText,s2=s1.substring(s1.indexOf("@")+1,$scope.commentText.length),s3=s2.trim();s3=s3.substr(0,len-1);var res=1;if(s3.length>2){var searchType="all_friends",privacy=$scope.privacy?$scope.privacy:4;switch(privacy){case 1:searchType="personal_friends";break;case 2:searchType="professional_friends";break;case 3:searchType="all_friends";break;case 4:searchType=1==$scope.clubType?"all_friends":"club_members"}$scope.searchTags(s3,searchType,$scope.clubId,function(data){res=0,$scope.allTaggs=data.data})}else $scope.allTaggs={}}else len=0,$scope.allTaggs={}}),$scope.clearSearchedTagg=function(){$scope.allTaggs={}},$scope.searchTags=function(text,search_type,club_id,callback){var opts={};opts.user_id=APP.currentUser.id,opts.search_keyword=text,opts.search_type=search_type,opts.club_id=club_id,opts.limit_start=APP.user_list_pagination.start,opts.limit_size=APP.user_list_pagination.end,ProfileService.searchAllFriend(opts,function(data){callback(data)})},$scope.getFirstText=function(text){var s1=text.split("@");return s1[0]},$scope.getSecondText=function(text){var s1=text.split("@");return s1[1].substr(len,s1[1].length)},$scope.tagUser=function(item){var s=$scope.getFirstText($scope.commentText),l=$scope.getSecondText($scope.commentText),linkHtml='<a class="selected-tagg" href="#/viewfriend/'+item.id+'">'+item.firstname+" "+item.last_name+"</a>",finalText=s+" "+linkHtml+" "+l+"<br/>";$scope.commentText=finalText,$scope.taggedObject.user.push(item.id),$timeout(function(){$element.focus()},0),$scope.allTaggs={}},$scope.tagShop=function(item){var s=$scope.getFirstText($scope.commentText),l=$scope.getSecondText($scope.commentText),linkHtml='<a class="selected-tagg" href="#/shop/view/'+item.id+'">'+(item.name?item.name:item.business_name)+"</a>",finalText=s+" "+linkHtml+" "+l+"<br/>";$scope.commentText=finalText,$scope.taggedObject.shop.push(item.id),$timeout(function(){$element.focus()},0),$scope.allTaggs={}},$scope.tagClub=function(item){var s=$scope.getFirstText($scope.commentText),l=$scope.getSecondText($scope.commentText),linkHtml='<a class="selected-tagg" href="#/club/view/'+item.id+"/"+item.status+'">'+item.name+"</a>",finalText=s+" "+linkHtml+" "+l+"<br/>";$scope.commentText=finalText,$scope.taggedObject.club.push(item.id),$timeout(function(){$element.focus()},0),$scope.allTaggs={}}}}}]),app.directive("searchEditTagging",["$parse",function($parse){return{restrict:"EA",require:"ngModel",templateUrl:"app/views/tagg_list.html",controller:function($scope,$element,$sce,$compile,$attrs,$timeout,ProfileService){$scope.allTaggs={},$scope.taggedObject={};var user=[],club=[],shop=[];$scope.taggedObject.user=user,$scope.taggedObject.club=club,$scope.taggedObject.shop=shop;var len=0,modelGetter=$parse($attrs.ngModel);$scope.$watch($attrs.ngModel,function(){if(-1!=$scope.$eval($attrs.ngModel).indexOf("@")){len++;var s1=$scope.$eval($attrs.ngModel),s2=s1.substring(s1.indexOf("@")+1,$scope.$eval($attrs.ngModel).length),s3=s2.trim();s3=s3.substr(0,len-1);var res=1;if(s3.length>2){var searchType="all_friends",privacy=$scope.privacy?$scope.privacy:4;switch(privacy){case 1:searchType="personal_friends";break;case 2:searchType="professional_friends";break;case 3:searchType="all_friends";break;case 4:searchType=1==$scope.clubType?"all_friends":"club_members"}$scope.searchTags(s3,searchType,$scope.clubId,function(data){res=0,$scope.allTaggs=data.data})}else $scope.allTaggs={}}else len=0,$scope.allTaggs={}}),$scope.clearSearchedTagg=function(){$scope.allTaggs={}},$scope.searchTags=function(text,search_type,club_id,callback){var opts={};opts.user_id=APP.currentUser.id,opts.search_keyword=text,opts.search_type=search_type,opts.club_id=club_id,opts.limit_start=APP.user_list_pagination.start,opts.limit_size=APP.user_list_pagination.end,ProfileService.searchAllFriend(opts,function(data){callback(data)})},$scope.getFirstText=function(text){var s1=text.split("@");return s1[0]},$scope.getSecondText=function(text){var s1=text.split("@");return s1[1].substr(len,s1[1].length)},$scope.tagUser=function(item){var s=$scope.getFirstText($scope.$eval($attrs.ngModel)),l=$scope.getSecondText($scope.$eval($attrs.ngModel)),linkHtml='<a class="selected-tagg" href="#/viewfriend/'+item.id+'">'+item.firstname+" "+item.last_name+"</a>",finalText=s+" "+linkHtml+" "+l+"<br/>",modelSetter=modelGetter.assign;modelSetter($scope,finalText),$scope.taggedObject.user.push(item.id),$timeout(function(){$element.focus()},0),$scope.allTaggs={}},$scope.tagShop=function(item){var s=$scope.getFirstText($scope.$eval($attrs.ngModel)),l=$scope.getSecondText($scope.$eval($attrs.ngModel)),linkHtml='<a class="selected-tagg" href="#/shop/view/'+item.id+'">'+(item.name?item.name:item.business_name)+"</a>",finalText=s+" "+linkHtml+" "+l+"<br/>",modelSetter=modelGetter.assign;modelSetter($scope,finalText),$scope.taggedObject.shop.push(item.id),$timeout(function(){$element.focus()},0),$scope.allTaggs={}},$scope.tagClub=function(item){var s=$scope.getFirstText($scope.$eval($attrs.ngModel)),l=$scope.getSecondText($scope.$eval($attrs.ngModel)),linkHtml='<a class="selected-tagg" href="#/club/view/'+item.id+"/"+item.status+'">'+item.name+"</a>",finalText=s+" "+linkHtml+" "+l+"<br/>",modelSetter=modelGetter.assign;modelSetter($scope,finalText),$scope.taggedObject.club.push(item.id),$timeout(function(){$element.focus()},0),$scope.allTaggs={}}}}}]),app.directive("ngFileSelect",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.file=(e.srcElement||e.target).files[0],$scope.getFile()})}}}),app.directive("userBrokerProfile",["ProfileImageService",function(ProfileImageService){return{restrict:"E",link:function(scope){scope.brokerProfileLoader=!0;var brokerOpts={};brokerOpts.user_id=APP.currentUser.id,brokerOpts.profile_type=APP.profileType.brokerProfile,ProfileImageService.viewmultiprofiles(brokerOpts,function(data){101==data.code?(scope.brokerProfileLoader=!1,scope.brokerProfile=data.data):scope.brokerProfileLoader=!1})},templateUrl:"app/views/user_about_broker.html"}}]),app.directive("userCitizenProfile",["ProfileImageService",function(ProfileImageService){return{restrict:"E",link:function(scope){},templateUrl:"app/views/user_about_citizen.html"}}]),app.directive("userProfesstionalProfile",["ProfileImageService",function(ProfileImageService){return{restrict:"E",link:function(scope){},templateUrl:"app/views/user_about_professtional.html"}}]),app.directive("friendViewProfile",["ProfileImageService",function(ProfileImageService){return{restrict:"E",link:function(scope){},templateUrl:"app/views/friend_view_profile.html"}}]),app.directive("showErrors",function(){return{restrict:"A",require:"ngModel",link:function(scope,el,attrs,formCtrl){el.bind("focusout",function(){scope.$eval(attrs.ngModel)&&void 0!=scope.$eval(attrs.ngModel)?el.removeClass("has-error"):el.addClass("has-error")}),el.bind("focusin",function(){scope.$eval(attrs.ngModel)&&void 0!=scope.$eval(attrs.ngModel)?el.addClass("has-error"):el.removeClass("has-error")})}}}),app.directive("stopccp",function(){return{scope:{},link:function(scope,element){element.on("cut copy paste",function(event){event.preventDefault()})}}}),app.directive("creditDetail",["$http","CitizenWallet","$rootScope",function($http,CitizenWallet,$rootScope){return{restrict:"E",templateUrl:"app/views/citizen_credit_detail.html",scope:!0,link:function(scope){},controller:function($scope){$scope.total_income_loader=!0,$scope.total_credit_loader=!0,$scope.total_creditAc_loader=!0,$scope.total_creditBal_loader=!0,$rootScope.citizenAvailableBalance=0;var query={my_citizen_income:{$collection:"sixc_bucks",$filter:{citizen_id:APP.currentUser.id.toString()},$group:{_id:null,amount:{$sum:"$amount"},debit:{$sum:"$debit"},credit:{$sum:"$credit"}}},my_income:{$collection:"sixc_wallet",$group:{credit:{$sum:"$credit"},debit:{$sum:"$debit"},amount:{$sum:"$amount"},_id:null,$fields:!1},$filter:{citizen_id:APP.currentUser.id.toString(),"discount_type_id.name":{$in:["Dp"]}}}};CitizenWallet.getCitizenCredits(query,function(data){if("ok"===data.status&&200===data.code){$scope.total_income_loader=!1,$scope.total_credit_loader=!1,$scope.total_creditAc_loader=!1,$scope.total_creditBal_loader=!1;var my_citizen_income=data.response.my_citizen_income.result[0],my_income=data.response.my_income.result[0];my_citizen_income?($scope.total_income=my_citizen_income.amount,$scope.total_credit=my_citizen_income.credit,$rootScope.citizenAvailableBalance=0,$rootScope.citizenAvailableBalance=my_citizen_income.amount):($scope.total_income=0,$scope.total_credit=0),my_income?($scope.credit_active=my_income.credit,$scope.credit_balance=my_income.credit-my_income.debit):($scope.credit_active=0,$scope.credit_balance=0)}})}}}]),app.directive("shopCard",["$http","$rootScope","StoreService","CitizenWallet","focus","$filter","DateToMongoDate",function($http,$rootScope,StoreService,CitizenWallet,focus,$filter,DateToMongoDate){return{restrict:"E",templateUrl:"app/views/citizen_shop_card.html",scope:!0,link:function(scope){},controller:function($scope){$(".dateInput").datepicker({dateFormat:"dd-mm-yy"}),$scope.totalCardItemss50=0,$scope.totalCardItemss100=0,
$scope.totalCards50=0,$scope.totalCards100=0,$scope.range50=[],$scope.range100=[],$scope.firstPage50=6,$scope.firstPage100=6,$scope.itemsPerPage=6,$scope.currentPage50=1,$scope.currentPage100=1,$scope.shopingCardLoad1=!0,$scope.shopingCardLoad2=!0,$scope.startDate=$scope.i18n.citizen_wallet.from,$scope.endDate=$scope.i18n.citizen_wallet.to,$scope.filterObject={citizen_id:APP.currentUser.id.toString(),balance:{$gt:0}};{var currentDate=new Date;new Date(parseInt(currentDate.getFullYear())+50,9,27)}$scope.changePageMore50=function(pageNo){$scope.shopingCardLoad2=!0,$scope.currentPage50=pageNo,$scope.loadMore()},$scope.prevPage50=function(){$scope.currentPage50>1&&$scope.currentPage50--,$scope.shopingCardLoad2=!0,$scope.loadMore()},$scope.prevPageDisabled50=function(){return 1===$scope.currentPage50?"disabled":""},$scope.nextPage50=function(){$scope.currentPage50<$scope.totalCards50&&$scope.currentPage50++,$scope.shopingCardLoad2=!0,$scope.loadMore()},$scope.nextPageDisabled50=function(){return $scope.currentPage50===$scope.totalCards50?"disabled":""},$scope.changePageMore100=function(pageNo){$scope.shopingCardLoad1=!0,$scope.currentPage100=pageNo,$scope.loadMore()},$scope.prevPage100=function(){$scope.currentPage100>1&&$scope.currentPage100--,$scope.shopingCardLoad1=!0,$scope.loadMore()},$scope.prevPageDisabled100=function(){return 1===$scope.currentPage100?"disabled":""},$scope.nextPage100=function(){$scope.currentPage100<$scope.totalCards100&&$scope.currentPage100++,$scope.shopingCardLoad1=!0,$scope.loadMore()},$scope.nextPageDisabled100=function(){return $scope.currentPage100===$scope.totalCards100?"disabled":""},$scope.loadMore=function(){var limit_start50=($scope.currentPage50-1)*$scope.itemsPerPage,limit_start100=($scope.currentPage100-1)*$scope.itemsPerPage,query={my_wallet_upto100:{$collection:APP.applaneTables.citizenWalletCards,$fields:{credit:1,card_no:1,card_code:1,"shop_id.name":1,"shop_id.address_l1":1,"shop_id.address_l2":1,"shop_id.city":1,"shop_id.country":1,"shop_id.average_anonymous_rating":1,"shop_id.latitude":1,"shop_id.longitude":1,"shop_id.mobile_no":1,"shop_id.region":1,"shop_id.province":1,"shop_id.zip":1,"shop_id.streetaddress":1,"shop_id.email_address":1,"shop_id.web_address":1,from_date:1,to_date:1,balance:1},$filter:$scope.filterObject,$sort:{to_date:1},$limit:$scope.itemsPerPage,$skip:limit_start100},my_wallet_upto100_count:{$collection:APP.applaneTables.citizenWalletCards,$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filterObject},my_wallet_upto50:{$collection:APP.applaneTables.citizenWalletCards,$fields:{credit:1,card_no:1,card_code:1,"shop_id.name":1,"shop_id.address_l1":1,"shop_id.address_l2":1,"shop_id.city":1,"shop_id.country":1,"shop_id.average_anonymous_rating":1,"shop_id.latitude":1,"shop_id.longitude":1,"shop_id.mobile_no":1,"shop_id.region":1,"shop_id.province":1,"shop_id.zip":1,"shop_id.streetaddress":1,"shop_id.email_address":1,"shop_id.web_address":1,from_date:1,to_date:1,balance:1},$filter:$scope.filterObject,$sort:{to_date:1},$limit:$scope.itemsPerPage,$skip:limit_start50},my_wallet_upto50_count:{$collection:APP.applaneTables.citizenWalletCards,$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filterObject}};if(query.my_wallet_upto100){var for100obj=JSON.parse(JSON.stringify(query.my_wallet_upto100.$filter));for100obj.type="551ce49e2aa8f00f20d93295",query.my_wallet_upto100.$filter=for100obj;var for100objCount=JSON.parse(JSON.stringify(query.my_wallet_upto100_count.$filter));for100objCount.type="551ce49e2aa8f00f20d93295",query.my_wallet_upto100_count.$filter=for100objCount,query.my_wallet_upto100_count.$filter=for100objCount}if(query.my_wallet_upto50){var for50obj=JSON.parse(JSON.stringify(query.my_wallet_upto50.$filter));for50obj.type="551ce49e2aa8f00f20d93293",query.my_wallet_upto50.$filter=for50obj;var for50objCount=JSON.parse(JSON.stringify(query.my_wallet_upto50_count.$filter));for50objCount.type="551ce49e2aa8f00f20d93293",query.my_wallet_upto50_count.$filter=for50objCount,query.my_wallet_upto50_count.$filter=for50objCount}CitizenWallet.getCitizenDetails(query,function(data){if($scope.shopingCardLoad1=!1,$scope.shopingCardLoad2=!1,"ok"===data.status&&200===data.code){$scope.totalCardItemss50=data.response.my_wallet_upto50_count.result[0]?data.response.my_wallet_upto50_count.result[0].count:0,$scope.totalCardItemss100=data.response.my_wallet_upto100_count.result[0]?data.response.my_wallet_upto100_count.result[0].count:0,$scope.totalCards50=Math.ceil($scope.totalCardItemss50/$scope.itemsPerPage),$scope.totalCards100=Math.ceil($scope.totalCardItemss100/$scope.itemsPerPage),$scope.range50=[],$scope.range100=[];for(var i=1;i<=$scope.totalCards50;i++)$scope.range50.push(i);for(var i=1;i<=$scope.totalCards100;i++)$scope.range100.push(i);$scope.shopCards100=data.response.my_wallet_upto100.result,$scope.shopCards50=data.response.my_wallet_upto50.result}else $scope.shopCards100=[],$scope.shopCards50=[],$scope.totalCardItemss50=0,$scope.totalCardItemss100=0})},$scope.loadMore();for(var i=1;i<=$scope.paging;i++)$scope.range.push(i);$scope.ratingConvert=function(rate,count){var rateArray=[];if(count){rate=rate?rate:0,rate-Math.floor(rate)>0&&(count-=1);for(var i=0;i<count-Math.floor(rate);i++)rateArray.push(i);return rateArray}if(rate){rate=Math.floor(rate);for(var i=0;rate>i;i++)rateArray.push(i);return rateArray}},$scope.convertToInt=function(floatVal){return Math.floor(floatVal)},$scope.cardSearch=function(){void 0!==$scope.searchValue&&""!==$scope.searchValue?$scope.filterObject["shop_id.name"]={$regex:$scope.searchValue,$options:"$i"}:$scope.filterObject["shop_id.name"]=void 0,$scope.filterObject.to_date={};for(var i=0;i<$(".form-control").length;i++)"opened1"===angular.element(".form-control")[i].getAttribute("is-open")&&angular.element(angular.element(".form-control")[i]).val().length>0&&($scope.filterObject.to_date.$gte=DateToMongoDate.dateToIso(angular.element(angular.element(".form-control")[i]).val())),"opened2"===angular.element(".form-control")[i].getAttribute("is-open")&&angular.element(angular.element(".form-control")[i]).val().length>0&&($scope.filterObject.to_date.$lte=DateToMongoDate.dateToIso(angular.element(angular.element(".form-control")[i]).val()));void 0===$scope.filterObject.to_date.$gte&&void 0===$scope.filterObject.to_date.$lte&&($scope.filterObject.to_date=void 0),$scope.shopingCardLoad1=!0,$scope.shopingCardLoad2=!0,$scope.totalCardItemss50=0,$scope.totalCardItemss100=0,$scope.totalCards50=0,$scope.totalCards100=0,$scope.range50=[],$scope.range100=[],$scope.firstPage50=6,$scope.firstPage100=6,$scope.itemsPerPage=6,$scope.currentPage50=1,$scope.currentPage100=1,$scope.loadMore()},$scope.clearSearch=function(){$scope.searchValue="",$scope.searchFrom="",$scope.searchTo="",angular.element(".form-control").val(""),$scope.shopingCardLoad1=!0,$scope.shopingCardLoad2=!0,$scope.totalCardItemss50=0,$scope.totalCardItemss100=0,$scope.totalCards50=0,$scope.totalCards100=0,$scope.range50=[],$scope.range100=[],$scope.firstPage50=6,$scope.firstPage100=6,$scope.itemsPerPage=6,$scope.currentPage50=1,$scope.currentPage100=1,$scope.filterObject={citizen_id:APP.currentUser.id.toString(),balance:{$gt:0}},$scope.loadMore()}}}}]),app.directive("coupon",["$http","CitizenWallet","focus","DateToMongoDate",function($http,CitizenWallet,focus,DateToMongoDate){return{restrict:"E",templateUrl:"app/views/citizen_coupon.html",scope:!0,link:function(scope){},controller:function($scope){$(".dateInput").datepicker({dateFormat:"dd-mm-yy"}),$scope.predicate="to_date",$scope.reverse=!1,$scope.citizenCouponLoader=!0,$scope.noCitizenCouponFound=!0,$scope.firstPage=APP.walletItemPerPage.perPage,$scope.itemsPerPage=APP.walletItemPerPage.perPage,$scope.currentPage=1,$scope.range=[],$scope.totalCoupon=0,$scope.fiveStar=[1,2,3,4,5],$scope.loadingCitizenCouon=!1,$scope.startDate=$scope.i18n.citizen_wallet.from,$scope.endDate=$scope.i18n.citizen_wallet.to,$scope.filterObject={credit:{$gt:0},balance:{$gt:0},citizen_id:APP.currentUser.id.toString(),type:"551ce49e2aa8f00f20d9328f"},$scope.changePageMore=function(pageNo){$scope.currentPage=pageNo,$scope.loadMore()},$scope.prevPage=function(){$scope.currentPage>1&&$scope.currentPage--,$scope.loadMore()},$scope.prevPageDisabled=function(){return 1===$scope.currentPage?"disabled":""},$scope.nextPage=function(){$scope.currentPage<$scope.totalItems&&$scope.currentPage++,$scope.loadMore()},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.totalItems?"disabled":""},$scope.loadMore=function(){var limit_start=($scope.currentPage-1)*$scope.itemsPerPage;$scope.loadingCitizenCouon=!0;var query={my_wallet_coupons:{$collection:APP.applaneTables.citizenWallet,$fields:{credit:1,discount:1,"shop_id.name":1,"shop_id.address_l1":1,"shop_id.address_l2":1,"shop_id.city":1,"shop_id.country":1,"shop_id.average_anonymous_rating":1,"shop_id.latitude":1,"shop_id.longitude":1,"shop_id.mobile_no":1,"shop_id.region":1,"shop_id.province":1,"shop_id.zip":1,"shop_id.streetaddress":1,"shop_id.email_address":1,"shop_id.web_address":1,from_date:1,to_date:1,balance:1},$filter:$scope.filterObject,$sort:{to_date:1},$limit:$scope.itemsPerPage,$skip:limit_start},my_wallet_coupons_count:{$collection:APP.applaneTables.citizenWallet,$group:{count:{$sum:1},_id:null,$fields:!1},$filter:$scope.filterObject}};CitizenWallet.getCitizenWalletCoupons(query,function(data){if($scope.loadingCitizenCouon=!1,$scope.citizenCouponLoader=!1,"ok"===data.status&&200===data.code){if(data.response.my_wallet_coupons.result.length){$scope.shopCoupons=data.response,$scope.totalCoupon=data.response.my_wallet_coupons_count.result[0].count,$scope.totalItems=Math.ceil($scope.totalCoupon/$scope.itemsPerPage),$scope.range=[];for(var i=1;i<=$scope.totalItems;i++)$scope.range.push(i)}else $scope.shopCoupons=[],$scope.totalCoupon=0,$scope.totalItems=0,$scope.range=[];$scope.noCitizenCouponFound=!1}else $scope.noCitizenCouponFound=!0,$scope.shopCoupons=[]})},$scope.loadMore(),$scope.searchCoupons=function(){void 0!==$scope.searchText&&$scope.searchText.length>0?$scope.filterObject.$or=[{"shop_id.name":{$regex:$scope.searchText,$options:"i"}},{"offer_id.keywords.name":{$regex:$scope.searchText,$options:"i"}}]:$scope.filterObject.$or=void 0,$scope.filterObject.to_date={};for(var i=0;i<$(".form-control").length;i++)"opened1"===angular.element(".form-control")[i].getAttribute("is-open")&&angular.element(angular.element(".form-control")[i]).val().length>0&&($scope.filterObject.to_date.$gte=DateToMongoDate.dateToIso(angular.element(angular.element(".form-control")[i]).val())),"opened2"===angular.element(".form-control")[i].getAttribute("is-open")&&angular.element(angular.element(".form-control")[i]).val().length>0&&($scope.filterObject.to_date.$lte=DateToMongoDate.dateToIso(angular.element(angular.element(".form-control")[i]).val()));void 0===$scope.filterObject.to_date.$gte&&void 0===$scope.filterObject.to_date.$lte&&($scope.filterObject.to_date=void 0),$scope.currentPage=1,$scope.range=[],$scope.loadMore()},$scope.clearSearch=function(){$scope.filterObject={},$scope.searchText=void 0,$scope.fromDate=void 0,$scope.toDate=void 0,angular.element(".form-control").val(""),$scope.filterObject={credit:{$gt:0},balance:{$gt:0},citizen_id:APP.currentUser.id.toString(),type:"551ce49e2aa8f00f20d9328f"},$scope.currentPage=1,$scope.range=[],$scope.loadMore()},$scope.ratingConvert=function(rate,count){var rateArray=[];if(count){rate=rate?rate:0,rate-Math.floor(rate)>0&&(count-=1);for(var i=0;i<count-Math.floor(rate);i++)rateArray.push(i);return rateArray}if(rate){rate=Math.floor(rate);for(var i=0;rate>i;i++)rateArray.push(i);return rateArray}},$scope.convertToInt=function(floatVal){return Math.floor(floatVal)}}}}]),app.directive("transactionHistory",["$http","CitizenWallet","$rootScope",function($http,CitizenWallet,$rootScope){return{restrict:"E",templateUrl:"app/views/citizen_transaction_history.html",scope:!0,link:function(scope){},controller:function($scope){$scope.oneAtATime=!0,$scope.trans_history=[{date:new Date(2011,6,20).toDateString(),credit_recevied:1e4,credit_used:100,credit_type:" a Credito sixth continent"},{date:new Date(2002,7,31).toDateString(),credit_recevied:1e3,credit_used:200,credit_type:" b Credito sixth continent"},{date:new Date(2002,9,31).toDateString(),credit_recevied:1e5,credit_used:10,credit_type:"a Credito sixth continent"},{date:new Date(2102,7,31).toDateString(),credit_recevied:100,credit_used:1e4,credit_type:"bb Credito sixth continent"},{date:new Date(2002,7,6).toDateString(),credit_recevied:1e6,credit_used:100,credit_type:"cc Credito sixth continent"}],$scope.openContnetDetail=function(){$scope.detailContent="Hello Guys"},$scope.getIncome=function(){var incomeReq={$collection:"sixc_bucks",$filter:{citizen_id:APP.currentUser.id.toString()},$group:{_id:null,amount:{$sum:"$amount"},debit:{$sum:"$debit"},credit:{$sum:"$credit"}}};CitizenWallet.getCitizenIncome(incomeReq,function(data){data.response.result.length>0?$rootScope.citizenAvailableBalance=data.response.result[0].amount:$rootScope.citizenAvailableBalance=0})},$rootScope.citizenAvailableBalance||$scope.getIncome(),$scope.historyLoader=!1,$scope.historyLimit=10,$scope.skip=0,$scope.firstLoad=!0,$scope.getCitizenHistory=function(){$scope.firstLoad===!0?($scope.historyLoader=!0,$scope.firstLoad=!1):$scope.paginationLoader=!0;var historyReq={citizenWalletHistoryRecord:{$collection:APP.applaneTables.sixc_bucks_wallet,$group:{_id:{record_from:"$record_from",group_column:"$group_column",date:{date:{$dayOfMonth:"$date"},month:{$month:"$date"},year:{$year:"$date"}}},$filter:{credit:{$gt:0}},record_from:{$first:"$record_from"},group_column:{$first:"$group_column"},citizen_transaction_id:{$first:"$citizen_transaction_id"},credit:{$sum:"$credit"},transaction_value:{$sum:"$transaction_value"},date:{$first:"$date"},$fields:!1,$sort:{date:-1}},$filter:{group_column:{$nin:["Shopping Card Upto 50%","Shopping Card Upto 100%","Coupon"]},record_from:{$exists:!0},citizen_id:APP.currentUser.id.toString()},$limit:$scope.historyLimit,$skip:$scope.skip},citizenWalletHistoryCount:{$collection:APP.applaneTables.sixc_bucks_wallet,$group:[{_id:{record_from:"$record_from",group_column:"$group_column",date:{date:{$dayOfMonth:"$date"},month:{$month:"$date"},year:{$year:"$date"}}},$filter:{credit:{$gt:0}},record_from:{$first:"$record_from"},group_column:{$first:"$group_column"},citizen_transaction_id:{$first:"$citizen_transaction_id"},credit:{$sum:"$credit"},transaction_value:{$sum:"$transaction_value"},date:{$first:"$date"},$fields:!1},{_id:null,count:{$sum:1}}],$filter:{group_column:{$nin:["Shopping Card Upto 50%","Shopping Card Upto 100%","Coupon"]},record_from:{$exists:!0},citizen_id:APP.currentUser.id.toString()}}};CitizenWallet.getCitizenWalletHistory(historyReq,function(data){if("ok"===data.status&&200==data.code){if($scope.citizenHistory=data.response.citizenWalletHistoryRecord.result,$scope.historyLoader=!1,data.response.citizenWalletHistoryCount.result.length>0&&data.response.citizenWalletHistoryCount.result[0].count>$scope.itemsPerPage){$scope.list=0,$scope.range=[],$scope.pagination=!0,$scope.paginationLoader=!1,$scope.list=data.response.citizenWalletHistoryCount.result[0].count-1;for(var i=0;i<$scope.list/$scope.itemsPerPage;i++)$scope.range.push(i)}}else $scope.pagination=!1,$scope.list=0,$scope.range=[],$scope.historyLoader=!1})},$scope.getCitizenHistory(),$scope.currentDate=new Date,$scope.itemsPerPage=10,$scope.currentPage=0,$scope.pagination=!1,$scope.list=0,$scope.range=[],$scope.historyLimit=10,$scope.skip=0,$scope.prevPage=function(page){$scope.currentPage>0&&($scope.currentPage--,$scope.loadMoreHistory($scope.currentPage))},$scope.loadMoreHistory=function(index){0!==index?$scope.skip=(index-1)*$scope.itemsPerPage:$scope.skip=0,$scope.historyLimit=$scope.itemsPerPage,$scope.getCitizenHistory()},$scope.prevPageDisabled=function(){return 0===$scope.currentPage?"disabled":""},$scope.pageCount=function(){return void 0!==$scope.list?Math.ceil($scope.list/$scope.itemsPerPage)-1:void 0},$scope.nextPage=function(page){$scope.currentPage<$scope.pageCount()&&($scope.currentPage++,$scope.loadMoreHistory($scope.currentPage+1))},$scope.nextPageDisabled=function(){return $scope.currentPage===$scope.pageCount()?"disabled":""},$scope.setPage=function(n){$scope.currentPage=n}}}}]),app.factory("focus",function($timeout){return function(id){$timeout(function(){var element=document.getElementById(id);element&&element.focus()},400)}}),app.factory("DateToMongoDate",function(){return{dateToIso:function(sourceDate){if(!sourceDate)return"";var currentData=(new Date,sourceDate.split("-")),dateObj=new Date(currentData[2],currentData[1]-1,currentData[0]);return dateObj.toISOString()}}}),app.factory("LandURL",["$location","$route",function($location,$route){return{sendTo:function(targetUrl){$location.path()!==targetUrl?$location.path(targetUrl):$route.reload()}}}]),app.filter("newlines",function(){return function(text,length,postType,seeText,postId){var splitTxt=[],tempStr="",tempPrev="",tempText=text;if(""!==text&&void 0!=text){if(1==postType){var arr=text.split('<div id="previewImages_lp1" '),regex=/src="([^"]+)"/,tempVal=arr[0],src=tempVal.split(regex)[1];tempVal=tempVal.replace(/(<iframe[^>]+>)|(<\/iframe>)/gi,src);var tempText=tempVal;if(void 0!=arr[1])var tempPrev=(text.indexOf('<div id="previewImages_lp1" '),'<p></p><div id="previewImages_lp1" '+arr[1])}tempRmLink=tempText.replace(/(<a[^>]+>)|(<\/a>)/gi,"");var str=$.trim(tempRmLink.replace(/\n\n\n+/g,"\n\n"));if(splitTxt=str.split(/\n/g),tempStr=splitTxt.shift()+"\n",""!==tempStr&&splitTxt.length>4)for(i=0;i<4;i++)tempStr+="<br />"+splitTxt.shift();else tempStr=str.replace(/\n/g,"<br />");return isNaN(length)&&(length=10),end="<a class='morelink' href='javascript:void(0);' postid='"+postId+"' postType='"+postType+"'>"+seeText+"</a>",(tempStr.length<=length||tempStr.length-end.length<=length)&&splitTxt.length<3?(replacePattern1=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,tempStr=tempStr.replace(replacePattern1,'<a class="sitelink" href="$1" target="_blank">$1</a>'),replacePattern2=/(^|[^\/f])(www\.[\S]+(\b|$))/gim,tempStr=tempStr.replace(replacePattern2,'$1 <a class="sitelink" href="http://$2" target="_blank">$2</a>'),HTMLtoXML(tempStr+tempPrev)):(replacePattern1=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,tempStr=tempStr.replace(replacePattern1,'<a class="sitelink" href="$1" target="_blank">$1</a>'),replacePattern2=/(^|[^\/f])(www\.[\S]+(\b|$))/gim,tempStr=tempStr.replace(replacePattern2,'$1 <a class="sitelink" href="http://$2" target="_blank">$2</a>'),HTMLtoXML(String(tempStr).substring(0,length-end.length)+end+tempPrev))}return tempStr}}),app.filter("dateFormat",function($filter){return function(datetext){if(null==datetext)return"";var _date=$filter("date")(new Date(datetext.replace(/-/g,"/")),"dd-MM-yyyy");return _date.toUpperCase()}}),app.filter("panFormat",function(){return function(panNumber){return null==panNumber?"":panNumber.substr(-4,4)}}),app.filter("expirationPanFormat",function(){return function(expirDate){if(null==expirDate)return"";var month=expirDate.substr(-2,2),year=expirDate.substring(0,expirDate.length-2),formatPan=month+"/"+year;return formatPan}}),app.filter("activateLink",function(){return function(text){var tempText=text;return tempText=tempText.replace(/ /g," "),replacePattern1=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,tempText=tempText.replace(replacePattern1,'<a class="sitelink" href="$1" target="_blank">$1</a>'),replacePattern2=/(^|[^\/f])(www\.[\S]+(\b|$))/gim,tempText=tempText.replace(replacePattern2,'$1 <a class="sitelink" href="http://$2" target="_blank">$2</a>')}}),app.filter("postDateFormat",function($filter){return function(input){if(null==input)return"";var date1=input.trim().split(" "),finaldate=date1[0]+"T"+date1[1],_pdate=$filter("date")(finaldate,"dd MMM | HH:mm");return _pdate}}),app.filter("monthYearDateFormat",function(){return function(dateText){var monthName=["January","February","March","April","May","June","July","August","September","October","November","December"];return monthName[parseInt(dateText.substring(5,7))-1]+"-"+dateText.substring(0,4)}}),app.filter("reverse",function(){return function(items){return items.slice().reverse()}}),app.filter("formatNum",function(){return function(num){return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1.")}}),app.filter("truncateNum",function(){return function(trunnumber){if(!trunnumber||void 0===trunnumber)return 0;var num=trunnumber.toString();return num.indexOf(".")>0&&(num=num.slice(0,num.indexOf(".")+3)),num}}),app.filter("hobbyList",function(){return function(text){return void 0!=text&&""!=text?text.split(","):text}}),app.filter("historyDetailDate",function($filter){return function(input){if(null==input)return"";var _pdate=$filter("date")(new Date(input),"dd/mm/yy:HH:mm");return _pdate}}),app.filter("historyListDate",function($filter){return function(input){if(null==input)return"";var _pdate=$filter("date")(new Date(input),"dd-MM-yyyy");return _pdate}}),app.filter("dateFormat",function($filter){return function(input){if(null==input)return"";var _pdate=input.substring(8,10)+input.substring(4,7)+"-"+input.substring(0,4);return _pdate}}),app.filter("discountFilter",function($filter){return function(input){return null==input?"0%":input+"%"}}),app.filter("txnPrgsDate",function($filter){return function(input){if(null==input)return"";var _pdate=$filter("date")(new Date(input),"hh:mm a dd MMM yyyy");return _pdate}}),app.filter("paypalDate",function($filter){return function(input){if(null==input)return"";var _pdate=$filter("date")(new Date(input),"dd-MM-yyyy");return _pdate}}),app.filter("paginationFilter",function(){return function(input,start){return start=start||0,input=input||"",start=parseInt(start,10),void 0!==start&&void 0!==input?input.slice(start):""}}),app.filter("spliceChar",function(){return function(input,limit){var limit=4;return void 0!==limit&&void 0!==input?input.substr(input.length-limit):""}}),app.filter("setDecimal",function($filter){return function(input){return isNaN(input)?input:input.toFixed(3)}}),app.service("SingleMediaDetailService",function($http,$timeout){return{getMediaInfo:function(opt,callback){var url=APP.service.singlephotomediadetails+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},addImgModalComment:function(opt,callback){var url=APP.service.addComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},DeleteImgModalComment:function(opt,callback){var url=APP.service.DeleteComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},ModifyImgModalComment:function(opt,callback){var url=APP.service.ModifyComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}),app.service("AffiliatedkService",["$http","$timeout",function($http,$timeout){return{getCitizenAffiliates:function(opt,callback){var url=APP.service.getCitizenAffiliates+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getBrokerAffiliates:function(opt,callback){var url=APP.service.getBrokerAffiliates+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getShopAffiliates:function(opt,callback){var url=APP.service.getShopAffiliates+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getCitizenAffiliateCount:function(opt,callback){var url=APP.service.getCitizenAffiliateCount+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getShopAffiliateCount:function(opt,callback){var url=APP.service.getShopAffiliateCount+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getBrokerAffiliateCount:function(opt,callback){var url=APP.service.getBrokerAffiliateCount+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getAllcounts:function(opt,callback){var url=APP.service.getAllcounts+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("AlbumService",["$http","$q",function($http,$q){return{createAlbum:function(opt,callback){var url=APP.service.createAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},uploadmediaAlbum:function(opt,file,callback){var url=APP.service.uploadmediaAlbum+"?access_token="+APP.accessToken;doPostUploadWithMedia($http,url,opt,file,function(data){callback(data)})},finalMediaAlbum:function(opt,callback){var url=APP.service.uploadmediaAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},albumListing:function(opt,callback){var url=APP.service.albumListing+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteAlbum:function(opt,callback){var url=APP.service.deleteAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},viewAlbum:function(opt,callback){var url=APP.service.viewAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},countPhoto:function(opt,callback){var url=APP.service.countPhoto+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteMediaAlbum:function(opt,callback){var url=APP.service.deleteMediaAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},setuserprofileimages:function(opt,callback){var url=APP.service.setuserprofileimages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},friendSuggest:function(opt,callback){var url=APP.service.searchFriends+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},photoTaging:function(opt,callback){var url=APP.service.tagAblumPhoto+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getTaggedPhoto:function(opt,callback){var url=APP.service.getTaggedPhoto+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},removeTaggedPhoto:function(opt,callback){var url=APP.service.removeTaggedPhoto+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateAlbum:function(opt,callback){var url=APP.service.updateAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("BLShopService",["$http",function($http){return{getPublicShops:function(opt,callback){var url=APP.service.getblShops;doPost($http,url,opt,function(data){callback(data)})},getShopsDetail:function(opt,callback){var url=APP.service.getblDetailShops;doPost($http,url,opt,function(data){callback(data)})},getShopAlbumDetail:function(opt,callback){var url=APP.service.getblAlbumDetailShops;doPost($http,url,opt,function(data){callback(data)})},getShopPostDetail:function(opt,callback){var url=APP.service.getblPostDetailShops;doPost($http,url,opt,function(data){callback(data)})},getShopPicturesDetail:function(opt,callback){var url=APP.service.getblPicturesList;doPost($http,url,opt,function(data){callback(data)})},getSearchStoreDetail:function(opt,callback){var url=APP.service.getSearchStoreDetail;doPost($http,url,opt,function(data){callback(data)})},getCommentsStoreDetail:function(opt,callback){var url=APP.service.getCommentsStoreDetail;doPost($http,url,opt,function(data){callback(data)})},getMapPublicDetail:function(opt,callback){var url=APP.service.getMapPublicDetail;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("BrokerProfileService",["$http","$q",function($http,$q){return{brokerMultiprofile:function(opt,callback){var url=APP.service.brokerMultiprofile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("CitizenWallet",["$http","$q",function($http,$q){return{getCitizenCredits:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getCitizenDetails:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getCitizenWalletCoupons:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getCitizenWalletHistory:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getCitizenIncome:function(opt,callback){var url=APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})}}}]),app.service("storeHistorySelection",["$location",function($location){var storage=!1;return{storeTodayYouGain:function(){storage=!0,$location.path("/wallets")},getStoreage:function(){return storage},clearStorage:function(){storage=!1}}}]),app.service("CommerialService",["$http","$timeout",function($http,$timeout){return{launchCoupens:function(formData,callback){var url=APP.service.getUserGroups+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},varifyPaypal:function(formData,callback){var url=APP.service.verifiePaypals+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},getSubscription:function(formData,callback){var url=APP.service.getSubscriptionpaymentUrl+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},unSubscribes:function(formData,callback){var url=APP.service.unSubscribes+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},returnPaymentCancel:function(formData,callback){var url=APP.service.returnPaymentCancel+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("GroupService",["$http","$timeout",function($http,$timeout){return{getUserGroups:function(formData,callback){var url=APP.service.getUserGroups+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},getInviteGroups:function(formData,callback){var url=APP.service.getInviteGroups+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},createGroup:function(opt,file,callback){var url=APP.service.createGroup+"?access_token="+APP.accessToken;doPostWithFile($http,url,opt,file,function(data){callback(data)})},updateGroup:function(opt,file,callback){var url=APP.service.updateGroup+"?access_token="+APP.accessToken;doPostWithFile($http,url,opt,file,function(data){callback(data)})},deleteGroup:function(formData,callback){var url=APP.service.deleteGroup+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},getGroupDetail:function(opt,callback){var url=APP.service.getGroupDetail+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchGroup:function(formData,callback){{var url=APP.service.searchGroup+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})}},getAllClubNotifications:function(opt,callback){var url=APP.service.getPublicGroupNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},responseClubNotification:function(opt,callback){var url=APP.service.responseClubNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getGroupNotifications:function(opt,callback){
{var url=APP.service.getSpecificClubNotication+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}},responseGroupJoin:function(formData,callback){var url=APP.service.responseGroupJoin+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},assignRoleToGroup:function(formData,callback){var url=APP.service.assignRoleToGroup+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},joinPublicGroup:function(formData,callback){var url=APP.service.joinPublicGroup+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},joinPrivateGroups:function(formData,callback){var url=APP.service.joinPrivateGroups+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},createClubAlbum:function(opt,callback){var url=APP.service.createClubAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getClubAlbum:function(opt,callback){var url=APP.service.getClubAlbums+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteClubAlbum:function(opt,callback){var url=APP.service.deleteClubAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteClubAlbumMedia:function(opt,callback){var url=APP.service.deleteClubAlbumMedia+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},viewClubAlbum:function(opt,callback){var url=APP.service.viewClubAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},uploadMediaInClubAlbumFinal:function(opt,callback){var url=APP.service.uploadMediaInClubAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},uploadMediaInClubAlbum:function(opt,file,callback){var url=APP.service.uploadMediaInClubAlbum+"?access_token="+APP.accessToken;doPostWithClubAlbumMedia($http,url,opt,file,function(data){callback(data)})},setClubProfileImage:function(opt,callback){var url=APP.service.setClubProfileImage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},uploadClubCover:function(opt,file,callback){var url=APP.service.uploadClubCover+"?access_token="+APP.accessToken;doPostWithFile($http,url,opt,file,function(data){callback(data)})},unjoinclubs:function(opt,callback){var url=APP.service.unjoinclubs+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteClubMember:function(opt,callback){var url=APP.service.deleteClubMember+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getUserFriendGroups:function(formData,callback){var url=APP.service.getUserFriendGroups+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},cancelGroup:function(formData,callback){var url=APP.service.cancelinvitationlink+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},getClubPostDetail:function(formData,callback){var url=APP.service.getClubPostDetail+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},setClubMediaCoordinate:function(opt,callback){var url=APP.service.getClubMediaCoordinate+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("PostService",["$http",function($http){return{createPost:function(opt,callback){var url=APP.service.createGroupPost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listPost:function(opt,callback){var url=APP.service.listGroupPosts+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updatePost:function(opt,file,callback){var url=APP.service.updateGroupPost+"?access_token="+APP.accessToken;doPostPostOnGroupWithFile($http,url,opt,file,function(data){callback(data)})},deletePost:function(opt,callback){var url=APP.service.deleteGroupPost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deletePostMedia:function(opt,callback){var url=APP.service.deleteGroupPostMedia+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("CommentService",["$http",function($http){return{createCommentWithImage:function(opt,file,callback){var url=APP.service.createGroupComment+"?access_token="+APP.accessToken;doPostCommentOnGroupWithFile($http,url,opt,file,function(data){callback(data)})},createComment:function(opt,callback){var url=APP.service.createGroupComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listComment:function(opt,callback){var url=APP.service.listGroupComments+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateComment:function(opt,file,callback){var url=APP.service.updateGroupComment+"?access_token="+APP.accessToken;doPostCommentOnGroupWithFile($http,url,opt,file,function(data){callback(data)})},deleteComment:function(opt,callback){var url=APP.service.deleteGroupComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("MediaService",["$http","$q",function($http,$q){return{uploadmedia:function(opt,callback){var url=APP.service.uploadmedia;doPost($http,url,opt,function(data){callback(data)})},listmedia:function(opt,callback){var url=APP.service.listmedia;doPost($http,url,opt,function(data){callback(data)})},deletemedia:function(opt,callback){var url=APP.service.deletemedia;doPost($http,url,opt,function(data){callback(data)})},searchmedia:function(opt,callback){var url=APP.service.searchmedia;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("MessageService",["$http","$q",function($http,$q){return{createMessage:function(opt,file,callback){var url=APP.service.createMessage+"?access_token="+APP.accessToken;doPostReplyWithMedia($http,url,opt,file,function(data){callback(data)})},groupMessageSends:function(opt,file,callback){var url=APP.service.groupMessageSends+"?access_token="+APP.accessToken;doPostReplyWithMedia($http,url,opt,file,function(data){callback(data)})},deleteMessage:function(opt,callback){var url=APP.service.deleteMessage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteGroupMessages:function(opt,callback){var url=APP.service.deleteGroupMessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},messageListing:function(opt,callback){var url=APP.service.messageListing+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listGroupMessages:function(opt,callback){var url=APP.service.listGroupMessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},readMessage:function(opt,callback){var url=APP.service.readMessage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},readGroupMessages:function(opt,callback){var url=APP.service.readGroupMessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},replyMessage:function(opt,file,callback){var url=APP.service.replyMessage+"?access_token="+APP.accessToken;doPostReplyWithMedia($http,url,opt,file,function(data){callback(data)})},searchMessage:function(opt,callback){var url=APP.service.searchMessage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateMessage:function(opt,callback){var url=APP.service.updateMessage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},sendemailMessage:function(opt,callback){var url=APP.service.sendemailMessage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchFriends:function(opt,callback){var url=APP.service.searchFriends+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},messageInbox:function(opt,callback){var url=APP.service.messageInbox+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listGroupInbox:function(opt,callback){var url=APP.service.listGroupInbox+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchUserThread:function(opt,callback){var url=APP.service.searchUserThread+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listusermessages:function(opt,callback){var url=APP.service.listusermessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listUnReadMessages:function(opt,callback){var url=APP.service.listunreadmessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},markReadAllMessages:function(opt,callback){var url=APP.service.markreadallmessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getCurrentUserMessage:function(){return APP.currentUser},listGroupUnreadMessages:function(opt,callback){var url=APP.service.listGroupUnreadMessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listGroups:function(opt,callback){var url=APP.service.listgroups+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listGroupMessages:function(opt,callback){var url=APP.service.listGroupMessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchThreadMessages:function(opt,callback){var url=APP.service.searchThreadMessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},removeGroupUsers:function(opt,callback){var url=APP.service.removeGroupUsers+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("saveFriendId",function(){var thisFriendId=0,thisThreadList=0;return{saveFriend:function(friendId){thisFriendId=friendId},getFriendId:function(){return thisFriendId},saveTreadId:function(thread){thisThreadList=thread},getThreadId:function(){return thisThreadList}}}),app.service("saveFriendDate",function(){var friendData={};return{saveFriendObject:function(friendObject){friendData=friendObject},getFriendIdObject:function(){return friendData},clearFrindObject:function(){friendData={}}}}),app.service("threadAndPass",function(){var thisThreadId=0,thisFriend=0;return{saveThreadAndFriend:function(threadId,friendId){thisThreadId=threadId,thisFriend=friendId},getThread:function(){return thisThreadId},getFriend:function(){return thisFriend},clearThreadAndFriend:function(){thisThreadId=0,thisFriend=0}}}),app.service("NotificationService",["$http","$q",function($http,$q){return{sendEmailNotification:function(formData,callback){var url=APP.service.sendEmailNotification+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},getEmailNotification:function(formData,callback){var url=APP.service.getEmailNotification+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},readUnreadEmailNotifications:function(formData,callback){var url=APP.service.readUnreadEmailNotifications+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},deleteEmailNotifications:function(formData,callback){var url=APP.service.deleteEmailNotifications+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})},searchEmailNotifications:function(formData,callback){var url=APP.service.searchEmailNotifications+"?access_token="+APP.accessToken,opt=formData;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("OfferService",["$http",function($http){return{getApplaneData:function(opt,callback){var url=APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},addUpdateApplaneData:function(opt,callback){var url=APP.service.addUpdateApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},deleteShopOfferMedias:function(opt,callback){var url=APP.service.deleteShopOfferMedias+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchstoreondimensions:function(opt,callback){var url=APP.service.searchstoreondimensions+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getApplaneInvoke:function(opt,callback){var url=APP.service.getApplaneInvoke+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},buyshoppingcard:function(opt,callback){var url=APP.service.buyshoppingcard+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},responsebuycards:function(opt,callback){var url=APP.service.responsebuycards+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("ProfileService",["$http",function($http){return{getProfile:function(opt,callback){var url=APP.service.getProfile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchSuggestion:function(opt,callback){var url=APP.service.suggestionmultiprofiles+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},viewMultiProfile:function(opt,callback){var url=APP.service.viewMultiProfile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateProfileDetail:function(opt,idcard,ssn,callback){var url=APP.service.updatemultiprofiles+"?access_token="+APP.accessToken;updateProfileWithFiles($http,url,opt,idcard,ssn,function(data){callback(data)})},deleteProfile:function(opt,callback){var url=APP.service.deleteProfile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchUser:function(opt,callback){var url=APP.service.searchUser+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchFriend:function(opt,callback){var url=APP.service.searchFriend+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},friendProfileView:function(opt,callback){var url=APP.service.friendProfile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},dashboardPost:function(opt,callback){var url=APP.service.dashboardpost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getPendingFreindReq:function(opt,callback){var url=APP.service.getPendingFriendRequest+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},acceptFriendRequest:function(opt,callback){var url=APP.service.acceptDenyFriendReq+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},rejectFriendRequest:function(opt,callback){var url=APP.service.acceptDenyFriendReq+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},sendFriendRequests:function(opt,callback){var url=APP.service.sendFriendRequests+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listDashboardPost:function(opt,callback){var url=APP.service.listDashboardPost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteDashboardPost:function(opt,callback){var url=APP.service.deleteDashboardPost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateDashboardPost:function(opt,callback){var url=APP.service.updateDashboardPost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},createDashboardCommentImage:function(opt,file,callback){var url=APP.service.createDashboardComment+"?access_token="+APP.accessToken;doPostCommentOnDashboardWithFile($http,url,opt,file,function(data){callback(data)})},createDashboardCommentFinal:function(opt,callback){var url=APP.service.createDashboardComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},changePassword:function(opt,callback){var url=APP.service.changePassword+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteDashboardComment:function(opt,callback){var url=APP.service.deleteDashboardComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateDashboardComment:function(opt,callback){var url=APP.service.updateDashboardComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deletePostMedia:function(opt,callback){var url=APP.service.deletePostMedia+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteDashboardMediaComments:function(opt,callback){var url=APP.service.dashboardMediaDeleteComments+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},friendAlbumListing:function(opt,callback){var url=APP.service.albumListing+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},friendAlbumImage:function(opt,callback){var url=APP.service.viewAlbum+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listUnReadMessages:function(opt,callback){var url=APP.service.listGroupUnreadMessages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getDashboardComments:function(opt,callback){var url=APP.service.getDashboardComments+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},readMessage:function(opt,callback){var url=APP.service.readMessage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},uploadCoverPhoto:function(opt,file,callback){var url=APP.service.setUserProfileCover+"?access_token="+APP.accessToken;doPostUploadProfileMedia($http,url,opt,file,function(data){callback(data)})},getFollowers:function(opt,callback){var url=APP.service.getFollowers+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getFollowings:function(opt,callback){var url=APP.service.getFollowings+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},checkfollowUser:function(opt,callback){var url=APP.service.getCheckFollows+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},followUser:function(opt,callback){var url=APP.service.getFollowUser+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},unFollowUser:function(opt,callback){var url=APP.service.getUnFollowUser+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getClientInformation:function(opt,callback){var url=APP.service.getClientInformation+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getConnectedProfil:function(opt,callback){var url=APP.service.getConnectedProfile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getIfFriendRequestAccepted:function(opt,callback){var url=APP.service.getFriendAcceptedNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getIfClubRequestAccepted:function(opt,callback){var url=APP.service.getClubAcceptedNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getIfShopRequestAccepted:function(opt,callback){var url=APP.service.getIfShopRequestAccepted+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getIfBrokerRequestAccepted:function(opt,callback){var url=APP.service.getIfBrokerRequestAccepted+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},markReadNotification:function(opt,callback){var url=APP.service.markReadNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getShopAprovalRejectNoti:function(opt,callback){var url=APP.service.getShopAprovalRejectNoti+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getAllTypeNotification:function(opt,callback){var url=APP.service.getAllTypeNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getDashboardWallFeeds:function(opt,callback){var url=APP.service.getDashboardWallFeeds+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchAllProfile:function(opt,callback){var url=APP.service.getAllProfiles+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},saveUserEducation:function(opt,callback){var url=APP.service.saveUserEducation+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},saveUserProfession:function(opt,callback){var url=APP.service.saveUserProfession+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},saveRelative:function(opt,callback){var url=APP.service.saveRelative+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},selectFriend:function(opt,callback){var url=APP.service.selectFriend+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchCatagory:function(opt,callback){var url=APP.service.searchCatagory+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doPost($http,url,opt,function(data){callback(data)})},searchCatagoryKeyword:function(opt,callback){var url=APP.service.searchCatagoryKeyword+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},saveCategory:function(opt,callback){var url=APP.service.saveCategory+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getCategories:function(opt,callback){var url=APP.service.getCategory+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteCategory:function(opt,callback){var url=APP.service.deleteusercategorykeywords+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteProfession:function(opt,callback){var url=APP.service.deleteProfession+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteEducation:function(opt,callback){var url=APP.service.deleteEducation+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteRelative:function(opt,callback){var url=APP.service.deleteRelative+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getrelationtype:function(opt,callback){var url=APP.service.getrelationtype+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},addUserSkills:function(opt,callback){var url=APP.service.addUserSkills+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getUserSkills:function(opt,callback){var url=APP.service.getUserSkills+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateEducationVisibility:function(opt,callback){var url=APP.service.updateEducationVisibility+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateProfessionVisibility:function(opt,callback){var url=APP.service.updateProfessionaVisibility+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchFriends:function(opt,callback){var url=APP.service.searchFriends+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},removeTagedFriends:function(opt,callback){var url=APP.service.removeTaggedFriends+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},rateThis:function(opt,urlOption,callback){var url;"add"===urlOption?url=APP.service.rateThis+"?access_token="+APP.accessToken:"update"===urlOption&&(url=APP.service.updateRating+"?access_token="+APP.accessToken),doPost($http,url,opt,function(data){callback(data)})},removeRating:function(opt,callback){var url=APP.service.removeRating+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getDashboardPostDetail:function(opt,callback){var url=APP.service.getDashboardPostDetail+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},findPeople:function(opt,callback){var url=APP.service.findPeople+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},notificationCount:function(opt,callback){var url=APP.service.getAllTypeNotiCount+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getAllGroupNotification:function(opt,callback){var url=APP.service.getAllGroupNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchAllFriend:function(opt,callback){var url=APP.service.getTaggingFriend+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},markAsDelete:function(opt,callback){var url=APP.service.markDeleteNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getAllsearchProfiles:function(opt,callback){var url=APP.service.searchAllProfiles+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},friendRequestStatus:function(opt,callback){var url=APP.service.friendRequestStatus+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},sendMediaCoordinate:function(opt,callback){var url=APP.service.getMediaCoordinates+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},addKeywords:function(opt,callback){var url=APP.service.addKeywords+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateFbAccessToken:function(opt,callback){var url=APP.service.updateFbAccessToken+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updatePostPrivacy:function(opt,callback){var url=APP.service.updateDashboardPostACLs+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getTodayCredit:function(opts,callback){var url=APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opts,function(data){callback(data)})}}}]),app.service("ProfileImageService",["$http","$q",function($http,$q){return{uploaduserprofileimages:function(opt,file,callback){var url=APP.service.uploaduserprofileimages+"?access_token="+APP.accessToken;doPostUploadProfileMedia($http,url,opt,file,function(data){callback(data)})},viewmultiprofiles:function(opt,callback){var url=APP.service.viewmultiprofiles+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("PublicService",["$http","$timeout",function($http,$timeout){return{getPublicPost:function(opt,callback){var url=APP.service.getPublicPost;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("StoreService",["$http",function($http){var stId="",_stData="";return{getStore:function(opt,callback){var url=APP.service.getStore+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getAllStoreWithChild:function(opt,callback){var url=APP.service.getStoreWithChild+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},createStore:function(opt,callback){var url=APP.service.createStore+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},createChildStore:function(opt,callback){var url=APP.service.createChildStore+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateStore:function(opt,callback){var url=APP.service.updateStore+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getCountryList:function(opt,callback){var url=APP.service.getCountryList;doPost($http,url,opt,function(data){callback(data)})},deleteStore:function(opt,callback){var url=APP.service.deleteStore+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchStore:function(opt,callback){var url=APP.service.searchStore+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getStoreDetail:function(opt,callback){var url=APP.service.storeDetail+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getStoreNotifications:function(opt,callback){var url=APP.service.getStoreNotification+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},acceptDenyToStoreNotification:function(opt,callback){var url=APP.service.responseToStoreNoti+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getStoreOwnerId:function(opt){return stId},setStoreOwnerId:function(opt){stId=opt.storeId},setStoreProfileImage:function(opt,callback){var url=APP.service.setStoreProfileImage+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},uploadStoreProfileimage:function(opt,file,callback){var url=APP.service.uploadStoreProfileimage+"?access_token="+APP.accessToken;doUploadStoreProfilePost($http,url,opt,file,function(data){callback(data)})},searchUser:function(opt,callback){var url=APP.service.searchUser+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},inviteUserOnStore:function(opt,callback){var url=APP.service.inviteUserOnStore+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getMobileAppUrl:function(opt,callback){var url=APP.service.linkMobileApp+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doPost($http,url,opt,function(data){callback(data)})},getmapstores:function(opt,callback){var url=APP.service.getmapstores+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getStoreHistory:function(opt,callback){var url=APP.service.getStoreHistory+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},searchshoponmaps:function(opt,callback){var url=APP.service.searchshoponmaps+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getSubCategoryList:function(opt,callback){var url=APP.service.getBusinessCategoryList+"?session_id="+APP.currentUser.id;doPost($http,url,opt,function(data){callback(data)})},getLatestAlbumList:function(opt,callback){var url=APP.service.getLatestAlbumList+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doPost($http,url,opt,function(data){callback(data)})},getStorePostDetail:function(opt,callback){var url=APP.service.getShopPostDetail+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},setStoreMediaCoordinate:function(opt,callback){var url=APP.service.getStoreCoverMediaCoordinates+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getShops:function(opt,callback){var url=APP.service.getShops+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},favouritestores:function(opt,callback){var url=APP.service.favouritestores+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},myfavouritestores:function(opt,callback){var url=APP.service.myfavouritestores+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},unfavouritestores:function(opt,callback){var url=APP.service.unfavouritestores+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){
callback(data)})},listcustomersreviews:function(opt,callback){var url=APP.service.listcustomersreviews+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},removeShopTagg:function(opt,callback){var url=APP.service.removeShopTagg+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},followshops:function(opt,callback){var url=APP.service.followshops+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},unfollowshops:function(opt,callback){var url=APP.service.unfollowshops+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},userfollowingshops:function(opt,callback){var url=APP.service.userfollowingshops+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getfriendboughtonstores:function(opt,callback){var url=APP.service.getfriendboughtonstores+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},frindboughtcount:function(opt,callback){var url=APP.service.getApplaneInvoke+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},SetStoreData:function(opt){_stData=opt},getStoreData:function(){return _stData},getstorecredit:function(opt,callback){var url=APP.service.getApplaneInvoke+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getReportTransacation:function(opt,callback){var url=APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})}}}]),app.service("StoreCreditCard",["$http","$q",function($http,$q){return{getCreditCardLists:function(opt,callback){var url=APP.service.creditCardLists+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},setDefaultCard:function(opt,callback){var url=App.service.markDefaultCard+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteCard:function(opt,callback){var url=App.service.digitalDeleteCard+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("StoreCreditCard",["$http","$q",function($http,$q){return{getCreditCardLists:function(opt,callback){var url=APP.service.creditCardLists+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},setDefaultCard:function(opt,callback){var url=APP.service.markDefaultCard+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteCard:function(opt,callback){var url=APP.service.digitalDeleteCard+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getOnClickRecurringPayments:function(opt,callback){var url=APP.service.getOnClickRecurringPayments+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getOneClickPaymentUrls:function(opts,callback){var url=APP.service.createOneClickPaymentUrls+"?access_token="+APP.accessToken;doPost($http,url,opts,function(data){callback(data)})},getPaypalAccounts:function(opt,callback){var url=APP.service.getPaypalAccounts+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deletePaypalAccounts:function(opt,callback){var url=APP.service.deletePaypalAccount+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},setDefaultPaypalAccounts:function(opt,callback){var url=APP.service.setDefaultPaypalAccount+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("StorePaymentService",["$http",function($http){return{getOneClickPaymentUrls:function(opts,callback){var url=APP.service.createOneClickPaymentUrls+"?access_token="+APP.accessToken;doPost($http,url,opts,function(data){callback(data)})}}}]),app.service("StorePostService",["$http",function($http){return{createPost:function(opt,callback){var url=APP.service.createStorePost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listPost:function(opt,callback){var url=APP.service.listStorePost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updatePost:function(opt,file,callback){var url=APP.service.updateStorePost+"?access_token="+APP.accessToken;doPostUploadWithStoreMedia($http,url,opt,file,function(data){callback(data)})},deletePost:function(opt,callback){var url=APP.service.deleteStorePost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteMediaPost:function(opt,callback){var url=APP.service.deleteStoreMediasPost+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("StoreCommentService",["$http",function($http){return{createCommentWithImage:function(opt,file,callback){var url=APP.service.createStoreComment+"?access_token="+APP.accessToken;doPostCommentOnStoreWithFile($http,url,opt,file,function(data){callback(data)})},createComment:function(opt,callback){var url=APP.service.createStoreComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},listComment:function(opt,callback){var url=APP.service.listStoreComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateComment:function(opt,callback){var url=APP.service.updateStoreComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteComment:function(opt,callback){var url=APP.service.deleteStoreComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deleteMediaComment:function(opt,callback){var url=APP.service.deleteStoreMediaComment+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("ShopTransactionService",["$http",function($http){var _shopTxnTab={};return{getTransactions:function(opts,callback){var url=APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opts,function(data){callback(data)})},getTransactionDetail:function(opts,callback){var url=APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opts,function(data){callback(data)})},updateTransactionObject:function(opts,callback){var url=APP.service.addUpdateApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opts,function(data){callback(data)})},setTransactionTab:function(opts){_shopTxnTab=opts},getTransactionTab:function(){return _shopTxnTab}}}]),app.service("StoreWalletService",["$http",function($http){return{getStoreWallet:function(opt,callback){var url=APP.service.getStoreWallet+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getPaymentHistory:function(opt,callback){var url=APP.service.getPaymentHistory+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getStoreWalletApplane:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getPaymentHistoryApplane:function(opt,callback){var url=APP.service.addUpdateApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getShopPreniumHistoryApplane:function(opt,callback){var url=APP.service.getApplaneData+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getStoreWalletShoppingCard:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getStoreWalletCouponApplane:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getShopWalletHistory:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})},getStoreWalletHistoryApplane:function(opt,callback){var url=APP.service.batchApplane+"?access_token="+APP.accessToken+"&session_id="+APP.currentUser.id;doApplanePost($http,url,opt,function(data){callback(data)})}}}]),app.service("storeShopHistorySelection",["$location",function($location){var storage=!1;return{storeHistoryTab:function(shopId){storage=!0,$location.path("/shop/wallet/"+shopId)},getStorage:function(){return storage},clearStorage:function(){storage=!1}}}]),app.service("StoreAlbumService",["$http","$q",function($http,$q){return{createstorealbums:function(opt,callback){var url=APP.service.createstorealbums+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},uploadstoremediaalbums:function(opt,file,callback){var url=APP.service.uploadstoremediaalbums+"?access_token="+APP.accessToken;doPostUploadWithStoreMedia($http,url,opt,file,function(data){callback(data)})},uploadstoremediaalbumsfinal:function(opt,callback){var url=APP.service.uploadstoremediaalbums+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},storealbumlists:function(opt,callback){var url=APP.service.storealbumlists+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deletestorealbums:function(opt,callback){var url=APP.service.deletestorealbums+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},viewstorealbums:function(opt,callback){var url=APP.service.viewstorealbums+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},deletealbummedias:function(opt,callback){var url=APP.service.deletealbummedias+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("TopLinkService",["$http","$timeout",function($http,$timeout){var _affilate={},_noReferral=!1,_isAlreadyUserLogin={};return{getTopLinkedCitizen:function(opt,callback){var url=APP.service.getTopLinkedCitizen;doPost($http,url,opt,function(data){callback(data)})},getTopCitizenPerIncome:function(opt,callback){var url=APP.service.getTopCitizenPerIncome;doPost($http,url,opt,function(data){callback(data)})},getTopShopPerRevenue:function(opt,callback){var url=APP.service.getTopShopPerRevenue;doPost($http,url,opt,function(data){callback(data)})},inviteAffiliation:function(opt,callback){var url=APP.service.inviteAffiliation+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},setAffiliationObject:function(opt){_affilate=opt},getAffiliationObject:function(){return _affilate},setNoAffiliated:function(opt){_noReferral=opt},getNoAffiliated:function(){return _noReferral},setIsAlreadyUserLogin:function(opt){_isAlreadyUserLogin=opt},getIsAlreadyUserLogin:function(){return _isAlreadyUserLogin},checkIsValidAffiliation:function(opt,callback){var url=APP.service.checkValidUser;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("UserService",["$http","$q",function($http,$q){var _hitUrl="";return{getAccessToken:function(opts){return $http({method:"POST",url:APP.service.getAccessToken,data:opts,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).then(function(response){return"object"==typeof response.data?response.data:$q.reject(response.data)},function(response){return $q.reject(response.data)})},getLoginUser:function(opt,callback){var url=APP.service.logins+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getCurrentUser:function(){return APP.currentUser},isAuthenticated:function(){return 0!=Object.keys(APP.currentUser).length?!0:!1},logout:function(opt,callback){var url=APP.service.logout+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},forgotPassword:function(opt,callback){var url=APP.service.forgotPassword;doPost($http,url,opt,function(data){callback(data)})},resetPassword:function(opt,callback){var url=APP.service.resetPassword;doPost($http,url,opt,function(data){callback(data)})},registration:function(opt,callback){var url=APP.service.registration;doPost($http,url,opt,function(data){callback(data)})},getFacebookRegister:function(opt,callback){var url=APP.service.getFacebookRegister;doPost($http,url,opt,function(data){callback(data)})},mapfacebookuser:function(opt,callback){var url=APP.service.mapfacebookuser;doPost($http,url,opt,function(data){callback(data)})},registerMultiProfile:function(opt,callback){var url=APP.service.registerMultiProfile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getBasicProfile:function(opt,callback){var url=APP.service.viewMultiProfile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},setCurrentLang:function(opt,callback){var url=APP.service.changeCurrentLanguages+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},updateFbAccessToken:function(opt,callback){var url=APP.service.updateFbAccessToken+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getTotalEconomyShifted:function(opt,callback){var url=APP.service.getTotalEconomy;doPost($http,url,opt,function(data){callback(data)})},getCreditAndIncome:function(opt,callback){var url=APP.service.getCreditAndIncome;doPost($http,url,opt,function(data){callback(data)})},setHitUrl:function(opt){_hitUrl=opt},getHitUrl:function(){return _hitUrl},verifyAccount:function(opt,callback){var url=APP.service.verifyAccount;doPost($http,url,opt,function(data){callback(data)})},resendverificationmail:function(opt,callback){var url=APP.service.resendverificationmail;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("CreateBrokerService",["$http",function($http){return{createBroker:function(opt,callback){var url=APP.service.brokerMultiprofile+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("saveUserPass",function(){var thisusername="",thispassword="";return{saveUserPassword:function(username,password){thisusername=username,thispassword=password},getUsername:function(){return thisusername},getPassword:function(){return thispassword},clearUserPass:function(){}}}),app.factory("$remember",function(){function fetchValue(name){for(var gCookieVal=document.cookie.split("; "),i=0;i<gCookieVal.length;i++){var gCrumb=gCookieVal[i].split("=");if(name===gCrumb[0]){var value="";try{value=angular.fromJson(gCrumb[1])}catch(e){value=unescape(gCrumb[1])}return value}}return null}return function(name,values){if(1===arguments.length)return fetchValue(name);var cookie=name+"=";if("object"==typeof values){var expires="";if(cookie+="object"==typeof values.value?angular.toJson(values.value)+";":values.value+";",values.expires){var date=new Date;date.setTime(date.getTime()+24*values.expires*60*60*1e3),expires=date.toGMTString()}cookie+=values.session?"":"expires="+expires+";",cookie+=values.path?"path="+values.path+";":"",cookie+=values.secure?"secure;":""}else cookie+=values+";";document.cookie=cookie}}),app.service("UserWalletService",["$http",function($http){return{getCitizenWallet:function(opt,callback){var url=APP.service.getCitizenWallets+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})},getCitizenIncomes:function(opt,callback){var url=APP.service.getCitizenIncomes+"?access_token="+APP.accessToken;doPost($http,url,opt,function(data){callback(data)})}}}]),app.service("verifyUser",["$modal",function($modal){return{check:function(){TrailExpiredModal=!1;var modalInstance=$modal.open({templateUrl:"app/views/verify_modal.html",size:"lg",controller:"VerifyModal"});modalInstance.result.then(function(){},function(){angular.element(document.getElementById("AppController")).scope().logoutWithoutService()})}}}]);